var app=function(){"use strict";function t(){}function e(t,e){for(const n in e)t[n]=e[n];return t}function n(t){return t()}function r(){return Object.create(null)}function i(t){t.forEach(n)}function o(t){return"function"==typeof t}function a(t,e){return t!=t?e==e:t!==e||t&&"object"==typeof t||"function"==typeof t}function s(t,e,n){if(t){const r=u(t,e,n);return t[0](r)}}function u(t,n,r){return t[1]?e({},e(n.$$scope.ctx,t[1](r?r(n):{}))):n.$$scope.ctx}function c(t,n,r,i){return t[1]?e({},e(n.$$scope.changed||{},t[1](i?i(r):{}))):n.$$scope.changed||{}}function h(t,e){t.appendChild(e)}function l(t,e,n){t.insertBefore(e,n||null)}function f(t){t.parentNode.removeChild(t)}function p(t){return document.createElement(t)}function d(t){return document.createTextNode(t)}function m(){return d(" ")}function y(t,e,n,r){return t.addEventListener(e,n,r),()=>t.removeEventListener(e,n,r)}function g(t,e,n){null==n?t.removeAttribute(e):t.setAttribute(e,n)}function v(t,e){e=""+e,t.data!==e&&(t.data=e)}let b;function w(t){b=t}function I(){const t=b;return(e,n)=>{const r=t.$$.callbacks[e];if(r){const i=function(t,e){const n=document.createEvent("CustomEvent");return n.initCustomEvent(t,!1,!1,e),n}(e,n);r.slice().forEach(e=>{e.call(t,i)})}}}function E(t,e){const n=t.$$.callbacks[e.type];n&&n.slice().forEach(t=>t(e))}const T=[],S=[],N=[],C=[],A=Promise.resolve();let D=!1;function k(t){N.push(t)}function _(){const t=new Set;do{for(;T.length;){const t=T.shift();w(t),R(t.$$)}for(;S.length;)S.pop()();for(let e=0;e<N.length;e+=1){const n=N[e];t.has(n)||(n(),t.add(n))}N.length=0}while(T.length);for(;C.length;)C.pop()();D=!1}function R(t){t.fragment&&(t.update(t.dirty),i(t.before_update),t.fragment.p(t.dirty,t.ctx),t.dirty=null,t.after_update.forEach(k))}const O=new Set;let P;function M(){P={r:0,c:[],p:P}}function L(){P.r||i(P.c),P=P.p}function x(t,e){t&&t.i&&(O.delete(t),t.i(e))}function q(t,e,n,r){if(t&&t.o){if(O.has(t))return;O.add(t),P.c.push(()=>{O.delete(t),r&&(n&&t.d(1),r())}),t.o(e)}}function F(t,e,r){const{fragment:a,on_mount:s,on_destroy:u,after_update:c}=t.$$;a.m(e,r),k(()=>{const e=s.map(n).filter(o);u?u.push(...e):i(e),t.$$.on_mount=[]}),c.forEach(k)}function U(t,e){t.$$.fragment&&(i(t.$$.on_destroy),t.$$.fragment.d(e),t.$$.on_destroy=t.$$.fragment=null,t.$$.ctx={})}function V(t,e){t.$$.dirty||(T.push(t),D||(D=!0,A.then(_)),t.$$.dirty=r()),t.$$.dirty[e]=!0}function B(e,n,o,a,s,u){const c=b;w(e);const h=n.props||{},l=e.$$={fragment:null,ctx:null,props:u,update:t,not_equal:s,bound:r(),on_mount:[],on_destroy:[],before_update:[],after_update:[],context:new Map(c?c.$$.context:[]),callbacks:r(),dirty:null};let f=!1;var p;l.ctx=o?o(e,h,(t,n,r=n)=>(l.ctx&&s(l.ctx[t],l.ctx[t]=r)&&(l.bound[t]&&l.bound[t](r),f&&V(e,t)),n)):h,l.update(),f=!0,i(l.before_update),l.fragment=a(l.ctx),n.target&&(n.hydrate?l.fragment.l((p=n.target,Array.from(p.childNodes))):l.fragment.c(),n.intro&&x(e.$$.fragment),F(e,n.target,n.anchor),_()),w(c)}class j{$destroy(){U(this,1),this.$destroy=t}$on(t,e){const n=this.$$.callbacks[t]||(this.$$.callbacks[t]=[]);return n.push(e),()=>{const t=n.indexOf(e);-1!==t&&n.splice(t,1)}}$set(){}}function K(e){var n;return{c(){(n=p("header")).innerHTML='<h1 class="svelte-3mmc7n">Salem | Meetup </h1>',g(n,"class","svelte-3mmc7n")},m(t,e){l(t,n,e)},p:t,i:t,o:t,d(t){t&&f(n)}}}class $ extends j{constructor(t){super(),B(this,t,null,K,a,[])}}function Q(t){var e,n,r,i;const o=t.$$slots.default,a=s(o,t,null);return{c(){e=p("button"),a&&a.c(),g(e,"class",n=t.mode+" "+t.color+" svelte-g32zaw"),g(e,"type",t.type),i=y(e,"click",t.click_handler)},l(t){a&&a.l(button_nodes)},m(t,n){l(t,e,n),a&&a.m(e,null),r=!0},p(t,i){a&&a.p&&t.$$scope&&a.p(c(o,i,t,null),u(o,i,null)),r&&!t.mode&&!t.color||n===(n=i.mode+" "+i.color+" svelte-g32zaw")||g(e,"class",n),r&&!t.type||g(e,"type",i.type)},i(t){r||(x(a,t),r=!0)},o(t){q(a,t),r=!1},d(t){t&&f(e),a&&a.d(t),i()}}}function W(t){var e,n;const r=t.$$slots.default,i=s(r,t,null);return{c(){e=p("a"),i&&i.c(),g(e,"href",t.href),g(e,"class","svelte-g32zaw")},l(t){i&&i.l(a_nodes)},m(t,r){l(t,e,r),i&&i.m(e,null),n=!0},p(t,o){i&&i.p&&t.$$scope&&i.p(c(r,o,t,null),u(r,o,null)),n&&!t.href||g(e,"href",o.href)},i(t){n||(x(i,t),n=!0)},o(t){q(i,t),n=!1},d(t){t&&f(e),i&&i.d(t)}}}function G(t){var e,n,r,i,o=[W,Q],a=[];function s(t,e){return e.href?0:1}return e=s(0,t),n=a[e]=o[e](t),{c(){n.c(),r=d("")},m(t,n){a[e].m(t,n),l(t,r,n),i=!0},p(t,i){var u=e;(e=s(0,i))===u?a[e].p(t,i):(M(),q(a[u],1,1,()=>{a[u]=null}),L(),(n=a[e])||(n=a[e]=o[e](i)).c(),x(n,1),n.m(r.parentNode,r))},i(t){i||(x(n),i=!0)},o(t){q(n),i=!1},d(t){a[e].d(t),t&&f(r)}}}function z(t,e,n){let{type:r="button",href:i=null,mode:o=null,color:a=null}=e,{$$slots:s={},$$scope:u}=e;return t.$set=(t=>{"type"in t&&n("type",r=t.type),"href"in t&&n("href",i=t.href),"mode"in t&&n("mode",o=t.mode),"color"in t&&n("color",a=t.color),"$$scope"in t&&n("$$scope",u=t.$$scope)}),{type:r,href:i,mode:o,color:a,click_handler:function(e){E(t,e)},$$slots:s,$$scope:u}}class H extends j{constructor(t){super(),B(this,t,z,G,a,["type","href","mode","color"])}}function Y(t){var e,n;const r=t.$$slots.default,i=s(r,t,null);return{c(){e=p("span"),i&&i.c(),g(e,"class","svelte-18dcboe")},l(t){i&&i.l(span_nodes)},m(t,r){l(t,e,r),i&&i.m(e,null),n=!0},p(t,e){i&&i.p&&t.$$scope&&i.p(c(r,e,t,null),u(r,e,null))},i(t){n||(x(i,t),n=!0)},o(t){q(i,t),n=!1},d(t){t&&f(e),i&&i.d(t)}}}function X(t,e,n){let{$$slots:r={},$$scope:i}=e;return t.$set=(t=>{"$$scope"in t&&n("$$scope",i=t.$$scope)}),{$$slots:r,$$scope:i}}class J extends j{constructor(t){super(),B(this,t,X,Y,a,[])}}function Z(t){var e,n=new J({props:{$$slots:{default:[tt]},$$scope:{ctx:t}}});return{c(){n.$$.fragment.c()},m(t,r){F(n,t,r),e=!0},i(t){e||(x(n.$$.fragment,t),e=!0)},o(t){q(n.$$.fragment,t),e=!1},d(t){U(n,t)}}}function tt(t){var e;return{c(){e=d("FAVORITE")},m(t,n){l(t,e,n)},d(t){t&&f(e)}}}function et(t){var e;return{c(){e=d("Contact")},m(t,n){l(t,e,n)},d(t){t&&f(e)}}}function nt(t){var e,n=t.isFav?"Unfavorite":"Favorite";return{c(){e=d(n)},m(t,n){l(t,e,n)},p(t,r){t.isFav&&n!==(n=r.isFav?"Unfavorite":"Favorite")&&v(e,n)},d(t){t&&f(e)}}}function rt(t){var e;return{c(){e=d("Show Details")},m(t,n){l(t,e,n)},d(t){t&&f(e)}}}function it(t){var e,n,r,i,o,a,s,u,c,y,b,w,I,E,T,S,N,C,A,D,k,_,R,O=t.isFav&&Z(t),P=new H({props:{href:"mailto:"+t.email,$$slots:{default:[et]},$$scope:{ctx:t}}}),V=new H({props:{mode:"outline",color:t.isFav?null:"success",type:"button",$$slots:{default:[nt]},$$scope:{ctx:t}}});V.$on("click",t.click_handler);var B=new H({props:{type:"button",$$slots:{default:[rt]},$$scope:{ctx:t}}});return{c(){e=p("article"),n=p("header"),r=p("h1"),i=d(t.title),o=m(),O&&O.c(),a=m(),s=p("h2"),u=d(t.subtitle),c=m(),y=p("p"),b=d(t.address),w=m(),I=p("div"),E=p("img"),T=m(),S=p("div"),N=p("p"),C=d(t.description),A=m(),D=p("footer"),P.$$.fragment.c(),k=m(),V.$$.fragment.c(),_=m(),B.$$.fragment.c(),g(r,"class","svelte-enhpap"),g(s,"class","svelte-enhpap"),g(y,"class","svelte-enhpap"),g(n,"class","svelte-enhpap"),g(E,"src",t.imageUrl),g(E,"alt",t.title),g(E,"class","svelte-enhpap"),g(I,"class","image svelte-enhpap"),g(N,"class","svelte-enhpap"),g(S,"class","content svelte-enhpap"),g(D,"class","svelte-enhpap"),g(e,"class","svelte-enhpap")},m(t,f){l(t,e,f),h(e,n),h(n,r),h(r,i),h(r,o),O&&O.m(r,null),h(n,a),h(n,s),h(s,u),h(n,c),h(n,y),h(y,b),h(e,w),h(e,I),h(I,E),h(e,T),h(e,S),h(S,N),h(N,C),h(e,A),h(e,D),F(P,D,null),h(D,k),F(V,D,null),h(D,_),F(B,D,null),R=!0},p(t,e){R&&!t.title||v(i,e.title),e.isFav?O?x(O,1):((O=Z(e)).c(),x(O,1),O.m(r,null)):O&&(M(),q(O,1,1,()=>{O=null}),L()),R&&!t.subtitle||v(u,e.subtitle),R&&!t.address||v(b,e.address),R&&!t.imageUrl||g(E,"src",e.imageUrl),R&&!t.title||g(E,"alt",e.title),R&&!t.description||v(C,e.description);var n={};t.email&&(n.href="mailto:"+e.email),t.$$scope&&(n.$$scope={changed:t,ctx:e}),P.$set(n);var o={};t.isFav&&(o.color=e.isFav?null:"success"),(t.$$scope||t.isFav)&&(o.$$scope={changed:t,ctx:e}),V.$set(o);var a={};t.$$scope&&(a.$$scope={changed:t,ctx:e}),B.$set(a)},i(t){R||(x(O),x(P.$$.fragment,t),x(V.$$.fragment,t),x(B.$$.fragment,t),R=!0)},o(t){q(O),q(P.$$.fragment,t),q(V.$$.fragment,t),q(B.$$.fragment,t),R=!1},d(t){t&&f(e),O&&O.d(),U(P),U(V),U(B)}}}function ot(t,e,n){let{id:r,title:i,subtitle:o,imageUrl:a,description:s,address:u,email:c,isFav:h}=e;const l=I();return t.$set=(t=>{"id"in t&&n("id",r=t.id),"title"in t&&n("title",i=t.title),"subtitle"in t&&n("subtitle",o=t.subtitle),"imageUrl"in t&&n("imageUrl",a=t.imageUrl),"description"in t&&n("description",s=t.description),"address"in t&&n("address",u=t.address),"email"in t&&n("email",c=t.email),"isFav"in t&&n("isFav",h=t.isFav)}),{id:r,title:i,subtitle:o,imageUrl:a,description:s,address:u,email:c,isFav:h,dispatch:l,click_handler:()=>l("togglefavorite",r)}}class at extends j{constructor(t){super(),B(this,t,ot,it,a,["id","title","subtitle","imageUrl","description","address","email","isFav"])}}function st(t,e,n){const r=Object.create(t);return r.meetup=e[n],r}function ut(t){var e,n=new at({props:{id:t.meetup.id,title:t.meetup.title,subtitle:t.meetup.subtitle,description:t.meetup.description,imageUrl:t.meetup.imageUrl,email:t.meetup.contactEmail,address:t.meetup.address,isFav:t.meetup.isFavorite}});return n.$on("togglefavorite",t.togglefavorite_handler),{c(){n.$$.fragment.c()},m(t,r){F(n,t,r),e=!0},p(t,e){var r={};t.meetups&&(r.id=e.meetup.id),t.meetups&&(r.title=e.meetup.title),t.meetups&&(r.subtitle=e.meetup.subtitle),t.meetups&&(r.description=e.meetup.description),t.meetups&&(r.imageUrl=e.meetup.imageUrl),t.meetups&&(r.email=e.meetup.contactEmail),t.meetups&&(r.address=e.meetup.address),t.meetups&&(r.isFav=e.meetup.isFavorite),n.$set(r)},i(t){e||(x(n.$$.fragment,t),e=!0)},o(t){q(n.$$.fragment,t),e=!1},d(t){U(n,t)}}}function ct(t){var e,n;let r=t.meetups,i=[];for(let e=0;e<r.length;e+=1)i[e]=ut(st(t,r,e));const o=t=>q(i[t],1,1,()=>{i[t]=null});return{c(){e=p("section");for(let t=0;t<i.length;t+=1)i[t].c();g(e,"id","meetups"),g(e,"class","svelte-181fmcx")},m(t,r){l(t,e,r);for(let t=0;t<i.length;t+=1)i[t].m(e,null);n=!0},p(t,n){if(t.meetups){let a;for(r=n.meetups,a=0;a<r.length;a+=1){const o=st(n,r,a);i[a]?(i[a].p(t,o),x(i[a],1)):(i[a]=ut(o),i[a].c(),x(i[a],1),i[a].m(e,null))}for(M(),a=r.length;a<i.length;a+=1)o(a);L()}},i(t){if(!n){for(let t=0;t<r.length;t+=1)x(i[t]);n=!0}},o(t){i=i.filter(Boolean);for(let t=0;t<i.length;t+=1)q(i[t]);n=!1},d(t){t&&f(e),function(t,e){for(let n=0;n<t.length;n+=1)t[n]&&t[n].d(e)}(i,t)}}}function ht(t,e,n){let{meetups:r}=e;return t.$set=(t=>{"meetups"in t&&n("meetups",r=t.meetups)}),{meetups:r,togglefavorite_handler:function(e){E(t,e)}}}class lt extends j{constructor(t){super(),B(this,t,ht,ct,a,["meetups"])}}function ft(t){var e,n;return{c(){g(e=p("input"),"type",t.type),g(e,"id",t.id),e.value=t.value,g(e,"class","svelte-xzzzlr"),n=y(e,"input",t.input_handler_1)},m(t,n){l(t,e,n)},p(t,n){t.type&&g(e,"type",n.type),t.id&&g(e,"id",n.id),t.value&&(e.value=n.value)},d(t){t&&f(e),n()}}}function pt(t){var e,n;return{c(){g(e=p("textarea"),"rows",t.rows),g(e,"id",t.id),e.value=t.value,g(e,"class","svelte-xzzzlr"),n=y(e,"input",t.input_handler)},m(t,n){l(t,e,n)},p(t,n){t.rows&&g(e,"rows",n.rows),t.id&&g(e,"id",n.id),t.value&&(e.value=n.value)},d(t){t&&f(e),n()}}}function dt(e){var n,r,i,o;function a(t,e){return"textarea"===e.controlType?pt:ft}var s=a(0,e),u=s(e);return{c(){n=p("div"),r=p("label"),i=d(e.label),o=m(),u.c(),g(r,"for",e.id),g(r,"class","svelte-xzzzlr"),g(n,"class","form-control svelte-xzzzlr")},m(t,e){l(t,n,e),h(n,r),h(r,i),h(n,o),u.m(n,null)},p(t,e){t.label&&v(i,e.label),t.id&&g(r,"for",e.id),s===(s=a(0,e))&&u?u.p(t,e):(u.d(1),(u=s(e))&&(u.c(),u.m(n,null)))},i:t,o:t,d(t){t&&f(n),u.d()}}}function mt(t,e,n){let{controlType:r=null,id:i,label:o,rows:a=null,value:s,type:u="text"}=e;return t.$set=(t=>{"controlType"in t&&n("controlType",r=t.controlType),"id"in t&&n("id",i=t.id),"label"in t&&n("label",o=t.label),"rows"in t&&n("rows",a=t.rows),"value"in t&&n("value",s=t.value),"type"in t&&n("type",u=t.type)}),{controlType:r,id:i,label:o,rows:a,value:s,type:u,input_handler:function(e){E(t,e)},input_handler_1:function(e){E(t,e)}}}class yt extends j{constructor(t){super(),B(this,t,mt,dt,a,["controlType","id","label","rows","value","type"])}}const gt=()=>({}),vt=()=>({});function bt(t){var e;return{c(){e=d("Close")},m(t,n){l(t,e,n)},d(t){t&&f(e)}}}function wt(t){var e,n,r,i,o,a,b,w,I,E,T;const S=t.$$slots.default,N=s(S,t,null),C=t.$$slots.footer,A=s(C,t,vt);var D=new H({props:{$$slots:{default:[bt]},$$scope:{ctx:t}}});return D.$on("click",t.closeModal),{c(){e=p("div"),n=m(),r=p("div"),i=p("h1"),o=d(t.title),a=m(),b=p("div"),N&&N.c(),w=m(),I=p("footer"),A||D.$$.fragment.c(),A&&A.c(),g(e,"class","modal-backdrop svelte-1wfedfe"),g(i,"class","svelte-1wfedfe"),g(b,"class","content svelte-1wfedfe"),g(I,"class","svelte-1wfedfe"),g(r,"class","modal svelte-1wfedfe"),T=y(e,"click",t.closeModal)},l(t){N&&N.l(div1_nodes),A&&A.l(footer_nodes)},m(t,s){l(t,e,s),l(t,n,s),l(t,r,s),h(r,i),h(i,o),h(r,a),h(r,b),N&&N.m(b,null),h(r,w),h(r,I),A?A.m(I,null):F(D,I,null),E=!0},p(t,e){if(E&&!t.title||v(o,e.title),N&&N.p&&t.$$scope&&N.p(c(S,e,t,null),u(S,e,null)),!A){var n={};t.$$scope&&(n.$$scope={changed:t,ctx:e}),D.$set(n)}A&&A.p&&t.$$scope&&A.p(c(C,e,t,gt),u(C,e,vt))},i(t){E||(x(N,t),x(D.$$.fragment,t),x(A,t),E=!0)},o(t){q(N,t),q(D.$$.fragment,t),q(A,t),E=!1},d(t){t&&(f(e),f(n),f(r)),N&&N.d(t),A||U(D),A&&A.d(t),T()}}}function It(t,e,n){let{title:r}=e;const i=I();let{$$slots:o={},$$scope:a}=e;return t.$set=(t=>{"title"in t&&n("title",r=t.title),"$$scope"in t&&n("$$scope",a=t.$$scope)}),{title:r,closeModal:function(){i("cancel")},$$slots:o,$$scope:a}}class Et extends j{constructor(t){super(),B(this,t,It,wt,a,["title"])}}function Tt(t){var e;return{c(){e=d("Cancel")},m(t,n){l(t,e,n)},d(t){t&&f(e)}}}function St(t){var e;return{c(){e=d("Save")},m(t,n){l(t,e,n)},d(t){t&&f(e)}}}function Nt(t){var e,n,r,i=new H({props:{type:"button",mode:"outline",$$slots:{default:[Tt]},$$scope:{ctx:t}}});i.$on("click",t.cancel);var o=new H({props:{type:"button",$$slots:{default:[St]},$$scope:{ctx:t}}});return o.$on("click",t.submitForm),{c(){e=p("div"),i.$$.fragment.c(),n=m(),o.$$.fragment.c(),g(e,"slot","footer")},m(t,a){l(t,e,a),F(i,e,null),h(e,n),F(o,e,null),r=!0},p(t,e){var n={};t.$$scope&&(n.$$scope={changed:t,ctx:e}),i.$set(n);var r={};t.$$scope&&(r.$$scope={changed:t,ctx:e}),o.$set(r)},i(t){r||(x(i.$$.fragment,t),x(o.$$.fragment,t),r=!0)},o(t){q(i.$$.fragment,t),q(o.$$.fragment,t),r=!1},d(t){t&&f(e),U(i),U(o)}}}function Ct(t){var e,n,r,i,o,a,s,u,c,d=new yt({props:{id:"title",label:"Title",value:t.title}});d.$on("input",t.input_handler);var v=new yt({props:{id:"subtitle",label:"Subtitle",value:t.subtitle}});v.$on("input",t.input_handler_1);var b=new yt({props:{id:"address",label:"Address",value:t.address}});b.$on("input",t.input_handler_2);var w=new yt({props:{id:"imageUrl",label:"Image URL",value:t.imageUrl}});w.$on("input",t.input_handler_3);var I=new yt({props:{id:"email",label:"E-Mail",type:"email",value:t.email}});I.$on("input",t.input_handler_4);var E=new yt({props:{id:"description",label:"Description",controlType:"textarea",value:t.description}});return E.$on("input",t.input_handler_5),{c(){var u;e=p("form"),d.$$.fragment.c(),n=m(),v.$$.fragment.c(),r=m(),b.$$.fragment.c(),i=m(),w.$$.fragment.c(),o=m(),I.$$.fragment.c(),a=m(),E.$$.fragment.c(),s=m(),g(e,"class","svelte-no1xoc"),c=y(e,"submit",(u=t.submitForm,function(t){return t.preventDefault(),u.call(this,t)}))},m(t,c){l(t,e,c),F(d,e,null),h(e,n),F(v,e,null),h(e,r),F(b,e,null),h(e,i),F(w,e,null),h(e,o),F(I,e,null),h(e,a),F(E,e,null),l(t,s,c),u=!0},p(t,e){var n={};t.title&&(n.value=e.title),d.$set(n);var r={};t.subtitle&&(r.value=e.subtitle),v.$set(r);var i={};t.address&&(i.value=e.address),b.$set(i);var o={};t.imageUrl&&(o.value=e.imageUrl),w.$set(o);var a={};t.email&&(a.value=e.email),I.$set(a);var s={};t.description&&(s.value=e.description),E.$set(s)},i(t){u||(x(d.$$.fragment,t),x(v.$$.fragment,t),x(b.$$.fragment,t),x(w.$$.fragment,t),x(I.$$.fragment,t),x(E.$$.fragment,t),u=!0)},o(t){q(d.$$.fragment,t),q(v.$$.fragment,t),q(b.$$.fragment,t),q(w.$$.fragment,t),q(I.$$.fragment,t),q(E.$$.fragment,t),u=!1},d(t){t&&f(e),U(d),U(v),U(b),U(w),U(I),U(E),t&&f(s),c()}}}function At(t){var e,n=new Et({props:{title:"Edit Meetup Data",$$slots:{default:[Ct],footer:[Nt]},$$scope:{ctx:t}}});return n.$on("cancel",t.cancel_handler),{c(){n.$$.fragment.c()},m(t,r){F(n,t,r),e=!0},p(t,e){var r={};(t.$$scope||t.description||t.email||t.imageUrl||t.address||t.subtitle||t.title)&&(r.$$scope={changed:t,ctx:e}),n.$set(r)},i(t){e||(x(n.$$.fragment,t),e=!0)},o(t){q(n.$$.fragment,t),e=!1},d(t){U(n,t)}}}function Dt(t,e,n){let r="",i="",o="",a="",s="",u="";const c=I();return{title:r,subtitle:i,address:o,email:a,description:s,imageUrl:u,submitForm:function(){c("save",{title:r,subtitle:i,address:o,email:a,description:s,imageUrl:u})},cancel:function(){c("cancel")},cancel_handler:function(e){E(t,e)},input_handler:t=>n("title",r=t.target.value),input_handler_1:t=>n("subtitle",i=t.target.value),input_handler_2:t=>n("address",o=t.target.value),input_handler_3:t=>n("imageUrl",u=t.target.value),input_handler_4:t=>n("email",a=t.target.value),input_handler_5:t=>n("description",s=t.target.value)}}class kt extends j{constructor(t){super(),B(this,t,Dt,At,a,[])}}function _t(e){var n,r,i,o,a,s,u;return{c(){n=p("div"),r=p("h3"),i=d("Hi "),o=d(e.displayName),a=d("!"),s=m(),g(u=p("img"),"src",e.photoURL),g(u,"width","100"),g(u,"alt","user avatar"),g(n,"class","main2 svelte-9iqdnu")},m(t,e){l(t,n,e),h(n,r),h(r,i),h(r,o),h(r,a),h(n,s),h(n,u)},p(t,e){t.displayName&&v(o,e.displayName),t.photoURL&&g(u,"src",e.photoURL)},i:t,o:t,d(t){t&&f(n)}}}function Rt(t,e,n){let{displayName:r,photoURL:i,uid:o}=e;return t.$set=(t=>{"displayName"in t&&n("displayName",r=t.displayName),"photoURL"in t&&n("photoURL",i=t.photoURL),"uid"in t&&n("uid",o=t.uid)}),{displayName:r,photoURL:i,uid:o}}class Ot extends j{constructor(t){super(),B(this,t,Rt,_t,a,["displayName","photoURL","uid"])}}var Pt=function(t,e){return(Pt=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(t,e){t.__proto__=e}||function(t,e){for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n])})(t,e)};function Mt(t,e){function n(){this.constructor=t}Pt(t,e),t.prototype=null===e?Object.create(e):(n.prototype=e.prototype,new n)}var Lt=function(){return(Lt=Object.assign||function(t){for(var e,n=1,r=arguments.length;n<r;n++)for(var i in e=arguments[n])Object.prototype.hasOwnProperty.call(e,i)&&(t[i]=e[i]);return t}).apply(this,arguments)};function xt(t,e,n,r){return new(n||(n=Promise))(function(i,o){function a(t){try{u(r.next(t))}catch(t){o(t)}}function s(t){try{u(r.throw(t))}catch(t){o(t)}}function u(t){t.done?i(t.value):new n(function(e){e(t.value)}).then(a,s)}u((r=r.apply(t,e||[])).next())})}function qt(t,e){var n,r,i,o,a={label:0,sent:function(){if(1&i[0])throw i[1];return i[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(i=2&o[0]?r.return:o[0]?r.throw||((i=r.return)&&i.call(r),0):r.next)&&!(i=i.call(r,o[1])).done)return i;switch(r=0,i&&(o=[2&o[0],i.value]),o[0]){case 0:case 1:i=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,r=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(i=(i=a.trys).length>0&&i[i.length-1])&&(6===o[0]||2===o[0])){a=0;continue}if(3===o[0]&&(!i||o[1]>i[0]&&o[1]<i[3])){a.label=o[1];break}if(6===o[0]&&a.label<i[1]){a.label=i[1],i=o;break}if(i&&a.label<i[2]){a.label=i[2],a.ops.push(o);break}i[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],r=0}finally{n=i=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Ft(t,e){if(!(e instanceof Object))return e;switch(e.constructor){case Date:return new Date(e.getTime());case Object:void 0===t&&(t={});break;case Array:t=[];break;default:return e}for(var n in e)e.hasOwnProperty(n)&&(t[n]=Ft(t[n],e[n]));return t}function Ut(){return"undefined"!=typeof navigator&&"string"==typeof navigator.userAgent?navigator.userAgent:""}var Vt="FirebaseError",Bt=function(t){function e(n,r){var i=t.call(this,r)||this;return i.code=n,i.name=Vt,Object.setPrototypeOf(i,e.prototype),Error.captureStackTrace&&Error.captureStackTrace(i,jt.prototype.create),i}return Mt(e,t),e}(Error),jt=function(){function t(t,e,n){this.service=t,this.serviceName=e,this.errors=n}return t.prototype.create=function(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];for(var r=e[0]||{},i=this.service+"/"+t,o=this.errors[t],a=o?function(t,e){return t.replace(Kt,function(t,n){var r=e[n];return null!=r?r.toString():"<"+n+"?>"})}(o,r):"Error",s=this.serviceName+": "+a+" ("+i+").",u=new Bt(i,s),c=0,h=Object.keys(r);c<h.length;c++){var l=h[c];"_"!==l.slice(-1)&&(l in u&&console.warn('Overwriting FirebaseError base field "'+l+'" can cause unexpected behavior.'),u[l]=r[l])}return u},t}();var Kt=/\{\$([^}]+)}/g;function $t(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function Qt(t,e){var n=new Gt(t,e);return n.subscribe.bind(n)}var Wt,Gt=function(){function t(t,e){var n=this;this.observers=[],this.unsubscribes=[],this.observerCount=0,this.task=Promise.resolve(),this.finalized=!1,this.onNoObservers=e,this.task.then(function(){t(n)}).catch(function(t){n.error(t)})}return t.prototype.next=function(t){this.forEachObserver(function(e){e.next(t)})},t.prototype.error=function(t){this.forEachObserver(function(e){e.error(t)}),this.close(t)},t.prototype.complete=function(){this.forEachObserver(function(t){t.complete()}),this.close()},t.prototype.subscribe=function(t,e,n){var r,i=this;if(void 0===t&&void 0===e&&void 0===n)throw new Error("Missing Observer.");void 0===(r=function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i in t&&"function"==typeof t[i])return!0}return!1}(t,["next","error","complete"])?t:{next:t,error:e,complete:n}).next&&(r.next=zt),void 0===r.error&&(r.error=zt),void 0===r.complete&&(r.complete=zt);var o=this.unsubscribeOne.bind(this,this.observers.length);return this.finalized&&this.task.then(function(){try{i.finalError?r.error(i.finalError):r.complete()}catch(t){}}),this.observers.push(r),o},t.prototype.unsubscribeOne=function(t){void 0!==this.observers&&void 0!==this.observers[t]&&(delete this.observers[t],this.observerCount-=1,0===this.observerCount&&void 0!==this.onNoObservers&&this.onNoObservers(this))},t.prototype.forEachObserver=function(t){if(!this.finalized)for(var e=0;e<this.observers.length;e++)this.sendOne(e,t)},t.prototype.sendOne=function(t,e){var n=this;this.task.then(function(){if(void 0!==n.observers&&void 0!==n.observers[t])try{e(n.observers[t])}catch(t){"undefined"!=typeof console&&console.error&&console.error(t)}})},t.prototype.close=function(t){var e=this;this.finalized||(this.finalized=!0,void 0!==t&&(this.finalError=t),this.task.then(function(){e.observers=void 0,e.onNoObservers=void 0}))},t}();function zt(){}!function(t){t[t.DEBUG=0]="DEBUG",t[t.VERBOSE=1]="VERBOSE",t[t.INFO=2]="INFO",t[t.WARN=3]="WARN",t[t.ERROR=4]="ERROR",t[t.SILENT=5]="SILENT"}(Wt||(Wt={}));var Ht,Yt=Wt.INFO,Xt=function(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(!(e<t.logLevel)){var i=(new Date).toISOString();switch(e){case Wt.DEBUG:case Wt.VERBOSE:console.log.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Wt.INFO:console.info.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Wt.WARN:console.warn.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;case Wt.ERROR:console.error.apply(console,["["+i+"]  "+t.name+":"].concat(n));break;default:throw new Error("Attempted to log a message with an invalid logType (value: "+e+")")}}},Jt=function(){function t(t){this.name=t,this._logLevel=Yt,this._logHandler=Xt}return Object.defineProperty(t.prototype,"logLevel",{get:function(){return this._logLevel},set:function(t){if(!(t in Wt))throw new TypeError("Invalid value assigned to `logLevel`");this._logLevel=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"logHandler",{get:function(){return this._logHandler},set:function(t){if("function"!=typeof t)throw new TypeError("Value assigned to `logHandler` must be a function");this._logHandler=t},enumerable:!0,configurable:!0}),t.prototype.debug=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Wt.DEBUG].concat(t))},t.prototype.log=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Wt.VERBOSE].concat(t))},t.prototype.info=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Wt.INFO].concat(t))},t.prototype.warn=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Wt.WARN].concat(t))},t.prototype.error=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];this._logHandler.apply(this,[this,Wt.ERROR].concat(t))},t}(),Zt=((Ht={})["no-app"]="No Firebase App '{$appName}' has been created - call Firebase App.initializeApp()",Ht["bad-app-name"]="Illegal App name: '{$appName}",Ht["duplicate-app"]="Firebase App named '{$appName}' already exists",Ht["app-deleted"]="Firebase App named '{$appName}' already deleted",Ht["invalid-app-argument"]="firebase.{$appName}() takes either no argument or a Firebase App instance.",Ht),te=new jt("app","Firebase",Zt),ee="[DEFAULT]",ne=function(){function t(t,e,n){var r=this;this.firebase_=n,this.isDeleted_=!1,this.services_={},this.tokenListeners_=[],this.analyticsEventRequests_=[],this.name_=e.name,this.automaticDataCollectionEnabled_=e.automaticDataCollectionEnabled||!1,this.options_=Ft(void 0,t);var i=this;this.INTERNAL={getUid:function(){return null},getToken:function(){return Promise.resolve(null)},addAuthTokenListener:function(t){r.tokenListeners_.push(t),setTimeout(function(){return t(null)},0)},removeAuthTokenListener:function(t){r.tokenListeners_=r.tokenListeners_.filter(function(e){return e!==t})},analytics:{logEvent:function(){i.analyticsEventRequests_.push(arguments)}}}}return Object.defineProperty(t.prototype,"automaticDataCollectionEnabled",{get:function(){return this.checkDestroyed_(),this.automaticDataCollectionEnabled_},set:function(t){this.checkDestroyed_(),this.automaticDataCollectionEnabled_=t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"name",{get:function(){return this.checkDestroyed_(),this.name_},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"options",{get:function(){return this.checkDestroyed_(),this.options_},enumerable:!0,configurable:!0}),t.prototype.delete=function(){var t=this;return new Promise(function(e){t.checkDestroyed_(),e()}).then(function(){t.firebase_.INTERNAL.removeApp(t.name_);for(var e=[],n=0,r=Object.keys(t.services_);n<r.length;n++)for(var i=r[n],o=0,a=Object.keys(t.services_[i]);o<a.length;o++){var s=a[o];e.push(t.services_[i][s])}return Promise.all(e.filter(function(t){return"INTERNAL"in t}).map(function(t){return t.INTERNAL.delete()}))}).then(function(){t.isDeleted_=!0,t.services_={}})},t.prototype._getService=function(t,e){if(void 0===e&&(e=ee),this.checkDestroyed_(),this.services_[t]||(this.services_[t]={}),!this.services_[t][e]){var n=e!==ee?e:void 0,r=this.firebase_.INTERNAL.factories[t](this,this.extendApp.bind(this),n);this.services_[t][e]=r}return this.services_[t][e]},t.prototype._removeServiceInstance=function(t,e){void 0===e&&(e=ee),this.services_[t]&&this.services_[t][e]&&delete this.services_[t][e]},t.prototype.extendApp=function(t){if(Ft(this,t),t.INTERNAL){if(t.INTERNAL.addAuthTokenListener){for(var e=0,n=this.tokenListeners_;e<n.length;e++){var r=n[e];this.INTERNAL.addAuthTokenListener(r)}this.tokenListeners_=[]}if(t.INTERNAL.analytics){for(var i=0,o=this.analyticsEventRequests_;i<o.length;i++){var a=o[i];this.INTERNAL.analytics.logEvent.apply(void 0,a)}this.analyticsEventRequests_=[]}}},t.prototype.checkDestroyed_=function(){if(this.isDeleted_)throw te.create("app-deleted",{appName:this.name_})},t}();ne.prototype.name&&ne.prototype.options||ne.prototype.delete||console.log("dc");var re="7.0.0",ie=new Jt("@firebase/app");if("object"==typeof self&&self.self===self&&void 0!==self.firebase){ie.warn("\n    Warning: Firebase is already defined in the global scope. Please make sure\n    Firebase library is only loaded once.\n  ");var oe=self.firebase.SDK_VERSION;oe&&oe.indexOf("LITE")>=0&&ie.warn("\n    Warning: You are trying to load Firebase while using Firebase Performance standalone script.\n    You should load Firebase Performance with this instance of Firebase to avoid loading duplicate code.\n    ")}var ae=function t(){var e=function(t){var e={},n={},r={},i={__esModule:!0,initializeApp:function(n,r){if(void 0===r&&(r={}),"object"!=typeof r||null===r){var o=r;r={name:o}}var a=r;void 0===a.name&&(a.name=ee);var u=a.name;if("string"!=typeof u||!u)throw te.create("bad-app-name",{appName:String(u)});if($t(e,u))throw te.create("duplicate-app",{appName:u});var c=new t(n,a,i);return e[u]=c,s(c,"create"),c},app:o,apps:null,SDK_VERSION:re,INTERNAL:{registerService:function(e,s,u,c,h){if(void 0===h&&(h=!1),n[e])return ie.debug("There were multiple attempts to register service "+e+"."),i[e];function l(t){if(void 0===t&&(t=o()),"function"!=typeof t[e])throw te.create("invalid-app-argument",{appName:e});return t[e]()}return n[e]=s,c&&(r[e]=c,a().forEach(function(t){c("create",t)})),void 0!==u&&Ft(l,u),i[e]=l,t.prototype[e]=function(){for(var t=[],n=0;n<arguments.length;n++)t[n]=arguments[n];return this._getService.bind(this,e).apply(this,h?t:[])},l},removeApp:function(t){s(e[t],"delete"),delete e[t]},factories:n,useAsService:u}};function o(t){if(!$t(e,t=t||ee))throw te.create("no-app",{appName:t});return e[t]}function a(){return Object.keys(e).map(function(t){return e[t]})}function s(t,e){for(var i=0,o=Object.keys(n);i<o.length;i++){var a=u(0,o[i]);if(null===a)return;r[a]&&r[a](e,t)}}function u(t,e){return"serverAuth"===e?null:e}return i.default=i,Object.defineProperty(i,"apps",{get:a}),o.App=t,i}(ne);return e.INTERNAL=Lt({},e.INTERNAL,{createFirebaseNamespace:t,extendNamespace:function(t){Ft(e,t)},createSubscribe:Qt,ErrorFactory:jt,deepExtend:Ft}),e}(),se=ae.initializeApp;ae.initializeApp=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return function(){try{return"[object process]"===Object.prototype.toString.call(global.process)}catch(t){return!1}}()&&ie.warn('\n      Warning: This is a browser-targeted Firebase bundle but it appears it is being\n      run in a Node environment.  If running in a Node environment, make sure you\n      are using the bundle specified by the "main" field in package.json.\n      \n      If you are using Webpack, you can specify "main" as the first item in\n      "resolve.mainFields":\n      https://webpack.js.org/configuration/resolve/#resolvemainfields\n      \n      If using Rollup, use the rollup-plugin-node-resolve plugin and specify "main"\n      as the first item in "mainFields", e.g. [\'main\', \'module\'].\n      https://github.com/rollup/rollup-plugin-node-resolve\n      '),se.apply(void 0,t)};var ue=ae;(function(){var t,e="function"==typeof Object.defineProperties?Object.defineProperty:function(t,e,n){t!=Array.prototype&&t!=Object.prototype&&(t[e]=n.value)},n="undefined"!=typeof window&&window===this?this:"undefined"!=typeof global&&null!=global?global:this;function r(t){var e=0;return function(){return e<t.length?{done:!1,value:t[e++]}:{done:!0}}}function i(t){var e="undefined"!=typeof Symbol&&Symbol.iterator&&t[Symbol.iterator];return e?e.call(t):{next:r(t)}}!function(t,r){if(r){var i=n;t=t.split(".");for(var o=0;o<t.length-1;o++){var a=t[o];a in i||(i[a]={}),i=i[a]}(r=r(o=i[t=t[t.length-1]]))!=o&&null!=r&&e(i,t,{configurable:!0,writable:!0,value:r})}}("Promise",function(t){function e(t){this.b=0,this.c=void 0,this.a=[];var e=this.f();try{t(e.resolve,e.reject)}catch(t){e.reject(t)}}function r(){this.a=null}function o(t){return t instanceof e?t:new e(function(e){e(t)})}if(t)return t;r.prototype.b=function(t){if(null==this.a){this.a=[];var e=this;this.c(function(){e.g()})}this.a.push(t)};var a=n.setTimeout;r.prototype.c=function(t){a(t,0)},r.prototype.g=function(){for(;this.a&&this.a.length;){var t=this.a;this.a=[];for(var e=0;e<t.length;++e){var n=t[e];t[e]=null;try{n()}catch(t){this.f(t)}}}this.a=null},r.prototype.f=function(t){this.c(function(){throw t})},e.prototype.f=function(){function t(t){return function(r){n||(n=!0,t.call(e,r))}}var e=this,n=!1;return{resolve:t(this.m),reject:t(this.g)}},e.prototype.m=function(t){if(t===this)this.g(new TypeError("A Promise cannot resolve to itself"));else if(t instanceof e)this.o(t);else{t:switch(typeof t){case"object":var n=null!=t;break t;case"function":n=!0;break t;default:n=!1}n?this.u(t):this.h(t)}},e.prototype.u=function(t){var e=void 0;try{e=t.then}catch(t){return void this.g(t)}"function"==typeof e?this.v(e,t):this.h(t)},e.prototype.g=function(t){this.i(2,t)},e.prototype.h=function(t){this.i(1,t)},e.prototype.i=function(t,e){if(0!=this.b)throw Error("Cannot settle("+t+", "+e+"): Promise already settled in state"+this.b);this.b=t,this.c=e,this.l()},e.prototype.l=function(){if(null!=this.a){for(var t=0;t<this.a.length;++t)s.b(this.a[t]);this.a=null}};var s=new r;return e.prototype.o=function(t){var e=this.f();t.Ja(e.resolve,e.reject)},e.prototype.v=function(t,e){var n=this.f();try{t.call(e,n.resolve,n.reject)}catch(t){n.reject(t)}},e.prototype.then=function(t,n){function r(t,e){return"function"==typeof t?function(e){try{i(t(e))}catch(t){o(t)}}:e}var i,o,a=new e(function(t,e){i=t,o=e});return this.Ja(r(t,i),r(n,o)),a},e.prototype.catch=function(t){return this.then(void 0,t)},e.prototype.Ja=function(t,e){function n(){switch(r.b){case 1:t(r.c);break;case 2:e(r.c);break;default:throw Error("Unexpected state: "+r.b)}}var r=this;null==this.a?s.b(n):this.a.push(n)},e.resolve=o,e.reject=function(t){return new e(function(e,n){n(t)})},e.race=function(t){return new e(function(e,n){for(var r=i(t),a=r.next();!a.done;a=r.next())o(a.value).Ja(e,n)})},e.all=function(t){var n=i(t),r=n.next();return r.done?o([]):new e(function(t,e){function i(e){return function(n){a[e]=n,0==--s&&t(a)}}var a=[],s=0;do{a.push(void 0),s++,o(r.value).Ja(i(a.length-1),e),r=n.next()}while(!r.done)})},e});var o=o||{},a=this||self;function s(t){return"string"==typeof t}function u(t){return"boolean"==typeof t}var c=/^[\w+\/_-]+[=]{0,2}$/,h=null;function l(){}function f(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function p(t){return null===t}function d(t){return"array"==f(t)}function m(t){var e=f(t);return"array"==e||"object"==e&&"number"==typeof t.length}function y(t){return"function"==f(t)}function g(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var v="closure_uid_"+(1e9*Math.random()>>>0),b=0;function w(t,e,n){return t.call.apply(t.bind,arguments)}function I(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function E(t,e,n){return(E=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?w:I).apply(null,arguments)}function T(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var S=Date.now||function(){return+new Date};function N(t,e){function n(){}n.prototype=e.prototype,t.qb=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.fd=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function C(t){if(!t)return!1;try{return!!t.$goog_Thenable}catch(t){return!1}}function A(t){if(Error.captureStackTrace)Error.captureStackTrace(this,A);else{var e=Error().stack;e&&(this.stack=e)}t&&(this.message=String(t))}function D(t,e){for(var n="",r=(t=t.split("%s")).length-1,i=0;i<r;i++)n+=t[i]+(i<e.length?e[i]:"%s");A.call(this,n+t[r])}function k(t,e){throw new D("Failure"+(t?": "+t:""),Array.prototype.slice.call(arguments,1))}function _(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function R(t,e){t.f(e),100>t.b&&(t.b++,e.next=t.a,t.a=e)}function O(){this.b=this.a=null}N(A,Error),A.prototype.name="CustomError",N(D,A),D.prototype.name="AssertionError",_.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var P=new _(function(){return new L},function(t){t.reset()});function M(){var t=jt,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function L(){this.next=this.b=this.a=null}function x(t,e){t:{try{var n=t&&t.ownerDocument,r=n&&(n.defaultView||n.parentWindow);if((r=r||a).Element&&r.Location){var i=r;break t}}catch(t){}i=null}if(i&&void 0!==i[e]&&(!t||!(t instanceof i[e])&&(t instanceof i.Location||t instanceof i.Element))){if(g(t))try{var o=t.constructor.displayName||t.constructor.name||Object.prototype.toString.call(t)}catch(t){o="<object could not be stringified>"}else o=void 0===t?"undefined":null===t?"null":typeof t;k("Argument is not a %s (or a non-Element, non-Location mock); got: %s",e,o)}}O.prototype.add=function(t,e){var n=P.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},L.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},L.prototype.reset=function(){this.next=this.b=this.a=null};var q=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(s(t))return s(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},F=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=s(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};var U=Array.prototype.map?function(t,e){return Array.prototype.map.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=Array(n),i=s(t)?t.split(""):t,o=0;o<n;o++)o in i&&(r[o]=e.call(void 0,i[o],o,t));return r},V=Array.prototype.some?function(t,e){return Array.prototype.some.call(t,e,void 0)}:function(t,e){for(var n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t))return!0;return!1};function B(t,e){return 0<=q(t,e)}function j(t,e){var n;return(n=0<=(e=q(t,e)))&&Array.prototype.splice.call(t,e,1),n}function K(t,e){!function(t,e){for(var n=s(t)?t.split(""):t,r=t.length-1;0<=r;--r)r in n&&e.call(void 0,n[r],r,t)}(t,function(n,r){e.call(void 0,n,r,t)&&1==Array.prototype.splice.call(t,r,1).length&&0})}function $(t){return Array.prototype.concat.apply([],arguments)}function Q(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function W(t,e){for(var n in t)e.call(void 0,t[n],n,t)}function G(t){for(var e in t)return!1;return!0}function z(t){var e,n={};for(e in t)n[e]=t[e];return n}var H="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function Y(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<H.length;o++)n=H[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function X(t,e){this.a=t===tt&&e||"",this.b=Z}function J(t){return t instanceof X&&t.constructor===X&&t.b===Z?t.a:(k("expected object of type Const, got '"+t+"'"),"type_error:Const")}X.prototype.qa=!0,X.prototype.pa=function(){return this.a},X.prototype.toString=function(){return"Const{"+this.a+"}"};var Z={},tt={},et=new X(tt,"");function nt(){this.a="",this.b=st}function rt(t){return t instanceof nt&&t.constructor===nt&&t.b===st?t.a:(k("expected object of type TrustedResourceUrl, got '"+t+"' of type "+f(t)),"type_error:TrustedResourceUrl")}function it(t,e){var n=J(t);if(!at.test(n))throw Error("Invalid TrustedResourceUrl format: "+n);return ut(t=n.replace(ot,function(t,r){if(!Object.prototype.hasOwnProperty.call(e,r))throw Error('Found marker, "'+r+'", in format string, "'+n+'", but no valid label mapping found in args: '+JSON.stringify(e));return(t=e[r])instanceof X?J(t):encodeURIComponent(String(t))}))}nt.prototype.qa=!0,nt.prototype.pa=function(){return this.a.toString()},nt.prototype.toString=function(){return"TrustedResourceUrl{"+this.a+"}"};var ot=/%{(\w+)}/g,at=/^((https:)?\/\/[0-9a-z.:[\]-]+\/|\/[^\/\\]|[^:\/\\%]+\/|[^:\/\\%]*[?#]|about:blank#)/i,st={};function ut(t){var e=new nt;return e.a=t,e}var ct=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]},ht=/&/g,lt=/</g,ft=/>/g,pt=/"/g,dt=/'/g,mt=/\x00/g,yt=/[\x00&<>"']/;function gt(t,e){return-1!=t.indexOf(e)}function vt(t,e){return t<e?-1:t>e?1:0}function bt(){this.a="",this.b=St}function wt(t){return t instanceof bt&&t.constructor===bt&&t.b===St?t.a:(k("expected object of type SafeUrl, got '"+t+"' of type "+f(t)),"type_error:SafeUrl")}bt.prototype.qa=!0,bt.prototype.pa=function(){return this.a.toString()},bt.prototype.toString=function(){return"SafeUrl{"+this.a+"}"};var It=/^(?:(?:https?|mailto|ftp):|[^:\/?#]*(?:[\/?#]|$))/i;function Et(t){return t instanceof bt?t:(t="object"==typeof t&&t.qa?t.pa():String(t),It.test(t)||(t="about:invalid#zClosurez"),Nt(t))}var Tt,St={};function Nt(t){var e=new bt;return e.a=t,e}Nt("about:blank");t:{var Ct=a.navigator;if(Ct){var At=Ct.userAgent;if(At){Tt=At;break t}}Tt=""}function Dt(t){return gt(Tt,t)}function kt(){this.a="",this.b=Rt}function _t(t){return t instanceof kt&&t.constructor===kt&&t.b===Rt?t.a:(k("expected object of type SafeHtml, got '"+t+"' of type "+f(t)),"type_error:SafeHtml")}kt.prototype.qa=!0,kt.prototype.pa=function(){return this.a.toString()},kt.prototype.toString=function(){return"SafeHtml{"+this.a+"}"};var Rt={};function Ot(t){var e=new kt;return e.a=t,e}Ot("<!DOCTYPE html>");var Pt,Mt,Lt=Ot("");function xt(t,e){for(var n=t.split("%s"),r="",i=Array.prototype.slice.call(arguments,1);i.length&&1<n.length;)r+=n.shift()+i.shift();return r+n.join("%s")}function qt(t){return yt.test(t)&&(-1!=t.indexOf("&")&&(t=t.replace(ht,"&amp;")),-1!=t.indexOf("<")&&(t=t.replace(lt,"&lt;")),-1!=t.indexOf(">")&&(t=t.replace(ft,"&gt;")),-1!=t.indexOf('"')&&(t=t.replace(pt,"&quot;")),-1!=t.indexOf("'")&&(t=t.replace(dt,"&#39;")),-1!=t.indexOf("\0")&&(t=t.replace(mt,"&#0;"))),t}function Ft(t){a.setTimeout(function(){throw t},0)}function Ut(){var t=a.MessageChannel;if(void 0===t&&"undefined"!=typeof window&&window.postMessage&&window.addEventListener&&!Dt("Presto")&&(t=function(){var t,e,n=document.createElement("IFRAME");n.style.display="none",t=n,e=ut(J(et)),x(t,"HTMLIFrameElement"),t.src=rt(e).toString(),document.documentElement.appendChild(n);var r=n.contentWindow;(n=r.document).open(),n.write(_t(Lt)),n.close();var i="callImmediate"+Math.random(),o="file:"==r.location.protocol?"*":r.location.protocol+"//"+r.location.host;n=E(function(t){"*"!=o&&t.origin!=o||t.data!=i||this.port1.onmessage()},this),r.addEventListener("message",n,!1),this.port1={},this.port2={postMessage:function(){r.postMessage(i,o)}}}),void 0!==t&&!Dt("Trident")&&!Dt("MSIE")){var e=new t,n={},r=n;return e.port1.onmessage=function(){if(void 0!==n.next){var t=(n=n.next).yb;n.yb=null,t()}},function(t){r.next={yb:t},r=r.next,e.port2.postMessage(0)}}return"undefined"!=typeof document&&"onreadystatechange"in document.createElement("SCRIPT")?function(t){var e=document.createElement("SCRIPT");e.onreadystatechange=function(){e.onreadystatechange=null,e.parentNode.removeChild(e),e=null,t(),t=null},document.documentElement.appendChild(e)}:function(t){a.setTimeout(t,0)}}function Vt(t,e){Mt||function(){if(a.Promise&&a.Promise.resolve){var t=a.Promise.resolve(void 0);Mt=function(){t.then(Kt)}}else Mt=function(){var t=Kt;!y(a.setImmediate)||a.Window&&a.Window.prototype&&!Dt("Edge")&&a.Window.prototype.setImmediate==a.setImmediate?(Pt||(Pt=Ut()),Pt(t)):a.setImmediate(t)}}(),Bt||(Mt(),Bt=!0),jt.add(t,e)}Ot("<br>");var Bt=!1,jt=new O;function Kt(){for(var t;t=M();){try{t.a.call(t.b)}catch(t){Ft(t)}R(P,t)}Bt=!1}function $t(t,e){if(this.a=Qt,this.i=void 0,this.f=this.b=this.c=null,this.g=this.h=!1,t!=l)try{var n=this;t.call(e,function(t){re(n,Wt,t)},function(t){if(!(t instanceof le))try{if(t instanceof Error)throw t;throw Error("Promise rejected.")}catch(t){}re(n,Gt,t)})}catch(t){re(this,Gt,t)}}var Qt=0,Wt=2,Gt=3;function zt(){this.next=this.f=this.b=this.g=this.a=null,this.c=!1}zt.prototype.reset=function(){this.f=this.b=this.g=this.a=null,this.c=!1};var Ht=new _(function(){return new zt},function(t){t.reset()});function Yt(t,e,n){var r=Ht.get();return r.g=t,r.b=e,r.f=n,r}function Xt(t){if(t instanceof $t)return t;var e=new $t(l);return re(e,Wt,t),e}function Jt(t){return new $t(function(e,n){n(t)})}function Zt(t,e,n){ie(t,e,n,null)||Vt(T(e,t))}function te(t){return new $t(function(e){var n=t.length,r=[];if(n)for(var i=function(t,i,o){n--,r[t]=i?{Gb:!0,value:o}:{Gb:!1,reason:o},0==n&&e(r)},o=0;o<t.length;o++)Zt(t[o],T(i,o,!0),T(i,o,!1));else e(r)})}function ee(t,e){t.b||t.a!=Wt&&t.a!=Gt||oe(t),t.f?t.f.next=e:t.b=e,t.f=e}function ne(t,e,n,r){var i=Yt(null,null,null);return i.a=new $t(function(t,o){i.g=e?function(n){try{var i=e.call(r,n);t(i)}catch(t){o(t)}}:t,i.b=n?function(e){try{var i=n.call(r,e);void 0===i&&e instanceof le?o(e):t(i)}catch(t){o(t)}}:o}),i.a.c=t,ee(t,i),i.a}function re(t,e,n){t.a==Qt&&(t===n&&(e=Gt,n=new TypeError("Promise cannot resolve to itself")),t.a=1,ie(n,t.Oc,t.Pc,t)||(t.i=n,t.a=e,t.c=null,oe(t),e!=Gt||n instanceof le||function(t,e){t.g=!0,Vt(function(){t.g&&he.call(null,e)})}(t,n)))}function ie(t,e,n,r){if(t instanceof $t)return ee(t,Yt(e||l,n||null,r)),!0;if(C(t))return t.then(e,n,r),!0;if(g(t))try{var i=t.then;if(y(i))return function(t,e,n,r,i){function o(t){a||(a=!0,r.call(i,t))}var a=!1;try{e.call(t,function(t){a||(a=!0,n.call(i,t))},o)}catch(t){o(t)}}(t,i,e,n,r),!0}catch(t){return n.call(r,t),!0}return!1}function oe(t){t.h||(t.h=!0,Vt(t.Zb,t))}function ae(t){var e=null;return t.b&&(e=t.b,t.b=e.next,e.next=null),t.b||(t.f=null),e}function se(t,e,n,r){if(n==Gt&&e.b&&!e.c)for(;t&&t.g;t=t.c)t.g=!1;if(e.a)e.a.c=null,ce(e,n,r);else try{e.c?e.g.call(e.f):ce(e,n,r)}catch(t){he.call(null,t)}R(Ht,e)}function ce(t,e,n){e==Wt?t.g.call(t.f,n):t.b&&t.b.call(t.f,n)}$t.prototype.then=function(t,e,n){return ne(this,y(t)?t:null,y(e)?e:null,n)},$t.prototype.$goog_Thenable=!0,(t=$t.prototype).ka=function(t,e){return(t=Yt(t,t,e)).c=!0,ee(this,t),this},t.s=function(t,e){return ne(this,null,t,e)},t.cancel=function(t){this.a==Qt&&Vt(function(){!function t(e,n){if(e.a==Qt)if(e.c){var r=e.c;if(r.b){for(var i=0,o=null,a=null,s=r.b;s&&(s.c||(i++,s.a==e&&(o=s),!(o&&1<i)));s=s.next)o||(a=s);o&&(r.a==Qt&&1==i?t(r,n):(a?((i=a).next==r.f&&(r.f=i),i.next=i.next.next):ae(r),se(r,o,Gt,n)))}e.c=null}else re(e,Gt,n)}(this,new le(t))},this)},t.Oc=function(t){this.a=Qt,re(this,Wt,t)},t.Pc=function(t){this.a=Qt,re(this,Gt,t)},t.Zb=function(){for(var t;t=ae(this);)se(this,t,this.a,this.i);this.h=!1};var he=Ft;function le(t){A.call(this,t)}function fe(){this.ta=this.ta,this.la=this.la}N(le,A),le.prototype.name="cancel";var pe=0;function de(t){if(!t.ta&&(t.ta=!0,t.xa(),0!=pe))t[v]||(t[v]=++b)}function me(t){return me[" "](t),t}fe.prototype.ta=!1,fe.prototype.xa=function(){if(this.la)for(;this.la.length;)this.la.shift()()},me[" "]=l;var ye,ge,ve=Dt("Opera"),be=Dt("Trident")||Dt("MSIE"),we=Dt("Edge"),Ie=we||be,Ee=Dt("Gecko")&&!(gt(Tt.toLowerCase(),"webkit")&&!Dt("Edge"))&&!(Dt("Trident")||Dt("MSIE"))&&!Dt("Edge"),Te=gt(Tt.toLowerCase(),"webkit")&&!Dt("Edge");function Se(){var t=a.document;return t?t.documentMode:void 0}t:{var Ne="",Ce=(ge=Tt,Ee?/rv:([^\);]+)(\)|;)/.exec(ge):we?/Edge\/([\d\.]+)/.exec(ge):be?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(ge):Te?/WebKit\/(\S+)/.exec(ge):ve?/(?:Version)[ \/]?(\S+)/.exec(ge):void 0);if(Ce&&(Ne=Ce?Ce[1]:""),be){var Ae=Se();if(null!=Ae&&Ae>parseFloat(Ne)){ye=String(Ae);break t}}ye=Ne}var De,ke={};function _e(t){return function(t,e){var n=ke;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=ct(String(ye)).split("."),r=ct(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=vt(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||vt(0==a[2].length,0==s[2].length)||vt(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}De=a.document&&be?Se():void 0;var Re=Object.freeze||function(t){return t},Oe=!be||9<=Number(De),Pe=be&&!_e("9"),Me=function(){if(!a.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{a.addEventListener("test",l,e),a.removeEventListener("test",l,e)}catch(t){}return t}();function Le(t,e){this.type=t,this.b=this.target=e,this.Mb=!0}function xe(t,e){if(Le.call(this,t?t.type:""),this.relatedTarget=this.b=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.a=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.b=e,e=t.relatedTarget){if(Ee){t:{try{me(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=s(t.pointerType)?t.pointerType:qe[t.pointerType]||"",this.a=t,t.defaultPrevented&&this.preventDefault()}}Le.prototype.preventDefault=function(){this.Mb=!1},N(xe,Le);var qe=Re({2:"touch",3:"pen",4:"mouse"});xe.prototype.preventDefault=function(){xe.qb.preventDefault.call(this);var t=this.a;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,Pe)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}},xe.prototype.f=function(){return this.a};var Fe="closure_listenable_"+(1e6*Math.random()|0),Ue=0;function Ve(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.Na=i,this.key=++Ue,this.ra=this.Ia=!1}function Be(t){t.ra=!0,t.listener=null,t.proxy=null,t.src=null,t.Na=null}function je(t){this.src=t,this.a={},this.b=0}function Ke(t,e){var n=e.type;n in t.a&&j(t.a[n],e)&&(Be(e),0==t.a[n].length&&(delete t.a[n],t.b--))}function $e(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.ra&&o.listener==e&&o.capture==!!n&&o.Na==r)return i}return-1}je.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=$e(t,e,r,i);return-1<a?(e=t[a],n||(e.Ia=!1)):((e=new Ve(e,this.src,o,!!r,i)).Ia=n,t.push(e)),e};var Qe="closure_lm_"+(1e6*Math.random()|0),We={};function Ge(t,e,n,r,i){if(r&&r.once)He(t,e,n,r,i);else if(d(e))for(var o=0;o<e.length;o++)Ge(t,e[o],n,r,i);else n=on(n),t&&t[Fe]?sn(t,e,n,g(r)?!!r.capture:!!r,i):ze(t,e,n,!1,r,i)}function ze(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=g(i)?!!i.capture:!!i,s=nn(t);if(s||(t[Qe]=s=new je(t)),!(n=s.add(e,n,r,a,o)).proxy)if(r=function(){var t=en,e=Oe?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)Me||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(Je(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}}function He(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)He(t,e[o],n,r,i);else n=on(n),t&&t[Fe]?un(t,e,n,g(r)?!!r.capture:!!r,i):ze(t,e,n,!0,r,i)}function Ye(t,e,n,r,i){if(d(e))for(var o=0;o<e.length;o++)Ye(t,e[o],n,r,i);else r=g(r)?!!r.capture:!!r,n=on(n),t&&t[Fe]?(t=t.u,(e=String(e).toString())in t.a&&(-1<(n=$e(o=t.a[e],n,r,i))&&(Be(o[n]),Array.prototype.splice.call(o,n,1),0==o.length&&(delete t.a[e],t.b--)))):t&&(t=nn(t))&&(e=t.a[e.toString()],t=-1,e&&(t=$e(e,n,r,i)),(n=-1<t?e[t]:null)&&Xe(n))}function Xe(t){if("number"!=typeof t&&t&&!t.ra){var e=t.src;if(e&&e[Fe])Ke(e.u,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(Je(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=nn(e))?(Ke(n,t),0==n.b&&(n.src=null,e[Qe]=null)):Be(t)}}}function Je(t){return t in We?We[t]:We[t]="on"+t}function Ze(t,e,n,r){var i=!0;if((t=nn(t))&&(e=t.a[e.toString()]))for(e=e.concat(),t=0;t<e.length;t++){var o=e[t];o&&o.capture==n&&!o.ra&&(o=tn(o,r),i=i&&!1!==o)}return i}function tn(t,e){var n=t.listener,r=t.Na||t.src;return t.Ia&&Xe(t),n.call(r,e)}function en(t,e){if(t.ra)return!0;if(!Oe){if(!e)t:{e=["window","event"];for(var n=a,r=0;r<e.length;r++)if(null==(n=n[e[r]])){e=null;break t}e=n}if(e=new xe(r=e,this),n=!0,!(0>r.keyCode||null!=r.returnValue)){t:{var i=!1;if(0==r.keyCode)try{r.keyCode=-1;break t}catch(t){i=!0}(i||null==r.returnValue)&&(r.returnValue=!0)}for(r=[],i=e.b;i;i=i.parentNode)r.push(i);for(t=t.type,i=r.length-1;0<=i;i--){e.b=r[i];var o=Ze(r[i],t,!0,e);n=n&&o}for(i=0;i<r.length;i++)e.b=r[i],o=Ze(r[i],t,!1,e),n=n&&o}return n}return tn(t,new xe(e,this))}function nn(t){return(t=t[Qe])instanceof je?t:null}var rn="__closure_events_fn_"+(1e9*Math.random()>>>0);function on(t){return y(t)?t:(t[rn]||(t[rn]=function(e){return t.handleEvent(e)}),t[rn])}function an(){fe.call(this),this.u=new je(this),this.Sb=this,this.Wa=null}function sn(t,e,n,r,i){t.u.add(String(e),n,!1,r,i)}function un(t,e,n,r,i){t.u.add(String(e),n,!0,r,i)}function cn(t,e,n,r){if(!(e=t.u.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.ra&&a.capture==n){var s=a.listener,u=a.Na||a.src;a.Ia&&Ke(t.u,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Mb}function hn(t,e,n){if(y(t))n&&(t=E(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=E(t.handleEvent,t)}return 2147483647<Number(e)?-1:a.setTimeout(t,e||0)}function ln(t){var e=null;return new $t(function(n,r){-1==(e=hn(function(){n(void 0)},t))&&r(Error("Failed to schedule timer."))}).s(function(t){throw a.clearTimeout(e),t})}function fn(t){if(t.U&&"function"==typeof t.U)return t.U();if(s(t))return t.split("");if(m(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}function pn(t){if(t.X&&"function"==typeof t.X)return t.X();if(!t.U||"function"!=typeof t.U){if(m(t)||s(t)){var e=[];t=t.length;for(var n=0;n<t;n++)e.push(n);return e}for(var r in e=[],n=0,t)e[n++]=r;return e}}function dn(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof dn)for(n=t.X(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function mn(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];yn(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)yn(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function yn(t,e){return Object.prototype.hasOwnProperty.call(t,e)}N(an,fe),an.prototype[Fe]=!0,an.prototype.addEventListener=function(t,e,n,r){Ge(this,t,e,n,r)},an.prototype.removeEventListener=function(t,e,n,r){Ye(this,t,e,n,r)},an.prototype.dispatchEvent=function(t){var e,n=this.Wa;if(n)for(e=[];n;n=n.Wa)e.push(n);n=this.Sb;var r=t.type||t;if(s(t))t=new Le(t,n);else if(t instanceof Le)t.target=t.target||n;else{var i=t;Y(t=new Le(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.b=e[o];i=cn(a,r,!0,t)&&i}if(i=cn(a=t.b=n,r,!0,t)&&i,i=cn(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=cn(a=t.b=e[o],r,!1,t)&&i;return i},an.prototype.xa=function(){if(an.qb.xa.call(this),this.u){var t,e=this.u;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)Be(n[r]);delete e.a[t],e.b--}}this.Wa=null},(t=dn.prototype).U=function(){mn(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},t.X=function(){return mn(this),this.a.concat()},t.clear=function(){this.b={},this.c=this.a.length=0},t.get=function(t,e){return yn(this.b,t)?this.b[t]:e},t.set=function(t,e){yn(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},t.forEach=function(t,e){for(var n=this.X(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var gn=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function vn(t,e){var n;this.b=this.i=this.f="",this.l=null,this.g=this.c="",this.h=!1,t instanceof vn?(this.h=void 0!==e?e:t.h,bn(this,t.f),this.i=t.i,this.b=t.b,wn(this,t.l),this.c=t.c,In(this,Vn(t.a)),this.g=t.g):t&&(n=String(t).match(gn))?(this.h=!!e,bn(this,n[1]||"",!0),this.i=Cn(n[2]||""),this.b=Cn(n[3]||"",!0),wn(this,n[4]),this.c=Cn(n[5]||"",!0),In(this,n[6]||"",!0),this.g=Cn(n[7]||"")):(this.h=!!e,this.a=new Mn(null,this.h))}function bn(t,e,n){t.f=n?Cn(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function wn(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.l=e}else t.l=null}function In(t,e,n){e instanceof Mn?(t.a=e,function(t,e){e&&!t.f&&(Ln(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(qn(this,e),Un(this,n,t))},t)),t.f=e}(t.a,t.h)):(n||(e=An(e,On)),t.a=new Mn(e,t.h))}function En(t,e,n){t.a.set(e,n)}function Tn(t,e){return t.a.get(e)}function Sn(t){return t instanceof vn?new vn(t):new vn(t,void 0)}function Nn(t,e){var n=new vn(null,void 0);return bn(n,"https"),t&&(n.b=t),e&&(n.c=e),n}function Cn(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function An(t,e,n){return s(t)?(t=encodeURI(t).replace(e,Dn),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Dn(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}vn.prototype.toString=function(){var t=[],e=this.f;e&&t.push(An(e,kn,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.i)&&t.push(An(e,kn,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.l)&&t.push(":",String(n))),(n=this.c)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(An(n,"/"==n.charAt(0)?Rn:_n,!0))),(n=this.a.toString())&&t.push("?",n),(n=this.g)&&t.push("#",An(n,Pn)),t.join("")},vn.prototype.resolve=function(t){var e=new vn(this),n=!!t.f;n?bn(e,t.f):n=!!t.i,n?e.i=t.i:n=!!t.b,n?e.b=t.b:n=null!=t.l;var r=t.c;if(n)wn(e,t.l);else if(n=!!t.c){if("/"!=r.charAt(0))if(this.b&&!this.c)r="/"+r;else{var i=e.c.lastIndexOf("/");-1!=i&&(r=e.c.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(gt(i,"./")||gt(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.c=r:n=""!==t.a.toString(),n?In(e,Vn(t.a)):n=!!t.g,n&&(e.g=t.g),e};var kn=/[#\/\?@]/g,_n=/[#\?:]/g,Rn=/[#\?]/g,On=/[#\?@]/g,Pn=/#/g;function Mn(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function Ln(t){t.a||(t.a=new dn,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function xn(t){var e=pn(t);if(void 0===e)throw Error("Keys are undefined");var n=new Mn(null,void 0);t=fn(t);for(var r=0;r<e.length;r++){var i=e[r],o=t[r];d(o)?Un(n,i,o):n.add(i,o)}return n}function qn(t,e){Ln(t),e=Bn(t,e),yn(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,yn((t=t.a).b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&mn(t)))}function Fn(t,e){return Ln(t),e=Bn(t,e),yn(t.a.b,e)}function Un(t,e,n){qn(t,e),0<n.length&&(t.c=null,t.a.set(Bn(t,e),Q(n)),t.b+=n.length)}function Vn(t){var e=new Mn;return e.c=t.c,t.a&&(e.a=new dn(t.a),e.b=t.b),e}function Bn(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}(t=Mn.prototype).add=function(t,e){Ln(this),this.c=null,t=Bn(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},t.clear=function(){this.a=this.c=null,this.b=0},t.forEach=function(t,e){Ln(this),this.a.forEach(function(n,r){F(n,function(n){t.call(e,n,r,this)},this)},this)},t.X=function(){Ln(this);for(var t=this.a.U(),e=this.a.X(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},t.U=function(t){Ln(this);var e=[];if(s(t))Fn(this,t)&&(e=$(e,this.a.get(Bn(this,t))));else{t=this.a.U();for(var n=0;n<t.length;n++)e=$(e,t[n])}return e},t.set=function(t,e){return Ln(this),this.c=null,Fn(this,t=Bn(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},t.get=function(t,e){return t&&0<(t=this.U(t)).length?String(t[0]):e},t.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.X(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.U(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")};var jn=!be||9<=Number(De);function Kn(t){var e=document;return s(t)?e.getElementById(t):t}function $n(t,e){W(e,function(e,n){e&&"object"==typeof e&&e.qa&&(e=e.pa()),"style"==n?t.style.cssText=e:"class"==n?t.className=e:"for"==n?t.htmlFor=e:Qn.hasOwnProperty(n)?t.setAttribute(Qn[n],e):0==n.lastIndexOf("aria-",0)||0==n.lastIndexOf("data-",0)?t.setAttribute(n,e):t[n]=e})}var Qn={cellpadding:"cellPadding",cellspacing:"cellSpacing",colspan:"colSpan",frameborder:"frameBorder",height:"height",maxlength:"maxLength",nonce:"nonce",role:"role",rowspan:"rowSpan",type:"type",usemap:"useMap",valign:"vAlign",width:"width"};function Wn(t,e,n){var r=arguments,i=document,o=String(r[0]),a=r[1];if(!jn&&a&&(a.name||a.type)){if(o=["<",o],a.name&&o.push(' name="',qt(a.name),'"'),a.type){o.push(' type="',qt(a.type),'"');var u={};Y(u,a),delete u.type,a=u}o.push(">"),o=o.join("")}return o=i.createElement(o),a&&(s(a)?o.className=a:d(a)?o.className=a.join(" "):$n(o,a)),2<r.length&&function(t,e,n){function r(n){n&&e.appendChild(s(n)?t.createTextNode(n):n)}for(var i=2;i<n.length;i++){var o=n[i];!m(o)||g(o)&&0<o.nodeType?r(o):F(Gn(o)?Q(o):o,r)}}(i,o,r),o}function Gn(t){if(t&&"number"==typeof t.length){if(g(t))return"function"==typeof t.item||"string"==typeof t.item;if(y(t))return"function"==typeof t.item}return!1}function zn(t){var e=[];return function t(e,n,r){if(null==n)r.push("null");else{if("object"==typeof n){if(d(n)){var i=n;n=i.length,r.push("[");for(var o="",a=0;a<n;a++)r.push(o),t(e,i[a],r),o=",";return void r.push("]")}if(!(n instanceof String||n instanceof Number||n instanceof Boolean)){for(i in r.push("{"),o="",n)Object.prototype.hasOwnProperty.call(n,i)&&("function"!=typeof(a=n[i])&&(r.push(o),Jn(i,r),r.push(":"),t(e,a,r),o=","));return void r.push("}")}n=n.valueOf()}switch(typeof n){case"string":Jn(n,r);break;case"number":r.push(isFinite(n)&&!isNaN(n)?String(n):"null");break;case"boolean":r.push(String(n));break;case"function":r.push("null");break;default:throw Error("Unknown type: "+typeof n)}}}(new Hn,t,e),e.join("")}function Hn(){}var Yn={'"':'\\"',"\\":"\\\\","/":"\\/","\b":"\\b","\f":"\\f","\n":"\\n","\r":"\\r","\t":"\\t","\v":"\\u000b"},Xn=/\uffff/.test("￿")?/[\\"\x00-\x1f\x7f-\uffff]/g:/[\\"\x00-\x1f\x7f-\xff]/g;function Jn(t,e){e.push('"',t.replace(Xn,function(t){var e=Yn[t];return e||(e="\\u"+(65536|t.charCodeAt(0)).toString(16).substr(1),Yn[t]=e),e}),'"')}function Zn(){var t=vr();return be&&!!De&&11==De||/Edge\/\d+/.test(t)}function tr(){return a.window&&a.window.location.href||self&&self.location&&self.location.href||""}function er(t,e){e=e||a.window;var n="about:blank";t&&(n=wt(Et(t)).toString()),e.location.href=n}function nr(t){return!!((t=(t||vr()).toLowerCase()).match(/android/)||t.match(/webos/)||t.match(/iphone|ipad|ipod/)||t.match(/blackberry/)||t.match(/windows phone/)||t.match(/iemobile/))}function rr(t){t=t||a.window;try{t.close()}catch(t){}}function ir(t,e,n){var r=Math.floor(1e9*Math.random()).toString();e=e||500,n=n||600;var i=(window.screen.availHeight-n)/2,o=(window.screen.availWidth-e)/2;for(a in e={width:e,height:n,top:0<i?i:0,left:0<o?o:0,location:!0,resizable:!0,statusbar:!0,toolbar:!1},n=vr().toLowerCase(),r&&(e.target=r,gt(n,"crios/")&&(e.target="_blank")),mr(vr())==pr&&(t=t||"http://localhost",e.scrollbars=!0),n=t||"",(t=e)||(t={}),r=window,e=n instanceof bt?n:Et(void 0!==n.href?n.href:String(n)),n=t.target||n.target,i=[],t)switch(a){case"width":case"height":case"top":case"left":i.push(a+"="+t[a]);break;case"target":case"noopener":case"noreferrer":break;default:i.push(a+"="+(t[a]?1:0))}var a=i.join(",");if((Dt("iPhone")&&!Dt("iPod")&&!Dt("iPad")||Dt("iPad")||Dt("iPod"))&&r.navigator&&r.navigator.standalone&&n&&"_self"!=n?(x(a=r.document.createElement("A"),"HTMLAnchorElement"),e instanceof bt||e instanceof bt||(e="object"==typeof e&&e.qa?e.pa():String(e),It.test(e)||(e="about:invalid#zClosurez"),e=Nt(e)),a.href=wt(e),a.setAttribute("target",n),t.noreferrer&&a.setAttribute("rel","noreferrer"),(t=document.createEvent("MouseEvent")).initMouseEvent("click",!0,!0,r,1),a.dispatchEvent(t),a={}):t.noreferrer?(a=r.open("",n,a),t=wt(e).toString(),a&&(Ie&&gt(t,";")&&(t="'"+t.replace(/'/g,"%27")+"'"),a.opener=null,t=Ot('<meta name="referrer" content="no-referrer"><meta http-equiv="refresh" content="0; url='+qt(t)+'">'),a.document.write(_t(t)),a.document.close())):(a=r.open(wt(e).toString(),n,a))&&t.noopener&&(a.opener=null),a)try{a.focus()}catch(t){}return a}var or=/^\d{1,3}\.\d{1,3}\.\d{1,3}\.\d{1,3}$/,ar=/^[^@]+@[^@]+$/;function sr(){var t=null;return new $t(function(e){"complete"==a.document.readyState?e():(t=function(){e()},He(window,"load",t))}).s(function(e){throw Ye(window,"load",t),e})}function ur(t){return t=t||vr(),!("file:"!==Tr()||!t.toLowerCase().match(/iphone|ipad|ipod|android/))}function cr(){var t=a.window;try{return!(!t||t==t.top)}catch(t){return!1}}function hr(){return void 0!==a.WorkerGlobalScope&&"function"==typeof a.importScripts}function lr(){return ue.INTERNAL.hasOwnProperty("reactNative")?"ReactNative":ue.INTERNAL.hasOwnProperty("node")?"Node":hr()?"Worker":"Browser"}function fr(){var t=lr();return"ReactNative"===t||"Node"===t}var pr="Firefox",dr="Chrome";function mr(t){var e=t.toLowerCase();return gt(e,"opera/")||gt(e,"opr/")||gt(e,"opios/")?"Opera":gt(e,"iemobile")?"IEMobile":gt(e,"msie")||gt(e,"trident/")?"IE":gt(e,"edge/")?"Edge":gt(e,"firefox/")?pr:gt(e,"silk/")?"Silk":gt(e,"blackberry")?"Blackberry":gt(e,"webos")?"Webos":!gt(e,"safari/")||gt(e,"chrome/")||gt(e,"crios/")||gt(e,"android")?!gt(e,"chrome/")&&!gt(e,"crios/")||gt(e,"edge/")?gt(e,"android")?"Android":(t=t.match(/([a-zA-Z\d\.]+)\/[a-zA-Z\d\.]*$/))&&2==t.length?t[1]:"Other":dr:"Safari"}var yr={Vc:"FirebaseCore-web",Xc:"FirebaseUI-web"};function gr(t,e){e=e||[];var n,r=[],i={};for(n in yr)i[yr[n]]=!0;for(n=0;n<e.length;n++)void 0!==i[e[n]]&&(delete i[e[n]],r.push(e[n]));return r.sort(),(e=r).length||(e=["FirebaseCore-web"]),"Browser"===(r=lr())?r=mr(i=vr()):"Worker"===r&&(r=mr(i=vr())+"-"+r),r+"/JsCore/"+t+"/"+e.join(",")}function vr(){return a.navigator&&a.navigator.userAgent||""}function br(t,e){t=t.split("."),e=e||a;for(var n=0;n<t.length&&"object"==typeof e&&null!=e;n++)e=e[t[n]];return n!=t.length&&(e=void 0),e}function wr(){try{var t=a.localStorage,e=Dr();if(t)return t.setItem(e,"1"),t.removeItem(e),!Zn()||!!a.indexedDB}catch(t){return hr()&&!!a.indexedDB}return!1}function Ir(){return(Er()||"chrome-extension:"===Tr()||ur())&&!fr()&&wr()&&!hr()}function Er(){return"http:"===Tr()||"https:"===Tr()}function Tr(){return a.location&&a.location.protocol||null}function Sr(t){return!nr(t=t||vr())&&mr(t)!=pr}function Nr(t){return void 0===t?null:zn(t)}function Cr(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&null!==t[e]&&void 0!==t[e]&&(n[e]=t[e]);return n}function Ar(t){if(null!==t)return JSON.parse(t)}function Dr(t){return t||Math.floor(1e9*Math.random()).toString()}function kr(t){return"Safari"!=mr(t=t||vr())&&!t.toLowerCase().match(/iphone|ipad|ipod/)}function _r(){var t=a.___jsl;if(t&&t.H)for(var e in t.H)if(t.H[e].r=t.H[e].r||[],t.H[e].L=t.H[e].L||[],t.H[e].r=t.H[e].L.concat(),t.CP)for(var n=0;n<t.CP.length;n++)t.CP[n]=null}function Rr(t,e){if(t>e)throw Error("Short delay should be less than long delay!");this.a=t,this.c=e,t=vr(),e=lr(),this.b=nr(t)||"ReactNative"===e}function Or(){var t=a.document;return!t||void 0===t.visibilityState||"visible"==t.visibilityState}function Pr(t){try{var e=new Date(parseInt(t,10));if(!isNaN(e.getTime())&&!/[^0-9]/.test(t))return e.toUTCString()}catch(t){}return null}function Mr(){return!(!br("fireauth.oauthhelper",a)&&!br("fireauth.iframe",a))}Rr.prototype.get=function(){var t=a.navigator;return!t||"boolean"!=typeof t.onLine||!Er()&&"chrome-extension:"!==Tr()&&void 0===t.connection||t.onLine?this.b?this.c:this.a:Math.min(5e3,this.a)};var Lr,xr={};function qr(t){xr[t]||(xr[t]=!0,"undefined"!=typeof console&&"function"==typeof console.warn&&console.warn(t))}try{var Fr={};Object.defineProperty(Fr,"abcd",{configurable:!0,enumerable:!0,value:1}),Object.defineProperty(Fr,"abcd",{configurable:!0,enumerable:!0,value:2}),Lr=2==Fr.abcd}catch(ge){Lr=!1}function Ur(t,e,n){Lr?Object.defineProperty(t,e,{configurable:!0,enumerable:!0,value:n}):t[e]=n}function Vr(t,e){if(e)for(var n in e)e.hasOwnProperty(n)&&Ur(t,n,e[n])}function Br(t){var e={};return Vr(e,t),e}function jr(t){var e=t;if("object"==typeof t&&null!=t)for(var n in e="length"in t?[]:{},t)Ur(e,n,jr(t[n]));return e}function Kr(t){var e={},n=t[Qr],r=t[Wr];if(!(t=t[Gr])||t!=$r&&!n)throw Error("Invalid provider user info!");e[Hr]=r||null,e[zr]=n||null,Ur(this,Xr,t),Ur(this,Yr,jr(e))}var $r="EMAIL_SIGNIN",Qr="email",Wr="newEmail",Gr="requestType",zr="email",Hr="fromEmail",Yr="data",Xr="operation";function Jr(t,e){this.code=ti+t,this.message=e||ei[t]||""}function Zr(t){var e=t&&t.code;return e?new Jr(e.substring(ti.length),t.message):null}N(Jr,Error),Jr.prototype.A=function(){return{code:this.code,message:this.message}},Jr.prototype.toJSON=function(){return this.A()};var ti="auth/",ei={"admin-restricted-operation":"This operation is restricted to administrators only.","argument-error":"","app-not-authorized":"This app, identified by the domain where it's hosted, is not authorized to use Firebase Authentication with the provided API key. Review your key configuration in the Google API console.","app-not-installed":"The requested mobile application corresponding to the identifier (Android package name or iOS bundle ID) provided is not installed on this device.","captcha-check-failed":"The reCAPTCHA response token provided is either invalid, expired, already used or the domain associated with it does not match the list of whitelisted domains.","code-expired":"The SMS code has expired. Please re-send the verification code to try again.","cordova-not-ready":"Cordova framework is not ready.","cors-unsupported":"This browser is not supported.","credential-already-in-use":"This credential is already associated with a different user account.","custom-token-mismatch":"The custom token corresponds to a different audience.","requires-recent-login":"This operation is sensitive and requires recent authentication. Log in again before retrying this request.","dynamic-link-not-activated":"Please activate Dynamic Links in the Firebase Console and agree to the terms and conditions.","email-already-in-use":"The email address is already in use by another account.","expired-action-code":"The action code has expired. ","cancelled-popup-request":"This operation has been cancelled due to another conflicting popup being opened.","internal-error":"An internal error has occurred.","invalid-app-credential":"The phone verification request contains an invalid application verifier. The reCAPTCHA token response is either invalid or expired.","invalid-app-id":"The mobile app identifier is not registed for the current project.","invalid-user-token":"This user's credential isn't valid for this project. This can happen if the user's token has been tampered with, or if the user isn't for the project associated with this API key.","invalid-auth-event":"An internal error has occurred.","invalid-verification-code":"The SMS verification code used to create the phone auth credential is invalid. Please resend the verification code sms and be sure use the verification code provided by the user.","invalid-continue-uri":"The continue URL provided in the request is invalid.","invalid-cordova-configuration":"The following Cordova plugins must be installed to enable OAuth sign-in: cordova-plugin-buildinfo, cordova-universal-links-plugin, cordova-plugin-browsertab, cordova-plugin-inappbrowser and cordova-plugin-customurlscheme.","invalid-custom-token":"The custom token format is incorrect. Please check the documentation.","invalid-dynamic-link-domain":"The provided dynamic link domain is not configured or authorized for the current project.","invalid-email":"The email address is badly formatted.","invalid-api-key":"Your API key is invalid, please check you have copied it correctly.","invalid-cert-hash":"The SHA-1 certificate hash provided is invalid.","invalid-credential":"The supplied auth credential is malformed or has expired.","invalid-message-payload":"The email template corresponding to this action contains invalid characters in its message. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-oauth-provider":"EmailAuthProvider is not supported for this operation. This operation only supports OAuth providers.","invalid-oauth-client-id":"The OAuth client ID provided is either invalid or does not match the specified API key.","unauthorized-domain":"This domain is not authorized for OAuth operations for your Firebase project. Edit the list of authorized domains from the Firebase console.","invalid-action-code":"The action code is invalid. This can happen if the code is malformed, expired, or has already been used.","wrong-password":"The password is invalid or the user does not have a password.","invalid-persistence-type":"The specified persistence type is invalid. It can only be local, session or none.","invalid-phone-number":"The format of the phone number provided is incorrect. Please enter the phone number in a format that can be parsed into E.164 format. E.164 phone numbers are written in the format [+][country code][subscriber number including area code].","invalid-provider-id":"The specified provider ID is invalid.","invalid-recipient-email":"The email corresponding to this action failed to send as the provided recipient email address is invalid.","invalid-sender":"The email template corresponding to this action contains an invalid sender email or name. Please fix by going to the Auth email templates section in the Firebase Console.","invalid-verification-id":"The verification ID used to create the phone auth credential is invalid.","invalid-tenant-id":"The Auth instance's tenant ID is invalid.","missing-android-pkg-name":"An Android Package Name must be provided if the Android App is required to be installed.","auth-domain-config-required":"Be sure to include authDomain when calling firebase.initializeApp(), by following the instructions in the Firebase console.","missing-app-credential":"The phone verification request is missing an application verifier assertion. A reCAPTCHA response token needs to be provided.","missing-verification-code":"The phone auth credential was created with an empty SMS verification code.","missing-continue-uri":"A continue URL must be provided in the request.","missing-iframe-start":"An internal error has occurred.","missing-ios-bundle-id":"An iOS Bundle ID must be provided if an App Store ID is provided.","missing-or-invalid-nonce":"The OIDC ID token requires a valid unhashed nonce.","missing-phone-number":"To send verification codes, provide a phone number for the recipient.","missing-verification-id":"The phone auth credential was created with an empty verification ID.","app-deleted":"This instance of FirebaseApp has been deleted.","account-exists-with-different-credential":"An account already exists with the same email address but different sign-in credentials. Sign in using a provider associated with this email address.","network-request-failed":"A network error (such as timeout, interrupted connection or unreachable host) has occurred.","no-auth-event":"An internal error has occurred.","no-such-provider":"User was not linked to an account with the given provider.","null-user":"A null user object was provided as the argument for an operation which requires a non-null user object.","operation-not-allowed":"The given sign-in provider is disabled for this Firebase project. Enable it in the Firebase console, under the sign-in method tab of the Auth section.","operation-not-supported-in-this-environment":'This operation is not supported in the environment this application is running on. "location.protocol" must be http, https or chrome-extension and web storage must be enabled.',"popup-blocked":"Unable to establish a connection with the popup. It may have been blocked by the browser.","popup-closed-by-user":"The popup has been closed by the user before finalizing the operation.","provider-already-linked":"User can only be linked to one identity for the given provider.","quota-exceeded":"The project's quota for this operation has been exceeded.","redirect-cancelled-by-user":"The redirect operation has been cancelled by the user before finalizing.","redirect-operation-pending":"A redirect sign-in operation is already pending.","rejected-credential":"The request contains malformed or mismatching credentials.","tenant-id-mismatch":"The provided tenant ID does not match the Auth instance's tenant ID",timeout:"The operation has timed out.","user-token-expired":"The user's credential is no longer valid. The user must sign in again.","too-many-requests":"We have blocked all requests from this device due to unusual activity. Try again later.","unauthorized-continue-uri":"The domain of the continue URL is not whitelisted.  Please whitelist the domain in the Firebase console.","unsupported-persistence-type":"The current environment does not support the specified persistence type.","unsupported-tenant-operation":"This operation is not supported in a multi-tenant context.","user-cancelled":"User did not grant your application the permissions it requested.","user-not-found":"There is no user record corresponding to this identifier. The user may have been deleted.","user-disabled":"The user account has been disabled by an administrator.","user-mismatch":"The supplied credentials do not correspond to the previously signed in user.","user-signed-out":"","weak-password":"The password must be 6 characters long or more.","web-storage-unsupported":"This browser is not supported or 3rd party cookies and data may be disabled."};function ni(t){var e=Tn(t=Sn(t),ri)||null,n=Tn(t,ii)||null,r=Tn(t,si)||null;if(r=r&&ci[r]||null,!e||!n||!r)throw new Jr("argument-error",ri+", "+ii+"and "+si+" are required in a valid action code URL.");Vr(this,{apiKey:e,operation:r,code:n,continueUrl:Tn(t,oi)||null,languageCode:Tn(t,ai)||null,tenantId:Tn(t,ui)||null})}var ri="apiKey",ii="oobCode",oi="continueUrl",ai="languageCode",si="mode",ui="tenantId",ci={recoverEmail:"RECOVER_EMAIL",resetPassword:"PASSWORD_RESET",signIn:$r,verifyEmail:"VERIFY_EMAIL"};function hi(t){try{return new ni(t)}catch(t){return null}}function li(t){var e=t[yi];if(void 0===e)throw new Jr("missing-continue-uri");if("string"!=typeof e||"string"==typeof e&&!e.length)throw new Jr("invalid-continue-uri");this.h=e,this.b=this.a=null,this.g=!1;var n=t[fi];if(n&&"object"==typeof n){e=n[bi];var r=n[gi];if(n=n[vi],"string"==typeof e&&e.length){if(this.a=e,void 0!==r&&"boolean"!=typeof r)throw new Jr("argument-error",gi+" property must be a boolean when specified.");if(this.g=!!r,void 0!==n&&("string"!=typeof n||"string"==typeof n&&!n.length))throw new Jr("argument-error",vi+" property must be a non empty string when specified.");this.b=n||null}else{if(void 0!==e)throw new Jr("argument-error",bi+" property must be a non empty string when specified.");if(void 0!==r||void 0!==n)throw new Jr("missing-android-pkg-name")}}else if(void 0!==n)throw new Jr("argument-error",fi+" property must be a non null object when specified.");if(this.f=null,(e=t[mi])&&"object"==typeof e){if("string"==typeof(e=e[wi])&&e.length)this.f=e;else if(void 0!==e)throw new Jr("argument-error",wi+" property must be a non empty string when specified.")}else if(void 0!==e)throw new Jr("argument-error",mi+" property must be a non null object when specified.");if(void 0!==(e=t[di])&&"boolean"!=typeof e)throw new Jr("argument-error",di+" property must be a boolean when specified.");if(this.c=!!e,void 0!==(t=t[pi])&&("string"!=typeof t||"string"==typeof t&&!t.length))throw new Jr("argument-error",pi+" property must be a non empty string when specified.");this.i=t||null}var fi="android",pi="dynamicLinkDomain",di="handleCodeInApp",mi="iOS",yi="url",gi="installApp",vi="minimumVersion",bi="packageName",wi="bundleId";function Ii(t){var e={};for(var n in e.continueUrl=t.h,e.canHandleCodeInApp=t.c,(e.androidPackageName=t.a)&&(e.androidMinimumVersion=t.b,e.androidInstallApp=t.g),e.iOSBundleId=t.f,e.dynamicLinkDomain=t.i,e)null===e[n]&&delete e[n];return e}var Ei=null,Ti=null;function Si(t){var e="";return function(t,e){function n(e){for(;r<t.length;){var n=t.charAt(r++),i=Ti[n];if(null!=i)return i;if(!/^[\s\xa0]*$/.test(n))throw Error("Unknown base64 encoding at char: "+n)}return e}!function(){if(!Ei){Ei={},Ti={};for(var t=0;65>t;t++)Ei[t]="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".charAt(t),Ti[Ei[t]]=t,62<=t&&(Ti["ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_.".charAt(t)]=t)}}();for(var r=0;;){var i=n(-1),o=n(0),a=n(64),s=n(64);if(64===s&&-1===i)break;e(i<<2|o>>4),64!=a&&(e(o<<4&240|a>>2),64!=s&&e(a<<6&192|s))}}(t,function(t){e+=String.fromCharCode(t)}),e}function Ni(t){this.f=t.sub,this.a=t.provider_id||t.firebase&&t.firebase.sign_in_provider||null,this.c=t.firebase&&t.firebase.tenant||null,this.b=!!t.is_anonymous||"anonymous"==this.a}function Ci(t){return(t=Ai(t))&&t.sub&&t.iss&&t.aud&&t.exp?new Ni(t):null}function Ai(t){if(!t)return null;if(3!=(t=t.split(".")).length)return null;for(var e=(4-(t=t[1]).length%4)%4,n=0;n<e;n++)t+=".";try{return JSON.parse(Si(t))}catch(t){}return null}Ni.prototype.R=function(){return this.c},Ni.prototype.g=function(){return this.b};var Di,ki={ad:{bb:"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://securetoken.googleapis.com/v1/token",id:"p"},cd:{bb:"https://staging-www.sandbox.googleapis.com/identitytoolkit/v3/relyingparty/",ib:"https://staging-securetoken.sandbox.googleapis.com/v1/token",id:"s"},dd:{bb:"https://www-googleapis-test.sandbox.google.com/identitytoolkit/v3/relyingparty/",ib:"https://test-securetoken.sandbox.googleapis.com/v1/token",id:"t"}};function _i(t){for(var e in ki)if(ki[e].id===t)return{firebaseEndpoint:(t=ki[e]).bb,secureTokenEndpoint:t.ib};return null}Di=_i("__EID__")?"__EID__":void 0;var Ri="oauth_consumer_key oauth_nonce oauth_signature oauth_signature_method oauth_timestamp oauth_token oauth_version".split(" "),Oi=["client_id","response_type","scope","redirect_uri","state"],Pi={Wc:{Oa:"locale",Da:500,Ca:600,Pa:"facebook.com",hb:Oi},Yc:{Oa:null,Da:500,Ca:620,Pa:"github.com",hb:Oi},Zc:{Oa:"hl",Da:515,Ca:680,Pa:"google.com",hb:Oi},ed:{Oa:"lang",Da:485,Ca:705,Pa:"twitter.com",hb:Ri}};function Mi(t){for(var e in Pi)if(Pi[e].Pa==t)return Pi[e];return null}function Li(t){var e={};e["facebook.com"]=Vi,e["google.com"]=ji,e["github.com"]=Bi,e["twitter.com"]=Ki;var n=t&&t[qi];try{if(n)return e[n]?new e[n](t):new Ui(t);if(void 0!==t[xi])return new Fi(t)}catch(t){}return null}var xi="idToken",qi="providerId";function Fi(t){var e=t[qi];if(!e&&t[xi]){var n=Ci(t[xi]);n&&n.a&&(e=n.a)}if(!e)throw Error("Invalid additional user info!");"anonymous"!=e&&"custom"!=e||(e=null),n=!1,void 0!==t.isNewUser?n=!!t.isNewUser:"identitytoolkit#SignupNewUserResponse"===t.kind&&(n=!0),Ur(this,"providerId",e),Ur(this,"isNewUser",n)}function Ui(t){Fi.call(this,t),Ur(this,"profile",jr((t=Ar(t.rawUserInfo||"{}"))||{}))}function Vi(t){if(Ui.call(this,t),"facebook.com"!=this.providerId)throw Error("Invalid provider ID!")}function Bi(t){if(Ui.call(this,t),"github.com"!=this.providerId)throw Error("Invalid provider ID!");Ur(this,"username",this.profile&&this.profile.login||null)}function ji(t){if(Ui.call(this,t),"google.com"!=this.providerId)throw Error("Invalid provider ID!")}function Ki(t){if(Ui.call(this,t),"twitter.com"!=this.providerId)throw Error("Invalid provider ID!");Ur(this,"username",t.screenName||null)}function $i(t){var e=Sn(t),n=Tn(e,"link"),r=Tn(Sn(n),"link");return e=Tn(e,"deep_link_id"),Tn(Sn(e),"link")||e||r||n||t}function Qi(){}function Wi(t,e){return t.then(function(t){if(t[Ma]){var n=Ci(t[Ma]);if(!n||e!=n.f)throw new Jr("user-mismatch");return t}throw new Jr("user-mismatch")}).s(function(t){throw t&&t.code&&t.code==ti+"user-not-found"?new Jr("user-mismatch"):t})}function Gi(t,e){if(!e)throw new Jr("internal-error","failed to construct a credential");this.a=e,Ur(this,"providerId",t),Ur(this,"signInMethod",t)}function zi(t){return{pendingToken:t.a,requestUri:"http://localhost"}}function Hi(t){if(t&&t.providerId&&t.signInMethod&&0==t.providerId.indexOf("saml.")&&t.pendingToken)try{return new Gi(t.providerId,t.pendingToken)}catch(t){}return null}function Yi(t,e,n){if(this.a=null,e.idToken||e.accessToken)e.idToken&&Ur(this,"idToken",e.idToken),e.accessToken&&Ur(this,"accessToken",e.accessToken),e.nonce&&!e.pendingToken&&Ur(this,"nonce",e.nonce),e.pendingToken&&(this.a=e.pendingToken);else{if(!e.oauthToken||!e.oauthTokenSecret)throw new Jr("internal-error","failed to construct a credential");Ur(this,"accessToken",e.oauthToken),Ur(this,"secret",e.oauthTokenSecret)}Ur(this,"providerId",t),Ur(this,"signInMethod",n)}function Xi(t){var e={};return t.idToken&&(e.id_token=t.idToken),t.accessToken&&(e.access_token=t.accessToken),t.secret&&(e.oauth_token_secret=t.secret),e.providerId=t.providerId,t.nonce&&!t.a&&(e.nonce=t.nonce),e={postBody:xn(e).toString(),requestUri:"http://localhost"},t.a&&(delete e.postBody,e.pendingToken=t.a),e}function Ji(t){if(t&&t.providerId&&t.signInMethod){var e={idToken:t.oauthIdToken,accessToken:t.oauthTokenSecret?null:t.oauthAccessToken,oauthTokenSecret:t.oauthTokenSecret,oauthToken:t.oauthTokenSecret&&t.oauthAccessToken,nonce:t.nonce,pendingToken:t.pendingToken};try{return new Yi(t.providerId,e,t.signInMethod)}catch(t){}}return null}function Zi(t,e){this.Fc=e||[],Vr(this,{providerId:t,isOAuthProvider:!0}),this.zb={},this.cb=(Mi(t)||{}).Oa||null,this.ab=null}function to(t){if("string"!=typeof t||0!=t.indexOf("saml."))throw new Jr("argument-error",'SAML provider IDs must be prefixed with "saml."');Zi.call(this,t,[])}function eo(t){Zi.call(this,t,Oi),this.a=[]}function no(){eo.call(this,"facebook.com")}function ro(t){if(!t)throw new Jr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new no).credential({accessToken:e})}function io(){eo.call(this,"github.com")}function oo(t){if(!t)throw new Jr("argument-error","credential failed: expected 1 argument (the OAuth access token).");var e=t;return g(t)&&(e=t.accessToken),(new io).credential({accessToken:e})}function ao(){eo.call(this,"google.com"),this.wa("profile")}function so(t,e){var n=t;return g(t)&&(n=t.idToken,e=t.accessToken),(new ao).credential({idToken:n,accessToken:e})}function uo(){Zi.call(this,"twitter.com",Ri)}function co(t,e){var n=t;if(g(n)||(n={oauthToken:t,oauthTokenSecret:e}),!n.oauthToken||!n.oauthTokenSecret)throw new Jr("argument-error","credential failed: expected 2 arguments (the OAuth access token and secret).");return new Yi("twitter.com",n,"twitter.com")}function ho(t,e,n){this.a=t,this.c=e,Ur(this,"providerId","password"),Ur(this,"signInMethod",n===fo.EMAIL_LINK_SIGN_IN_METHOD?fo.EMAIL_LINK_SIGN_IN_METHOD:fo.EMAIL_PASSWORD_SIGN_IN_METHOD)}function lo(t){return t&&t.email&&t.password?new ho(t.email,t.password,t.signInMethod):null}function fo(){Vr(this,{providerId:"password",isOAuthProvider:!1})}function po(t,e){if(!(e=mo(e)))throw new Jr("argument-error","Invalid email link!");return new ho(t,e.code,fo.EMAIL_LINK_SIGN_IN_METHOD)}function mo(t){return(t=hi(t=$i(t)))&&t.operation===$r?t:null}function yo(t){if(!(t.Ua&&t.Ta||t.Fa&&t.ba))throw new Jr("internal-error");this.a=t,Ur(this,"providerId","phone"),Ur(this,"signInMethod","phone")}function go(t){if(t&&"phone"===t.providerId&&(t.verificationId&&t.verificationCode||t.temporaryProof&&t.phoneNumber)){var e={};return F(["verificationId","verificationCode","temporaryProof","phoneNumber"],function(n){t[n]&&(e[n]=t[n])}),new yo(e)}return null}function vo(t){return t.a.Fa&&t.a.ba?{temporaryProof:t.a.Fa,phoneNumber:t.a.ba}:{sessionInfo:t.a.Ua,code:t.a.Ta}}function bo(t){try{this.a=t||ue.auth()}catch(t){throw new Jr("argument-error","Either an instance of firebase.auth.Auth must be passed as an argument to the firebase.auth.PhoneAuthProvider constructor, or the default firebase App instance must be initialized via firebase.initializeApp().")}Vr(this,{providerId:"phone",isOAuthProvider:!1})}function wo(t,e){if(!t)throw new Jr("missing-verification-id");if(!e)throw new Jr("missing-verification-code");return new yo({Ua:t,Ta:e})}function Io(t){if(t.temporaryProof&&t.phoneNumber)return new yo({Fa:t.temporaryProof,ba:t.phoneNumber});var e=t&&t.providerId;if(!e||"password"===e)return null;var n=t&&t.oauthAccessToken,r=t&&t.oauthTokenSecret,i=t&&t.nonce,o=t&&t.oauthIdToken,a=t&&t.pendingToken;try{switch(e){case"google.com":return so(o,n);case"facebook.com":return ro(n);case"github.com":return oo(n);case"twitter.com":return co(n,r);default:return n||r||o||a?a?0==e.indexOf("saml.")?new Gi(e,a):new Yi(e,{pendingToken:a,idToken:t.oauthIdToken,accessToken:t.oauthAccessToken},e):new eo(e).credential({idToken:o,accessToken:n,rawNonce:i}):null}}catch(t){return null}}function Eo(t){if(!t.isOAuthProvider)throw new Jr("invalid-oauth-provider")}function To(t,e,n,r,i,o,a){if(this.c=t,this.b=e||null,this.g=n||null,this.f=r||null,this.i=o||null,this.h=a||null,this.a=i||null,!this.g&&!this.a)throw new Jr("invalid-auth-event");if(this.g&&this.a)throw new Jr("invalid-auth-event");if(this.g&&!this.f)throw new Jr("invalid-auth-event")}function So(t){return(t=t||{}).type?new To(t.type,t.eventId,t.urlResponse,t.sessionId,t.error&&Zr(t.error),t.postBody,t.tenantId):null}function No(){this.b=null,this.a=[]}N(Ui,Fi),N(Vi,Ui),N(Bi,Ui),N(ji,Ui),N(Ki,Ui),Gi.prototype.na=function(t){return Ja(t,zi(this))},Gi.prototype.b=function(t,e){var n=zi(this);return n.idToken=e,Za(t,n)},Gi.prototype.f=function(t,e){return Wi(ts(t,zi(this)),e)},Gi.prototype.A=function(){return{providerId:this.providerId,signInMethod:this.signInMethod,pendingToken:this.a}},Yi.prototype.na=function(t){return Ja(t,Xi(this))},Yi.prototype.b=function(t,e){var n=Xi(this);return n.idToken=e,Za(t,n)},Yi.prototype.f=function(t,e){return Wi(ts(t,Xi(this)),e)},Yi.prototype.A=function(){var t={providerId:this.providerId,signInMethod:this.signInMethod};return this.idToken&&(t.oauthIdToken=this.idToken),this.accessToken&&(t.oauthAccessToken=this.accessToken),this.secret&&(t.oauthTokenSecret=this.secret),this.nonce&&(t.nonce=this.nonce),this.a&&(t.pendingToken=this.a),t},Zi.prototype.Ea=function(t){return this.zb=z(t),this},N(to,Zi),N(eo,Zi),eo.prototype.wa=function(t){return B(this.a,t)||this.a.push(t),this},eo.prototype.Hb=function(){return Q(this.a)},eo.prototype.credential=function(t,e){var n;if(!(n=g(t)?{idToken:t.idToken||null,accessToken:t.accessToken||null,nonce:t.rawNonce||null}:{idToken:t||null,accessToken:e||null}).idToken&&!n.accessToken)throw new Jr("argument-error","credential failed: must provide the ID token and/or the access token.");return new Yi(this.providerId,n,this.providerId)},N(no,eo),Ur(no,"PROVIDER_ID","facebook.com"),Ur(no,"FACEBOOK_SIGN_IN_METHOD","facebook.com"),N(io,eo),Ur(io,"PROVIDER_ID","github.com"),Ur(io,"GITHUB_SIGN_IN_METHOD","github.com"),N(ao,eo),Ur(ao,"PROVIDER_ID","google.com"),Ur(ao,"GOOGLE_SIGN_IN_METHOD","google.com"),N(uo,Zi),Ur(uo,"PROVIDER_ID","twitter.com"),Ur(uo,"TWITTER_SIGN_IN_METHOD","twitter.com"),ho.prototype.na=function(t){return this.signInMethod==fo.EMAIL_LINK_SIGN_IN_METHOD?ks(t,us,{email:this.a,oobCode:this.c}):ks(t,Ns,{email:this.a,password:this.c})},ho.prototype.b=function(t,e){return this.signInMethod==fo.EMAIL_LINK_SIGN_IN_METHOD?ks(t,cs,{idToken:e,email:this.a,oobCode:this.c}):ks(t,bs,{idToken:e,email:this.a,password:this.c})},ho.prototype.f=function(t,e){return Wi(this.na(t),e)},ho.prototype.A=function(){return{email:this.a,password:this.c,signInMethod:this.signInMethod}},Vr(fo,{PROVIDER_ID:"password"}),Vr(fo,{EMAIL_LINK_SIGN_IN_METHOD:"emailLink"}),Vr(fo,{EMAIL_PASSWORD_SIGN_IN_METHOD:"password"}),yo.prototype.na=function(t){return t.Va(vo(this))},yo.prototype.b=function(t,e){var n=vo(this);return n.idToken=e,ks(t,As,n)},yo.prototype.f=function(t,e){var n=vo(this);return n.operation="REAUTH",Wi(t=ks(t,Ds,n),e)},yo.prototype.A=function(){var t={providerId:"phone"};return this.a.Ua&&(t.verificationId=this.a.Ua),this.a.Ta&&(t.verificationCode=this.a.Ta),this.a.Fa&&(t.temporaryProof=this.a.Fa),this.a.ba&&(t.phoneNumber=this.a.ba),t},bo.prototype.Va=function(t,e){var n=this.a.b;return Xt(e.verify()).then(function(r){if(!s(r))throw new Jr("argument-error","An implementation of firebase.auth.ApplicationVerifier.prototype.verify() must return a firebase.Promise that resolves with a string.");switch(e.type){case"recaptcha":return function(t,e){return ks(t,gs,e)}(n,{phoneNumber:t,recaptchaToken:r}).then(function(t){return"function"==typeof e.reset&&e.reset(),t},function(t){throw"function"==typeof e.reset&&e.reset(),t});default:throw new Jr("argument-error",'Only firebase.auth.ApplicationVerifiers with type="recaptcha" are currently supported.')}})},Vr(bo,{PROVIDER_ID:"phone"}),Vr(bo,{PHONE_SIGN_IN_METHOD:"phone"}),To.prototype.getUid=function(){var t=[];return t.push(this.c),this.b&&t.push(this.b),this.f&&t.push(this.f),this.h&&t.push(this.h),t.join("-")},To.prototype.R=function(){return this.h},To.prototype.A=function(){return{type:this.c,eventId:this.b,urlResponse:this.g,sessionId:this.f,postBody:this.i,tenantId:this.h,error:this.a&&this.a.A()}};var Co,Ao=null;function Do(t){var e="unauthorized-domain",n=void 0,r=Sn(t);t=r.b,"chrome-extension"==(r=r.f)?n=xt("This chrome extension ID (chrome-extension://%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):"http"==r||"https"==r?n=xt("This domain (%s) is not authorized to run this operation. Add it to the OAuth redirect domains list in the Firebase console -> Auth section -> Sign in method tab.",t):e="operation-not-supported-in-this-environment",Jr.call(this,e,n)}function ko(t,e,n){Jr.call(this,t,n),(t=e||{}).Ab&&Ur(this,"email",t.Ab),t.ba&&Ur(this,"phoneNumber",t.ba),t.credential&&Ur(this,"credential",t.credential),t.Qb&&Ur(this,"tenantId",t.Qb)}function _o(t){if(t.code){var e=t.code||"";0==e.indexOf(ti)&&(e=e.substring(ti.length));var n={credential:Io(t),Qb:t.tenantId};if(t.email)n.Ab=t.email;else if(t.phoneNumber)n.ba=t.phoneNumber;else if(!n.credential)return new Jr(e,t.message||void 0);return new ko(e,n,t.message)}return null}function Ro(){}function Oo(t){return t.c||(t.c=t.b())}function Po(){}function Mo(t){if(!t.f&&"undefined"==typeof XMLHttpRequest&&"undefined"!=typeof ActiveXObject){for(var e=["MSXML2.XMLHTTP.6.0","MSXML2.XMLHTTP.3.0","MSXML2.XMLHTTP","Microsoft.XMLHTTP"],n=0;n<e.length;n++){var r=e[n];try{return new ActiveXObject(r),t.f=r}catch(t){}}throw Error("Could not create ActiveXObject. ActiveX might be disabled, or MSXML might not be installed")}return t.f}function Lo(){}function xo(){this.a=new XDomainRequest,this.readyState=0,this.onreadystatechange=null,this.responseType=this.responseText=this.response="",this.status=-1,this.statusText="",this.a.onload=E(this.fc,this),this.a.onerror=E(this.Ib,this),this.a.onprogress=E(this.gc,this),this.a.ontimeout=E(this.kc,this)}function qo(t,e){t.readyState=e,t.onreadystatechange&&t.onreadystatechange()}function Fo(t,e,n){this.reset(t,e,n,void 0,void 0)}function Uo(t){this.f=t,this.b=this.c=this.a=null}function Vo(t,e){this.name=t,this.value=e}N(Do,Jr),N(ko,Jr),ko.prototype.A=function(){var t={code:this.code,message:this.message};this.email&&(t.email=this.email),this.phoneNumber&&(t.phoneNumber=this.phoneNumber),this.tenantId&&(t.tenantId=this.tenantId);var e=this.credential&&this.credential.A();return e&&Y(t,e),t},ko.prototype.toJSON=function(){return this.A()},Ro.prototype.c=null,N(Po,Ro),Po.prototype.a=function(){var t=Mo(this);return t?new ActiveXObject(t):new XMLHttpRequest},Po.prototype.b=function(){var t={};return Mo(this)&&(t[0]=!0,t[1]=!0),t},Co=new Po,N(Lo,Ro),Lo.prototype.a=function(){var t=new XMLHttpRequest;if("withCredentials"in t)return t;if("undefined"!=typeof XDomainRequest)return new xo;throw Error("Unsupported browser")},Lo.prototype.b=function(){return{}},(t=xo.prototype).open=function(t,e,n){if(null!=n&&!n)throw Error("Only async requests are supported.");this.a.open(t,e)},t.send=function(t){if(t){if("string"!=typeof t)throw Error("Only string data is supported");this.a.send(t)}else this.a.send()},t.abort=function(){this.a.abort()},t.setRequestHeader=function(){},t.getResponseHeader=function(t){return"content-type"==t.toLowerCase()?this.a.contentType:""},t.fc=function(){this.status=200,this.response=this.responseText=this.a.responseText,qo(this,4)},t.Ib=function(){this.status=500,this.response=this.responseText="",qo(this,4)},t.kc=function(){this.Ib()},t.gc=function(){this.status=200,qo(this,1)},t.getAllResponseHeaders=function(){return"content-type: "+this.a.contentType},Fo.prototype.a=null,Fo.prototype.reset=function(t,e,n,r,i){delete this.a},Vo.prototype.toString=function(){return this.name};var Bo=new Vo("SEVERE",1e3),jo=new Vo("WARNING",900),Ko=new Vo("CONFIG",700),$o=new Vo("FINE",500);Uo.prototype.log=function(t,e,n){if(t.value>=function t(e){return e.c?e.c:e.a?t(e.a):(k("Root logger has no level set."),null)}(this).value)for(y(e)&&(e=e()),t=new Fo(t,String(e),this.f),n&&(t.a=n),n=this;n;)n=n.a};var Qo={},Wo=null;function Go(t){var e;if(Wo||(Wo=new Uo(""),Qo[""]=Wo,Wo.c=Ko),!(e=Qo[t])){e=new Uo(t);var n=t.lastIndexOf("."),r=t.substr(n+1);(n=Go(t.substr(0,n))).b||(n.b={}),n.b[r]=e,e.a=n,Qo[t]=e}return e}function zo(t,e){t&&t.log($o,e,void 0)}function Ho(t){this.f=t}function Yo(t){an.call(this),this.o=t,this.readyState=Xo,this.status=0,this.responseType=this.responseText=this.response=this.statusText="",this.onreadystatechange=null,this.i=new Headers,this.b=null,this.m="GET",this.g="",this.a=!1,this.h=Go("goog.net.FetchXmlHttp"),this.l=this.c=this.f=null}N(Ho,Ro),Ho.prototype.a=function(){return new Yo(this.f)},Ho.prototype.b=function(t){return function(){return t}}({}),N(Yo,an);var Xo=0;function Jo(t){t.c.read().then(t.ec.bind(t)).catch(t.Ma.bind(t))}function Zo(t,e){e&&t.f&&(t.status=t.f.status,t.statusText=t.f.statusText),t.readyState=4,t.f=null,t.c=null,t.l=null,ta(t)}function ta(t){t.onreadystatechange&&t.onreadystatechange.call(t)}function ea(t){an.call(this),this.headers=new dn,this.B=t||null,this.c=!1,this.w=this.a=null,this.h=this.O=this.l="",this.f=this.J=this.i=this.I=!1,this.g=0,this.o=null,this.m=na,this.v=this.P=!1}(t=Yo.prototype).open=function(t,e){if(this.readyState!=Xo)throw this.abort(),Error("Error reopening a connection");this.m=t,this.g=e,this.readyState=1,ta(this)},t.send=function(t){if(1!=this.readyState)throw this.abort(),Error("need to call open() first. ");this.a=!0;var e={headers:this.i,method:this.m,credentials:void 0,cache:void 0};t&&(e.body=t),this.o.fetch(new Request(this.g,e)).then(this.jc.bind(this),this.Ma.bind(this))},t.abort=function(){this.response=this.responseText="",this.i=new Headers,this.status=0,this.c&&this.c.cancel("Request was aborted."),1<=this.readyState&&this.a&&4!=this.readyState&&(this.a=!1,Zo(this,!1)),this.readyState=Xo},t.jc=function(t){this.a&&(this.f=t,this.b||(this.b=t.headers,this.readyState=2,ta(this)),this.a&&(this.readyState=3,ta(this),this.a&&("arraybuffer"===this.responseType?t.arrayBuffer().then(this.hc.bind(this),this.Ma.bind(this)):void 0!==a.ReadableStream&&"body"in t?(this.response=this.responseText="",this.c=t.body.getReader(),this.l=new TextDecoder,Jo(this)):t.text().then(this.ic.bind(this),this.Ma.bind(this)))))},t.ec=function(t){if(this.a){var e=this.l.decode(t.value?t.value:new Uint8Array(0),{stream:!t.done});e&&(this.response=this.responseText+=e),t.done?Zo(this,!0):ta(this),3==this.readyState&&Jo(this)}},t.ic=function(t){this.a&&(this.response=this.responseText=t,Zo(this,!0))},t.hc=function(t){this.a&&(this.response=t,Zo(this,!0))},t.Ma=function(t){var e=this.h;e&&e.log(jo,"Failed to fetch url "+this.g,t instanceof Error?t:Error(t)),this.a&&Zo(this,!0)},t.setRequestHeader=function(t,e){this.i.append(t,e)},t.getResponseHeader=function(t){return this.b?this.b.get(t.toLowerCase())||"":((t=this.h)&&t.log(jo,"Attempting to get response header but no headers have been received for url: "+this.g,void 0),"")},t.getAllResponseHeaders=function(){if(!this.b){var t=this.h;return t&&t.log(jo,"Attempting to get all response headers but no headers have been received for url: "+this.g,void 0),""}t=[];for(var e=this.b.entries(),n=e.next();!n.done;)n=n.value,t.push(n[0]+": "+n[1]),n=e.next();return t.join("\r\n")},N(ea,an);var na="";ea.prototype.b=Go("goog.net.XhrIo");var ra=/^https?$/i,ia=["POST","PUT"];function oa(t,e,n,r,i){if(t.a)throw Error("[goog.net.XhrIo] Object is active with another request="+t.l+"; newUri="+e);n=n?n.toUpperCase():"GET",t.l=e,t.h="",t.O=n,t.I=!1,t.c=!0,t.a=t.B?t.B.a():Co.a(),t.w=t.B?Oo(t.B):Oo(Co),t.a.onreadystatechange=E(t.Lb,t);try{zo(t.b,da(t,"Opening Xhr")),t.J=!0,t.a.open(n,String(e),!0),t.J=!1}catch(e){return zo(t.b,da(t,"Error opening Xhr: "+e.message)),void sa(t,e)}e=r||"";var o=new dn(t.headers);i&&function(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(m(t)||s(t))F(t,e,void 0);else for(var n=pn(t),r=fn(t),i=r.length,o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}(i,function(t,e){o.set(e,t)}),i=function(t){t:{for(var e=aa,n=t.length,r=s(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:s(t)?t.charAt(e):t[e]}(o.X()),r=a.FormData&&e instanceof a.FormData,!B(ia,n)||i||r||o.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),o.forEach(function(t,e){this.a.setRequestHeader(e,t)},t),t.m&&(t.a.responseType=t.m),"withCredentials"in t.a&&t.a.withCredentials!==t.P&&(t.a.withCredentials=t.P);try{la(t),0<t.g&&(t.v=function(t){return be&&_e(9)&&"number"==typeof t.timeout&&void 0!==t.ontimeout}(t.a),zo(t.b,da(t,"Will abort after "+t.g+"ms if incomplete, xhr2 "+t.v)),t.v?(t.a.timeout=t.g,t.a.ontimeout=E(t.Ga,t)):t.o=hn(t.Ga,t.g,t)),zo(t.b,da(t,"Sending request")),t.i=!0,t.a.send(e),t.i=!1}catch(e){zo(t.b,da(t,"Send error: "+e.message)),sa(t,e)}}function aa(t){return"content-type"==t.toLowerCase()}function sa(t,e){t.c=!1,t.a&&(t.f=!0,t.a.abort(),t.f=!1),t.h=e,ua(t),ha(t)}function ua(t){t.I||(t.I=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function ca(t){if(t.c&&void 0!==o)if(t.w[1]&&4==fa(t)&&2==pa(t))zo(t.b,da(t,"Local request error detected and ignored"));else if(t.i&&4==fa(t))hn(t.Lb,0,t);else if(t.dispatchEvent("readystatechange"),4==fa(t)){zo(t.b,da(t,"Request complete")),t.c=!1;try{var e,n=pa(t);t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var s=String(t.l).match(gn)[1]||null;if(!s&&a.self&&a.self.location){var u=a.self.location.protocol;s=u.substr(0,u.length-1)}i=!ra.test(s?s.toLowerCase():"")}e=i}if(e)t.dispatchEvent("complete"),t.dispatchEvent("success");else{try{var c=2<fa(t)?t.a.statusText:""}catch(e){zo(t.b,"Can not get status: "+e.message),c=""}t.h=c+" ["+pa(t)+"]",ua(t)}}finally{ha(t)}}}function ha(t,e){if(t.a){la(t);var n=t.a,r=t.w[0]?l:null;t.a=null,t.w=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(e){(t=t.b)&&t.log(Bo,"Problem encountered resetting onreadystatechange: "+e.message,void 0)}}}function la(t){t.a&&t.v&&(t.a.ontimeout=null),t.o&&(a.clearTimeout(t.o),t.o=null)}function fa(t){return t.a?t.a.readyState:0}function pa(t){try{return 2<fa(t)?t.a.status:-1}catch(t){return-1}}function da(t,e){return e+" ["+t.O+" "+t.l+" "+pa(t)+"]"}function ma(t){var e=Ca;this.g=[],this.v=e,this.o=t||null,this.f=this.a=!1,this.c=void 0,this.u=this.w=this.i=!1,this.h=0,this.b=null,this.l=0}function ya(t,e,n){t.a=!0,t.c=n,t.f=!e,wa(t)}function ga(t){if(t.a){if(!t.u)throw new Ia(t);t.u=!1}}function va(t,e,n,r){t.g.push([e,n,r]),t.a&&wa(t)}function ba(t){return V(t.g,function(t){return y(t[1])})}function wa(t){if(t.h&&t.a&&ba(t)){var e=t.h,n=Sa[e];n&&(a.clearTimeout(n.a),delete Sa[e]),t.h=0}t.b&&(t.b.l--,delete t.b),e=t.c;for(var r=n=!1;t.g.length&&!t.i;){var i=t.g.shift(),o=i[0],s=i[1];if(i=i[2],o=t.f?s:o)try{var u=o.call(i||t.o,e);void 0!==u&&(t.f=t.f&&(u==e||u instanceof Error),t.c=e=u),(C(e)||"function"==typeof a.Promise&&e instanceof a.Promise)&&(r=!0,t.i=!0)}catch(r){e=r,t.f=!0,ba(t)||(n=!0)}}t.c=e,r&&(u=E(t.m,t,!0),r=E(t.m,t,!1),e instanceof ma?(va(e,u,r),e.w=!0):e.then(u,r)),n&&(e=new Ta(e),Sa[e.a]=e,t.h=e.a)}function Ia(){A.call(this)}function Ea(){A.call(this)}function Ta(t){this.a=a.setTimeout(E(this.c,this),0),this.b=t}(t=ea.prototype).Ga=function(){void 0!==o&&this.a&&(this.h="Timed out after "+this.g+"ms, aborting",zo(this.b,da(this,this.h)),this.dispatchEvent("timeout"),this.abort(8))},t.abort=function(){this.a&&this.c&&(zo(this.b,da(this,"Aborting")),this.c=!1,this.f=!0,this.a.abort(),this.f=!1,this.dispatchEvent("complete"),this.dispatchEvent("abort"),ha(this))},t.xa=function(){this.a&&(this.c&&(this.c=!1,this.f=!0,this.a.abort(),this.f=!1),ha(this,!0)),ea.qb.xa.call(this)},t.Lb=function(){this.ta||(this.J||this.i||this.f?ca(this):this.yc())},t.yc=function(){ca(this)},t.getResponse=function(){try{if(!this.a)return null;if("response"in this.a)return this.a.response;switch(this.m){case na:case"text":return this.a.responseText;case"arraybuffer":if("mozResponseArrayBuffer"in this.a)return this.a.mozResponseArrayBuffer}var t=this.b;return t&&t.log(Bo,"Response type "+this.m+" is not supported on this browser",void 0),null}catch(t){return zo(this.b,"Can not get response: "+t.message),null}},ma.prototype.cancel=function(t){if(this.a)this.c instanceof ma&&this.c.cancel();else{if(this.b){var e=this.b;delete this.b,t?e.cancel(t):(e.l--,0>=e.l&&e.cancel())}this.v?this.v.call(this.o,this):this.u=!0,this.a||(t=new Ea(this),ga(this),ya(this,!1,t))}},ma.prototype.m=function(t,e){this.i=!1,ya(this,t,e)},ma.prototype.then=function(t,e,n){var r,i,o=new $t(function(t,e){r=t,i=e});return va(this,r,function(t){t instanceof Ea?o.cancel():i(t)}),o.then(t,e,n)},ma.prototype.$goog_Thenable=!0,N(Ia,A),Ia.prototype.message="Deferred has already fired",Ia.prototype.name="AlreadyCalledError",N(Ea,A),Ea.prototype.message="Deferred was canceled",Ea.prototype.name="CanceledError",Ta.prototype.c=function(){throw delete Sa[this.a],this.b};var Sa={};function Na(t){var e,n=document,r=rt(t).toString(),i=document.createElement("SCRIPT"),o={Nb:i,Ga:void 0},s=new ma(o);return e=window.setTimeout(function(){Aa(i,!0);var t=new _a(ka,"Timeout reached for loading script "+r);ga(s),ya(s,!1,t)},5e3),o.Ga=e,i.onload=i.onreadystatechange=function(){i.readyState&&"loaded"!=i.readyState&&"complete"!=i.readyState||(Aa(i,!1,e),ga(s),ya(s,!0,null))},i.onerror=function(){Aa(i,!0,e);var t=new _a(Da,"Error while loading script "+r);ga(s),ya(s,!1,t)},Y(o={},{type:"text/javascript",charset:"UTF-8"}),$n(i,o),function(t,e){x(t,"HTMLScriptElement"),t.src=rt(e),null===h&&(h=(e=(e=a.document).querySelector&&e.querySelector("script[nonce]"))&&(e=e.nonce||e.getAttribute("nonce"))&&c.test(e)?e:""),(e=h)&&t.setAttribute("nonce",e)}(i,t),function(t){var e;return(e=(t||document).getElementsByTagName("HEAD"))&&0!=e.length?e[0]:t.documentElement}(n).appendChild(i),s}function Ca(){if(this&&this.Nb){var t=this.Nb;t&&"SCRIPT"==t.tagName&&Aa(t,!0,this.Ga)}}function Aa(t,e,n){null!=n&&a.clearTimeout(n),t.onload=l,t.onerror=l,t.onreadystatechange=l,e&&window.setTimeout(function(){t&&t.parentNode&&t.parentNode.removeChild(t)},0)}var Da=0,ka=1;function _a(t,e){var n="Jsloader error (code #"+t+")";e&&(n+=": "+e),A.call(this,n),this.code=t}function Ra(t){this.f=t}function Oa(t,e,n){if(this.c=t,t=e||{},this.l=t.secureTokenEndpoint||"https://securetoken.googleapis.com/v1/token",this.u=t.secureTokenTimeout||La,this.g=z(t.secureTokenHeaders||xa),this.h=t.firebaseEndpoint||"https://www.googleapis.com/identitytoolkit/v3/relyingparty/",this.i=t.firebaseTimeout||qa,this.a=z(t.firebaseHeaders||Fa),n&&(this.a["X-Client-Version"]=n,this.g["X-Client-Version"]=n),n="Node"==lr(),!(n=a.XMLHttpRequest||n&&ue.INTERNAL.node&&ue.INTERNAL.node.XMLHttpRequest)&&!hr())throw new Jr("internal-error","The XMLHttpRequest compatibility library was not found.");this.f=void 0,hr()?this.f=new Ho(self):fr()?this.f=new Ra(n):this.f=new Lo,this.b=null}N(_a,A),N(Ra,Ro),Ra.prototype.a=function(){return new this.f},Ra.prototype.b=function(){return{}};var Pa,Ma="idToken",La=new Rr(3e4,6e4),xa={"Content-Type":"application/x-www-form-urlencoded"},qa=new Rr(3e4,6e4),Fa={"Content-Type":"application/json"};function Ua(t,e){e?t.a["X-Firebase-Locale"]=e:delete t.a["X-Firebase-Locale"]}function Va(t,e){e?(t.a["X-Client-Version"]=e,t.g["X-Client-Version"]=e):(delete t.a["X-Client-Version"],delete t.g["X-Client-Version"])}function Ba(t,e,n,r,i,o,s){(function(){var t=vr();return!((t=mr(t)!=dr?null:(t=t.match(/\sChrome\/(\d+)/i))&&2==t.length?parseInt(t[1],10):null)&&30>t||be&&De&&!(9<De))})()||hr()?t=E(t.o,t):(Pa||(Pa=new $t(function(t,e){!function(t,e){if(((window.gapi||{}).client||{}).request)t();else{a[Ka]=function(){((window.gapi||{}).client||{}).request?t():e(Error("CORS_UNSUPPORTED"))};var n=it(ja,{onload:Ka});!function(t,e){va(t,null,e,void 0)}(Na(n),function(){e(Error("CORS_UNSUPPORTED"))})}}(t,e)})),t=E(t.m,t)),t(e,n,r,i,o,s)}Oa.prototype.R=function(){return this.b},Oa.prototype.o=function(t,e,n,r,i,o){if(hr()&&(void 0===a.fetch||void 0===a.Headers||void 0===a.Request))throw new Jr("operation-not-supported-in-this-environment","fetch, Headers and Request native APIs or equivalent Polyfills must be available to support HTTP requests from a Worker environment.");var s=new ea(this.f);if(o){s.g=Math.max(0,o);var u=setTimeout(function(){s.dispatchEvent("timeout")},o)}sn(s,"complete",function(){u&&clearTimeout(u);var t=null;try{t=JSON.parse(function(t){try{return t.a?t.a.responseText:""}catch(e){return zo(t.b,"Can not get responseText: "+e.message),""}}(this))||null}catch(e){t=null}e&&e(t)}),un(s,"ready",function(){u&&clearTimeout(u),de(this)}),un(s,"timeout",function(){u&&clearTimeout(u),de(this),e&&e(null)}),oa(s,t,n,r,i)};var ja=new X(tt,"https://apis.google.com/js/client.js?onload=%{onload}"),Ka="__fcb"+Math.floor(1e6*Math.random()).toString();function $a(t){if(!s(t=t.email)||!ar.test(t))throw new Jr("invalid-email")}function Qa(t){"email"in t&&$a(t)}function Wa(t){if(!t[Ma])throw new Jr("internal-error")}function Ga(t){if(t.phoneNumber||t.temporaryProof){if(!t.phoneNumber||!t.temporaryProof)throw new Jr("internal-error")}else{if(!t.sessionInfo)throw new Jr("missing-verification-id");if(!t.code)throw new Jr("missing-verification-code")}}Oa.prototype.m=function(t,e,n,r,i){var o=this;Pa.then(function(){window.gapi.client.setApiKey(o.c);var a=window.gapi.auth.getToken();window.gapi.auth.setToken(null),window.gapi.client.request({path:t,method:n,body:r,headers:i,authType:"none",callback:function(t){window.gapi.auth.setToken(a),e&&e(t)}})}).s(function(t){e&&e({error:{message:t&&t.message||"CORS_UNSUPPORTED"}})})},Oa.prototype.ob=function(){return ks(this,ws,{})},Oa.prototype.rb=function(t,e){return ks(this,vs,{idToken:t,email:e})},Oa.prototype.sb=function(t,e){return ks(this,bs,{idToken:t,password:e})};var za={displayName:"DISPLAY_NAME",photoUrl:"PHOTO_URL"};function Ha(t){if(!t.requestUri||!t.sessionId&&!t.postBody&&!t.pendingToken)throw new Jr("internal-error")}function Ya(t,e){return e.oauthIdToken&&e.providerId&&0==e.providerId.indexOf("oidc.")&&!e.pendingToken&&(t.sessionId?e.nonce=t.sessionId:t.postBody&&(Fn(t=new Mn(t.postBody),"nonce")&&(e.nonce=t.get("nonce")))),e}function Xa(t){var e=null;if(t.needConfirmation?(t.code="account-exists-with-different-credential",e=_o(t)):"FEDERATED_USER_ID_ALREADY_LINKED"==t.errorMessage?(t.code="credential-already-in-use",e=_o(t)):"EMAIL_EXISTS"==t.errorMessage?(t.code="email-already-in-use",e=_o(t)):t.errorMessage&&(e=_s(t.errorMessage)),e)throw e;if(!t[Ma])throw new Jr("internal-error")}function Ja(t,e){return e.returnIdpCredential=!0,ks(t,Is,e)}function Za(t,e){return e.returnIdpCredential=!0,ks(t,Ts,e)}function ts(t,e){return e.returnIdpCredential=!0,e.autoCreate=!1,ks(t,Es,e)}function es(t){if(!t.oobCode)throw new Jr("invalid-action-code")}(t=Oa.prototype).tb=function(t,e){var n={idToken:t},r=[];return W(za,function(t,i){var o=e[i];null===o?r.push(t):i in e&&(n[i]=o)}),r.length&&(n.deleteAttribute=r),ks(this,vs,n)},t.kb=function(t,e){return Y(t={requestType:"PASSWORD_RESET",email:t},e),ks(this,ps,t)},t.lb=function(t,e){return Y(t={requestType:"EMAIL_SIGNIN",email:t},e),ks(this,ls,t)},t.jb=function(t,e){return Y(t={requestType:"VERIFY_EMAIL",idToken:t},e),ks(this,fs,t)},t.Va=function(t){return ks(this,Cs,t)},t.$a=function(t,e){return ks(this,ys,{oobCode:t,newPassword:e})},t.Ka=function(t){return ks(this,rs,{oobCode:t})},t.Xa=function(t){return ks(this,ns,{oobCode:t})};var ns={endpoint:"setAccountInfo",D:es,fa:"email",F:!0},rs={endpoint:"resetPassword",D:es,K:function(t){var e=t.requestType;if(!e||!t.email&&"EMAIL_SIGNIN"!=e)throw new Jr("internal-error")},F:!0},is={endpoint:"signupNewUser",D:function(t){if($a(t),!t.password)throw new Jr("weak-password")},K:Wa,T:!0,F:!0},os={endpoint:"createAuthUri",F:!0},as={endpoint:"deleteAccount",V:["idToken"]},ss={endpoint:"setAccountInfo",V:["idToken","deleteProvider"],D:function(t){if(!d(t.deleteProvider))throw new Jr("internal-error")}},us={endpoint:"emailLinkSignin",V:["email","oobCode"],D:$a,K:Wa,T:!0,F:!0},cs={endpoint:"emailLinkSignin",V:["idToken","email","oobCode"],D:$a,K:Wa,T:!0},hs={endpoint:"getAccountInfo"},ls={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("EMAIL_SIGNIN"!=t.requestType)throw new Jr("internal-error");$a(t)},fa:"email",F:!0},fs={endpoint:"getOobConfirmationCode",V:["idToken","requestType"],D:function(t){if("VERIFY_EMAIL"!=t.requestType)throw new Jr("internal-error")},fa:"email",F:!0},ps={endpoint:"getOobConfirmationCode",V:["requestType"],D:function(t){if("PASSWORD_RESET"!=t.requestType)throw new Jr("internal-error");$a(t)},fa:"email",F:!0},ds={wb:!0,endpoint:"getProjectConfig",Kb:"GET"},ms={wb:!0,endpoint:"getRecaptchaParam",Kb:"GET",K:function(t){if(!t.recaptchaSiteKey)throw new Jr("internal-error")}},ys={endpoint:"resetPassword",D:es,fa:"email",F:!0},gs={endpoint:"sendVerificationCode",V:["phoneNumber","recaptchaToken"],fa:"sessionInfo",F:!0},vs={endpoint:"setAccountInfo",V:["idToken"],D:Qa,T:!0},bs={endpoint:"setAccountInfo",V:["idToken"],D:function(t){if(Qa(t),!t.password)throw new Jr("weak-password")},K:Wa,T:!0},ws={endpoint:"signupNewUser",K:Wa,T:!0,F:!0},Is={endpoint:"verifyAssertion",D:Ha,Qa:Ya,K:Xa,T:!0,F:!0},Es={endpoint:"verifyAssertion",D:Ha,Qa:Ya,K:function(t){if(t.errorMessage&&"USER_NOT_FOUND"==t.errorMessage)throw new Jr("user-not-found");if(t.errorMessage)throw _s(t.errorMessage);if(!t[Ma])throw new Jr("internal-error")},T:!0,F:!0},Ts={endpoint:"verifyAssertion",D:function(t){if(Ha(t),!t.idToken)throw new Jr("internal-error")},Qa:Ya,K:Xa,T:!0},Ss={endpoint:"verifyCustomToken",D:function(t){if(!t.token)throw new Jr("invalid-custom-token")},K:Wa,T:!0,F:!0},Ns={endpoint:"verifyPassword",D:function(t){if($a(t),!t.password)throw new Jr("wrong-password")},K:Wa,T:!0,F:!0},Cs={endpoint:"verifyPhoneNumber",D:Ga,K:Wa,F:!0},As={endpoint:"verifyPhoneNumber",D:function(t){if(!t.idToken)throw new Jr("internal-error");Ga(t)},K:function(t){if(t.temporaryProof)throw t.code="credential-already-in-use",_o(t);Wa(t)}},Ds={Yb:{USER_NOT_FOUND:"user-not-found"},endpoint:"verifyPhoneNumber",D:Ga,K:Wa,F:!0};function ks(t,e,n){if(!function(t,e){if(!e||!e.length)return!0;if(!t)return!1;for(var n=0;n<e.length;n++){var r=t[e[n]];if(null==r||""===r)return!1}return!0}(n,e.V))return Jt(new Jr("internal-error"));var r,i=e.Kb||"POST";return Xt(n).then(e.D).then(function(){return e.T&&(n.returnSecureToken=!0),e.F&&t.b&&void 0===n.tenantId&&(n.tenantId=t.b),function(t,e,n,r,i,o){var a=Sn(t.h+e);En(a,"key",t.c),o&&En(a,"cb",S().toString());var s="GET"==n;if(s)for(var u in r)r.hasOwnProperty(u)&&En(a,u,r[u]);return new $t(function(e,o){Ba(t,a.toString(),function(t){t?t.error?o(Rs(t,i||{})):e(t):o(new Jr("network-request-failed"))},n,s?void 0:zn(Cr(r)),t.a,t.i.get())})}(t,e.endpoint,i,n,e.Yb,e.wb||!1)}).then(function(t){return r=t,e.Qa?e.Qa(n,r):r}).then(e.K).then(function(){if(!e.fa)return r;if(!(e.fa in r))throw new Jr("internal-error");return r[e.fa]})}function _s(t){return Rs({error:{errors:[{message:t}],code:400,message:t}})}function Rs(t,e){var n=(t.error&&t.error.errors&&t.error.errors[0]||{}).reason||"",r={keyInvalid:"invalid-api-key",ipRefererBlocked:"app-not-authorized"};if(n=r[n]?new Jr(r[n]):null)return n;for(var i in n=t.error&&t.error.message||"",Y(r={INVALID_CUSTOM_TOKEN:"invalid-custom-token",CREDENTIAL_MISMATCH:"custom-token-mismatch",MISSING_CUSTOM_TOKEN:"internal-error",INVALID_IDENTIFIER:"invalid-email",MISSING_CONTINUE_URI:"internal-error",INVALID_EMAIL:"invalid-email",INVALID_PASSWORD:"wrong-password",USER_DISABLED:"user-disabled",MISSING_PASSWORD:"internal-error",EMAIL_EXISTS:"email-already-in-use",PASSWORD_LOGIN_DISABLED:"operation-not-allowed",INVALID_IDP_RESPONSE:"invalid-credential",INVALID_PENDING_TOKEN:"invalid-credential",FEDERATED_USER_ID_ALREADY_LINKED:"credential-already-in-use",MISSING_OR_INVALID_NONCE:"missing-or-invalid-nonce",INVALID_MESSAGE_PAYLOAD:"invalid-message-payload",INVALID_RECIPIENT_EMAIL:"invalid-recipient-email",INVALID_SENDER:"invalid-sender",EMAIL_NOT_FOUND:"user-not-found",RESET_PASSWORD_EXCEED_LIMIT:"too-many-requests",EXPIRED_OOB_CODE:"expired-action-code",INVALID_OOB_CODE:"invalid-action-code",MISSING_OOB_CODE:"internal-error",INVALID_PROVIDER_ID:"invalid-provider-id",CREDENTIAL_TOO_OLD_LOGIN_AGAIN:"requires-recent-login",INVALID_ID_TOKEN:"invalid-user-token",TOKEN_EXPIRED:"user-token-expired",USER_NOT_FOUND:"user-token-expired",CORS_UNSUPPORTED:"cors-unsupported",DYNAMIC_LINK_NOT_ACTIVATED:"dynamic-link-not-activated",INVALID_APP_ID:"invalid-app-id",TOO_MANY_ATTEMPTS_TRY_LATER:"too-many-requests",WEAK_PASSWORD:"weak-password",OPERATION_NOT_ALLOWED:"operation-not-allowed",USER_CANCELLED:"user-cancelled",CAPTCHA_CHECK_FAILED:"captcha-check-failed",INVALID_APP_CREDENTIAL:"invalid-app-credential",INVALID_CODE:"invalid-verification-code",INVALID_PHONE_NUMBER:"invalid-phone-number",INVALID_SESSION_INFO:"invalid-verification-id",INVALID_TEMPORARY_PROOF:"invalid-credential",MISSING_APP_CREDENTIAL:"missing-app-credential",MISSING_CODE:"missing-verification-code",MISSING_PHONE_NUMBER:"missing-phone-number",MISSING_SESSION_INFO:"missing-verification-id",QUOTA_EXCEEDED:"quota-exceeded",SESSION_EXPIRED:"code-expired",REJECTED_CREDENTIAL:"rejected-credential",INVALID_CONTINUE_URI:"invalid-continue-uri",MISSING_ANDROID_PACKAGE_NAME:"missing-android-pkg-name",MISSING_IOS_BUNDLE_ID:"missing-ios-bundle-id",UNAUTHORIZED_DOMAIN:"unauthorized-continue-uri",INVALID_DYNAMIC_LINK_DOMAIN:"invalid-dynamic-link-domain",INVALID_OAUTH_CLIENT_ID:"invalid-oauth-client-id",INVALID_CERT_HASH:"invalid-cert-hash",UNSUPPORTED_TENANT_OPERATION:"unsupported-tenant-operation",INVALID_TENANT_ID:"invalid-tenant-id",ADMIN_ONLY_OPERATION:"admin-restricted-operation"},e||{}),e=(e=n.match(/^[^\s]+\s*:\s*(.*)$/))&&1<e.length?e[1]:void 0,r)if(0===n.indexOf(i))return new Jr(r[i],e);return!e&&t&&(e=Nr(t)),new Jr("internal-error",e)}function Os(t){this.b=t,this.a=null,this.fb=function(t){return(xs||(xs=new $t(function(t,e){function n(){_r(),br("gapi.load")("gapi.iframes",{callback:t,ontimeout:function(){_r(),e(Error("Network Error"))},timeout:Ms.get()})}if(br("gapi.iframes.Iframe"))t();else if(br("gapi.load"))n();else{var r="__iframefcb"+Math.floor(1e6*Math.random()).toString();a[r]=function(){br("gapi.load")?n():e(Error("Network Error"))},Xt(Na(r=it(Ps,{onload:r}))).s(function(){e(Error("Network Error"))})}}).s(function(t){throw xs=null,t}))).then(function(){return new $t(function(e,n){br("gapi.iframes.getContext")().open({where:document.body,url:t.b,messageHandlersFilter:br("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"),attributes:{style:{position:"absolute",top:"-100px",width:"1px",height:"1px"}},dontclear:!0},function(r){function i(){clearTimeout(o),e()}t.a=r,t.a.restyle({setHideOnLeave:!1});var o=setTimeout(function(){n(Error("Network Error"))},Ls.get());r.ping(i).then(i,function(){n(Error("Network Error"))})})})})}(this)}var Ps=new X(tt,"https://apis.google.com/js/api.js?onload=%{onload}"),Ms=new Rr(3e4,6e4),Ls=new Rr(5e3,15e3),xs=null;function qs(t,e,n){this.i=t,this.g=e,this.h=n,this.f=null,this.a=Nn(this.i,"/__/auth/iframe"),En(this.a,"apiKey",this.g),En(this.a,"appName",this.h),this.b=null,this.c=[]}function Fs(t,e,n,r,i){this.o=t,this.m=e,this.c=n,this.u=r,this.i=this.g=this.l=null,this.a=i,this.h=this.f=null}function Us(t){try{return ue.app(t).auth().Aa()}catch(t){return[]}}function Vs(t,e,n,r,i){this.u=t,this.f=e,this.b=n,this.c=r||null,this.h=i||null,this.m=this.o=this.v=null,this.g=[],this.l=this.a=null}function Bs(t){var e=tr();return function(t){return ks(t,ds,{}).then(function(t){return t.authorizedDomains||[]})}(t).then(function(t){t:{var n=Sn(e),r=n.f;n=n.b;for(var i=0;i<t.length;i++){var o=t[i],a=n,s=r;if(0==o.indexOf("chrome-extension://")?a=Sn(o).b==a&&"chrome-extension"==s:"http"!=s&&"https"!=s?a=!1:or.test(o)?a=a==o:(o=o.split(".").join("\\."),a=new RegExp("^(.+\\."+o+"|"+o+")$","i").test(a)),a){t=!0;break t}}t=!1}if(!t)throw new Do(tr())})}function js(t){return t.l?t.l:(t.l=sr().then(function(){if(!t.o){var e=t.c,n=t.h,r=Us(t.b),i=new qs(t.u,t.f,t.b);i.f=e,i.b=n,i.c=Q(r||[]),t.o=i.toString()}t.i=new Os(t.o),function(t){if(!t.i)throw Error("IfcHandler must be initialized!");!function(t,e){t.fb.then(function(){t.a.register("authEvent",e,br("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})}(t.i,function(e){var n={};if(e&&e.authEvent){var r=!1;for(e=So(e.authEvent),n=0;n<t.g.length;n++)r=t.g[n](e)||r;return(n={}).status=r?"ACK":"ERROR",Xt(n)}return n.status="ERROR",Xt(n)})}(t)}),t.l)}function Ks(t){return t.m||(t.v=t.c?gr(t.c,Us(t.b)):null,t.m=new Oa(t.f,_i(t.h),t.v)),t.m}function $s(t,e,n,r,i,o,a,s,u,c,h){return(t=new Fs(t,e,n,r,i)).l=o,t.g=a,t.i=s,t.b=z(u||null),t.f=c,t.nb(h).toString()}function Qs(t){if(this.a=t||ue.INTERNAL.reactNative&&ue.INTERNAL.reactNative.AsyncStorage,!this.a)throw new Jr("internal-error","The React Native compatibility library was not found.");this.type="asyncStorage"}function Ws(t){this.b=t,this.a={},this.f=E(this.c,this)}qs.prototype.toString=function(){return this.f?En(this.a,"v",this.f):qn(this.a.a,"v"),this.b?En(this.a,"eid",this.b):qn(this.a.a,"eid"),this.c.length?En(this.a,"fw",this.c.join(",")):qn(this.a.a,"fw"),this.a.toString()},Fs.prototype.nb=function(t){return this.h=t,this},Fs.prototype.toString=function(){var t=Nn(this.o,"/__/auth/handler");if(En(t,"apiKey",this.m),En(t,"appName",this.c),En(t,"authType",this.u),this.a.isOAuthProvider){var e=this.a;try{var n=ue.app(this.c).auth().ha()}catch(t){n=null}for(var r in e.ab=n,En(t,"providerId",this.a.providerId),n=Cr((e=this.a).zb))n[r]=n[r].toString();r=e.Fc,n=z(n);for(var i=0;i<r.length;i++){var o=r[i];o in n&&delete n[o]}e.cb&&e.ab&&!n[e.cb]&&(n[e.cb]=e.ab),G(n)||En(t,"customParameters",Nr(n))}if("function"==typeof this.a.Hb&&((e=this.a.Hb()).length&&En(t,"scopes",e.join(","))),this.l?En(t,"redirectUrl",this.l):qn(t.a,"redirectUrl"),this.g?En(t,"eventId",this.g):qn(t.a,"eventId"),this.i?En(t,"v",this.i):qn(t.a,"v"),this.b)for(var a in this.b)this.b.hasOwnProperty(a)&&!Tn(t,a)&&En(t,a,this.b[a]);return this.h?En(t,"tid",this.h):qn(t.a,"tid"),this.f?En(t,"eid",this.f):qn(t.a,"eid"),(a=Us(this.c)).length&&En(t,"fw",a.join(",")),t.toString()},(t=Vs.prototype).Fb=function(t,e,n){var r=new Jr("popup-closed-by-user"),i=new Jr("web-storage-unsupported"),o=this,a=!1;return this.ia().then(function(){(function(t){var e={type:"webStorageSupport"};return js(t).then(function(){return function(t,e){return t.fb.then(function(){return new $t(function(n){t.a.send(e.type,e,n,br("gapi.iframes.CROSS_ORIGIN_IFRAMES_FILTER"))})})}(t.i,e)}).then(function(t){if(t&&t.length&&void 0!==t[0].webStorageSupport)return t[0].webStorageSupport;throw Error()})})(o).then(function(n){n||(t&&rr(t),e(i),a=!0)})}).s(function(){}).then(function(){if(!a)return function(t){return new $t(function(e){return function n(){ln(2e3).then(function(){if(t&&!t.closed)return n();e()})}()})}(t)}).then(function(){if(!a)return ln(n).then(function(){e(r)})})},t.Ob=function(){var t=vr();return!Sr(t)&&!kr(t)},t.Jb=function(){return!1},t.Db=function(t,e,n,r,i,o,a,s){if(!t)return Jt(new Jr("popup-blocked"));if(a&&!Sr())return this.ia().s(function(e){rr(t),i(e)}),r(),Xt();this.a||(this.a=Bs(Ks(this)));var u=this;return this.a.then(function(){var e=u.ia().s(function(e){throw rr(t),i(e),e});return r(),e}).then(function(){(Eo(n),a)||er($s(u.u,u.f,u.b,e,n,null,o,u.c,void 0,u.h,s),t)}).s(function(t){throw"auth/network-request-failed"==t.code&&(u.a=null),t})},t.Eb=function(t,e,n,r){this.a||(this.a=Bs(Ks(this)));var i=this;return this.a.then(function(){Eo(e),er($s(i.u,i.f,i.b,t,e,tr(),n,i.c,void 0,i.h,r))}).s(function(t){throw"auth/network-request-failed"==t.code&&(i.a=null),t})},t.ia=function(){var t=this;return js(this).then(function(){return t.i.fb}).s(function(){throw t.a=null,new Jr("network-request-failed")})},t.Rb=function(){return!0},t.ya=function(t){this.g.push(t)},t.La=function(t){K(this.g,function(e){return e==t})},(t=Qs.prototype).get=function(t){return Xt(this.a.getItem(t)).then(function(t){return t&&Ar(t)})},t.set=function(t,e){return Xt(this.a.setItem(t,Nr(e)))},t.S=function(t){return Xt(this.a.removeItem(t))},t.$=function(){},t.ea=function(){};var Gs,zs=[];function Hs(t,e,n){G(t.a)&&t.b.addEventListener("message",t.f),void 0===t.a[e]&&(t.a[e]=[]),t.a[e].push(n)}function Ys(t){this.a=t}function Xs(t){this.c=t,this.b=!1,this.a=[]}function Js(t,e,n,r){var i,o,a,s,u=n||{},c=null;if(t.b)return Jt(Error("connection_unavailable"));var h=r?800:50,l="undefined"!=typeof MessageChannel?new MessageChannel:null;return new $t(function(n,r){l?(i=Math.floor(Math.random()*Math.pow(10,20)).toString(),l.port1.start(),a=setTimeout(function(){r(Error("unsupported_event"))},h),c={messageChannel:l,onMessage:o=function(t){t.data.eventId===i&&("ack"===t.data.status?(clearTimeout(a),s=setTimeout(function(){r(Error("timeout"))},3e3)):"done"===t.data.status?(clearTimeout(s),void 0!==t.data.response?n(t.data.response):r(Error("unknown_error"))):(clearTimeout(a),clearTimeout(s),r(Error("invalid_response"))))}},t.a.push(c),l.port1.addEventListener("message",o),t.c.postMessage({eventType:e,eventId:i,data:u},[l.port2])):r(Error("connection_unavailable"))}).then(function(e){return Zs(t,c),e}).s(function(e){throw Zs(t,c),e})}function Zs(t,e){if(e){var n=e.messageChannel,r=e.onMessage;n&&(n.port1.removeEventListener("message",r),n.port1.close()),K(t.a,function(t){return t==e})}}function tu(){if(!ru())throw new Jr("web-storage-unsupported");this.c={},this.a=[],this.b=0,this.u=a.indexedDB,this.type="indexedDB",this.g=this.l=this.f=this.i=null,this.o=!1,this.h=null;var t=this;hr()&&self?(this.l=function(){var t=hr()?self:null;if(F(zs,function(n){n.b==t&&(e=n)}),!e){var e=new Ws(t);zs.push(e)}return e}(),Hs(this.l,"keyChanged",function(e,n){return uu(t).then(function(e){return 0<e.length&&F(t.a,function(t){t(e)}),{keyProcessed:B(e,n.key)}})}),Hs(this.l,"ping",function(){return Xt(["keyChanged"])})):function(){var t=a.navigator;return t&&t.serviceWorker?Xt().then(function(){return t.serviceWorker.ready}).then(function(t){return t.active||null}).s(function(){return null}):Xt(null)}().then(function(e){(t.h=e)&&(t.g=new Xs(new Ys(e)),Js(t.g,"ping",null,!0).then(function(e){e[0].fulfilled&&B(e[0].value,"keyChanged")&&(t.o=!0)}).s(function(){}))})}function eu(t){return new $t(function(e,n){var r=t.u.open("firebaseLocalStorageDb",1);r.onerror=function(t){try{t.preventDefault()}catch(t){}n(Error(t.target.error))},r.onupgradeneeded=function(t){t=t.target.result;try{t.createObjectStore("firebaseLocalStorage",{keyPath:"fbase_key"})}catch(t){n(t)}},r.onsuccess=function(r){(r=r.target.result).objectStoreNames.contains("firebaseLocalStorage")?e(r):function(t){return new $t(function(e,n){var r=t.u.deleteDatabase("firebaseLocalStorageDb");r.onsuccess=function(){e()},r.onerror=function(t){n(Error(t.target.error))}})}(t).then(function(){return eu(t)}).then(function(t){e(t)}).s(function(t){n(t)})}})}function nu(t){return t.m||(t.m=eu(t)),t.m}function ru(){try{return!!a.indexedDB}catch(t){return!1}}function iu(t){return t.objectStore("firebaseLocalStorage")}function ou(t,e){return t.transaction(["firebaseLocalStorage"],e?"readwrite":"readonly")}function au(t){return new $t(function(e,n){t.onsuccess=function(t){t&&t.target?e(t.target.result):e()},t.onerror=function(t){n(t.target.error)}})}function su(t,e){return t.g&&t.h&&function(){var t=a.navigator;return t&&t.serviceWorker&&t.serviceWorker.controller||null}()===t.h?Js(t.g,"keyChanged",{key:e},t.o).then(function(){}).s(function(){}):Xt()}function uu(t){return nu(t).then(function(t){var e=iu(ou(t,!1));return e.getAll?au(e.getAll()):new $t(function(t,n){var r=[],i=e.openCursor();i.onsuccess=function(e){(e=e.target.result)?(r.push(e.value),e.continue()):t(r)},i.onerror=function(t){n(t.target.error)}})}).then(function(e){var n={},r=[];if(0==t.b){for(r=0;r<e.length;r++)n[e[r].fbase_key]=e[r].value;r=function t(e,n){var r,i=[];for(r in e)r in n?typeof e[r]!=typeof n[r]?i.push(r):"object"==typeof e[r]&&null!=e[r]&&null!=n[r]?0<t(e[r],n[r]).length&&i.push(r):e[r]!==n[r]&&i.push(r):i.push(r);for(r in n)r in e||i.push(r);return i}(t.c,n),t.c=n}return r})}function cu(t){t.i&&t.i.cancel("STOP_EVENT"),t.f&&(clearTimeout(t.f),t.f=null)}function hu(t){var e=this,n=null;this.a=[],this.type="indexedDB",this.c=t,this.b=Xt().then(function(){if(ru()){var t=Dr(),r="__sak"+t;return Gs||(Gs=new tu),(n=Gs).set(r,t).then(function(){return n.get(r)}).then(function(e){if(e!==t)throw Error("indexedDB not supported!");return n.S(r)}).then(function(){return n}).s(function(){return e.c})}return e.c}).then(function(t){return e.type=t.type,t.$(function(t){F(e.a,function(e){e(t)})}),t})}function lu(){this.a={},this.type="inMemory"}function fu(){if(!function(){var t="Node"==lr();if(!(t=pu()||t&&ue.INTERNAL.node&&ue.INTERNAL.node.localStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==lr())throw new Jr("internal-error","The LocalStorage compatibility library was not found.");throw new Jr("web-storage-unsupported")}this.a=pu()||ue.INTERNAL.node.localStorage,this.type="localStorage"}function pu(){try{var t=a.localStorage,e=Dr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function du(){this.type="nullStorage"}function mu(){if(!function(){var t="Node"==lr();if(!(t=yu()||t&&ue.INTERNAL.node&&ue.INTERNAL.node.sessionStorage))return!1;try{return t.setItem("__sak","1"),t.removeItem("__sak"),!0}catch(t){return!1}}()){if("Node"==lr())throw new Jr("internal-error","The SessionStorage compatibility library was not found.");throw new Jr("web-storage-unsupported")}this.a=yu()||ue.INTERNAL.node.sessionStorage,this.type="sessionStorage"}function yu(){try{var t=a.sessionStorage,e=Dr();return t&&(t.setItem(e,"1"),t.removeItem(e)),t}catch(t){return null}}function gu(){var t={};t.Browser=wu,t.Node=Iu,t.ReactNative=Eu,t.Worker=Tu,this.a=t[lr()]}Ws.prototype.c=function(t){var e=t.data.eventType,n=t.data.eventId,r=this.a[e];if(r&&0<r.length){t.ports[0].postMessage({status:"ack",eventId:n,eventType:e,response:null});var i=[];F(r,function(e){i.push(Xt().then(function(){return e(t.origin,t.data.data)}))}),te(i).then(function(r){var i=[];F(r,function(t){i.push({fulfilled:t.Gb,value:t.value,reason:t.reason?t.reason.message:void 0})}),F(i,function(t){for(var e in t)void 0===t[e]&&delete t[e]}),t.ports[0].postMessage({status:"done",eventId:n,eventType:e,response:i})})}},Ys.prototype.postMessage=function(t,e){this.a.postMessage(t,e)},Xs.prototype.close=function(){for(;0<this.a.length;)Zs(this,this.a[0]);this.b=!0},(t=tu.prototype).set=function(t,e){var n,r=!1,i=this;return nu(this).then(function(e){return au((e=iu(ou(n=e,!0))).get(t))}).then(function(o){var a=iu(ou(n,!0));return o?(o.value=e,au(a.put(o))):(i.b++,r=!0,(o={}).fbase_key=t,o.value=e,au(a.add(o)))}).then(function(){return i.c[t]=e,su(i,t)}).ka(function(){r&&i.b--})},t.get=function(t){return nu(this).then(function(e){return au(iu(ou(e,!1)).get(t))}).then(function(t){return t&&t.value})},t.S=function(t){var e=!1,n=this;return nu(this).then(function(r){return e=!0,n.b++,au(iu(ou(r,!0)).delete(t))}).then(function(){return delete n.c[t],su(n,t)}).ka(function(){e&&n.b--})},t.$=function(t){0==this.a.length&&function(t){cu(t),function e(){t.f=setTimeout(function(){t.i=uu(t).then(function(e){0<e.length&&F(t.a,function(t){t(e)})}).then(function(){e()}).s(function(t){"STOP_EVENT"!=t.message&&e()})},800)}()}(this),this.a.push(t)},t.ea=function(t){K(this.a,function(e){return e==t}),0==this.a.length&&cu(this)},(t=hu.prototype).get=function(t){return this.b.then(function(e){return e.get(t)})},t.set=function(t,e){return this.b.then(function(n){return n.set(t,e)})},t.S=function(t){return this.b.then(function(e){return e.S(t)})},t.$=function(t){this.a.push(t)},t.ea=function(t){K(this.a,function(e){return e==t})},(t=lu.prototype).get=function(t){return Xt(this.a[t])},t.set=function(t,e){return this.a[t]=e,Xt()},t.S=function(t){return delete this.a[t],Xt()},t.$=function(){},t.ea=function(){},(t=fu.prototype).get=function(t){var e=this;return Xt().then(function(){return Ar(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Xt().then(function(){var r=Nr(e);null===r?n.S(t):n.a.setItem(t,r)})},t.S=function(t){var e=this;return Xt().then(function(){e.a.removeItem(t)})},t.$=function(t){a.window&&Ge(a.window,"storage",t)},t.ea=function(t){a.window&&Ye(a.window,"storage",t)},(t=du.prototype).get=function(){return Xt(null)},t.set=function(){return Xt()},t.S=function(){return Xt()},t.$=function(){},t.ea=function(){},(t=mu.prototype).get=function(t){var e=this;return Xt().then(function(){return Ar(e.a.getItem(t))})},t.set=function(t,e){var n=this;return Xt().then(function(){var r=Nr(e);null===r?n.S(t):n.a.setItem(t,r)})},t.S=function(t){var e=this;return Xt().then(function(){e.a.removeItem(t)})},t.$=function(){},t.ea=function(){};var vu,bu,wu={C:fu,Sa:mu},Iu={C:fu,Sa:mu},Eu={C:Qs,Sa:du},Tu={C:fu,Sa:du},Su={$c:"local",NONE:"none",bd:"session"};function Nu(){var t=!(kr(vr())||!cr()),e=Sr(),n=wr();this.m=t,this.h=e,this.l=n,this.a={},vu||(vu=new gu),t=vu;try{this.g=!Zn()&&Mr()||!a.indexedDB?new t.a.C:new hu(hr()?new lu:new t.a.C)}catch(t){this.g=new lu,this.h=!0}try{this.i=new t.a.Sa}catch(t){this.i=new lu}this.u=new lu,this.f=E(this.Pb,this),this.b={}}function Cu(){return bu||(bu=new Nu),bu}function Au(t,e){switch(e){case"session":return t.i;case"none":return t.u;default:return t.g}}function Du(t,e){return"firebase:"+t.name+(e?":"+e:"")}function ku(t,e,n){return n=Du(e,n),"local"==e.C&&(t.b[n]=null),Au(t,e.C).S(n)}function _u(t){t.c&&(clearInterval(t.c),t.c=null)}function Ru(t){this.a=t,this.b=Cu()}(t=Nu.prototype).get=function(t,e){return Au(this,t.C).get(Du(t,e))},t.set=function(t,e,n){var r=Du(t,n),i=this,o=Au(this,t.C);return o.set(r,e).then(function(){return o.get(r)}).then(function(e){"local"==t.C&&(i.b[r]=e)})},t.addListener=function(t,e,n){t=Du(t,e),this.l&&(this.b[t]=a.localStorage.getItem(t)),G(this.a)&&(Au(this,"local").$(this.f),this.h||(Zn()||!Mr())&&a.indexedDB||!this.l||function(t){_u(t),t.c=setInterval(function(){for(var e in t.a){var n=a.localStorage.getItem(e),r=t.b[e];n!=r&&(t.b[e]=n,n=new xe({type:"storage",key:e,target:window,oldValue:r,newValue:n,a:!0}),t.Pb(n))}},1e3)}(this)),this.a[t]||(this.a[t]=[]),this.a[t].push(n)},t.removeListener=function(t,e,n){t=Du(t,e),this.a[t]&&(K(this.a[t],function(t){return t==n}),0==this.a[t].length&&delete this.a[t]),G(this.a)&&(Au(this,"local").ea(this.f),_u(this))},t.Pb=function(t){if(t&&t.f){var e=t.a.key;if(null==e)for(var n in this.a){var r=this.b[n];void 0===r&&(r=null);var i=a.localStorage.getItem(n);i!==r&&(this.b[n]=i,this.Za(n))}else if(0==e.indexOf("firebase:")&&this.a[e]){if(void 0!==t.a.a?Au(this,"local").ea(this.f):_u(this),this.m)if(n=a.localStorage.getItem(e),(r=t.a.newValue)!==n)null!==r?a.localStorage.setItem(e,r):a.localStorage.removeItem(e);else if(this.b[e]===r&&void 0===t.a.a)return;var o=this;n=function(){void 0===t.a.a&&o.b[e]===a.localStorage.getItem(e)||(o.b[e]=a.localStorage.getItem(e),o.Za(e))},be&&De&&10==De&&a.localStorage.getItem(e)!==t.a.newValue&&t.a.newValue!==t.a.oldValue?setTimeout(n,10):n()}}else F(t,E(this.Za,this))},t.Za=function(t){this.a[t]&&F(this.a[t],function(t){t()})};var Ou,Pu={name:"authEvent",C:"local"};function Mu(){this.a=Cu()}function Lu(t,e){this.b=xu,this.f=a.Uint8Array?new Uint8Array(this.b):Array(this.b),this.g=this.c=0,this.a=[],this.i=t,this.h=e,this.l=a.Int32Array?new Int32Array(64):Array(64),void 0!==Ou||(Ou=a.Int32Array?new Int32Array(Ku):Ku),this.reset()}N(Lu,function(){this.b=-1});for(var xu=64,qu=xu-1,Fu=[],Uu=0;Uu<qu;Uu++)Fu[Uu]=0;var Vu=$(128,Fu);function Bu(t){for(var e=t.f,n=t.l,r=0,i=0;i<e.length;)n[r++]=e[i]<<24|e[i+1]<<16|e[i+2]<<8|e[i+3],i=4*r;for(e=16;64>e;e++){i=0|n[e-15],r=0|n[e-2];var o=(0|n[e-16])+((i>>>7|i<<25)^(i>>>18|i<<14)^i>>>3)|0,a=(0|n[e-7])+((r>>>17|r<<15)^(r>>>19|r<<13)^r>>>10)|0;n[e]=o+a|0}r=0|t.a[0],i=0|t.a[1];var s=0|t.a[2],u=0|t.a[3],c=0|t.a[4],h=0|t.a[5],l=0|t.a[6];for(o=0|t.a[7],e=0;64>e;e++){var f=((r>>>2|r<<30)^(r>>>13|r<<19)^(r>>>22|r<<10))+(r&i^r&s^i&s)|0;a=(o=o+((c>>>6|c<<26)^(c>>>11|c<<21)^(c>>>25|c<<7))|0)+((a=(a=c&h^~c&l)+(0|Ou[e])|0)+(0|n[e])|0)|0,o=l,l=h,h=c,c=u+a|0,u=s,s=i,i=r,r=a+f|0}t.a[0]=t.a[0]+r|0,t.a[1]=t.a[1]+i|0,t.a[2]=t.a[2]+s|0,t.a[3]=t.a[3]+u|0,t.a[4]=t.a[4]+c|0,t.a[5]=t.a[5]+h|0,t.a[6]=t.a[6]+l|0,t.a[7]=t.a[7]+o|0}function ju(t,e,n){void 0===n&&(n=e.length);var r=0,i=t.c;if(s(e))for(;r<n;)t.f[i++]=e.charCodeAt(r++),i==t.b&&(Bu(t),i=0);else{if(!m(e))throw Error("message must be string or array");for(;r<n;){var o=e[r++];if(!("number"==typeof o&&0<=o&&255>=o&&o==(0|o)))throw Error("message must be a byte array");t.f[i++]=o,i==t.b&&(Bu(t),i=0)}}t.c=i,t.g+=n}Lu.prototype.reset=function(){this.g=this.c=0,this.a=a.Int32Array?new Int32Array(this.h):Q(this.h)};var Ku=[1116352408,1899447441,3049323471,3921009573,961987163,1508970993,2453635748,2870763221,3624381080,310598401,607225278,1426881987,1925078388,2162078206,2614888103,3248222580,3835390401,4022224774,264347078,604807628,770255983,1249150122,1555081692,1996064986,2554220882,2821834349,2952996808,3210313671,3336571891,3584528711,113926993,338241895,666307205,773529912,1294757372,1396182291,1695183700,1986661051,2177026350,2456956037,2730485921,2820302411,3259730800,3345764771,3516065817,3600352804,4094571909,275423344,430227734,506948616,659060556,883997877,958139571,1322822218,1537002063,1747873779,1955562222,2024104815,2227730452,2361852424,2428436474,2756734187,3204031479,3329325298];function $u(){Lu.call(this,8,Qu)}N($u,Lu);var Qu=[1779033703,3144134277,1013904242,2773480762,1359893119,2600822924,528734635,1541459225];function Wu(t,e,n,r,i){this.u=t,this.i=e,this.l=n,this.m=r||null,this.o=i||null,this.h=e+":"+n,this.v=new Mu,this.g=new Ru(this.h),this.f=null,this.b=[],this.a=this.c=null}function Gu(t){return new Jr("invalid-cordova-configuration",t)}function zu(t){var e=new $u;ju(e,t),t=[];var n=8*e.g;56>e.c?ju(e,Vu,56-e.c):ju(e,Vu,e.b-(e.c-56));for(var r=63;56<=r;r--)e.f[r]=255&n,n/=256;for(Bu(e),r=n=0;r<e.i;r++)for(var i=24;0<=i;i-=8)t[n++]=e.a[r]>>i&255;return function(t){return U(t,function(t){return 1<(t=t.toString(16)).length?t:"0"+t}).join("")}(t)}function Hu(t,e){for(var n=0;n<t.b.length;n++)try{t.b[n](e)}catch(t){}}function Yu(t){return t.f||(t.f=t.ia().then(function(){return new $t(function(e){t.ya(function n(r){return e(r),t.La(n),!1}),function(t){function e(e){r=!0,i&&i.cancel(),Xu(t).then(function(r){var i=n;if(r&&e&&e.url){var o=null;-1!=(i=$i(e.url)).indexOf("/__/auth/callback")&&(o=(o="object"==typeof(o=Ar(Tn(o=Sn(i),"firebaseError")||null))?Zr(o):null)?new To(r.c,r.b,null,null,o,null,r.R()):new To(r.c,r.b,i,r.f,null,null,r.R())),i=o||n}Hu(t,i)})}var n=new To("unknown",null,null,null,new Jr("no-auth-event")),r=!1,i=ln(500).then(function(){return Xu(t).then(function(){r||Hu(t,n)})}),o=a.handleOpenURL;a.handleOpenURL=function(t){if(0==t.toLowerCase().indexOf(br("BuildInfo.packageName",a).toLowerCase()+"://")&&e({url:t}),"function"==typeof o)try{o(t)}catch(t){console.error(t)}},Ao||(Ao=new No),function(t){var e=Ao;e.a.push(t),e.b||(e.b=function(t){for(var n=0;n<e.a.length;n++)e.a[n](t)},"function"==typeof(t=br("universalLinks.subscribe",a))&&t(null,e.b))}(e)}(t)})})),t.f}function Xu(t){var e=null;return function(t){return t.b.get(Pu,t.a).then(function(t){return So(t)})}(t.g).then(function(n){return e=n,ku((n=t.g).b,Pu,n.a)}).then(function(){return e})}function Ju(t){this.a=t,this.b=Cu()}(t=Wu.prototype).ia=function(){return this.Ba?this.Ba:this.Ba=(ur(void 0)?sr().then(function(){return new $t(function(t,e){var n=a.document,r=setTimeout(function(){e(Error("Cordova framework is not ready."))},1e3);n.addEventListener("deviceready",function(){clearTimeout(r),t()},!1)})}):Jt(Error("Cordova must run in an Android or iOS file scheme."))).then(function(){if("function"!=typeof br("universalLinks.subscribe",a))throw Gu("cordova-universal-links-plugin-fix is not installed");if(void 0===br("BuildInfo.packageName",a))throw Gu("cordova-plugin-buildinfo is not installed");if("function"!=typeof br("cordova.plugins.browsertab.openUrl",a))throw Gu("cordova-plugin-browsertab is not installed");if("function"!=typeof br("cordova.InAppBrowser.open",a))throw Gu("cordova-plugin-inappbrowser is not installed")},function(){throw new Jr("cordova-not-ready")})},t.Fb=function(t,e){return e(new Jr("operation-not-supported-in-this-environment")),Xt()},t.Db=function(){return Jt(new Jr("operation-not-supported-in-this-environment"))},t.Rb=function(){return!1},t.Ob=function(){return!0},t.Jb=function(){return!0},t.Eb=function(t,e,n,r){if(this.c)return Jt(new Jr("redirect-operation-pending"));var i=this,o=a.document,s=null,u=null,c=null,h=null;return this.c=Xt().then(function(){return Eo(e),Yu(i)}).then(function(){return function(t,e,n,r,i){var o=function(){for(var t=20,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}(),s=new To(e,r,null,o,new Jr("no-auth-event"),null,i),u=br("BuildInfo.packageName",a);if("string"!=typeof u)throw new Jr("invalid-cordova-configuration");var c=br("BuildInfo.displayName",a),h={};if(vr().toLowerCase().match(/iphone|ipad|ipod/))h.ibi=u;else{if(!vr().toLowerCase().match(/android/))return Jt(new Jr("operation-not-supported-in-this-environment"));h.apn=u}c&&(h.appDisplayName=c),o=zu(o),h.sessionId=o;var l=$s(t.u,t.i,t.l,e,n,null,r,t.m,h,t.o,i);return t.ia().then(function(){var e=t.h;return t.v.a.set(Pu,s.A(),e)}).then(function(){var e=br("cordova.plugins.browsertab.isAvailable",a);if("function"!=typeof e)throw new Jr("invalid-cordova-configuration");var n=null;e(function(e){if(e){if("function"!=typeof(n=br("cordova.plugins.browsertab.openUrl",a)))throw new Jr("invalid-cordova-configuration");n(l)}else{if("function"!=typeof(n=br("cordova.InAppBrowser.open",a)))throw new Jr("invalid-cordova-configuration");e=vr(),t.a=n(l,e.match(/(iPad|iPhone|iPod).*OS 7_\d/i)||e.match(/(iPad|iPhone|iPod).*OS 8_\d/i)?"_blank":"_system","location=yes")}})})}(i,t,e,n,r)}).then(function(){return new $t(function(t,e){u=function(){var e=br("cordova.plugins.browsertab.close",a);return t(),"function"==typeof e&&e(),i.a&&"function"==typeof i.a.close&&(i.a.close(),i.a=null),!1},i.ya(u),c=function(){s||(s=ln(2e3).then(function(){e(new Jr("redirect-cancelled-by-user"))}))},h=function(){Or()&&c()},o.addEventListener("resume",c,!1),vr().toLowerCase().match(/android/)||o.addEventListener("visibilitychange",h,!1)}).s(function(t){return Xu(i).then(function(){throw t})})}).ka(function(){c&&o.removeEventListener("resume",c,!1),h&&o.removeEventListener("visibilitychange",h,!1),s&&s.cancel(),u&&i.La(u),i.c=null})},t.ya=function(t){this.b.push(t),Yu(this).s(function(e){"auth/invalid-cordova-configuration"===e.code&&(e=new To("unknown",null,null,null,new Jr("no-auth-event")),t(e))})},t.La=function(t){K(this.b,function(e){return e==t})};var Zu={name:"pendingRedirect",C:"session"};function tc(t){return ku(t.b,Zu,t.a)}function ec(t,e,n){this.i={},this.v=0,this.B=t,this.u=e,this.m=n,this.h=[],this.f=!1,this.l=E(this.o,this),this.b=new mc,this.w=new wc,this.g=new Ju(this.u+":"+this.m),this.c={},this.c.unknown=this.b,this.c.signInViaRedirect=this.b,this.c.linkViaRedirect=this.b,this.c.reauthViaRedirect=this.b,this.c.signInViaPopup=this.w,this.c.linkViaPopup=this.w,this.c.reauthViaPopup=this.w,this.a=nc(this.B,this.u,this.m,Di)}function nc(t,e,n,r){var i=ue.SDK_VERSION||null;return ur()?new Wu(t,e,n,i,r):new Vs(t,e,n,i,r)}function rc(t){t.f||(t.f=!0,t.a.ya(t.l));var e=t.a;return t.a.ia().s(function(n){throw t.a==e&&t.reset(),n})}function ic(t){t.a.Ob()&&rc(t).s(function(e){var n=new To("unknown",null,null,null,new Jr("operation-not-supported-in-this-environment"));hc(e)&&t.o(n)}),t.a.Jb()||yc(t.b)}function oc(t,e){B(t.h,e)||t.h.push(e),t.f||function(t){return t.b.get(Zu,t.a).then(function(t){return"pending"==t})}(t.g).then(function(e){e?tc(t.g).then(function(){rc(t).s(function(e){var n=new To("unknown",null,null,null,new Jr("operation-not-supported-in-this-environment"));hc(e)&&t.o(n)})}):ic(t)}).s(function(){ic(t)})}function ac(t,e){K(t.h,function(t){return t==e})}ec.prototype.reset=function(){this.f=!1,this.a.La(this.l),this.a=nc(this.B,this.u,this.m),this.i={}},ec.prototype.o=function(t){if(!t)throw new Jr("invalid-auth-event");if(6e5<=S()-this.v&&(this.i={},this.v=0),t&&t.getUid()&&this.i.hasOwnProperty(t.getUid()))return!1;for(var e=!1,n=0;n<this.h.length;n++){var r=this.h[n];if(r.xb(t.c,t.b)){(e=this.c[t.c])&&(e.h(t,r),t&&(t.f||t.b)&&(this.i[t.getUid()]=!0,this.v=S())),e=!0;break}}return yc(this.b),e};var sc=new Rr(2e3,1e4),uc=new Rr(3e4,6e4);function cc(t,e,n,r,i,o,a){return t.a.Db(e,n,r,function(){t.f||(t.f=!0,t.a.ya(t.l))},function(){t.reset()},i,o,a)}function hc(t){return!(!t||"auth/cordova-not-ready"!=t.code)}function lc(t,e,n,r,i){var o;return function(t){return t.b.set(Zu,"pending",t.a)}(t.g).then(function(){return t.a.Eb(e,n,r,i).s(function(e){if(hc(e))throw new Jr("operation-not-supported-in-this-environment");return o=e,tc(t.g).then(function(){throw o})}).then(function(){return t.a.Rb()?new $t(function(){}):tc(t.g).then(function(){return t.oa()}).then(function(){}).s(function(){})})})}function fc(t,e,n,r,i){return t.a.Fb(r,function(t){e.ja(n,null,t,i)},sc.get())}ec.prototype.oa=function(){return this.b.oa()};var pc={};function dc(t,e,n){var r=e+":"+n;return pc[r]||(pc[r]=new ec(t,e,n)),pc[r]}function mc(){this.b=null,this.f=[],this.c=[],this.a=null,this.i=this.g=!1}function yc(t){t.g||(t.g=!0,bc(t,!1,null,null))}function gc(t){t.g&&!t.i&&bc(t,!1,null,null)}function vc(t,e){if(t.b=function(){return Xt(e)},t.f.length)for(var n=0;n<t.f.length;n++)t.f[n](e)}function bc(t,e,n,r){e?r?function(t,e){if(t.b=function(){return Jt(e)},t.c.length)for(var n=0;n<t.c.length;n++)t.c[n](e)}(t,r):vc(t,n):vc(t,{user:null}),t.f=[],t.c=[]}function wc(){}function Ic(){this.vb=!1,Object.defineProperty(this,"appVerificationDisabled",{get:function(){return this.vb},set:function(t){this.vb=t},enumerable:!1})}function Ec(t,e){this.a=e,Ur(this,"verificationId",t)}function Tc(t,e,n,r){return new bo(t).Va(e,n).then(function(t){return new Ec(t,r)})}function Sc(t){var e=Ai(t);if(!(e&&e.exp&&e.auth_time&&e.iat))throw new Jr("internal-error","An internal error occurred. The token obtained by Firebase appears to be malformed. Please retry the operation.");Vr(this,{token:t,expirationTime:Pr(1e3*e.exp),authTime:Pr(1e3*e.auth_time),issuedAtTime:Pr(1e3*e.iat),signInProvider:e.firebase&&e.firebase.sign_in_provider?e.firebase.sign_in_provider:null,claims:e})}function Nc(t,e,n){if(this.h=t,this.i=e,this.g=n,this.c=3e4,this.f=96e4,this.b=null,this.a=this.c,this.f<this.c)throw Error("Proactive refresh lower bound greater than upper bound!")}function Cc(t){this.f=t,this.b=this.a=null,this.c=0}function Ac(t,e){var n=e[Ma],r=e.refreshToken;e=Dc(e.expiresIn),t.b=n,t.c=e,t.a=r}function Dc(t){return S()+1e3*parseInt(t,10)}function kc(t,e){return function(t,e){return new $t(function(n,r){"refresh_token"==e.grant_type&&e.refresh_token||"authorization_code"==e.grant_type&&e.code?Ba(t,t.l+"?key="+encodeURIComponent(t.c),function(t){t?t.error?r(Rs(t)):t.access_token&&t.refresh_token?n(t):r(new Jr("internal-error")):r(new Jr("network-request-failed"))},"POST",xn(e).toString(),t.g,t.u.get()):r(new Jr("internal-error"))})}(t.f,e).then(function(e){return t.b=e.access_token,t.c=Dc(e.expires_in),t.a=e.refresh_token,{accessToken:t.b,expirationTime:t.c,refreshToken:t.a}}).s(function(e){throw"auth/user-token-expired"==e.code&&(t.a=null),e})}function _c(t,e){this.a=t||null,this.b=e||null,Vr(this,{lastSignInTime:Pr(e||null),creationTime:Pr(t||null)})}function Rc(t,e,n,r,i,o){Vr(this,{uid:t,displayName:r||null,photoURL:i||null,email:n||null,phoneNumber:o||null,providerId:e})}function Oc(t,e){for(var n in Le.call(this,t),e)this[n]=e[n]}function Pc(t,e,n){this.I=[],this.l=t.apiKey,this.m=t.appName,this.o=t.authDomain||null,t=ue.SDK_VERSION?gr(ue.SDK_VERSION):null,this.a=new Oa(this.l,_i(Di),t),this.b=new Cc(this.a),Vc(this,e[Ma]),Ac(this.b,e),Ur(this,"refreshToken",this.b.a),Kc(this,n||{}),an.call(this),this.J=!1,this.o&&Ir()&&(this.i=dc(this.o,this.l,this.m)),this.O=[],this.h=null,this.w=function(t){return new Nc(function(){return t.G(!0)},function(t){return!(!t||"auth/network-request-failed"!=t.code)},function(){var e=t.b.c-S()-3e5;return 0<e?e:0})}(this),this.W=E(this.Ha,this);var r=this;this.ga=null,this.va=function(t){r.sa(t.g)},this.Z=null,this.P=[],this.ua=function(t){Lc(r,t.c)},this.Y=null}function Mc(t,e){t.Z&&Ye(t.Z,"languageCodeChanged",t.va),(t.Z=e)&&Ge(e,"languageCodeChanged",t.va)}function Lc(t,e){t.P=e,Va(t.a,ue.SDK_VERSION?gr(ue.SDK_VERSION,t.P):null)}function xc(t,e){t.Y&&Ye(t.Y,"frameworkChanged",t.ua),(t.Y=e)&&Ge(e,"frameworkChanged",t.ua)}function qc(t){try{return ue.app(t.m).auth()}catch(e){throw new Jr("internal-error","No firebase.auth.Auth instance is available for the Firebase App '"+t.m+"'!")}}function Fc(t){t.B||t.w.b||(t.w.start(),Ye(t,"tokenChanged",t.W),Ge(t,"tokenChanged",t.W))}function Uc(t){Ye(t,"tokenChanged",t.W),t.w.stop()}function Vc(t,e){t.ma=e,Ur(t,"_lat",e)}function Bc(t){for(var e=[],n=0;n<t.O.length;n++)e.push(t.O[n](t));return te(e).then(function(){return t})}function jc(t){t.i&&!t.J&&(t.J=!0,oc(t.i,t))}function Kc(t,e){Vr(t,{uid:e.uid,displayName:e.displayName||null,photoURL:e.photoURL||null,email:e.email||null,emailVerified:e.emailVerified||!1,phoneNumber:e.phoneNumber||null,isAnonymous:e.isAnonymous||!1,tenantId:e.tenantId||null,metadata:new _c(e.createdAt,e.lastLoginAt),providerData:[]}),t.a.b=t.tenantId}function $c(){}function Qc(t){return Xt().then(function(){if(t.B)throw new Jr("app-deleted")})}function Wc(t){return U(t.providerData,function(t){return t.providerId})}function Gc(t,e){e&&(zc(t,e.providerId),t.providerData.push(e))}function zc(t,e){K(t.providerData,function(t){return t.providerId==e})}function Hc(t,e,n){("uid"!=e||n)&&t.hasOwnProperty(e)&&Ur(t,e,n)}function Yc(t,e){t!=e&&(Vr(t,{uid:e.uid,displayName:e.displayName,photoURL:e.photoURL,email:e.email,emailVerified:e.emailVerified,phoneNumber:e.phoneNumber,isAnonymous:e.isAnonymous,tenantId:e.tenantId,providerData:[]}),e.metadata?Ur(t,"metadata",function(t){return new _c(t.a,t.b)}(e.metadata)):Ur(t,"metadata",new _c),F(e.providerData,function(e){Gc(t,e)}),function(t,e){t.b=e.b,t.a=e.a,t.c=e.c}(t.b,e.b),Ur(t,"refreshToken",t.b.a))}function Xc(t){return t.G().then(function(e){var n=t.isAnonymous;return function(t,e){return ks(t.a,hs,{idToken:e}).then(E(t.zc,t))}(t,e).then(function(){return n||Hc(t,"isAnonymous",!1),e})})}function Jc(t,e){e[Ma]&&t.ma!=e[Ma]&&(Ac(t.b,e),t.dispatchEvent(new Oc("tokenChanged")),Vc(t,e[Ma]),Hc(t,"refreshToken",t.b.a))}function Zc(t,e){return Xc(t).then(function(){if(B(Wc(t),e))return Bc(t).then(function(){throw new Jr("provider-already-linked")})})}function th(t,e,n){return Br({user:t,credential:Io(e),additionalUserInfo:e=Li(e),operationType:n})}function eh(t,e){return Jc(t,e),t.reload().then(function(){return t})}function nh(t,e,n,r,i){if(!Ir())return Jt(new Jr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Jt(t.h);var o=Mi(n.providerId),a=Dr(t.uid+":::"),s=null;(!Sr()||cr())&&t.o&&n.isOAuthProvider&&(s=$s(t.o,t.l,t.m,e,n,null,a,ue.SDK_VERSION||null,null,null,t.tenantId));var u=ir(s,o&&o.Da,o&&o.Ca);return r=r().then(function(){if(ih(t),!i)return t.G().then(function(){})}).then(function(){return cc(t.i,u,e,n,a,!!s,t.tenantId)}).then(function(){return new $t(function(n,r){t.ja(e,null,new Jr("cancelled-popup-request"),t.g||null),t.f=n,t.v=r,t.g=a,t.c=fc(t.i,t,e,u,a)})}).then(function(t){return u&&rr(u),t?Br(t):null}).s(function(t){throw u&&rr(u),t}),oh(t,r,i)}function rh(t,e,n,r,i){if(!Ir())return Jt(new Jr("operation-not-supported-in-this-environment"));if(t.h&&!i)return Jt(t.h);var o=null,a=Dr(t.uid+":::");return r=r().then(function(){if(ih(t),!i)return t.G().then(function(){})}).then(function(){return t.ca=a,Bc(t)}).then(function(e){return t.da&&(e=(e=t.da).b.set(uh,t.A(),e.a)),e}).then(function(){return lc(t.i,e,n,a,t.tenantId)}).s(function(e){if(o=e,t.da)return ch(t.da);throw o}).then(function(){if(o)throw o}),oh(t,r,i)}function ih(t){if(!t.i||!t.J){if(t.i&&!t.J)throw new Jr("internal-error");throw new Jr("auth-domain-config-required")}}function oh(t,e,n){var r=function(t,e,n){return t.h&&!n?(e.cancel(),Jt(t.h)):e.s(function(e){throw!e||"auth/user-disabled"!=e.code&&"auth/user-token-expired"!=e.code||(t.h||t.dispatchEvent(new Oc("userInvalidated")),t.h=e),e})}(t,e,n);return t.I.push(r),r.ka(function(){j(t.I,r)}),r}function ah(t){if(!t.apiKey)return null;var e={apiKey:t.apiKey,authDomain:t.authDomain,appName:t.appName},n={};if(!(t.stsTokenManager&&t.stsTokenManager.accessToken&&t.stsTokenManager.expirationTime))return null;n[Ma]=t.stsTokenManager.accessToken,n.refreshToken=t.stsTokenManager.refreshToken||null,n.expiresIn=(t.stsTokenManager.expirationTime-S())/1e3;var r=new Pc(e,n,t);return t.providerData&&F(t.providerData,function(t){t&&Gc(r,Br(t))}),t.redirectEventId&&(r.ca=t.redirectEventId),r}function sh(t){this.a=t,this.b=Cu()}mc.prototype.reset=function(){this.b=null,this.a&&(this.a.cancel(),this.a=null)},mc.prototype.h=function(t,e){if(t){this.reset(),this.g=!0;var n=t.c,r=t.b,i=t.a&&"auth/web-storage-unsupported"==t.a.code,o=t.a&&"auth/operation-not-supported-in-this-environment"==t.a.code;this.i=!(!i&&!o),"unknown"!=n||i||o?t.a?(bc(this,!0,null,t.a),Xt()):e.za(n,r)?function(t,e,n){n=n.za(e.c,e.b);var r=e.g,i=e.f,o=e.i,a=e.R(),s=!!e.c.match(/Redirect$/);n(r,i,a,o).then(function(e){bc(t,s,e,null)}).s(function(e){bc(t,s,null,e)})}(this,t,e):Jt(new Jr("invalid-auth-event")):(bc(this,!1,null,null),Xt())}else Jt(new Jr("invalid-auth-event"))},mc.prototype.oa=function(){var t=this;return new $t(function(e,n){t.b?t.b().then(e,n):(t.f.push(e),t.c.push(n),function(t){var e=new Jr("timeout");t.a&&t.a.cancel(),t.a=ln(uc.get()).then(function(){t.b||(t.g=!0,bc(t,!0,null,e))})}(t))})},wc.prototype.h=function(t,e){if(t){var n=t.c,r=t.b;t.a?(e.ja(t.c,null,t.a,t.b),Xt()):e.za(n,r)?function(t,e){var n=t.b,r=t.c;e.za(r,n)(t.g,t.f,t.R(),t.i).then(function(t){e.ja(r,t,null,n)}).s(function(t){e.ja(r,null,t,n)})}(t,e):Jt(new Jr("invalid-auth-event"))}else Jt(new Jr("invalid-auth-event"))},Ec.prototype.confirm=function(t){return t=wo(this.verificationId,t),this.a(t)},Nc.prototype.start=function(){this.a=this.c,function t(e,n){e.stop();e.b=ln(function(t,e){return e?(t.a=t.c,t.g()):(e=t.a,t.a*=2,t.a>t.f&&(t.a=t.f),e)}(e,n)).then(function(){return t=a.document,e=null,Or()||!t?Xt():new $t(function(n){e=function(){Or()&&(t.removeEventListener("visibilitychange",e,!1),n())},t.addEventListener("visibilitychange",e,!1)}).s(function(n){throw t.removeEventListener("visibilitychange",e,!1),n});var t,e}).then(function(){return e.h()}).then(function(){t(e,!0)}).s(function(n){e.i(n)&&t(e,!1)})}(this,!0)},Nc.prototype.stop=function(){this.b&&(this.b.cancel(),this.b=null)},Cc.prototype.A=function(){return{apiKey:this.f.c,refreshToken:this.a,accessToken:this.b,expirationTime:this.c}},Cc.prototype.getToken=function(t){return t=!!t,this.b&&!this.a?Jt(new Jr("user-token-expired")):t||!this.b||S()>this.c-3e4?this.a?kc(this,{grant_type:"refresh_token",refresh_token:this.a}):Xt(null):Xt({accessToken:this.b,expirationTime:this.c,refreshToken:this.a})},_c.prototype.A=function(){return{lastLoginAt:this.b,createdAt:this.a}},N(Oc,Le),N(Pc,an),Pc.prototype.sa=function(t){this.ga=t,Ua(this.a,t)},Pc.prototype.ha=function(){return this.ga},Pc.prototype.Aa=function(){return Q(this.P)},Pc.prototype.Ha=function(){this.w.b&&(this.w.stop(),this.w.start())},Ur(Pc.prototype,"providerId","firebase"),(t=Pc.prototype).reload=function(){var t=this;return oh(this,Qc(this).then(function(){return Xc(t).then(function(){return Bc(t)}).then($c)}))},t.dc=function(t){return this.G(t).then(function(t){return new Sc(t)})},t.G=function(t){var e=this;return oh(this,Qc(this).then(function(){return e.b.getToken(t)}).then(function(t){if(!t)throw new Jr("internal-error");return t.accessToken!=e.ma&&(Vc(e,t.accessToken),e.dispatchEvent(new Oc("tokenChanged"))),Hc(e,"refreshToken",t.refreshToken),t.accessToken}))},t.zc=function(t){if(!(t=t.users)||!t.length)throw new Jr("internal-error");Kc(this,{uid:(t=t[0]).localId,displayName:t.displayName,photoURL:t.photoUrl,email:t.email,emailVerified:!!t.emailVerified,phoneNumber:t.phoneNumber,lastLoginAt:t.lastLoginAt,createdAt:t.createdAt,tenantId:t.tenantId});for(var e=function(t){return(t=t.providerUserInfo)&&t.length?U(t,function(t){return new Rc(t.rawId,t.providerId,t.email,t.displayName,t.photoUrl,t.phoneNumber)}):[]}(t),n=0;n<e.length;n++)Gc(this,e[n]);Hc(this,"isAnonymous",!(this.email&&t.passwordHash||this.providerData&&this.providerData.length))},t.Ac=function(t){return qr("firebase.User.prototype.reauthenticateAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.reauthenticateWithCredential instead."),this.gb(t)},t.gb=function(t){var e=this,n=null;return oh(this,t.f(this.a,this.uid).then(function(t){return Jc(e,t),n=th(e,t,"reauthenticate"),e.h=null,e.reload()}).then(function(){return n}),!0)},t.rc=function(t){return qr("firebase.User.prototype.linkAndRetrieveDataWithCredential is deprecated. Please use firebase.User.prototype.linkWithCredential instead."),this.eb(t)},t.eb=function(t){var e=this,n=null;return oh(this,Zc(this,t.providerId).then(function(){return e.G()}).then(function(n){return t.b(e.a,n)}).then(function(t){return n=th(e,t,"link"),eh(e,t)}).then(function(){return n}))},t.sc=function(t,e){var n=this;return oh(this,Zc(this,"phone").then(function(){return Tc(qc(n),t,e,E(n.eb,n))}))},t.Bc=function(t,e){var n=this;return oh(this,Xt().then(function(){return Tc(qc(n),t,e,E(n.gb,n))}),!0)},t.rb=function(t){var e=this;return oh(this,this.G().then(function(n){return e.a.rb(n,t)}).then(function(t){return Jc(e,t),e.reload()}))},t.Sc=function(t){var e=this;return oh(this,this.G().then(function(n){return t.b(e.a,n)}).then(function(t){return Jc(e,t),e.reload()}))},t.sb=function(t){var e=this;return oh(this,this.G().then(function(n){return e.a.sb(n,t)}).then(function(t){return Jc(e,t),e.reload()}))},t.tb=function(t){if(void 0===t.displayName&&void 0===t.photoURL)return Qc(this);var e=this;return oh(this,this.G().then(function(n){return e.a.tb(n,{displayName:t.displayName,photoUrl:t.photoURL})}).then(function(t){return Jc(e,t),Hc(e,"displayName",t.displayName||null),Hc(e,"photoURL",t.photoUrl||null),F(e.providerData,function(t){"password"===t.providerId&&(Ur(t,"displayName",e.displayName),Ur(t,"photoURL",e.photoURL))}),Bc(e)}).then($c))},t.Qc=function(t){var e=this;return oh(this,Xc(this).then(function(n){return B(Wc(e),t)?function(t,e,n){return ks(t,ss,{idToken:e,deleteProvider:n})}(e.a,n,[t]).then(function(t){var n={};return F(t.providerUserInfo||[],function(t){n[t.providerId]=!0}),F(Wc(e),function(t){n[t]||zc(e,t)}),n[bo.PROVIDER_ID]||Ur(e,"phoneNumber",null),Bc(e)}):Bc(e).then(function(){throw new Jr("no-such-provider")})}))},t.delete=function(){var t=this;return oh(this,this.G().then(function(e){return ks(t.a,as,{idToken:e})}).then(function(){t.dispatchEvent(new Oc("userDeleted"))})).then(function(){for(var e=0;e<t.I.length;e++)t.I[e].cancel("app-deleted");Mc(t,null),xc(t,null),t.I=[],t.B=!0,Uc(t),Ur(t,"refreshToken",null),t.i&&ac(t.i,t)})},t.xb=function(t,e){return!!("linkViaPopup"==t&&(this.g||null)==e&&this.f||"reauthViaPopup"==t&&(this.g||null)==e&&this.f||"linkViaRedirect"==t&&(this.ca||null)==e||"reauthViaRedirect"==t&&(this.ca||null)==e)},t.ja=function(t,e,n,r){"linkViaPopup"!=t&&"reauthViaPopup"!=t||r!=(this.g||null)||(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"linkViaPopup"==t&&e==(this.g||null)?E(this.Bb,this):"reauthViaPopup"==t&&e==(this.g||null)?E(this.Cb,this):"linkViaRedirect"==t&&(this.ca||null)==e?E(this.Bb,this):"reauthViaRedirect"==t&&(this.ca||null)==e?E(this.Cb,this):null},t.tc=function(t){var e=this;return nh(this,"linkViaPopup",t,function(){return Zc(e,t.providerId).then(function(){return Bc(e)})},!1)},t.Cc=function(t){return nh(this,"reauthViaPopup",t,function(){return Xt()},!0)},t.uc=function(t){var e=this;return rh(this,"linkViaRedirect",t,function(){return Zc(e,t.providerId)},!1)},t.Dc=function(t){return rh(this,"reauthViaRedirect",t,function(){return Xt()},!0)},t.Bb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return oh(this,this.G().then(function(n){return Za(i.a,{requestUri:t,postBody:r,sessionId:e,idToken:n})}).then(function(t){return o=th(i,t,"link"),eh(i,t)}).then(function(){return o}))},t.Cb=function(t,e,n,r){var i=this;this.c&&(this.c.cancel(),this.c=null);var o=null;return oh(this,Xt().then(function(){return Wi(ts(i.a,{requestUri:t,sessionId:e,postBody:r,tenantId:n}),i.uid)}).then(function(t){return o=th(i,t,"reauthenticate"),Jc(i,t),i.h=null,i.reload()}).then(function(){return o}),!0)},t.jb=function(t){var e=this,n=null;return oh(this,this.G().then(function(e){return n=e,void 0===t||G(t)?{}:Ii(new li(t))}).then(function(t){return e.a.jb(n,t)}).then(function(t){if(e.email!=t)return e.reload()}).then(function(){}))},t.toJSON=function(){return this.A()},t.A=function(){var t={uid:this.uid,displayName:this.displayName,photoURL:this.photoURL,email:this.email,emailVerified:this.emailVerified,phoneNumber:this.phoneNumber,isAnonymous:this.isAnonymous,tenantId:this.tenantId,providerData:[],apiKey:this.l,appName:this.m,authDomain:this.o,stsTokenManager:this.b.A(),redirectEventId:this.ca||null};return this.metadata&&Y(t,this.metadata.A()),F(this.providerData,function(e){t.providerData.push(function(t){var e,n={};for(e in t)t.hasOwnProperty(e)&&(n[e]=t[e]);return n}(e))}),t};var uh={name:"redirectUser",C:"session"};function ch(t){return ku(t.b,uh,t.a)}function hh(t){this.a=t,this.b=Cu(),this.c=null,this.f=function(t){var e=ph("local"),n=ph("session"),r=ph("none");return function(t,e,n){var r=Du(e,n),i=Au(t,e.C);return t.get(e,n).then(function(o){var s=null;try{s=Ar(a.localStorage.getItem(r))}catch(t){}if(s&&!o)return a.localStorage.removeItem(r),t.set(e,s,n);s&&o&&"localStorage"!=i.type&&a.localStorage.removeItem(r)})}(t.b,e,t.a).then(function(){return t.b.get(n,t.a)}).then(function(i){return i?n:t.b.get(r,t.a).then(function(n){return n?r:t.b.get(e,t.a).then(function(n){return n?e:t.b.get(fh,t.a).then(function(t){return t?ph(t):e})})})}).then(function(e){return t.c=e,lh(t,e.C)}).s(function(){t.c||(t.c=e)})}(this),this.b.addListener(ph("local"),this.a,E(this.g,this))}function lh(t,e){var n,r=[];for(n in Su)Su[n]!==e&&r.push(ku(t.b,ph(Su[n]),t.a));return r.push(ku(t.b,fh,t.a)),function(t){return new $t(function(e,n){var r=t.length,i=[];if(r)for(var o=function(t,n){r--,i[t]=n,0==r&&e(i)},a=function(t){n(t)},s=0;s<t.length;s++)Zt(t[s],T(o,s),a);else e(i)})}(r)}hh.prototype.g=function(){var t=this,e=ph("local");gh(this,function(){return Xt().then(function(){return t.c&&"local"!=t.c.C?t.b.get(e,t.a):null}).then(function(n){if(n)return lh(t,"local").then(function(){t.c=e})})})};var fh={name:"persistence",C:"session"};function ph(t){return{name:"authUser",C:t}}function dh(t,e){return gh(t,function(){return t.b.set(t.c,e.A(),t.a)})}function mh(t){return gh(t,function(){return ku(t.b,t.c,t.a)})}function yh(t,e){return gh(t,function(){return t.b.get(t.c,t.a).then(function(t){return t&&e&&(t.authDomain=e),ah(t||{})})})}function gh(t,e){return t.f=t.f.then(e,e),t.f}function vh(t){if(this.l=!1,Ur(this,"settings",new Ic),Ur(this,"app",t),!Ch(this).options||!Ch(this).options.apiKey)throw new Jr("invalid-api-key");t=ue.SDK_VERSION?gr(ue.SDK_VERSION):null,this.b=new Oa(Ch(this).options&&Ch(this).options.apiKey,_i(Di),t),this.O=[],this.m=[],this.J=[],this.Ub=ue.INTERNAL.createSubscribe(E(this.oc,this)),this.W=void 0,this.Vb=ue.INTERNAL.createSubscribe(E(this.pc,this)),Sh(this,null),this.h=new hh(Ch(this).options.apiKey+":"+Ch(this).name),this.w=new sh(Ch(this).options.apiKey+":"+Ch(this).name),this.Y=_h(this,function(t){var e=Ch(t).options.authDomain,n=function(t){var e=function(t,e){return t.b.get(uh,t.a).then(function(t){return t&&e&&(t.authDomain=e),ah(t||{})})}(t.w,Ch(t).options.authDomain).then(function(e){return(t.B=e)&&(e.da=t.w),ch(t.w)});return _h(t,e)}(t).then(function(){return yh(t.h,e)}).then(function(e){return e?(e.da=t.w,t.B&&(t.B.ca||null)==(e.ca||null)?e:e.reload().then(function(){return dh(t.h,e).then(function(){return e})}).s(function(n){return"auth/network-request-failed"==n.code?e:mh(t.h)})):null}).then(function(e){Sh(t,e||null)});return _h(t,n)}(this)),this.i=_h(this,function(t){return t.Y.then(function(){return Eh(t)}).s(function(){}).then(function(){if(!t.l)return t.ma()}).s(function(){}).then(function(){if(!t.l){t.ga=!0;var e=t.h;e.b.addListener(ph("local"),e.a,t.ma)}})}(this)),this.ga=!1,this.ma=E(this.Nc,this),this.ub=E(this.aa,this),this.ua=E(this.bc,this),this.va=E(this.mc,this),this.Ha=E(this.nc,this),this.a=null,function(t){var e=Ch(t).options.authDomain,n=Ch(t).options.apiKey;e&&Ir()&&(t.Tb=t.Y.then(function(){if(!t.l){if(t.a=dc(e,n,Ch(t).name),oc(t.a,t),Ah(t)&&jc(Ah(t)),t.B){jc(t.B);var r=t.B;r.sa(t.ha()),Mc(r,t),Lc(r=t.B,t.I),xc(r,t),t.B=null}return t.a}}))}(this),this.INTERNAL={},this.INTERNAL.delete=E(this.delete,this),this.INTERNAL.logFramework=E(this.vc,this),this.o=0,an.call(this),function(t){Object.defineProperty(t,"lc",{get:function(){return this.ha()},set:function(t){this.sa(t)},enumerable:!1}),t.Z=null,Object.defineProperty(t,"ti",{get:function(){return this.R()},set:function(t){this.nb(t)},enumerable:!1}),t.P=null}(this),this.I=[]}function bh(t){Le.call(this,"languageCodeChanged"),this.g=t}function wh(t){Le.call(this,"frameworkChanged"),this.c=t}function Ih(t){return t.Tb||Jt(new Jr("auth-domain-config-required"))}function Eh(t){if(!Ir())return Jt(new Jr("operation-not-supported-in-this-environment"));var e=Ih(t).then(function(){return t.a.oa()}).then(function(t){return t?Br(t):null});return _h(t,e)}function Th(t,e){var n={};return n.apiKey=Ch(t).options.apiKey,n.authDomain=Ch(t).options.authDomain,n.appName=Ch(t).name,t.Y.then(function(){return function(t,e,n,r){var i=new Pc(t,e);return n&&(i.da=n),r&&Lc(i,r),i.reload().then(function(){return i})}(n,e,t.w,t.Aa())}).then(function(e){return Ah(t)&&e.uid==Ah(t).uid?(Yc(Ah(t),e),t.aa(e)):(Sh(t,e),jc(e),t.aa(e))}).then(function(){kh(t)})}function Sh(t,e){Ah(t)&&(function(t,e){K(t.O,function(t){return t==e})}(Ah(t),t.ub),Ye(Ah(t),"tokenChanged",t.ua),Ye(Ah(t),"userDeleted",t.va),Ye(Ah(t),"userInvalidated",t.Ha),Uc(Ah(t))),e&&(e.O.push(t.ub),Ge(e,"tokenChanged",t.ua),Ge(e,"userDeleted",t.va),Ge(e,"userInvalidated",t.Ha),0<t.o&&Fc(e)),Ur(t,"currentUser",e),e&&(e.sa(t.ha()),Mc(e,t),Lc(e,t.I),xc(e,t))}function Nh(t,e){var n=null,r=null;return _h(t,e.then(function(e){return n=Io(e),r=Li(e),Th(t,e)}).then(function(){return Br({user:Ah(t),credential:n,additionalUserInfo:r,operationType:"signIn"})}))}function Ch(t){return t.app}function Ah(t){return t.currentUser}function Dh(t){return Ah(t)&&Ah(t)._lat||null}function kh(t){if(t.ga){for(var e=0;e<t.m.length;e++)t.m[e]&&t.m[e](Dh(t));if(t.W!==t.getUid()&&t.J.length)for(t.W=t.getUid(),e=0;e<t.J.length;e++)t.J[e]&&t.J[e](Dh(t))}}function _h(t,e){return t.O.push(e),e.ka(function(){j(t.O,e)}),e}function Rh(){}function Oh(){this.a={},this.b=1e12}hh.prototype.mb=function(t){var e=null,n=this;return function(t){var e=new Jr("invalid-persistence-type"),n=new Jr("unsupported-persistence-type");t:{for(r in Su)if(Su[r]==t){var r=!0;break t}r=!1}if(!r||"string"!=typeof t)throw e;switch(lr()){case"ReactNative":if("session"===t)throw n;break;case"Node":if("none"!==t)throw n;break;default:if(!wr()&&"none"!==t)throw n}}(t),gh(this,function(){return t!=n.c.C?n.b.get(n.c,n.a).then(function(r){return e=r,lh(n,t)}).then(function(){if(n.c=ph(t),e)return n.b.set(n.c,e,n.a)}):Xt()})},N(vh,an),N(bh,Le),N(wh,Le),(t=vh.prototype).mb=function(t){return _h(this,t=this.h.mb(t))},t.sa=function(t){this.Z===t||this.l||(this.Z=t,Ua(this.b,this.Z),this.dispatchEvent(new bh(this.ha())))},t.ha=function(){return this.Z},t.Tc=function(){var t=a.navigator;this.sa(t&&(t.languages&&t.languages[0]||t.language||t.userLanguage)||null)},t.vc=function(t){this.I.push(t),Va(this.b,ue.SDK_VERSION?gr(ue.SDK_VERSION,this.I):null),this.dispatchEvent(new wh(this.I))},t.Aa=function(){return Q(this.I)},t.nb=function(t){this.P===t||this.l||(this.P=t,this.b.b=this.P)},t.R=function(){return this.P},t.toJSON=function(){return{apiKey:Ch(this).options.apiKey,authDomain:Ch(this).options.authDomain,appName:Ch(this).name,currentUser:Ah(this)&&Ah(this).A()}},t.xb=function(t,e){switch(t){case"unknown":case"signInViaRedirect":return!0;case"signInViaPopup":return this.g==e&&!!this.f;default:return!1}},t.ja=function(t,e,n,r){"signInViaPopup"==t&&this.g==r&&(n&&this.v?this.v(n):e&&!n&&this.f&&this.f(e),this.c&&(this.c.cancel(),this.c=null),delete this.f,delete this.v)},t.za=function(t,e){return"signInViaRedirect"==t||"signInViaPopup"==t&&this.g==e&&this.f?E(this.ac,this):null},t.ac=function(t,e,n,r){var i=this;t={requestUri:t,postBody:r,sessionId:e,tenantId:n},this.c&&(this.c.cancel(),this.c=null);var o=null,a=null,s=Ja(i.b,t).then(function(t){return o=Io(t),a=Li(t),t});return _h(this,t=i.Y.then(function(){return s}).then(function(t){return Th(i,t)}).then(function(){return Br({user:Ah(i),credential:o,additionalUserInfo:a,operationType:"signIn"})}))},t.Lc=function(t){if(!Ir())return Jt(new Jr("operation-not-supported-in-this-environment"));var e=this,n=Mi(t.providerId),r=Dr(),i=null;(!Sr()||cr())&&Ch(this).options.authDomain&&t.isOAuthProvider&&(i=$s(Ch(this).options.authDomain,Ch(this).options.apiKey,Ch(this).name,"signInViaPopup",t,null,r,ue.SDK_VERSION||null,null,null,this.R()));var o=ir(i,n&&n.Da,n&&n.Ca);return _h(this,n=Ih(this).then(function(n){return cc(n,o,"signInViaPopup",t,r,!!i,e.R())}).then(function(){return new $t(function(t,n){e.ja("signInViaPopup",null,new Jr("cancelled-popup-request"),e.g),e.f=t,e.v=n,e.g=r,e.c=fc(e.a,e,"signInViaPopup",o,r)})}).then(function(t){return o&&rr(o),t?Br(t):null}).s(function(t){throw o&&rr(o),t}))},t.Mc=function(t){if(!Ir())return Jt(new Jr("operation-not-supported-in-this-environment"));var e=this;return _h(this,Ih(this).then(function(){return gh(t=e.h,function(){return t.b.set(fh,t.c.C,t.a)});var t}).then(function(){return lc(e.a,"signInViaRedirect",t,void 0,e.R())}))},t.oa=function(){var t=this;return Eh(this).then(function(e){return t.a&&gc(t.a.b),e}).s(function(e){throw t.a&&gc(t.a.b),e})},t.Rc=function(t){if(!t)return Jt(new Jr("null-user"));if(this.P!=t.tenantId)return Jt(new Jr("tenant-id-mismatch"));var e=this,n={};n.apiKey=Ch(this).options.apiKey,n.authDomain=Ch(this).options.authDomain,n.appName=Ch(this).name;var r=function(t,e,n,r){e=e||{apiKey:t.l,authDomain:t.o,appName:t.m};var i=t.b,o={};return o[Ma]=i.b,o.refreshToken=i.a,o.expiresIn=(i.c-S())/1e3,e=new Pc(e,o),n&&(e.da=n),r&&Lc(e,r),Yc(e,t),e}(t,n,e.w,e.Aa());return _h(this,this.i.then(function(){if(Ch(e).options.apiKey!=t.l)return r.reload()}).then(function(){return Ah(e)&&t.uid==Ah(e).uid?(Yc(Ah(e),t),e.aa(t)):(Sh(e,r),jc(r),e.aa(r))}).then(function(){kh(e)}))},t.pb=function(){var t=this;return _h(this,this.i.then(function(){return t.a&&gc(t.a.b),Ah(t)?(Sh(t,null),mh(t.h).then(function(){kh(t)})):Xt()}))},t.Nc=function(){var t=this;return yh(this.h,Ch(this).options.authDomain).then(function(e){if(!t.l){var n;if(n=Ah(t)&&e){n=Ah(t).uid;var r=e.uid;n=null!=n&&""!==n&&null!=r&&""!==r&&n==r}if(n)return Yc(Ah(t),e),Ah(t).G();(Ah(t)||e)&&(Sh(t,e),e&&(jc(e),e.da=t.w),t.a&&oc(t.a,t),kh(t))}})},t.aa=function(t){return dh(this.h,t)},t.bc=function(){kh(this),this.aa(Ah(this))},t.mc=function(){this.pb()},t.nc=function(){this.pb()},t.oc=function(t){var e=this;this.addAuthTokenListener(function(){t.next(Ah(e))})},t.pc=function(t){var e=this;!function(t,e){t.J.push(e),_h(t,t.i.then(function(){!t.l&&B(t.J,e)&&t.W!==t.getUid()&&(t.W=t.getUid(),e(Dh(t)))}))}(this,function(){t.next(Ah(e))})},t.xc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){y(t)?t(Ah(r)):y(t.next)&&t.next(Ah(r))}),this.Ub(t,e,n)},t.wc=function(t,e,n){var r=this;return this.ga&&Promise.resolve().then(function(){r.W=r.getUid(),y(t)?t(Ah(r)):y(t.next)&&t.next(Ah(r))}),this.Vb(t,e,n)},t.cc=function(t){var e=this;return _h(this,this.i.then(function(){return Ah(e)?Ah(e).G(t).then(function(t){return{accessToken:t}}):null}))},t.Hc=function(t){var e=this;return this.i.then(function(){return Nh(e,ks(e.b,Ss,{token:t}))}).then(function(t){var n=t.user;return Hc(n,"isAnonymous",!1),e.aa(n),t})},t.Ic=function(t,e){var n=this;return this.i.then(function(){return Nh(n,ks(n.b,Ns,{email:t,password:e}))})},t.Xb=function(t,e){var n=this;return this.i.then(function(){return Nh(n,ks(n.b,is,{email:t,password:e}))})},t.Ra=function(t){var e=this;return this.i.then(function(){return Nh(e,t.na(e.b))})},t.Gc=function(t){return qr("firebase.auth.Auth.prototype.signInAndRetrieveDataWithCredential is deprecated. Please use firebase.auth.Auth.prototype.signInWithCredential instead."),this.Ra(t)},t.ob=function(){var t=this;return this.i.then(function(){var e=Ah(t);if(e&&e.isAnonymous){var n=Br({providerId:null,isNewUser:!1});return Br({user:e,credential:null,additionalUserInfo:n,operationType:"signIn"})}return Nh(t,t.b.ob()).then(function(e){var n=e.user;return Hc(n,"isAnonymous",!0),t.aa(n),e})})},t.getUid=function(){return Ah(this)&&Ah(this).uid||null},t.Wb=function(t){this.addAuthTokenListener(t),this.o++,0<this.o&&Ah(this)&&Fc(Ah(this))},t.Ec=function(t){var e=this;F(this.m,function(n){n==t&&e.o--}),0>this.o&&(this.o=0),0==this.o&&Ah(this)&&Uc(Ah(this)),this.removeAuthTokenListener(t)},t.addAuthTokenListener=function(t){var e=this;this.m.push(t),_h(this,this.i.then(function(){e.l||B(e.m,t)&&t(Dh(e))}))},t.removeAuthTokenListener=function(t){K(this.m,function(e){return e==t})},t.delete=function(){this.l=!0;for(var t=0;t<this.O.length;t++)this.O[t].cancel("app-deleted");return this.O=[],this.h&&(t=this.h).b.removeListener(ph("local"),t.a,this.ma),this.a&&(ac(this.a,this),gc(this.a.b)),Promise.resolve()},t.$b=function(t){return _h(this,function(t,e){return ks(t,os,{identifier:e,continueUri:Er()?tr():"http://localhost"}).then(function(t){return t.signinMethods||[]})}(this.b,t))},t.qc=function(t){return!!mo(t)},t.lb=function(t,e){var n=this;return _h(this,Xt().then(function(){var t=new li(e);if(!t.c)throw new Jr("argument-error",di+" must be true when sending sign in link to email");return Ii(t)}).then(function(e){return n.b.lb(t,e)}).then(function(){}))},t.Uc=function(t){return this.Ka(t).then(function(t){return t.data.email})},t.$a=function(t,e){return _h(this,this.b.$a(t,e).then(function(){}))},t.Ka=function(t){return _h(this,this.b.Ka(t).then(function(t){return new Kr(t)}))},t.Xa=function(t){return _h(this,this.b.Xa(t).then(function(){}))},t.kb=function(t,e){var n=this;return _h(this,Xt().then(function(){return void 0===e||G(e)?{}:Ii(new li(e))}).then(function(e){return n.b.kb(t,e)}).then(function(){}))},t.Kc=function(t,e){return _h(this,Tc(this,t,e,E(this.Ra,this)))},t.Jc=function(t,e){var n=this;return _h(this,Xt().then(function(){var r=e||tr(),i=po(t,r);if(!(r=mo(r)))throw new Jr("argument-error","Invalid email link!");if(r.tenantId!==n.R())throw new Jr("tenant-id-mismatch");return n.Ra(i)}))},Rh.prototype.render=function(){},Rh.prototype.reset=function(){},Rh.prototype.getResponse=function(){},Rh.prototype.execute=function(){};var Ph=null;function Mh(t,e){return(e=Lh(e))&&t.a[e]||null}function Lh(t){return(t=void 0===t?1e12:t)?t.toString():null}function xh(t,e){this.g=!1,this.c=e,this.a=this.b=null,this.h="invisible"!==this.c.size,this.f=Kn(t);var n=this;this.i=function(){n.execute()},this.h?this.execute():Ge(this.f,"click",this.i)}function qh(t){if(t.g)throw Error("reCAPTCHA mock was already deleted!")}function Fh(){}Oh.prototype.render=function(t,e){return this.a[this.b.toString()]=new xh(t,e),this.b++},Oh.prototype.reset=function(t){var e=Mh(this,t);t=Lh(t),e&&t&&(e.delete(),delete this.a[t])},Oh.prototype.getResponse=function(t){return(t=Mh(this,t))?t.getResponse():null},Oh.prototype.execute=function(t){(t=Mh(this,t))&&t.execute()},xh.prototype.getResponse=function(){return qh(this),this.b},xh.prototype.execute=function(){qh(this);var t=this;this.a||(this.a=setTimeout(function(){t.b=function(){for(var t=50,e=[];0<t;)e.push("1234567890abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ".charAt(Math.floor(62*Math.random()))),t--;return e.join("")}();var e=t.c.callback,n=t.c["expired-callback"];if(e)try{e(t.b)}catch(t){}t.a=setTimeout(function(){if(t.a=null,t.b=null,n)try{n()}catch(t){}t.h&&t.execute()},6e4)},500))},xh.prototype.delete=function(){qh(this),this.g=!0,clearTimeout(this.a),this.a=null,Ye(this.f,"click",this.i)},Fh.prototype.g=function(){return Ph||(Ph=new Oh),Xt(Ph)},Fh.prototype.c=function(){};var Uh=null;function Vh(){this.b=a.grecaptcha?1/0:0,this.f=null,this.a="__rcb"+Math.floor(1e6*Math.random()).toString()}var Bh=new X(tt,"https://www.google.com/recaptcha/api.js?onload=%{onload}&render=explicit&hl=%{hl}"),jh=new Rr(3e4,6e4);Vh.prototype.g=function(t){var e=this;return new $t(function(n,r){var i=setTimeout(function(){r(new Jr("network-request-failed"))},jh.get());!a.grecaptcha||t!==e.f&&!e.b?(a[e.a]=function(){if(a.grecaptcha){e.f=t;var o=a.grecaptcha.render;a.grecaptcha.render=function(t,n){return t=o(t,n),e.b++,t},clearTimeout(i),n(a.grecaptcha)}else clearTimeout(i),r(new Jr("internal-error"));delete a[e.a]},Xt(Na(it(Bh,{onload:e.a,hl:t||""}))).s(function(){clearTimeout(i),r(new Jr("internal-error","Unable to load external reCAPTCHA dependencies!"))})):(clearTimeout(i),n(a.grecaptcha))})},Vh.prototype.c=function(){this.b--};var Kh=null;function $h(t,e,n,r,i,o,s){if(Ur(this,"type","recaptcha"),this.c=this.f=null,this.B=!1,this.u=e,this.g=null,s?(Uh||(Uh=new Fh),s=Uh):(Kh||(Kh=new Vh),s=Kh),this.m=s,this.a=n||{theme:"light",type:"image"},this.h=[],this.a[Gh])throw new Jr("argument-error","sitekey should not be provided for reCAPTCHA as one is automatically provisioned for the current project.");if(this.i="invisible"===this.a[zh],!a.document)throw new Jr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment with DOM support.");if(!Kn(e)||!this.i&&Kn(e).hasChildNodes())throw new Jr("argument-error","reCAPTCHA container is either not found or already contains inner elements!");this.o=new Oa(t,o||null,i||null),this.v=r||function(){return null};var u=this;this.l=[];var c=this.a[Qh];this.a[Qh]=function(t){if(Hh(u,t),"function"==typeof c)c(t);else if("string"==typeof c){var e=br(c,a);"function"==typeof e&&e(t)}};var h=this.a[Wh];this.a[Wh]=function(){if(Hh(u,null),"function"==typeof h)h();else if("string"==typeof h){var t=br(h,a);"function"==typeof t&&t()}}}var Qh="callback",Wh="expired-callback",Gh="sitekey",zh="size";function Hh(t,e){for(var n=0;n<t.l.length;n++)try{t.l[n](e)}catch(t){}}function Yh(t,e){return t.h.push(e),e.ka(function(){j(t.h,e)}),e}function Xh(t){if(t.B)throw new Jr("internal-error","RecaptchaVerifier instance has been destroyed.")}function Jh(t,e,n){var r=!1;try{this.b=n||ue.app()}catch(t){throw new Jr("argument-error","No firebase.app.App instance is currently initialized.")}if(!this.b.options||!this.b.options.apiKey)throw new Jr("invalid-api-key");n=this.b.options.apiKey;var i=this,o=null;try{o=this.b.auth().Aa()}catch(t){}try{r=this.b.auth().settings.appVerificationDisabledForTesting}catch(t){}o=ue.SDK_VERSION?gr(ue.SDK_VERSION,o):null,$h.call(this,n,t,e,function(){try{var t=i.b.auth().ha()}catch(e){t=null}return t},o,_i(Di),r)}function Zh(t,e,n,r){t:{n=Array.prototype.slice.call(n);for(var i=0,o=!1,a=0;a<e.length;a++)if(e[a].optional)o=!0;else{if(o)throw new Jr("internal-error","Argument validator encountered a required argument after an optional argument.");i++}if(o=e.length,n.length<i||o<n.length)r="Expected "+(i==o?1==i?"1 argument":i+" arguments":i+"-"+o+" arguments")+" but got "+n.length+".";else{for(i=0;i<n.length;i++)if(o=e[i].optional&&void 0===n[i],!e[i].N(n[i])&&!o){if(e=e[i],0>i||i>=tl.length)throw new Jr("internal-error","Argument validator received an unsupported number of arguments.");n=tl[i],r=(r?"":n+" argument ")+(e.name?'"'+e.name+'" ':"")+"must be "+e.M+".";break t}r=null}}if(r)throw new Jr("argument-error",t+" failed: "+r)}(t=$h.prototype).Ba=function(){var t=this;return this.f?this.f:this.f=Yh(this,Xt().then(function(){if(Er()&&!hr())return sr();throw new Jr("operation-not-supported-in-this-environment","RecaptchaVerifier is only supported in a browser HTTP/HTTPS environment.")}).then(function(){return t.m.g(t.v())}).then(function(e){return t.g=e,ks(t.o,ms,{})}).then(function(e){t.a[Gh]=e.recaptchaSiteKey}).s(function(e){throw t.f=null,e}))},t.render=function(){Xh(this);var t=this;return Yh(this,this.Ba().then(function(){if(null===t.c){var e=t.u;if(!t.i){var n=Kn(e);e=Wn("DIV"),n.appendChild(e)}t.c=t.g.render(e,t.a)}return t.c}))},t.verify=function(){Xh(this);var t=this;return Yh(this,this.render().then(function(e){return new $t(function(n){var r=t.g.getResponse(e);if(r)n(r);else{var i=function(e){e&&(function(t,e){K(t.l,function(t){return t==e})}(t,i),n(e))};t.l.push(i),t.i&&t.g.execute(t.c)}})}))},t.reset=function(){Xh(this),null!==this.c&&this.g.reset(this.c)},t.clear=function(){Xh(this),this.B=!0,this.m.c();for(var t=0;t<this.h.length;t++)this.h[t].cancel("RecaptchaVerifier instance has been destroyed.");if(!this.i){t=Kn(this.u);for(var e;e=t.firstChild;)t.removeChild(e)}},N(Jh,$h);var tl="First Second Third Fourth Fifth Sixth Seventh Eighth Ninth".split(" ");function el(t,e){return{name:t||"",M:"a valid string",optional:!!e,N:s}}function nl(t,e){return{name:t||"",M:"a boolean",optional:!!e,N:u}}function rl(t,e){return{name:t||"",M:"a valid object",optional:!!e,N:g}}function il(t,e){return{name:t||"",M:"a function",optional:!!e,N:y}}function ol(t,e){return{name:t||"",M:"null",optional:!!e,N:p}}function al(t){return{name:t?t+"Credential":"credential",M:t?"a valid "+t+" credential":"a valid credential",optional:!1,N:function(e){if(!e)return!1;var n=!t||e.providerId===t;return!(!e.na||!n)}}}function sl(){return{name:"applicationVerifier",M:"an implementation of firebase.auth.ApplicationVerifier",optional:!1,N:function(t){return!!(t&&s(t.type)&&y(t.verify))}}}function ul(t,e,n,r){return{name:n||"",M:t.M+" or "+e.M,optional:!!r,N:function(n){return t.N(n)||e.N(n)}}}function cl(t,e){for(var n in e){var r=e[n].name;t[r]=fl(r,t[n],e[n].j)}}function hl(t,e){for(var n in e){var r=e[n].name;r!==n&&Object.defineProperty(t,r,{get:T(function(t){return this[t]},n),set:T(function(t,e,n,r){Zh(t,[n],[r],!0),this[e]=r},r,n,e[n].Ya),enumerable:!0})}}function ll(t,e,n,r){t[e]=fl(e,n,r)}function fl(t,e,n){function r(){var t=Array.prototype.slice.call(arguments);return Zh(o,n,t),e.apply(this,t)}if(!n)return e;var i,o=function(t){return(t=t.split("."))[t.length-1]}(t);for(i in e)r[i]=e[i];for(i in e.prototype)r.prototype[i]=e.prototype[i];return r}cl(vh.prototype,{Xa:{name:"applyActionCode",j:[el("code")]},Ka:{name:"checkActionCode",j:[el("code")]},$a:{name:"confirmPasswordReset",j:[el("code"),el("newPassword")]},Xb:{name:"createUserWithEmailAndPassword",j:[el("email"),el("password")]},$b:{name:"fetchSignInMethodsForEmail",j:[el("email")]},oa:{name:"getRedirectResult",j:[]},qc:{name:"isSignInWithEmailLink",j:[el("emailLink")]},wc:{name:"onAuthStateChanged",j:[ul(rl(),il(),"nextOrObserver"),il("opt_error",!0),il("opt_completed",!0)]},xc:{name:"onIdTokenChanged",j:[ul(rl(),il(),"nextOrObserver"),il("opt_error",!0),il("opt_completed",!0)]},kb:{name:"sendPasswordResetEmail",j:[el("email"),ul(rl("opt_actionCodeSettings",!0),ol(null,!0),"opt_actionCodeSettings",!0)]},lb:{name:"sendSignInLinkToEmail",j:[el("email"),rl("actionCodeSettings")]},mb:{name:"setPersistence",j:[el("persistence")]},Gc:{name:"signInAndRetrieveDataWithCredential",j:[al()]},ob:{name:"signInAnonymously",j:[]},Ra:{name:"signInWithCredential",j:[al()]},Hc:{name:"signInWithCustomToken",j:[el("token")]},Ic:{name:"signInWithEmailAndPassword",j:[el("email"),el("password")]},Jc:{name:"signInWithEmailLink",j:[el("email"),el("emailLink",!0)]},Kc:{name:"signInWithPhoneNumber",j:[el("phoneNumber"),sl()]},Lc:{name:"signInWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Mc:{name:"signInWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Rc:{name:"updateCurrentUser",j:[ul({name:"user",M:"an instance of Firebase User",optional:!1,N:function(t){return!!(t&&t instanceof Pc)}},ol(),"user")]},pb:{name:"signOut",j:[]},toJSON:{name:"toJSON",j:[el(null,!0)]},Tc:{name:"useDeviceLanguage",j:[]},Uc:{name:"verifyPasswordResetCode",j:[el("code")]}}),hl(vh.prototype,{lc:{name:"languageCode",Ya:ul(el(),ol(),"languageCode")},ti:{name:"tenantId",Ya:ul(el(),ol(),"tenantId")}}),vh.Persistence=Su,vh.Persistence.LOCAL="local",vh.Persistence.SESSION="session",vh.Persistence.NONE="none",cl(Pc.prototype,{delete:{name:"delete",j:[]},dc:{name:"getIdTokenResult",j:[nl("opt_forceRefresh",!0)]},G:{name:"getIdToken",j:[nl("opt_forceRefresh",!0)]},rc:{name:"linkAndRetrieveDataWithCredential",j:[al()]},eb:{name:"linkWithCredential",j:[al()]},sc:{name:"linkWithPhoneNumber",j:[el("phoneNumber"),sl()]},tc:{name:"linkWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},uc:{name:"linkWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Ac:{name:"reauthenticateAndRetrieveDataWithCredential",j:[al()]},gb:{name:"reauthenticateWithCredential",j:[al()]},Bc:{name:"reauthenticateWithPhoneNumber",j:[el("phoneNumber"),sl()]},Cc:{name:"reauthenticateWithPopup",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},Dc:{name:"reauthenticateWithRedirect",j:[{name:"authProvider",M:"a valid Auth provider",optional:!1,N:function(t){return!!(t&&t.providerId&&t.hasOwnProperty&&t.hasOwnProperty("isOAuthProvider"))}}]},reload:{name:"reload",j:[]},jb:{name:"sendEmailVerification",j:[ul(rl("opt_actionCodeSettings",!0),ol(null,!0),"opt_actionCodeSettings",!0)]},toJSON:{name:"toJSON",j:[el(null,!0)]},Qc:{name:"unlink",j:[el("provider")]},rb:{name:"updateEmail",j:[el("email")]},sb:{name:"updatePassword",j:[el("password")]},Sc:{name:"updatePhoneNumber",j:[al("phone")]},tb:{name:"updateProfile",j:[rl("profile")]}}),cl(Oh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),cl(Rh.prototype,{execute:{name:"execute"},render:{name:"render"},reset:{name:"reset"},getResponse:{name:"getResponse"}}),cl($t.prototype,{ka:{name:"finally"},s:{name:"catch"},then:{name:"then"}}),hl(Ic.prototype,{appVerificationDisabled:{name:"appVerificationDisabledForTesting",Ya:nl("appVerificationDisabledForTesting")}}),cl(Ec.prototype,{confirm:{name:"confirm",j:[el("verificationCode")]}}),ll(Qi,"fromJSON",function(t){t=s(t)?JSON.parse(t):t;for(var e,n=[Ji,lo,go,Hi],r=0;r<n.length;r++)if(e=n[r](t))return e;return null},[ul(el(),rl(),"json")]),ll(fo,"credential",function(t,e){return new ho(t,e)},[el("email"),el("password")]),cl(ho.prototype,{A:{name:"toJSON",j:[el(null,!0)]}}),cl(no.prototype,{wa:{name:"addScope",j:[el("scope")]},Ea:{name:"setCustomParameters",j:[rl("customOAuthParameters")]}}),ll(no,"credential",ro,[ul(el(),rl(),"token")]),ll(fo,"credentialWithLink",po,[el("email"),el("emailLink")]),cl(io.prototype,{wa:{name:"addScope",j:[el("scope")]},Ea:{name:"setCustomParameters",j:[rl("customOAuthParameters")]}}),ll(io,"credential",oo,[ul(el(),rl(),"token")]),cl(ao.prototype,{wa:{name:"addScope",j:[el("scope")]},Ea:{name:"setCustomParameters",j:[rl("customOAuthParameters")]}}),ll(ao,"credential",so,[ul(el(),ul(rl(),ol()),"idToken"),ul(el(),ol(),"accessToken",!0)]),cl(uo.prototype,{Ea:{name:"setCustomParameters",j:[rl("customOAuthParameters")]}}),ll(uo,"credential",co,[ul(el(),rl(),"token"),el("secret",!0)]),cl(eo.prototype,{wa:{name:"addScope",j:[el("scope")]},credential:{name:"credential",j:[ul(el(),ul(rl(),ol()),"optionsOrIdToken"),ul(el(),ol(),"accessToken",!0)]},Ea:{name:"setCustomParameters",j:[rl("customOAuthParameters")]}}),cl(Yi.prototype,{A:{name:"toJSON",j:[el(null,!0)]}}),cl(Gi.prototype,{A:{name:"toJSON",j:[el(null,!0)]}}),ll(bo,"credential",wo,[el("verificationId"),el("verificationCode")]),cl(bo.prototype,{Va:{name:"verifyPhoneNumber",j:[el("phoneNumber"),sl()]}}),cl(yo.prototype,{A:{name:"toJSON",j:[el(null,!0)]}}),cl(Jr.prototype,{toJSON:{name:"toJSON",j:[el(null,!0)]}}),cl(ko.prototype,{toJSON:{name:"toJSON",j:[el(null,!0)]}}),cl(Do.prototype,{toJSON:{name:"toJSON",j:[el(null,!0)]}}),cl(Jh.prototype,{clear:{name:"clear",j:[]},render:{name:"render",j:[]},verify:{name:"verify",j:[]}}),ll(ni,"parseLink",hi,[el("link")]),function(){if(void 0===ue||!ue.INTERNAL||!ue.INTERNAL.registerService)throw Error("Cannot find the firebase namespace; be sure to include firebase-app.js before this library.");var t={ActionCodeInfo:{Operation:{EMAIL_SIGNIN:$r,PASSWORD_RESET:"PASSWORD_RESET",RECOVER_EMAIL:"RECOVER_EMAIL",VERIFY_EMAIL:"VERIFY_EMAIL"}},Auth:vh,AuthCredential:Qi,Error:Jr};ll(t,"EmailAuthProvider",fo,[]),ll(t,"FacebookAuthProvider",no,[]),ll(t,"GithubAuthProvider",io,[]),ll(t,"GoogleAuthProvider",ao,[]),ll(t,"TwitterAuthProvider",uo,[]),ll(t,"OAuthProvider",eo,[el("providerId")]),ll(t,"SAMLAuthProvider",to,[el("providerId")]),ll(t,"PhoneAuthProvider",bo,[{name:"auth",M:"an instance of Firebase Auth",optional:!0,N:function(t){return!!(t&&t instanceof vh)}}]),ll(t,"RecaptchaVerifier",Jh,[ul(el(),{name:"",M:"an HTML element",optional:!1,N:function(t){return!!(t&&t instanceof Element)}},"recaptchaContainer"),rl("recaptchaParameters",!0),{name:"app",M:"an instance of Firebase App",optional:!0,N:function(t){return!!(t&&t instanceof ue.app.App)}}]),ll(t,"ActionCodeURL",ni,[]),ue.INTERNAL.registerService("auth",function(t,e){return e({INTERNAL:{getUid:E((t=new vh(t)).getUid,t),getToken:E(t.cc,t),addAuthTokenListener:E(t.Wb,t),removeAuthTokenListener:E(t.Ec,t)}}),t},t,function(t,e){if("create"===t)try{e.auth()}catch(t){}}),ue.INTERNAL.extendNamespace({User:Pc})}()}).apply("undefined"!=typeof global?global:"undefined"!=typeof self?self:"undefined"!=typeof window?window:{});var ce,he="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},le=le||{},fe=he;function pe(t){return"string"==typeof t}function de(t){return"number"==typeof t}function me(t,e){t=t.split("."),e=e||fe;for(var n=0;n<t.length;n++)if(null==(e=e[t[n]]))return null;return e}function ye(){}function ge(t){var e=typeof t;if("object"==e){if(!t)return"null";if(t instanceof Array)return"array";if(t instanceof Object)return e;var n=Object.prototype.toString.call(t);if("[object Window]"==n)return"object";if("[object Array]"==n||"number"==typeof t.length&&void 0!==t.splice&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("splice"))return"array";if("[object Function]"==n||void 0!==t.call&&void 0!==t.propertyIsEnumerable&&!t.propertyIsEnumerable("call"))return"function"}else if("function"==e&&void 0===t.call)return"object";return e}function ve(t){return"array"==ge(t)}function be(t){var e=ge(t);return"array"==e||"object"==e&&"number"==typeof t.length}function we(t){var e=typeof t;return"object"==e&&null!=t||"function"==e}var Ie="closure_uid_"+(1e9*Math.random()>>>0),Ee=0;function Te(t,e,n){return t.call.apply(t.bind,arguments)}function Se(t,e,n){if(!t)throw Error();if(2<arguments.length){var r=Array.prototype.slice.call(arguments,2);return function(){var n=Array.prototype.slice.call(arguments);return Array.prototype.unshift.apply(n,r),t.apply(e,n)}}return function(){return t.apply(e,arguments)}}function Ne(t,e,n){return(Ne=Function.prototype.bind&&-1!=Function.prototype.bind.toString().indexOf("native code")?Te:Se).apply(null,arguments)}function Ce(t,e){var n=Array.prototype.slice.call(arguments,1);return function(){var e=n.slice();return e.push.apply(e,arguments),t.apply(this,e)}}var Ae=Date.now||function(){return+new Date};function De(t,e){function n(){}n.prototype=e.prototype,t.N=e.prototype,t.prototype=new n,t.prototype.constructor=t,t.yb=function(t,n,r){for(var i=Array(arguments.length-2),o=2;o<arguments.length;o++)i[o-2]=arguments[o];return e.prototype[n].apply(t,i)}}function ke(){this.j=this.j,this.i=this.i}ke.prototype.j=!1,ke.prototype.la=function(){if(!this.j&&(this.j=!0,this.G(),0))this[Ie]||(this[Ie]=++Ee)},ke.prototype.G=function(){if(this.i)for(;this.i.length;)this.i.shift()()};var _e=Array.prototype.indexOf?function(t,e){return Array.prototype.indexOf.call(t,e,void 0)}:function(t,e){if(pe(t))return pe(e)&&1==e.length?t.indexOf(e,0):-1;for(var n=0;n<t.length;n++)if(n in t&&t[n]===e)return n;return-1},Re=Array.prototype.forEach?function(t,e,n){Array.prototype.forEach.call(t,e,n)}:function(t,e,n){for(var r=t.length,i=pe(t)?t.split(""):t,o=0;o<r;o++)o in i&&e.call(n,i[o],o,t)};function Oe(t){return Array.prototype.concat.apply([],arguments)}function Pe(t){var e=t.length;if(0<e){for(var n=Array(e),r=0;r<e;r++)n[r]=t[r];return n}return[]}function Me(t){return/^[\s\xa0]*$/.test(t)}var Le,xe=String.prototype.trim?function(t){return t.trim()}:function(t){return/^[\s\xa0]*([\s\S]*?)[\s\xa0]*$/.exec(t)[1]};function qe(t,e){return-1!=t.indexOf(e)}function Fe(t,e){return t<e?-1:t>e?1:0}t:{var Ue=fe.navigator;if(Ue){var Ve=Ue.userAgent;if(Ve){Le=Ve;break t}}Le=""}function Be(t,e,n){for(var r in t)e.call(n,t[r],r,t)}function je(t){var e,n={};for(e in t)n[e]=t[e];return n}var Ke="constructor hasOwnProperty isPrototypeOf propertyIsEnumerable toLocaleString toString valueOf".split(" ");function $e(t,e){for(var n,r,i=1;i<arguments.length;i++){for(n in r=arguments[i])t[n]=r[n];for(var o=0;o<Ke.length;o++)n=Ke[o],Object.prototype.hasOwnProperty.call(r,n)&&(t[n]=r[n])}}function Qe(t){return Qe[" "](t),t}Qe[" "]=ye;var We,Ge,ze=qe(Le,"Opera"),He=qe(Le,"Trident")||qe(Le,"MSIE"),Ye=qe(Le,"Edge"),Xe=Ye||He,Je=qe(Le,"Gecko")&&!(qe(Le.toLowerCase(),"webkit")&&!qe(Le,"Edge"))&&!(qe(Le,"Trident")||qe(Le,"MSIE"))&&!qe(Le,"Edge"),Ze=qe(Le.toLowerCase(),"webkit")&&!qe(Le,"Edge");function tn(){var t=fe.document;return t?t.documentMode:void 0}t:{var en="",nn=(Ge=Le,Je?/rv:([^\);]+)(\)|;)/.exec(Ge):Ye?/Edge\/([\d\.]+)/.exec(Ge):He?/\b(?:MSIE|rv)[: ]([^\);]+)(\)|;)/.exec(Ge):Ze?/WebKit\/(\S+)/.exec(Ge):ze?/(?:Version)[ \/]?(\S+)/.exec(Ge):void 0);if(nn&&(en=nn?nn[1]:""),He){var rn=tn();if(null!=rn&&rn>parseFloat(en)){We=String(rn);break t}}We=en}var on,an={};function sn(t){return function(t,e){var n=an;return Object.prototype.hasOwnProperty.call(n,t)?n[t]:n[t]=e(t)}(t,function(){for(var e=0,n=xe(String(We)).split("."),r=xe(String(t)).split("."),i=Math.max(n.length,r.length),o=0;0==e&&o<i;o++){var a=n[o]||"",s=r[o]||"";do{if(a=/(\d*)(\D*)(.*)/.exec(a)||["","","",""],s=/(\d*)(\D*)(.*)/.exec(s)||["","","",""],0==a[0].length&&0==s[0].length)break;e=Fe(0==a[1].length?0:parseInt(a[1],10),0==s[1].length?0:parseInt(s[1],10))||Fe(0==a[2].length,0==s[2].length)||Fe(a[2],s[2]),a=a[3],s=s[3]}while(0==e)}return 0<=e})}var un=fe.document;on=un&&He?tn()||("CSS1Compat"==un.compatMode?parseInt(We,10):5):void 0;var cn=!He||9<=Number(on),hn=He&&!sn("9"),ln=function(){if(!fe.addEventListener||!Object.defineProperty)return!1;var t=!1,e=Object.defineProperty({},"passive",{get:function(){t=!0}});try{fe.addEventListener("test",ye,e),fe.removeEventListener("test",ye,e)}catch(t){}return t}();function fn(t,e){this.type=t,this.a=this.target=e,this.Ja=!0}function pn(t,e){if(fn.call(this,t?t.type:""),this.relatedTarget=this.a=this.target=null,this.button=this.screenY=this.screenX=this.clientY=this.clientX=0,this.key="",this.metaKey=this.shiftKey=this.altKey=this.ctrlKey=!1,this.pointerId=0,this.pointerType="",this.c=null,t){var n=this.type=t.type,r=t.changedTouches&&t.changedTouches.length?t.changedTouches[0]:null;if(this.target=t.target||t.srcElement,this.a=e,e=t.relatedTarget){if(Je){t:{try{Qe(e.nodeName);var i=!0;break t}catch(t){}i=!1}i||(e=null)}}else"mouseover"==n?e=t.fromElement:"mouseout"==n&&(e=t.toElement);this.relatedTarget=e,r?(this.clientX=void 0!==r.clientX?r.clientX:r.pageX,this.clientY=void 0!==r.clientY?r.clientY:r.pageY,this.screenX=r.screenX||0,this.screenY=r.screenY||0):(this.clientX=void 0!==t.clientX?t.clientX:t.pageX,this.clientY=void 0!==t.clientY?t.clientY:t.pageY,this.screenX=t.screenX||0,this.screenY=t.screenY||0),this.button=t.button,this.key=t.key||"",this.ctrlKey=t.ctrlKey,this.altKey=t.altKey,this.shiftKey=t.shiftKey,this.metaKey=t.metaKey,this.pointerId=t.pointerId||0,this.pointerType=pe(t.pointerType)?t.pointerType:dn[t.pointerType]||"",this.c=t,t.defaultPrevented&&this.b()}}fn.prototype.b=function(){this.Ja=!1},De(pn,fn);var dn={2:"touch",3:"pen",4:"mouse"};pn.prototype.b=function(){pn.N.b.call(this);var t=this.c;if(t.preventDefault)t.preventDefault();else if(t.returnValue=!1,hn)try{(t.ctrlKey||112<=t.keyCode&&123>=t.keyCode)&&(t.keyCode=-1)}catch(t){}};var mn="closure_listenable_"+(1e6*Math.random()|0),yn=0;function gn(t,e,n,r,i){this.listener=t,this.proxy=null,this.src=e,this.type=n,this.capture=!!r,this.da=i,this.key=++yn,this.X=this.Z=!1}function vn(t){t.X=!0,t.listener=null,t.proxy=null,t.src=null,t.da=null}function bn(t){this.src=t,this.a={},this.b=0}function wn(t,e){var n=e.type;if(n in t.a){var r,i=t.a[n],o=_e(i,e);(r=0<=o)&&Array.prototype.splice.call(i,o,1),r&&(vn(e),0==t.a[n].length&&(delete t.a[n],t.b--))}}function In(t,e,n,r){for(var i=0;i<t.length;++i){var o=t[i];if(!o.X&&o.listener==e&&o.capture==!!n&&o.da==r)return i}return-1}bn.prototype.add=function(t,e,n,r,i){var o=t.toString();(t=this.a[o])||(t=this.a[o]=[],this.b++);var a=In(t,e,r,i);return-1<a?(e=t[a],n||(e.Z=!1)):((e=new gn(e,this.src,o,!!r,i)).Z=n,t.push(e)),e};var En="closure_lm_"+(1e6*Math.random()|0),Tn={};function Sn(t,e,n,r,i){if(r&&r.once)return function t(e,n,r,i,o){if(ve(n)){for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);return null}r=On(r);return e&&e[mn]?e.Ba(n,r,we(i)?!!i.capture:!!i,o):Nn(e,n,r,!0,i,o)}(t,e,n,r,i);if(ve(e)){for(var o=0;o<e.length;o++)Sn(t,e[o],n,r,i);return null}return n=On(n),t&&t[mn]?t.Aa(e,n,we(r)?!!r.capture:!!r,i):Nn(t,e,n,!1,r,i)}function Nn(t,e,n,r,i,o){if(!e)throw Error("Invalid event type");var a=we(i)?!!i.capture:!!i;if(a&&!cn)return null;var s=_n(t);if(s||(t[En]=s=new bn(t)),(n=s.add(e,n,r,a,o)).proxy)return n;if(r=function(){var t=kn,e=cn?function(n){return t.call(e.src,e.listener,n)}:function(n){if(!(n=t.call(e.src,e.listener,n)))return n};return e}(),n.proxy=r,r.src=t,r.listener=n,t.addEventListener)ln||(i=a),void 0===i&&(i=!1),t.addEventListener(e.toString(),r,i);else if(t.attachEvent)t.attachEvent(An(e.toString()),r);else{if(!t.addListener||!t.removeListener)throw Error("addEventListener and attachEvent are unavailable.");t.addListener(r)}return n}function Cn(t){if(!de(t)&&t&&!t.X){var e=t.src;if(e&&e[mn])wn(e.c,t);else{var n=t.type,r=t.proxy;e.removeEventListener?e.removeEventListener(n,r,t.capture):e.detachEvent?e.detachEvent(An(n),r):e.addListener&&e.removeListener&&e.removeListener(r),(n=_n(e))?(wn(n,t),0==n.b&&(n.src=null,e[En]=null)):vn(t)}}}function An(t){return t in Tn?Tn[t]:Tn[t]="on"+t}function Dn(t,e){var n=t.listener,r=t.da||t.src;return t.Z&&Cn(t),n.call(r,e)}function kn(t,e){return!!t.X||(cn?Dn(t,new pn(e,this)):Dn(t,e=new pn(e||me("window.event"),this)))}function _n(t){return(t=t[En])instanceof bn?t:null}var Rn="__closure_events_fn_"+(1e9*Math.random()>>>0);function On(t){return"function"==ge(t)?t:(t[Rn]||(t[Rn]=function(e){return t.handleEvent(e)}),t[Rn])}function Pn(){ke.call(this),this.c=new bn(this),this.J=this,this.B=null}function Mn(t,e,n,r){if(!(e=t.c.a[String(e)]))return!0;e=e.concat();for(var i=!0,o=0;o<e.length;++o){var a=e[o];if(a&&!a.X&&a.capture==n){var s=a.listener,u=a.da||a.src;a.Z&&wn(t.c,a),i=!1!==s.call(u,r)&&i}}return i&&0!=r.Ja}De(Pn,ke),Pn.prototype[mn]=!0,(ce=Pn.prototype).addEventListener=function(t,e,n,r){Sn(this,t,e,n,r)},ce.removeEventListener=function(t,e,n,r){!function t(e,n,r,i,o){if(ve(n))for(var a=0;a<n.length;a++)t(e,n[a],r,i,o);else i=we(i)?!!i.capture:!!i,r=On(r),e&&e[mn]?(e=e.c,(n=String(n).toString())in e.a&&-1<(r=In(a=e.a[n],r,i,o))&&(vn(a[r]),Array.prototype.splice.call(a,r,1),0==a.length&&(delete e.a[n],e.b--))):e&&(e=_n(e))&&(n=e.a[n.toString()],e=-1,n&&(e=In(n,r,i,o)),(r=-1<e?n[e]:null)&&Cn(r))}(this,t,e,n,r)},ce.dispatchEvent=function(t){var e,n=this.B;if(n)for(e=[];n;n=n.B)e.push(n);n=this.J;var r=t.type||t;if(pe(t))t=new fn(t,n);else if(t instanceof fn)t.target=t.target||n;else{var i=t;$e(t=new fn(r,n),i)}if(i=!0,e)for(var o=e.length-1;0<=o;o--){var a=t.a=e[o];i=Mn(a,r,!0,t)&&i}if(i=Mn(a=t.a=n,r,!0,t)&&i,i=Mn(a,r,!1,t)&&i,e)for(o=0;o<e.length;o++)i=Mn(a=t.a=e[o],r,!1,t)&&i;return i},ce.G=function(){if(Pn.N.G.call(this),this.c){var t,e=this.c;for(t in e.a){for(var n=e.a[t],r=0;r<n.length;r++)vn(n[r]);delete e.a[t],e.b--}}this.B=null},ce.Aa=function(t,e,n,r){return this.c.add(String(t),e,!1,n,r)},ce.Ba=function(t,e,n,r){return this.c.add(String(t),e,!0,n,r)};var Ln=fe.JSON.stringify;function xn(t,e){this.c=t,this.f=e,this.b=0,this.a=null}function qn(){this.b=this.a=null}xn.prototype.get=function(){if(0<this.b){this.b--;var t=this.a;this.a=t.next,t.next=null}else t=this.c();return t};var Fn,Un=new xn(function(){return new Bn},function(t){t.reset()});function Vn(){var t=Qn,e=null;return t.a&&(e=t.a,t.a=t.a.next,t.a||(t.b=null),e.next=null),e}function Bn(){this.next=this.b=this.a=null}function jn(t){fe.setTimeout(function(){throw t},0)}function Kn(t,e){Fn||function(){var t=fe.Promise.resolve(void 0);Fn=function(){t.then(Wn)}}(),$n||(Fn(),$n=!0),Qn.add(t,e)}qn.prototype.add=function(t,e){var n=Un.get();n.set(t,e),this.b?this.b.next=n:this.a=n,this.b=n},Bn.prototype.set=function(t,e){this.a=t,this.b=e,this.next=null},Bn.prototype.reset=function(){this.next=this.b=this.a=null};var $n=!1,Qn=new qn;function Wn(){for(var t;t=Vn();){try{t.a.call(t.b)}catch(t){jn(t)}var e=Un;e.f(t),100>e.b&&(e.b++,t.next=e.a,e.a=t)}$n=!1}function Gn(t,e){Pn.call(this),this.b=t||1,this.a=e||fe,this.f=Ne(this.gb,this),this.g=Ae()}function zn(t){t.ba=!1,t.L&&(t.a.clearTimeout(t.L),t.L=null)}function Hn(t,e,n){if("function"==ge(t))n&&(t=Ne(t,n));else{if(!t||"function"!=typeof t.handleEvent)throw Error("Invalid listener argument");t=Ne(t.handleEvent,t)}return 2147483647<Number(e)?-1:fe.setTimeout(t,e||0)}function Yn(t,e,n){ke.call(this),this.f=null!=n?Ne(t,n):t,this.c=e,this.b=Ne(this.ab,this),this.a=[]}function Xn(t){t.U=Hn(t.b,t.c),t.f.apply(null,t.a)}function Jn(t){ke.call(this),this.b=t,this.a={}}De(Gn,Pn),(ce=Gn.prototype).ba=!1,ce.L=null,ce.gb=function(){if(this.ba){var t=Ae()-this.g;0<t&&t<.8*this.b?this.L=this.a.setTimeout(this.f,this.b-t):(this.L&&(this.a.clearTimeout(this.L),this.L=null),this.dispatchEvent("tick"),this.ba&&(zn(this),this.start()))}},ce.start=function(){this.ba=!0,this.L||(this.L=this.a.setTimeout(this.f,this.b),this.g=Ae())},ce.G=function(){Gn.N.G.call(this),zn(this),delete this.a},De(Yn,ke),(ce=Yn.prototype).ea=!1,ce.U=null,ce.Ua=function(t){this.a=arguments,this.U?this.ea=!0:Xn(this)},ce.G=function(){Yn.N.G.call(this),this.U&&(fe.clearTimeout(this.U),this.U=null,this.ea=!1,this.a=[])},ce.ab=function(){this.U=null,this.ea&&(this.ea=!1,Xn(this))},De(Jn,ke);var Zn=[];function tr(t,e,n,r){ve(n)||(n&&(Zn[0]=n.toString()),n=Zn);for(var i=0;i<n.length;i++){var o=Sn(e,n[i],r||t.handleEvent,!1,t.b||t);if(!o)break;t.a[o.key]=o}}function er(t){Be(t.a,function(t,e){this.a.hasOwnProperty(e)&&Cn(t)},t),t.a={}}function nr(){}Jn.prototype.G=function(){Jn.N.G.call(this),er(this)},Jn.prototype.handleEvent=function(){throw Error("EventHandler.handleEvent not implemented")};var rr=new Pn;function ir(t){fn.call(this,"serverreachability",t)}function or(t){rr.dispatchEvent(new ir(rr,t))}function ar(t){fn.call(this,"statevent",t)}function sr(t){rr.dispatchEvent(new ar(rr,t))}function ur(t){fn.call(this,"timingevent",t)}function cr(t,e){if("function"!=ge(t))throw Error("Fn must not be null and must be a function");return fe.setTimeout(function(){t()},e)}De(ir,fn),De(ar,fn),De(ur,fn);var hr={NO_ERROR:0,hb:1,ob:2,nb:3,kb:4,mb:5,pb:6,Ma:7,TIMEOUT:8,sb:9},lr={jb:"complete",wb:"success",Na:"error",Ma:"abort",ub:"ready",vb:"readystatechange",TIMEOUT:"timeout",qb:"incrementaldata",tb:"progress",lb:"downloadprogress",xb:"uploadprogress"};function fr(){}function pr(t){var e;return(e=t.a)||(e=t.a={}),e}function dr(){}fr.prototype.a=null;var mr,yr={OPEN:"a",ib:"b",Na:"c",rb:"d"};function gr(){fn.call(this,"d")}function vr(){fn.call(this,"c")}function br(){}function wr(t,e,n){this.g=t,this.W=e,this.V=n||1,this.I=new Jn(this),this.O=Ir,t=Xe?125:void 0,this.P=new Gn(t),this.h=null,this.b=!1,this.l=this.D=this.f=this.F=this.v=this.R=this.i=null,this.j=[],this.a=null,this.A=0,this.c=this.w=null,this.o=-1,this.m=!1,this.J=0,this.B=null,this.s=this.S=this.H=!1}De(gr,fn),De(vr,fn),De(br,fr),mr=new br;var Ir=45e3,Er={},Tr={};function Sr(t,e,n){t.F=1,t.f=Hr(jr(e)),t.l=n,t.H=!0,Cr(t,null)}function Nr(t,e,n,r){t.F=1,t.f=Hr(jr(e)),t.l=null,t.H=n,Cr(t,r)}function Cr(t,e){t.v=Ae(),kr(t),t.D=jr(t.f),zr(t.D,"t",t.V),t.A=0,t.a=t.g.$(t.g.Y()?e:null),0<t.J&&(t.B=new Yn(Ne(t.Ka,t,t.a),t.J)),tr(t.I,t.a,"readystatechange",t.eb),e=t.h?je(t.h):{},t.l?(t.w||(t.w="POST"),e["Content-Type"]="application/x-www-form-urlencoded",t.a.ca(t.D,t.w,t.l,e)):(t.w="GET",t.a.ca(t.D,t.w,null,e)),or(1)}function Ar(t,e,n){for(var r=!0;!t.m&&t.A<n.length;){var i=Dr(t,n);if(i==Tr){4==e&&(t.c=4,sr(14),r=!1);break}if(i==Er){t.c=4,sr(15),r=!1;break}Mr(t,i)}4==e&&0==n.length&&(t.c=1,sr(16),r=!1),t.b=t.b&&r,r||(Pr(t),Or(t))}function Dr(t,e){var n=t.A,r=e.indexOf("\n",n);return-1==r?Tr:(n=Number(e.substring(n,r)),isNaN(n)?Er:(r+=1)+n>e.length?Tr:(e=e.substr(r,n),t.A=r+n,e))}function kr(t){t.R=Ae()+t.O,_r(t,t.O)}function _r(t,e){if(null!=t.i)throw Error("WatchDog timer not null");t.i=cr(Ne(t.bb,t),e)}function Rr(t){t.i&&(fe.clearTimeout(t.i),t.i=null)}function Or(t){t.g.Da()||t.m||t.g.na(t)}function Pr(t){Rr(t);var e=t.B;e&&"function"==typeof e.la&&e.la(),t.B=null,zn(t.P),er(t.I),t.a&&(e=t.a,t.a=null,e.abort(),e.la())}function Mr(t,e){try{t.g.Ga(t,e),or(4)}catch(t){}}function Lr(t,e){if(t.forEach&&"function"==typeof t.forEach)t.forEach(e,void 0);else if(be(t)||pe(t))Re(t,e,void 0);else{if(t.K&&"function"==typeof t.K)var n=t.K();else if(t.C&&"function"==typeof t.C)n=void 0;else if(be(t)||pe(t)){n=[];for(var r=t.length,i=0;i<r;i++)n.push(i)}else for(i in n=[],r=0,t)n[r++]=i;i=(r=function(t){if(t.C&&"function"==typeof t.C)return t.C();if(pe(t))return t.split("");if(be(t)){for(var e=[],n=t.length,r=0;r<n;r++)e.push(t[r]);return e}for(r in e=[],n=0,t)e[n++]=t[r];return e}(t)).length;for(var o=0;o<i;o++)e.call(void 0,r[o],n&&n[o],t)}}function xr(t,e){this.b={},this.a=[],this.c=0;var n=arguments.length;if(1<n){if(n%2)throw Error("Uneven number of arguments");for(var r=0;r<n;r+=2)this.set(arguments[r],arguments[r+1])}else if(t)if(t instanceof xr)for(n=t.K(),r=0;r<n.length;r++)this.set(n[r],t.get(n[r]));else for(r in t)this.set(r,t[r])}function qr(t,e){Ur(t.b,e)&&(delete t.b[e],t.c--,t.a.length>2*t.c&&Fr(t))}function Fr(t){if(t.c!=t.a.length){for(var e=0,n=0;e<t.a.length;){var r=t.a[e];Ur(t.b,r)&&(t.a[n++]=r),e++}t.a.length=n}if(t.c!=t.a.length){var i={};for(n=e=0;e<t.a.length;)Ur(i,r=t.a[e])||(t.a[n++]=r,i[r]=1),e++;t.a.length=n}}function Ur(t,e){return Object.prototype.hasOwnProperty.call(t,e)}(ce=wr.prototype).setTimeout=function(t){this.O=t},ce.eb=function(t){t=t.target;var e=this.B;e&&3==Bi(t)?e.Ua():this.Ka(t)},ce.Ka=function(t){try{if(t==this.a)t:{var e=Bi(this.a),n=this.a.ya(),r=this.a.T();if(!(3>e||3==e&&!Xe&&!this.a.aa())){this.m||4!=e||7==n||or(8==n||0>=r?3:2),Rr(this);var i=this.a.T();this.o=i;var o=this.a.aa();if(this.b=200==i){if(this.S&&!this.s){e:{if(this.a){var a=ji(this.a,"X-HTTP-Initial-Response");if(a&&!Me(a)){var s=a;break e}}s=null}if(!s){this.b=!1,this.c=3,sr(12),Pr(this),Or(this);break t}this.s=!0,Mr(this,s)}this.H?(Ar(this,e,o),Xe&&this.b&&3==e&&(tr(this.I,this.P,"tick",this.cb),this.P.start())):Mr(this,o),4==e&&Pr(this),this.b&&!this.m&&(4==e?this.g.na(this):(this.b=!1,kr(this)))}else 400==i&&0<o.indexOf("Unknown SID")?(this.c=3,sr(12)):(this.c=0,sr(13)),Pr(this),Or(this)}}}catch(t){}},ce.cb=function(){if(this.a){var t=Bi(this.a),e=this.a.aa();this.A<e.length&&(Rr(this),Ar(this,t,e),this.b&&4!=t&&kr(this))}},ce.cancel=function(){this.m=!0,Pr(this)},ce.bb=function(){this.i=null;var t=Ae();0<=t-this.R?(2!=this.F&&(or(3),sr(17)),Pr(this),this.c=2,Or(this)):_r(this,this.R-t)},(ce=xr.prototype).C=function(){Fr(this);for(var t=[],e=0;e<this.a.length;e++)t.push(this.b[this.a[e]]);return t},ce.K=function(){return Fr(this),this.a.concat()},ce.get=function(t,e){return Ur(this.b,t)?this.b[t]:e},ce.set=function(t,e){Ur(this.b,t)||(this.c++,this.a.push(t)),this.b[t]=e},ce.forEach=function(t,e){for(var n=this.K(),r=0;r<n.length;r++){var i=n[r],o=this.get(i);t.call(e,o,i,this)}};var Vr=/^(?:([^:\/?#.]+):)?(?:\/\/(?:([^\/?#]*)@)?([^\/#?]*?)(?::([0-9]+))?(?=[\/#?]|$))?([^?#]+)?(?:\?([^#]*))?(?:#([\s\S]*))?$/;function Br(t,e){var n;this.b=this.j=this.f="",this.i=null,this.g=this.a="",this.h=!1,t instanceof Br?(this.h=void 0!==e?e:t.h,Kr(this,t.f),this.j=t.j,$r(this,t.b),Qr(this,t.i),this.a=t.a,Wr(this,ci(t.c)),this.g=t.g):t&&(n=String(t).match(Vr))?(this.h=!!e,Kr(this,n[1]||"",!0),this.j=Yr(n[2]||""),$r(this,n[3]||"",!0),Qr(this,n[4]),this.a=Yr(n[5]||"",!0),Wr(this,n[6]||"",!0),this.g=Yr(n[7]||"")):(this.h=!!e,this.c=new ii(null,this.h))}function jr(t){return new Br(t)}function Kr(t,e,n){t.f=n?Yr(e,!0):e,t.f&&(t.f=t.f.replace(/:$/,""))}function $r(t,e,n){t.b=n?Yr(e,!0):e}function Qr(t,e){if(e){if(e=Number(e),isNaN(e)||0>e)throw Error("Bad port number "+e);t.i=e}else t.i=null}function Wr(t,e,n){e instanceof ii?(t.c=e,function(t,e){e&&!t.f&&(oi(t),t.c=null,t.a.forEach(function(t,e){var n=e.toLowerCase();e!=n&&(ai(this,e),ui(this,n,t))},t)),t.f=e}(t.c,t.h)):(n||(e=Xr(e,ni)),t.c=new ii(e,t.h))}function Gr(t,e,n){t.c.set(e,n)}function zr(t,e,n){ve(n)||(n=[String(n)]),ui(t.c,e,n)}function Hr(t){return Gr(t,"zx",Math.floor(2147483648*Math.random()).toString(36)+Math.abs(Math.floor(2147483648*Math.random())^Ae()).toString(36)),t}function Yr(t,e){return t?e?decodeURI(t.replace(/%25/g,"%2525")):decodeURIComponent(t):""}function Xr(t,e,n){return pe(t)?(t=encodeURI(t).replace(e,Jr),n&&(t=t.replace(/%25([0-9a-fA-F]{2})/g,"%$1")),t):null}function Jr(t){return"%"+((t=t.charCodeAt(0))>>4&15).toString(16)+(15&t).toString(16)}Br.prototype.toString=function(){var t=[],e=this.f;e&&t.push(Xr(e,Zr,!0),":");var n=this.b;return(n||"file"==e)&&(t.push("//"),(e=this.j)&&t.push(Xr(e,Zr,!0),"@"),t.push(encodeURIComponent(String(n)).replace(/%25([0-9a-fA-F]{2})/g,"%$1")),null!=(n=this.i)&&t.push(":",String(n))),(n=this.a)&&(this.b&&"/"!=n.charAt(0)&&t.push("/"),t.push(Xr(n,"/"==n.charAt(0)?ei:ti,!0))),(n=this.c.toString())&&t.push("?",n),(n=this.g)&&t.push("#",Xr(n,ri)),t.join("")},Br.prototype.resolve=function(t){var e=jr(this),n=!!t.f;n?Kr(e,t.f):n=!!t.j,n?e.j=t.j:n=!!t.b,n?$r(e,t.b):n=null!=t.i;var r=t.a;if(n)Qr(e,t.i);else if(n=!!t.a){if("/"!=r.charAt(0))if(this.b&&!this.a)r="/"+r;else{var i=e.a.lastIndexOf("/");-1!=i&&(r=e.a.substr(0,i+1)+r)}if(".."==(i=r)||"."==i)r="";else if(qe(i,"./")||qe(i,"/.")){r=0==i.lastIndexOf("/",0),i=i.split("/");for(var o=[],a=0;a<i.length;){var s=i[a++];"."==s?r&&a==i.length&&o.push(""):".."==s?((1<o.length||1==o.length&&""!=o[0])&&o.pop(),r&&a==i.length&&o.push("")):(o.push(s),r=!0)}r=o.join("/")}else r=i}return n?e.a=r:n=""!==t.c.toString(),n?Wr(e,ci(t.c)):n=!!t.g,n&&(e.g=t.g),e};var Zr=/[#\/\?@]/g,ti=/[#\?:]/g,ei=/[#\?]/g,ni=/[#\?@]/g,ri=/#/g;function ii(t,e){this.b=this.a=null,this.c=t||null,this.f=!!e}function oi(t){t.a||(t.a=new xr,t.b=0,t.c&&function(t,e){if(t){t=t.split("&");for(var n=0;n<t.length;n++){var r=t[n].indexOf("="),i=null;if(0<=r){var o=t[n].substring(0,r);i=t[n].substring(r+1)}else o=t[n];e(o,i?decodeURIComponent(i.replace(/\+/g," ")):"")}}}(t.c,function(e,n){t.add(decodeURIComponent(e.replace(/\+/g," ")),n)}))}function ai(t,e){oi(t),e=hi(t,e),Ur(t.a.b,e)&&(t.c=null,t.b-=t.a.get(e).length,qr(t.a,e))}function si(t,e){return oi(t),e=hi(t,e),Ur(t.a.b,e)}function ui(t,e,n){ai(t,e),0<n.length&&(t.c=null,t.a.set(hi(t,e),Pe(n)),t.b+=n.length)}function ci(t){var e=new ii;return e.c=t.c,t.a&&(e.a=new xr(t.a),e.b=t.b),e}function hi(t,e){return e=String(e),t.f&&(e=e.toLowerCase()),e}function li(t){this.a=t,this.b=this.h=null,this.g=!1,this.i=null,this.c=-1,this.l=this.f=null}function fi(t){var e=t.a.F.a;if(null!=e)sr(4),e?(sr(10),to(t.a,t,!1)):(sr(11),to(t.a,t,!0));else{t.b=new wr(t,void 0,void 0),t.b.h=t.h,e=oo(e=t.a,e.Y()?t.f:null,t.i),sr(4),zr(e,"TYPE","xmlhttp");var n=t.a.j,r=t.a.I;n&&r&&Gr(e,n,r),Nr(t.b,e,!1,t.f)}}function pi(){this.a=this.b=null}function di(){this.a=new xr}function mi(t){var e=typeof t;return"object"==e&&t||"function"==e?"o"+(t[Ie]||(t[Ie]=++Ee)):e.charAt(0)+t}function yi(t,e){this.b=t,this.a=e}function gi(t){this.g=t||vi,fe.PerformanceNavigationTiming?t=0<(t=fe.performance.getEntriesByType("navigation")).length&&("hq"==t[0].nextHopProtocol||"h2"==t[0].nextHopProtocol):t=!!(fe.ka&&fe.ka.Ea&&fe.ka.Ea()&&fe.ka.Ea().zb),this.f=t?this.g:1,this.a=null,1<this.f&&(this.a=new di),this.b=null,this.c=[]}(ce=ii.prototype).add=function(t,e){oi(this),this.c=null,t=hi(this,t);var n=this.a.get(t);return n||this.a.set(t,n=[]),n.push(e),this.b+=1,this},ce.forEach=function(t,e){oi(this),this.a.forEach(function(n,r){Re(n,function(n){t.call(e,n,r,this)},this)},this)},ce.K=function(){oi(this);for(var t=this.a.C(),e=this.a.K(),n=[],r=0;r<e.length;r++)for(var i=t[r],o=0;o<i.length;o++)n.push(e[r]);return n},ce.C=function(t){oi(this);var e=[];if(pe(t))si(this,t)&&(e=Oe(e,this.a.get(hi(this,t))));else{t=this.a.C();for(var n=0;n<t.length;n++)e=Oe(e,t[n])}return e},ce.set=function(t,e){return oi(this),this.c=null,si(this,t=hi(this,t))&&(this.b-=this.a.get(t).length),this.a.set(t,[e]),this.b+=1,this},ce.get=function(t,e){return t&&0<(t=this.C(t)).length?String(t[0]):e},ce.toString=function(){if(this.c)return this.c;if(!this.a)return"";for(var t=[],e=this.a.K(),n=0;n<e.length;n++){var r=e[n],i=encodeURIComponent(String(r));r=this.C(r);for(var o=0;o<r.length;o++){var a=i;""!==r[o]&&(a+="="+encodeURIComponent(String(r[o]))),t.push(a)}}return this.c=t.join("&")},De(function(){},function(){}),(ce=li.prototype).M=null,ce.$=function(t){return this.a.$(t)},ce.abort=function(){this.b&&(this.b.cancel(),this.b=null),this.c=-1},ce.Da=function(){return!1},ce.Ga=function(t,e){if(this.c=t.o,0==this.M){if(!this.a.o&&(t=t.a)){var n=ji(t,"X-Client-Wire-Protocol");this.l=n||null,this.a.j&&(t=ji(t,"X-HTTP-Session-Id"))&&(this.a.I=t)}if(e){try{var r=this.a.ja.a.parse(e)}catch(t){return(e=this.a).m=this.c,void ro(e,2)}this.f=r[0]}else(e=this.a).m=this.c,ro(e,2)}else 1==this.M&&(this.g?sr(6):"11111"==e?(sr(5),this.g=!0,(!He||10<=Number(on))&&(this.c=200,this.b.cancel(),sr(11),to(this.a,this,!0))):(sr(7),this.g=!1))},ce.na=function(){if(this.c=this.b.o,this.b.b)0==this.M?(this.M=1,fi(this)):1==this.M&&(this.g?(sr(11),to(this.a,this,!0)):(sr(10),to(this.a,this,!1)));else{0==this.M?sr(8):1==this.M&&sr(9);var t=this.a;t.m=this.c,ro(t,2)}},ce.Y=function(){return this.a.Y()},ce.ma=function(){return this.a.ma()},di.prototype.add=function(t){this.a.set(mi(t),t)},di.prototype.C=function(){return this.a.C()};var vi=10;function bi(t,e){!t.a&&(qe(e,"spdy")||qe(e,"quic")||qe(e,"h2"))&&(t.f=t.g,t.a=new di,t.b&&(Ti(t,t.b),t.b=null))}function wi(t){return!!t.b||!!t.a&&t.a.a.c>=t.f}function Ii(t){return t.b?1:t.a?t.a.a.c:0}function Ei(t,e){return t.b?t=t.b==e:t.a?(e=mi(e),t=Ur(t.a.a.b,e)):t=!1,t}function Ti(t,e){t.a?t.a.add(e):t.b=e}function Si(t,e){var n;t.b&&t.b==e?t.b=null:((n=t.a)&&(n=mi(e),n=Ur(t.a.a.b,n)),n&&qr(t.a.a,mi(e)))}function Ni(t){if(null!=t.b)return t.c.concat(t.b.j);if(null!=t.a&&0!=t.a.a.c){var e=t.c;return Re(t.a.C(),function(t){e=e.concat(t.j)}),e}return Pe(t.c)}function Ci(){}function Ai(){this.a=new Ci}function Di(t,e,n){var r=n||"";try{Lr(t,function(t,n){var i=t;we(t)&&(i=Ln(t)),e.push(r+n+"="+encodeURIComponent(i))})}catch(t){throw e.push(r+"type="+encodeURIComponent("_badmap")),t}}function ki(t,e,n,r,i){try{e.onload=null,e.onerror=null,e.onabort=null,e.ontimeout=null,i(r)}catch(t){}}gi.prototype.cancel=function(){var t;this.c=Ni(this),this.b?(this.b.cancel(),this.b=null):this.a&&0!=this.a.a.c&&(Re(this.a.C(),function(t){t.cancel()}),(t=this.a.a).b={},t.a.length=0,t.c=0)},Ci.prototype.stringify=function(t){return fe.JSON.stringify(t,void 0)},Ci.prototype.parse=function(t){return fe.JSON.parse(t,void 0)};var _i=fe.JSON.parse;function Ri(t){Pn.call(this),this.headers=new xr,this.H=t||null,this.b=!1,this.s=this.a=null,this.A="",this.h=0,this.f="",this.g=this.w=this.l=this.v=!1,this.o=0,this.m=null,this.I=Oi,this.D=this.F=!1}De(Ri,Pn);var Oi="",Pi=/^https?$/i,Mi=["POST","PUT"];function Li(t){return"content-type"==t.toLowerCase()}function xi(t,e){t.b=!1,t.a&&(t.g=!0,t.a.abort(),t.g=!1),t.f=e,t.h=5,qi(t),Ui(t)}function qi(t){t.v||(t.v=!0,t.dispatchEvent("complete"),t.dispatchEvent("error"))}function Fi(t){if(t.b&&void 0!==le&&(!t.s[1]||4!=Bi(t)||2!=t.T()))if(t.l&&4==Bi(t))Hn(t.Fa,0,t);else if(t.dispatchEvent("readystatechange"),4==Bi(t)){t.b=!1;try{var e,n=t.T();t:switch(n){case 200:case 201:case 202:case 204:case 206:case 304:case 1223:var r=!0;break t;default:r=!1}if(!(e=r)){var i;if(i=0===n){var o=String(t.A).match(Vr)[1]||null;if(!o&&fe.self&&fe.self.location){var a=fe.self.location.protocol;o=a.substr(0,a.length-1)}i=!Pi.test(o?o.toLowerCase():"")}e=i}e?(t.dispatchEvent("complete"),t.dispatchEvent("success")):(t.h=6,t.f=t.za()+" ["+t.T()+"]",qi(t))}finally{Ui(t)}}}function Ui(t,e){if(t.a){Vi(t);var n=t.a,r=t.s[0]?ye:null;t.a=null,t.s=null,e||t.dispatchEvent("ready");try{n.onreadystatechange=r}catch(t){}}}function Vi(t){t.a&&t.D&&(t.a.ontimeout=null),t.m&&(fe.clearTimeout(t.m),t.m=null)}function Bi(t){return t.a?t.a.readyState:0}function ji(t,e){return t.a?t.a.getResponseHeader(e):null}function Ki(t,e,n){t:{for(r in n){var r=!1;break t}r=!0}if(r)return t;if(n=function(t){var e="";return Be(t,function(t,n){e+=n,e+=":",e+=t,e+="\r\n"}),e}(n),pe(t)){if(e=encodeURIComponent(String(e)),e+=n=null!=n?"="+encodeURIComponent(String(n)):""){if(0>(n=t.indexOf("#"))&&(n=t.length),0>(r=t.indexOf("?"))||r>n){r=n;var i=""}else i=t.substring(r+1,n);n=(t=[t.substr(0,r),i,t.substr(n)])[1],t[1]=e?n?n+"&"+e:e:n,t=t[0]+(t[1]?"?"+t[1]:"")+t[2]}return t}return Gr(t,e,n),t}function $i(t){this.f=[],this.F=new pi,this.ga=this.pa=this.B=this.ha=this.a=this.I=this.j=this.V=this.g=this.J=this.i=null,this.Ra=this.P=0,this.Pa=!!me("internalChannelParams.failFast",t),this.ia=this.w=this.s=this.l=this.h=this.c=null,this.oa=!0,this.m=this.ra=this.O=-1,this.S=this.v=this.A=0,this.Oa=me("internalChannelParams.baseRetryDelayMs",t)||5e3,this.Sa=me("internalChannelParams.retryDelaySeedMs",t)||1e4,this.Qa=me("internalChannelParams.forwardChannelMaxRetries",t)||2,this.qa=me("internalChannelParams.forwardChannelRequestTimeoutMs",t)||2e4,this.La=t&&t.Ab||void 0,this.D=void 0,this.R=t&&t.supportsCrossDomainXhr||!1,this.H="",this.b=new gi(t&&t.concurrentRequestLimit),this.ja=new Ai,this.o=!t||void 0===t.backgroundChannelTest||t.backgroundChannelTest,(this.W=t&&t.fastHandshake||!1)&&!this.o&&(this.o=!0),t&&t.forceLongPolling&&(this.oa=!1),this.fa=void 0}function Qi(t){if(Wi(t),3==t.u){var e=t.P++,n=jr(t.B);Gr(n,"SID",t.H),Gr(n,"RID",e),Gr(n,"TYPE","terminate"),Yi(t,n),(e=new wr(t,e,void 0)).F=2,e.f=Hr(jr(n)),n=!1,fe.navigator&&fe.navigator.sendBeacon&&(n=fe.navigator.sendBeacon(e.f.toString(),"")),!n&&fe.Image&&((new Image).src=e.f,n=!0),n||(e.a=e.g.$(null),e.a.ca(e.f)),e.v=Ae(),kr(e)}io(t)}function Wi(t){t.w&&(t.w.abort(),t.w=null),t.a&&(t.a.cancel(),t.a=null),t.l&&(fe.clearTimeout(t.l),t.l=null),eo(t),t.b.cancel(),t.h&&(de(t.h)&&fe.clearTimeout(t.h),t.h=null)}function Gi(t,e){t.f.push(new yi(t.Ra++,e)),3==t.u&&zi(t)}function zi(t){wi(t.b)||t.h||(t.h=!0,Kn(t.Ia,t),t.A=0)}function Hi(t,e){var n;n=e?e.W:t.P++;var r=jr(t.B);Gr(r,"SID",t.H),Gr(r,"RID",n),Gr(r,"AID",t.O),Yi(t,r),t.g&&t.i&&Ki(r,t.g,t.i),n=new wr(t,n,t.A+1),null===t.g&&(n.h=t.i),e&&(t.f=e.j.concat(t.f)),e=Xi(t,n,1e3),n.setTimeout(Math.round(.5*t.qa)+Math.round(.5*t.qa*Math.random())),Ti(t.b,n),Sr(n,r,e)}function Yi(t,e){t.c&&Lr({},function(t,n){Gr(e,n,t)})}function Xi(t,e,n){n=Math.min(t.f.length,n);var r=t.c?Ne(t.c.Ta,t.c,t):null;t:for(var i=t.f,o=-1;;){var a=["count="+n];-1==o?0<n?(o=i[0].b,a.push("ofs="+o)):o=0:a.push("ofs="+o);for(var s=!0,u=0;u<n;u++){var c=i[u].b,h=i[u].a;if(0>(c-=o))o=Math.max(0,i[u].b-100),s=!1;else try{Di(h,a,"req"+c+"_")}catch(t){r&&r(h)}}if(s){r=a.join("&");break t}}return t=t.f.splice(0,n),e.j=t,r}function Ji(t){t.a||t.l||(t.S=1,Kn(t.Ha,t),t.v=0)}function Zi(t){return!(t.a||t.l||3<=t.v)&&(t.S++,t.l=cr(Ne(t.Ha,t),no(t,t.v)),t.v++,!0)}function to(t,e,n){var r=e.l;r&&bi(t.b,r),t.ia=t.oa&&n,t.m=e.c,t.B=oo(t,null,t.ha),zi(t)}function eo(t){null!=t.s&&(fe.clearTimeout(t.s),t.s=null)}function no(t,e){var n=t.Oa+Math.floor(Math.random()*t.Sa);return t.ma()||(n*=2),n*e}function ro(t,e){if(2==e){var n=null;t.c&&(n=null);var r=Ne(t.fb,t);n||(n=new Br("//www.google.com/images/cleardot.gif"),fe.location&&"http"==fe.location.protocol||Kr(n,"https"),Hr(n)),function(t,e){var n=new nr;if(fe.Image){var r=new Image;r.onload=Ce(ki,n,r,"TestLoadImage: loaded",!0,e),r.onerror=Ce(ki,n,r,"TestLoadImage: error",!1,e),r.onabort=Ce(ki,n,r,"TestLoadImage: abort",!1,e),r.ontimeout=Ce(ki,n,r,"TestLoadImage: timeout",!1,e),fe.setTimeout(function(){r.ontimeout&&r.ontimeout()},1e4),r.src=t}else e(!1)}(n.toString(),r)}else sr(2);t.u=0,t.c&&t.c.ta(e),io(t),Wi(t)}function io(t){t.u=0,t.m=-1,t.c&&(0==Ni(t.b).length&&0==t.f.length||(t.b.c.length=0,Pe(t.f),t.f.length=0),t.c.sa())}function oo(t,e,n){var r=function(t){return t instanceof Br?jr(t):new Br(t,void 0)}(n);if(""!=r.b)e&&$r(r,e+"."+r.b),Qr(r,r.i);else{var i,o=fe.location;i=e?e+"."+o.hostname:o.hostname,r=function(t,e,n,r){var i=new Br(null,void 0);return t&&Kr(i,t),e&&$r(i,e),n&&Qr(i,n),r&&(i.a=r),i}(o.protocol,i,+o.port,n)}return t.V&&Be(t.V,function(t,e){Gr(r,e,t)}),e=t.j,n=t.I,e&&n&&Gr(r,e,n),Gr(r,"VER",t.wa),Yi(t,r),r}function ao(){}function so(){if(He&&!(10<=Number(on)))throw Error("Environmental error: no available transport.")}function uo(t,e){Pn.call(this),this.a=new $i(e),this.g=t,this.m=e&&e.testUrl?e.testUrl:function(t){for(var e=arguments[0],n=1;n<arguments.length;n++){var r,i=arguments[n];0==i.lastIndexOf("/",0)?e=i:((r=""==e)||(r=0<=(r=e.length-1)&&e.indexOf("/",r)==r),e+=r?i:"/"+i)}return e}(this.g,"test"),this.b=e&&e.messageUrlParams||null,t=e&&e.messageHeaders||null,e&&e.clientProtocolHeaderRequired&&(t?t["X-Client-Protocol"]="webchannel":t={"X-Client-Protocol":"webchannel"}),this.a.i=t,t=e&&e.initMessageHeaders||null,e&&e.messageContentType&&(t?t["X-WebChannel-Content-Type"]=e.messageContentType:t={"X-WebChannel-Content-Type":e.messageContentType}),e&&e.xa&&(t?t["X-WebChannel-Client-Profile"]=e.xa:t={"X-WebChannel-Client-Profile":e.xa}),this.a.J=t,(t=e&&e.httpHeadersOverwriteParam)&&!Me(t)&&(this.a.g=t),this.l=e&&e.supportsCrossDomainXhr||!1,this.h=e&&e.sendRawJson||!1,(e=e&&e.httpSessionIdParam)&&!Me(e)&&(this.a.j=e,null!==(t=this.b)&&e in t&&(e in(t=this.b)&&delete t[e])),this.f=new lo(this)}function co(t){gr.call(this);var e=t.__sm__;if(e){t:{for(var n in e){t=n;break t}t=void 0}(this.c=t)?(t=this.c,this.data=null!==e&&t in e?e[t]:void 0):this.data=e}else this.data=t}function ho(){vr.call(this),this.status=1}function lo(t){this.a=t}(ce=Ri.prototype).ca=function(t,e,n,r){if(this.a)throw Error("[goog.net.XhrIo] Object is active with another request="+this.A+"; newUri="+t);e=e?e.toUpperCase():"GET",this.A=t,this.f="",this.h=0,this.v=!1,this.b=!0,this.a=new XMLHttpRequest,this.s=this.H?pr(this.H):pr(mr),this.a.onreadystatechange=Ne(this.Fa,this);try{this.w=!0,this.a.open(e,String(t),!0),this.w=!1}catch(t){return void xi(this,t)}t=n||"";var i=new xr(this.headers);r&&Lr(r,function(t,e){i.set(e,t)}),r=function(t){t:{for(var e=Li,n=t.length,r=pe(t)?t.split(""):t,i=0;i<n;i++)if(i in r&&e.call(void 0,r[i],i,t)){e=i;break t}e=-1}return 0>e?null:pe(t)?t.charAt(e):t[e]}(i.K()),n=fe.FormData&&t instanceof fe.FormData,!(0<=_e(Mi,e))||r||n||i.set("Content-Type","application/x-www-form-urlencoded;charset=utf-8"),i.forEach(function(t,e){this.a.setRequestHeader(e,t)},this),this.I&&(this.a.responseType=this.I),"withCredentials"in this.a&&this.a.withCredentials!==this.F&&(this.a.withCredentials=this.F);try{Vi(this),0<this.o&&((this.D=function(t){return He&&sn(9)&&de(t.timeout)&&void 0!==t.ontimeout}(this.a))?(this.a.timeout=this.o,this.a.ontimeout=Ne(this.Ca,this)):this.m=Hn(this.Ca,this.o,this)),this.l=!0,this.a.send(t),this.l=!1}catch(t){xi(this,t)}},ce.Ca=function(){void 0!==le&&this.a&&(this.f="Timed out after "+this.o+"ms, aborting",this.h=8,this.dispatchEvent("timeout"),this.abort(8))},ce.abort=function(t){this.a&&this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1,this.h=t||7,this.dispatchEvent("complete"),this.dispatchEvent("abort"),Ui(this))},ce.G=function(){this.a&&(this.b&&(this.b=!1,this.g=!0,this.a.abort(),this.g=!1),Ui(this,!0)),Ri.N.G.call(this)},ce.Fa=function(){this.j||(this.w||this.l||this.g?Fi(this):this.$a())},ce.$a=function(){Fi(this)},ce.T=function(){try{return 2<Bi(this)?this.a.status:-1}catch(t){return-1}},ce.za=function(){try{return 2<Bi(this)?this.a.statusText:""}catch(t){return""}},ce.aa=function(){try{return this.a?this.a.responseText:""}catch(t){return""}},ce.Va=function(t){if(this.a){var e=this.a.responseText;return t&&0==e.indexOf(t)&&(e=e.substring(t.length)),_i(e)}},ce.ya=function(){return this.h},ce.Ya=function(){return pe(this.f)?this.f:String(this.f)},(ce=$i.prototype).wa=8,ce.u=1,ce.Da=function(){return 0==this.u},ce.Ia=function(t){if(this.h)if(this.h=null,1==this.u){if(!t){this.P=Math.floor(1e5*Math.random());var e,n=new wr(this,t=this.P++,void 0),r=this.i;if(this.J&&(r?$e(r=je(r),this.J):r=this.J),null===this.g&&(n.h=r),this.W)t:{for(var i=e=0;i<this.f.length;i++){var o=this.f[i];if(void 0===(o="__data__"in o.a&&pe(o=o.a.__data__)?o.length:void 0))break;if(4096<(e+=o)){e=i;break t}if(4096===e||i===this.f.length-1){e=i+1;break t}}e=1e3}else e=1e3;e=Xi(this,n,e),Gr(i=jr(this.B),"RID",t),Gr(i,"CVER",22),this.o&&this.j&&Gr(i,"X-HTTP-Session-Id",this.j),Yi(this,i),this.g&&r&&Ki(i,this.g,r),Ti(this.b,n),this.W?(Gr(i,"$req",e),Gr(i,"SID","null"),n.S=!0,Sr(n,i,null)):Sr(n,i,e),this.u=2}}else 3==this.u&&(t?Hi(this,t):0==this.f.length||wi(this.b)||Hi(this))},ce.Ha=function(){this.l=null,this.a=new wr(this,"rpc",this.S),null===this.g&&(this.a.h=this.i),this.a.J=0;var t=jr(this.pa);Gr(t,"RID","rpc"),Gr(t,"SID",this.H),Gr(t,"CI",this.ia?"0":"1"),Gr(t,"AID",this.O),Yi(this,t),Gr(t,"TYPE","xmlhttp"),this.g&&this.i&&Ki(t,this.g,this.i),this.D&&this.a.setTimeout(this.D),Nr(this.a,t,!0,this.ga)},ce.Ga=function(t,e){if(0!=this.u&&(this.a==t||Ei(this.b,t)))if(this.m=t.o,!t.s&&Ei(this.b,t)&&3==this.u){try{var n=this.ja.a.parse(e)}catch(t){n=null}if(ve(n)&&3==n.length){if(0==(e=n)[0]){t:if(!this.l){if(this.a){if(!(this.a.v+3e3<t.v))break t;eo(this),this.a.cancel(),this.a=null}Zi(this),sr(18)}}else this.ra=e[1],0<this.ra-this.O&&37500>e[2]&&this.ia&&0==this.v&&!this.s&&(this.s=cr(Ne(this.Za,this),6e3));if(1>=Ii(this.b)&&this.fa){try{this.fa()}catch(t){}this.fa=void 0}}else ro(this,11)}else if((t.s||this.a==t)&&eo(this),!Me(e))for(e=n=this.ja.a.parse(e),n=0;n<e.length;n++){var r=e[n];if(this.O=r[0],r=r[1],2==this.u)if("c"==r[0]){this.H=r[1],this.ga=r[2];var i=r[3];null!=i&&(this.wa=i),null!=(r=r[5])&&de(r)&&0<r&&(this.D=1.5*r),this.o&&(r=t.a)&&((i=ji(r,"X-Client-Wire-Protocol"))&&bi(this.b,i),this.j&&(r=ji(r,"X-HTTP-Session-Id")))&&(this.I=r,Gr(this.B,this.j,r)),this.u=3,this.c&&this.c.va(),r=t,this.pa=oo(this,this.Y()?this.ga:null,this.ha),r.s?(Si(this.b,r),(i=this.D)&&r.setTimeout(i),r.i&&(Rr(r),kr(r)),this.a=r):Ji(this),0<this.f.length&&zi(this)}else"stop"!=r[0]&&"close"!=r[0]||ro(this,7);else 3==this.u&&("stop"==r[0]||"close"==r[0]?"stop"==r[0]?ro(this,7):Qi(this):"noop"!=r[0]&&this.c&&this.c.ua(r),this.v=0)}},ce.Za=function(){null!=this.s&&(this.s=null,this.a.cancel(),this.a=null,Zi(this),sr(19))},ce.na=function(t){var e=null;if(this.a==t){eo(this),this.a=null;var n=2}else{if(!Ei(this.b,t))return;e=t.j,Si(this.b,t),n=1}if(this.m=t.o,0!=this.u)if(t.b)1==n?(e=Ae()-t.v,rr.dispatchEvent(new ur(rr,t.l?t.l.length:0,e,this.A)),zi(this)):Ji(this);else{var r=t.c;if(3==r||0==r&&0<this.m||!(1==n&&function(t,e){return!(Ii(t.b)>=t.b.f-(t.h?1:0)||(t.h?(t.f=e.j.concat(t.f),0):1==t.u||2==t.u||t.A>=(t.Pa?0:t.Qa)||(t.h=cr(Ne(t.Ia,t,e),no(t,t.A)),t.A++,0)))}(this,t)||2==n&&Zi(this)))switch(e&&0<e.length&&(t=this.b,t.c=t.c.concat(e)),r){case 1:ro(this,5);break;case 4:ro(this,10);break;case 3:ro(this,6);break;default:ro(this,2)}}},ce.fb=function(t){sr(t?2:1)},ce.$=function(t){if(t&&!this.R)throw Error("Can't create secondary domain capable XhrIo object.");return(t=new Ri(this.La)).F=this.R,t},ce.ma=function(){return!!this.c&&!0},ce.Y=function(){return this.R},(ce=ao.prototype).va=function(){},ce.ua=function(){},ce.ta=function(){},ce.sa=function(){},ce.Ta=function(){},so.prototype.a=function(t,e){return new uo(t,e)},De(uo,Pn),(ce=uo.prototype).addEventListener=function(t,e,n,r){uo.N.addEventListener.call(this,t,e,n,r)},ce.removeEventListener=function(t,e,n,r){uo.N.removeEventListener.call(this,t,e,n,r)},ce.Wa=function(){this.a.c=this.f,this.l&&(this.a.R=!0);var t=this.a,e=this.m,n=this.g,r=this.b||void 0;sr(0),t.ha=n,t.V=r||{},t.o&&(t.F.b=[],t.F.a=!1),t.w=new li(t),null===t.g&&(t.w.h=t.i),n=e,t.g&&t.i&&(n=Ki(e,t.g,t.i)),(t=t.w).i=n,e=oo(t.a,null,t.i),sr(3),null!=(n=t.a.F.b)?(t.f=n[0],t.M=1,fi(t)):(zr(e,"MODE","init"),!t.a.o&&t.a.j&&zr(e,"X-HTTP-Session-Id",t.a.j),t.b=new wr(t,void 0,void 0),t.b.h=t.h,Nr(t.b,e,!1,null),t.M=0)},ce.close=function(){Qi(this.a)},ce.Xa=function(t){if(pe(t)){var e={};e.__data__=t,Gi(this.a,e)}else this.h?((e={}).__data__=Ln(t),Gi(this.a,e)):Gi(this.a,t)},ce.G=function(){this.a.c=null,delete this.f,Qi(this.a),delete this.a,uo.N.G.call(this)},De(co,gr),De(ho,vr),De(lo,ao),lo.prototype.va=function(){this.a.dispatchEvent("a")},lo.prototype.ua=function(t){this.a.dispatchEvent(new co(t))},lo.prototype.ta=function(t){this.a.dispatchEvent(new ho(t))},lo.prototype.sa=function(){this.a.dispatchEvent("b")};var fo=Ce(function(t,e){function n(){}n.prototype=t.prototype;var r=new n;return t.apply(r,Array.prototype.slice.call(arguments,1)),r},so);so.prototype.createWebChannel=so.prototype.a,uo.prototype.send=uo.prototype.Xa,uo.prototype.open=uo.prototype.Wa,uo.prototype.close=uo.prototype.close,hr.NO_ERROR=0,hr.TIMEOUT=8,hr.HTTP_ERROR=6,lr.COMPLETE="complete",dr.EventType=yr,yr.OPEN="a",yr.CLOSE="b",yr.ERROR="c",yr.MESSAGE="d",Pn.prototype.listen=Pn.prototype.Aa,Ri.prototype.listenOnce=Ri.prototype.Ba,Ri.prototype.getLastError=Ri.prototype.Ya,Ri.prototype.getLastErrorCode=Ri.prototype.ya,Ri.prototype.getStatus=Ri.prototype.T,Ri.prototype.getStatusText=Ri.prototype.za,Ri.prototype.getResponseJson=Ri.prototype.Va,Ri.prototype.getResponseText=Ri.prototype.aa,Ri.prototype.send=Ri.prototype.ca;var po,mo={createWebChannelTransport:fo,ErrorCode:hr,EventType:lr,WebChannel:dr,XhrIo:Ri},yo=mo.createWebChannelTransport,go=mo.ErrorCode,vo=mo.EventType,bo=mo.WebChannel,wo=mo.XhrIo,Io=ue.SDK_VERSION,Eo=new Jt("@firebase/firestore");function To(){return Eo.logLevel===Wt.DEBUG?po.DEBUG:Eo.logLevel===Wt.SILENT?po.SILENT:po.ERROR}function So(t){switch(t){case po.DEBUG:Eo.logLevel=Wt.DEBUG;break;case po.ERROR:Eo.logLevel=Wt.ERROR;break;case po.SILENT:Eo.logLevel=Wt.SILENT;break;default:Eo.error("Firestore ("+Io+"): Invalid value passed to `setLogLevel`")}}function No(t,e){for(var n=[],r=2;r<arguments.length;r++)n[r-2]=arguments[r];if(Eo.logLevel<=Wt.DEBUG){var i=n.map(Ao);Eo.debug.apply(Eo,["Firestore ("+Io+") ["+t+"]: "+e].concat(i))}}function Co(t){for(var e=[],n=1;n<arguments.length;n++)e[n-1]=arguments[n];if(Eo.logLevel<=Wt.ERROR){var r=e.map(Ao);Eo.error.apply(Eo,["Firestore ("+Io+"): "+t].concat(r))}}function Ao(t){if("string"==typeof t)return t;var e=_o.getPlatform();try{return e.formatJSON(t)}catch(e){return t}}function Do(t){var e="FIRESTORE ("+Io+") INTERNAL ASSERTION FAILED: "+t;throw Co(e),new Error(e)}function ko(t,e){t||Do(e)}!function(t){t[t.DEBUG=0]="DEBUG",t[t.ERROR=1]="ERROR",t[t.SILENT=2]="SILENT"}(po||(po={}));var _o=function(){function t(){}return t.setPlatform=function(e){t.platform&&Do("Platform already defined"),t.platform=e},t.getPlatform=function(){return t.platform||Do("Platform not set"),t.platform},t}();function Ro(){return _o.getPlatform().emptyByteString}var Oo={OK:"ok",CANCELLED:"cancelled",UNKNOWN:"unknown",INVALID_ARGUMENT:"invalid-argument",DEADLINE_EXCEEDED:"deadline-exceeded",NOT_FOUND:"not-found",ALREADY_EXISTS:"already-exists",PERMISSION_DENIED:"permission-denied",UNAUTHENTICATED:"unauthenticated",RESOURCE_EXHAUSTED:"resource-exhausted",FAILED_PRECONDITION:"failed-precondition",ABORTED:"aborted",OUT_OF_RANGE:"out-of-range",UNIMPLEMENTED:"unimplemented",INTERNAL:"internal",UNAVAILABLE:"unavailable",DATA_LOSS:"data-loss"},Po=function(t){function e(e,n){var r=t.call(this,n)||this;return r.code=e,r.message=n,r.name="FirebaseError",r.toString=function(){return r.name+": [code="+r.code+"]: "+r.message},r}return Mt(e,t),e}(Error);function Mo(t,e){function n(){var t="This constructor is private.";throw e&&(t+=" ",t+=e),new Po(Oo.INVALID_ARGUMENT,t)}for(var r in n.prototype=t.prototype,t)t.hasOwnProperty(r)&&(n[r]=t[r]);return n}function Lo(t,e){return Object.prototype.hasOwnProperty.call(t,e)}function xo(t,e){return void 0!==t?t:e}function qo(t,e){for(var n in t)if(Object.prototype.hasOwnProperty.call(t,n)){var r=Number(n);isNaN(r)||e(r,t[n])}}function Fo(t,e){for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&e(n,t[n])}function Uo(t){for(var e in ko(null!=t&&"object"==typeof t,"isEmpty() expects object parameter."),t)if(Object.prototype.hasOwnProperty.call(t,e))return!1;return!0}function Vo(t,e){if(0!==e.length)throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() does not support arguments, but was called with "+ra(e.length,"argument")+".")}function Bo(t,e,n){if(e.length!==n)throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() requires "+ra(n,"argument")+", but was called with "+ra(e.length,"argument")+".")}function jo(t,e,n){if(e.length<n)throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() requires at least "+ra(n,"argument")+", but was called with "+ra(e.length,"argument")+".")}function Ko(t,e,n,r){if(e.length<n||e.length>r)throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() requires between "+n+" and "+r+" arguments, but was called with "+ra(e.length,"argument")+".")}function $o(t,e,n,r){Yo(t,e,na(n)+" argument",r)}function Qo(t,e,n,r){void 0!==r&&$o(t,e,n,r)}function Wo(t,e,n,r){Yo(t,e,n+" option",r)}function Go(t,e,n,r){void 0!==r&&Wo(t,e,n,r)}function zo(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){if(!(r instanceof Array))throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() requires its "+e+" option to be an array, but it was: "+Jo(r));for(var o=0;o<r.length;++o)if(!i(r[o]))throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() requires all "+e+" elements to be "+n+", but the value at index "+o+" was: "+Jo(r[o]))}(t,e,n,r,i)}function Ho(t,e,n,r,i){void 0!==r&&function(t,e,n,r,i){for(var o=[],a=0,s=i;a<s.length;a++){var u=s[a];if(u===r)return;o.push(Jo(u))}var c=Jo(r);throw new Po(Oo.INVALID_ARGUMENT,"Invalid value "+c+" provided to function "+t+'() for option "'+n+'". Acceptable values: '+o.join(", "))}(t,0,n,r,i)}function Yo(t,e,n,r){if(!("object"===e?Xo(r):"non-empty string"===e?"string"==typeof r&&""!==r:typeof r===e)){var i=Jo(r);throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" to be of type "+e+", but it was: "+i)}}function Xo(t){return"object"==typeof t&&null!==t&&(Object.getPrototypeOf(t)===Object.prototype||null===Object.getPrototypeOf(t))}function Jo(t){if(void 0===t)return"undefined";if(null===t)return"null";if("string"==typeof t)return t.length>20&&(t=t.substring(0,20)+"..."),JSON.stringify(t);if("number"==typeof t||"boolean"==typeof t)return""+t;if("object"==typeof t){if(t instanceof Array)return"an array";var e=function(t){if(t.constructor){var e=/function\s+([^\s(]+)\s*\(/.exec(t.constructor.toString());if(e&&e.length>1)return e[1]}return null}(t);return e?"a custom "+e+" object":"an object"}return"function"==typeof t?"a function":Do("Unknown wrong type: "+typeof t)}function Zo(t,e,n){if(void 0===n)throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() requires a valid "+na(e)+" argument, but it was undefined.")}function ta(t,e,n){Fo(e,function(e,r){if(n.indexOf(e)<0)throw new Po(Oo.INVALID_ARGUMENT,"Unknown option '"+e+"' passed to function "+t+"(). Available options: "+n.join(", "))})}function ea(t,e,n,r){var i=Jo(r);return new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() requires its "+na(n)+" argument to be a "+e+", but it was: "+i)}function na(t){switch(t){case 1:return"first";case 2:return"second";case 3:return"third";default:return t+"th"}}function ra(t,e){return t+" "+e+(1===t?"":"s")}var ia=function(){function t(){}return t.newId=function(){for(var t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789",e="",n=0;n<20;n++)e+=t.charAt(Math.floor(Math.random()*t.length));return ko(20===e.length,"Invalid auto ID: "+e),e},t}();function oa(t,e){return t<e?-1:t>e?1:0}function aa(t,e){if(t.length!==e.length)return!1;for(var n=0;n<t.length;n++)if(!t[n].isEqual(e[n]))return!1;return!0}function sa(t){return t+"\0"}function ua(){if("undefined"==typeof Uint8Array)throw new Po(Oo.UNIMPLEMENTED,"Uint8Arrays are not available in this environment.")}function ca(){if(!_o.getPlatform().base64Available)throw new Po(Oo.UNIMPLEMENTED,"Blobs are unavailable in Firestore in this environment.")}var ha,la=function(){function t(t){ca(),this._binaryString=t}return t.fromBase64String=function(e){Bo("Blob.fromBase64String",arguments,1),$o("Blob.fromBase64String","string",1,e),ca();try{return new t(_o.getPlatform().atob(e))}catch(t){throw new Po(Oo.INVALID_ARGUMENT,"Failed to construct Blob from Base64 string: "+t)}},t.fromUint8Array=function(e){if(Bo("Blob.fromUint8Array",arguments,1),ua(),!(e instanceof Uint8Array))throw ea("Blob.fromUint8Array","Uint8Array",1,e);return new t(Array.prototype.map.call(e,function(t){return String.fromCharCode(t)}).join(""))},t.prototype.toBase64=function(){return Bo("Blob.toBase64",arguments,0),ca(),_o.getPlatform().btoa(this._binaryString)},t.prototype.toUint8Array=function(){Bo("Blob.toUint8Array",arguments,0),ua();for(var t=new Uint8Array(this._binaryString.length),e=0;e<this._binaryString.length;e++)t[e]=this._binaryString.charCodeAt(e);return t},t.prototype.toString=function(){return"Blob(base64: "+this.toBase64()+")"},t.prototype.isEqual=function(t){return this._binaryString===t._binaryString},t.prototype._compareTo=function(t){return oa(this._binaryString,t._binaryString)},t}(),fa=Mo(la,"Use Blob.fromUint8Array() or Blob.fromBase64String() instead."),pa=function(){return function(t,e,n,r,i){this.databaseId=t,this.persistenceKey=e,this.host=n,this.ssl=r,this.forceLongPolling=i}}(),da="(default)",ma=function(){function t(t,e){this.projectId=t,this.database=e||da}return Object.defineProperty(t.prototype,"isDefaultDatabase",{get:function(){return this.database===da},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return e instanceof t&&e.projectId===this.projectId&&e.database===this.database},t.prototype.compareTo=function(t){return oa(this.projectId,t.projectId)||oa(this.database,t.database)},t}(),ya=function(){function t(t,e){var n=this;this.previousValue=t,e&&(e.sequenceNumberHandler=function(t){return n.setPreviousValue(t)},this.writeNewSequenceNumber=function(t){return e.writeSequenceNumber(t)})}return t.prototype.setPreviousValue=function(t){return this.previousValue=Math.max(t,this.previousValue),this.previousValue},t.prototype.next=function(){var t=++this.previousValue;return this.writeNewSequenceNumber&&this.writeNewSequenceNumber(t),t},t.INVALID=-1,t}(),ga=function(){function t(t,e,n){void 0===e?e=0:e>t.length&&Do("offset "+e+" out of range "+t.length),void 0===n?n=t.length-e:n>t.length-e&&Do("length "+n+" out of range "+(t.length-e)),this.segments=t,this.offset=e,this.len=n}return Object.defineProperty(t.prototype,"length",{get:function(){return this.len},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){return 0===t.comparator(this,e)},t.prototype.child=function(e){var n=this.segments.slice(this.offset,this.limit());return e instanceof t?e.forEach(function(t){n.push(t)}):n.push(e),this.construct(n)},t.prototype.limit=function(){return this.offset+this.length},t.prototype.popFirst=function(t){return t=void 0===t?1:t,ko(this.length>=t,"Can't call popFirst() with less segments"),this.construct(this.segments,this.offset+t,this.length-t)},t.prototype.popLast=function(){return ko(!this.isEmpty(),"Can't call popLast() on empty path"),this.construct(this.segments,this.offset,this.length-1)},t.prototype.firstSegment=function(){return ko(!this.isEmpty(),"Can't call firstSegment() on empty path"),this.segments[this.offset]},t.prototype.lastSegment=function(){return this.get(this.length-1)},t.prototype.get=function(t){return ko(t<this.length,"Index out of range"),this.segments[this.offset+t]},t.prototype.isEmpty=function(){return 0===this.length},t.prototype.isPrefixOf=function(t){if(t.length<this.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.isImmediateParentOf=function(t){if(this.length+1!==t.length)return!1;for(var e=0;e<this.length;e++)if(this.get(e)!==t.get(e))return!1;return!0},t.prototype.forEach=function(t){for(var e=this.offset,n=this.limit();e<n;e++)t(this.segments[e])},t.prototype.toArray=function(){return this.segments.slice(this.offset,this.limit())},t.comparator=function(t,e){for(var n=Math.min(t.length,e.length),r=0;r<n;r++){var i=t.get(r),o=e.get(r);if(i<o)return-1;if(i>o)return 1}return t.length<e.length?-1:t.length>e.length?1:0},t}(),va=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mt(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.prototype.canonicalString=function(){return this.toArray().join("/")},e.prototype.toString=function(){return this.canonicalString()},e.fromString=function(t){if(t.indexOf("//")>=0)throw new Po(Oo.INVALID_ARGUMENT,"Invalid path ("+t+"). Paths must not contain // in them.");return new e(t.split("/").filter(function(t){return t.length>0}))},e.EMPTY_PATH=new e([]),e}(ga),ba=/^[_a-zA-Z][_a-zA-Z0-9]*$/,wa=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mt(e,t),e.prototype.construct=function(t,n,r){return new e(t,n,r)},e.isValidIdentifier=function(t){return ba.test(t)},e.prototype.canonicalString=function(){return this.toArray().map(function(t){return t=t.replace("\\","\\\\").replace("`","\\`"),e.isValidIdentifier(t)||(t="`"+t+"`"),t}).join(".")},e.prototype.toString=function(){return this.canonicalString()},e.prototype.isKeyField=function(){return 1===this.length&&"__name__"===this.get(0)},e.keyField=function(){return new e(["__name__"])},e.fromServerFormat=function(t){for(var n=[],r="",i=0,o=function(){if(0===r.length)throw new Po(Oo.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'");n.push(r),r=""},a=!1;i<t.length;){var s=t[i];if("\\"===s){if(i+1===t.length)throw new Po(Oo.INVALID_ARGUMENT,"Path has trailing escape character: "+t);var u=t[i+1];if("\\"!==u&&"."!==u&&"`"!==u)throw new Po(Oo.INVALID_ARGUMENT,"Path has invalid escape sequence: "+t);r+=u,i+=2}else"`"===s?(a=!a,i++):"."!==s||a?(r+=s,i++):(o(),i++)}if(o(),a)throw new Po(Oo.INVALID_ARGUMENT,"Unterminated ` in path: "+t);return new e(n)},e.EMPTY_PATH=new e([]),e}(ga),Ia=function(){function t(e){this.path=e,ko(t.isDocumentKey(e),"Invalid DocumentKey with an odd number of segments: "+e.toArray().join("/"))}return t.prototype.hasCollectionId=function(t){return this.path.length>=2&&this.path.get(this.path.length-2)===t},t.prototype.isEqual=function(t){return null!==t&&0===va.comparator(this.path,t.path)},t.prototype.toString=function(){return this.path.toString()},t.comparator=function(t,e){return va.comparator(t.path,e.path)},t.isDocumentKey=function(t){return t.length%2==0},t.fromSegments=function(e){return new t(new va(e.slice()))},t.fromPathString=function(e){return new t(va.fromString(e))},t.EMPTY=new t(new va([])),t}(),Ea=function(){return function(){var t=this;this.promise=new Promise(function(e,n){t.resolve=e,t.reject=n})}}();!function(t){t.All="all",t.ListenStreamIdle="listen_stream_idle",t.ListenStreamConnectionBackoff="listen_stream_connection_backoff",t.WriteStreamIdle="write_stream_idle",t.WriteStreamConnectionBackoff="write_stream_connection_backoff",t.OnlineStateTimeout="online_state_timeout",t.ClientMetadataRefresh="client_metadata_refresh",t.LruGarbageCollection="lru_garbage_collection",t.RetryTransaction="retry_transaction"}(ha||(ha={}));var Ta=function(){function t(t,e,n,r,i){this.asyncQueue=t,this.timerId=e,this.targetTimeMs=n,this.op=r,this.removalCallback=i,this.deferred=new Ea,this.then=this.deferred.promise.then.bind(this.deferred.promise),this.catch=this.deferred.promise.catch.bind(this.deferred.promise),this.deferred.promise.catch(function(t){})}return t.createAndSchedule=function(e,n,r,i,o){var a=new t(e,n,Date.now()+r,i,o);return a.start(r),a},t.prototype.start=function(t){var e=this;this.timerHandle=setTimeout(function(){return e.handleDelayElapsed()},t)},t.prototype.skipDelay=function(){return this.handleDelayElapsed()},t.prototype.cancel=function(t){null!==this.timerHandle&&(this.clearTimeout(),this.deferred.reject(new Po(Oo.CANCELLED,"Operation cancelled"+(t?": "+t:""))))},t.prototype.handleDelayElapsed=function(){var t=this;this.asyncQueue.enqueueAndForget(function(){return null!==t.timerHandle?(t.clearTimeout(),t.op().then(function(e){return t.deferred.resolve(e)})):Promise.resolve()})},t.prototype.clearTimeout=function(){null!==this.timerHandle&&(this.removalCallback(this),clearTimeout(this.timerHandle),this.timerHandle=null)},t}(),Sa=function(){function t(){this.tail=Promise.resolve(),this._isShuttingDown=!1,this.delayedOperations=[],this.failure=null,this.operationInProgress=!1,this.timerIdsToSkip=[]}return Object.defineProperty(t.prototype,"isShuttingDown",{get:function(){return this._isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.enqueueAndForget=function(t){this.enqueue(t)},t.prototype.enqueueAndForgetEvenAfterShutdown=function(t){this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueEvenAfterShutdown=function(t){return this.verifyNotFailed(),this.enqueueInternal(t)},t.prototype.enqueueAndInitiateShutdown=function(t){return xt(this,void 0,void 0,function(){return qt(this,function(e){switch(e.label){case 0:return this.verifyNotFailed(),this._isShuttingDown?[3,2]:(this._isShuttingDown=!0,[4,this.enqueueEvenAfterShutdown(t)]);case 1:e.sent(),e.label=2;case 2:return[2]}})})},t.prototype.enqueue=function(t){return this.verifyNotFailed(),this._isShuttingDown?new Promise(function(t){}):this.enqueueInternal(t)},t.prototype.enqueueInternal=function(t){var e=this,n=this.tail.then(function(){return e.operationInProgress=!0,t().catch(function(t){e.failure=t,e.operationInProgress=!1;var n=t.stack||t.message||"";throw Co("INTERNAL UNHANDLED ERROR: ",n),n.indexOf("Firestore Test Simulated Error")<0&&setTimeout(function(){throw t},0),t}).then(function(t){return e.operationInProgress=!1,t})});return this.tail=n,n},t.prototype.enqueueAfterDelay=function(t,e,n){var r=this;this.verifyNotFailed(),ko(e>=0,"Attempted to schedule an operation with a negative delay of "+e),this.timerIdsToSkip.indexOf(t)>-1&&(e=0);var i=Ta.createAndSchedule(this,t,e,n,function(t){return r.removeDelayedOperation(t)});return this.delayedOperations.push(i),i},t.prototype.verifyNotFailed=function(){this.failure&&Do("AsyncQueue is already failed: "+(this.failure.stack||this.failure.message))},t.prototype.verifyOperationInProgress=function(){ko(this.operationInProgress,"verifyOpInProgress() called when no op in progress on this queue.")},t.prototype.drain=function(){return this.enqueueEvenAfterShutdown(function(){return Promise.resolve()})},t.prototype.containsDelayedOperation=function(t){for(var e=0,n=this.delayedOperations;e<n.length;e++){if(n[e].timerId===t)return!0}return!1},t.prototype.runDelayedOperationsEarly=function(t){var e=this;return this.drain().then(function(){ko(t===ha.All||e.containsDelayedOperation(t),"Attempted to drain to missing operation "+t),e.delayedOperations.sort(function(t,e){return t.targetTimeMs-e.targetTimeMs});for(var n=0,r=e.delayedOperations;n<r.length;n++){var i=r[n];if(i.skipDelay(),t!==ha.All&&i.timerId===t)break}return e.drain()})},t.prototype.skipDelaysForTimerId=function(t){this.timerIdsToSkip.push(t)},t.prototype.removeDelayedOperation=function(t){var e=this.delayedOperations.indexOf(t);ko(e>=0,"Delayed operation not found."),this.delayedOperations.splice(e,1)},t}(),Na="",Ca="",Aa="",Da="";function ka(t){for(var e="",n=0;n<t.length;n++)e.length>0&&(e=Ra(e)),e=_a(t.get(n),e);return Ra(e)}function _a(t,e){for(var n=e,r=t.length,i=0;i<r;i++){var o=t.charAt(i);switch(o){case"\0":n+=Na+Aa;break;case Na:n+=Na+Da;break;default:n+=o}}return n}function Ra(t){return t+Na+Ca}function Oa(t){var e=t.length;if(ko(e>=2,"Invalid path "+t),2===e)return ko(t.charAt(0)===Na&&t.charAt(1)===Ca,"Non-empty path "+t+" had length 2"),va.EMPTY_PATH;for(var n=e-2,r=[],i="",o=0;o<e;){var a=t.indexOf(Na,o);switch((a<0||a>n)&&Do('Invalid encoded resource path: "'+t+'"'),t.charAt(a+1)){case Ca:var s=t.substring(o,a),u=void 0;0===i.length?u=s:(u=i+=s,i=""),r.push(u);break;case Aa:i+=t.substring(o,a),i+="\0";break;case Da:i+=t.substring(o,a+1);break;default:Do('Invalid encoded resource path: "'+t+'"')}o=a+2}return new va(r)}var Pa=function(){function t(t,e){if(this.seconds=t,this.nanoseconds=e,e<0)throw new Po(Oo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(e>=1e9)throw new Po(Oo.INVALID_ARGUMENT,"Timestamp nanoseconds out of range: "+e);if(t<-62135596800)throw new Po(Oo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t);if(t>=253402300800)throw new Po(Oo.INVALID_ARGUMENT,"Timestamp seconds out of range: "+t)}return t.now=function(){return t.fromMillis(Date.now())},t.fromDate=function(e){return t.fromMillis(e.getTime())},t.fromMillis=function(e){var n=Math.floor(e/1e3);return new t(n,1e6*(e-1e3*n))},t.prototype.toDate=function(){return new Date(this.toMillis())},t.prototype.toMillis=function(){return 1e3*this.seconds+this.nanoseconds/1e6},t.prototype._compareTo=function(t){return this.seconds===t.seconds?oa(this.nanoseconds,t.nanoseconds):oa(this.seconds,t.seconds)},t.prototype.isEqual=function(t){return t.seconds===this.seconds&&t.nanoseconds===this.nanoseconds},t.prototype.toString=function(){return"Timestamp(seconds="+this.seconds+", nanoseconds="+this.nanoseconds+")"},t}(),Ma=function(){function t(t){this.timestamp=t}return t.fromMicroseconds=function(e){var n=Math.floor(e/1e6);return new t(new Pa(n,e%1e6*1e3))},t.fromTimestamp=function(e){return new t(e)},t.forDeletedDoc=function(){return t.MIN},t.prototype.compareTo=function(t){return this.timestamp._compareTo(t.timestamp)},t.prototype.isEqual=function(t){return this.timestamp.isEqual(t.timestamp)},t.prototype.toMicroseconds=function(){return 1e6*this.timestamp.seconds+this.timestamp.nanoseconds/1e3},t.prototype.toString=function(){return"SnapshotVersion("+this.timestamp.toString()+")"},t.prototype.toTimestamp=function(){return this.timestamp},t.MIN=new t(new Pa(0,0)),t}(),La=function(){function t(t,e){this.comparator=t,this.root=e||qa.EMPTY}return t.prototype.insert=function(e,n){return new t(this.comparator,this.root.insert(e,n,this.comparator).copy(null,null,qa.BLACK,null,null))},t.prototype.remove=function(e){return new t(this.comparator,this.root.remove(e,this.comparator).copy(null,null,qa.BLACK,null,null))},t.prototype.get=function(t){for(var e=this.root;!e.isEmpty();){var n=this.comparator(t,e.key);if(0===n)return e.value;n<0?e=e.left:n>0&&(e=e.right)}return null},t.prototype.indexOf=function(t){for(var e=0,n=this.root;!n.isEmpty();){var r=this.comparator(t,n.key);if(0===r)return e+n.left.size;r<0?n=n.left:(e+=n.left.size+1,n=n.right)}return-1},t.prototype.isEmpty=function(){return this.root.isEmpty()},Object.defineProperty(t.prototype,"size",{get:function(){return this.root.size},enumerable:!0,configurable:!0}),t.prototype.minKey=function(){return this.root.minKey()},t.prototype.maxKey=function(){return this.root.maxKey()},t.prototype.inorderTraversal=function(t){return this.root.inorderTraversal(t)},t.prototype.forEach=function(t){this.inorderTraversal(function(e,n){return t(e,n),!1})},t.prototype.toString=function(){var t=[];return this.inorderTraversal(function(e,n){return t.push(e+":"+n),!1}),"{"+t.join(", ")+"}"},t.prototype.reverseTraversal=function(t){return this.root.reverseTraversal(t)},t.prototype.getIterator=function(){return new xa(this.root,null,this.comparator,!1)},t.prototype.getIteratorFrom=function(t){return new xa(this.root,t,this.comparator,!1)},t.prototype.getReverseIterator=function(){return new xa(this.root,null,this.comparator,!0)},t.prototype.getReverseIteratorFrom=function(t){return new xa(this.root,t,this.comparator,!0)},t}(),xa=function(){function t(t,e,n,r){this.isReverse=r,this.nodeStack=[];for(var i=1;!t.isEmpty();)if(i=e?n(t.key,e):1,r&&(i*=-1),i<0)t=this.isReverse?t.left:t.right;else{if(0===i){this.nodeStack.push(t);break}this.nodeStack.push(t),t=this.isReverse?t.right:t.left}}return t.prototype.getNext=function(){ko(this.nodeStack.length>0,"getNext() called on iterator when hasNext() is false.");var t=this.nodeStack.pop(),e={key:t.key,value:t.value};if(this.isReverse)for(t=t.left;!t.isEmpty();)this.nodeStack.push(t),t=t.right;else for(t=t.right;!t.isEmpty();)this.nodeStack.push(t),t=t.left;return e},t.prototype.hasNext=function(){return this.nodeStack.length>0},t.prototype.peek=function(){if(0===this.nodeStack.length)return null;var t=this.nodeStack[this.nodeStack.length-1];return{key:t.key,value:t.value}},t}(),qa=function(){function t(e,n,r,i,o){this.key=e,this.value=n,this.color=null!=r?r:t.RED,this.left=null!=i?i:t.EMPTY,this.right=null!=o?o:t.EMPTY,this.size=this.left.size+1+this.right.size}return t.prototype.copy=function(e,n,r,i,o){return new t(null!=e?e:this.key,null!=n?n:this.value,null!=r?r:this.color,null!=i?i:this.left,null!=o?o:this.right)},t.prototype.isEmpty=function(){return!1},t.prototype.inorderTraversal=function(t){return this.left.inorderTraversal(t)||t(this.key,this.value)||this.right.inorderTraversal(t)},t.prototype.reverseTraversal=function(t){return this.right.reverseTraversal(t)||t(this.key,this.value)||this.left.reverseTraversal(t)},t.prototype.min=function(){return this.left.isEmpty()?this:this.left.min()},t.prototype.minKey=function(){return this.min().key},t.prototype.maxKey=function(){return this.right.isEmpty()?this.key:this.right.maxKey()},t.prototype.insert=function(t,e,n){var r=this,i=n(t,r.key);return(r=i<0?r.copy(null,null,null,r.left.insert(t,e,n),null):0===i?r.copy(null,e,null,null,null):r.copy(null,null,null,null,r.right.insert(t,e,n))).fixUp()},t.prototype.removeMin=function(){if(this.left.isEmpty())return t.EMPTY;var e=this;return e.left.isRed()||e.left.left.isRed()||(e=e.moveRedLeft()),(e=e.copy(null,null,null,e.left.removeMin(),null)).fixUp()},t.prototype.remove=function(e,n){var r,i=this;if(n(e,i.key)<0)i.left.isEmpty()||i.left.isRed()||i.left.left.isRed()||(i=i.moveRedLeft()),i=i.copy(null,null,null,i.left.remove(e,n),null);else{if(i.left.isRed()&&(i=i.rotateRight()),i.right.isEmpty()||i.right.isRed()||i.right.left.isRed()||(i=i.moveRedRight()),0===n(e,i.key)){if(i.right.isEmpty())return t.EMPTY;r=i.right.min(),i=i.copy(r.key,r.value,null,null,i.right.removeMin())}i=i.copy(null,null,null,null,i.right.remove(e,n))}return i.fixUp()},t.prototype.isRed=function(){return this.color},t.prototype.fixUp=function(){var t=this;return t.right.isRed()&&!t.left.isRed()&&(t=t.rotateLeft()),t.left.isRed()&&t.left.left.isRed()&&(t=t.rotateRight()),t.left.isRed()&&t.right.isRed()&&(t=t.colorFlip()),t},t.prototype.moveRedLeft=function(){var t=this.colorFlip();return t.right.left.isRed()&&(t=(t=(t=t.copy(null,null,null,null,t.right.rotateRight())).rotateLeft()).colorFlip()),t},t.prototype.moveRedRight=function(){var t=this.colorFlip();return t.left.left.isRed()&&(t=(t=t.rotateRight()).colorFlip()),t},t.prototype.rotateLeft=function(){var e=this.copy(null,null,t.RED,null,this.right.left);return this.right.copy(null,null,this.color,e,null)},t.prototype.rotateRight=function(){var e=this.copy(null,null,t.RED,this.left.right,null);return this.left.copy(null,null,this.color,null,e)},t.prototype.colorFlip=function(){var t=this.left.copy(null,null,!this.left.color,null,null),e=this.right.copy(null,null,!this.right.color,null,null);return this.copy(null,null,!this.color,t,e)},t.prototype.checkMaxDepth=function(){var t=this.check();return Math.pow(2,t)<=this.size+1},t.prototype.check=function(){if(this.isRed()&&this.left.isRed())throw Do("Red node has red child("+this.key+","+this.value+")");if(this.right.isRed())throw Do("Right child of ("+this.key+","+this.value+") is red");var t=this.left.check();if(t!==this.right.check())throw Do("Black depths differ");return t+(this.isRed()?0:1)},t.EMPTY=null,t.RED=!0,t.BLACK=!1,t}(),Fa=function(){function t(){this.size=0}return Object.defineProperty(t.prototype,"key",{get:function(){throw Do("LLRBEmptyNode has no key.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"value",{get:function(){throw Do("LLRBEmptyNode has no value.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"color",{get:function(){throw Do("LLRBEmptyNode has no color.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"left",{get:function(){throw Do("LLRBEmptyNode has no left child.")},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"right",{get:function(){throw Do("LLRBEmptyNode has no right child.")},enumerable:!0,configurable:!0}),t.prototype.copy=function(t,e,n,r,i){return this},t.prototype.insert=function(t,e,n){return new qa(t,e)},t.prototype.remove=function(t,e){return this},t.prototype.isEmpty=function(){return!0},t.prototype.inorderTraversal=function(t){return!1},t.prototype.reverseTraversal=function(t){return!1},t.prototype.minKey=function(){return null},t.prototype.maxKey=function(){return null},t.prototype.isRed=function(){return!1},t.prototype.checkMaxDepth=function(){return!0},t.prototype.check=function(){return 0},t}();qa.EMPTY=new Fa;var Ua=function(){function t(t){this.comparator=t,this.data=new La(this.comparator)}return t.fromMapKeys=function(e){var n=new t(e.comparator);return e.forEach(function(t){n=n.add(t)}),n},t.prototype.has=function(t){return null!==this.data.get(t)},t.prototype.first=function(){return this.data.minKey()},t.prototype.last=function(){return this.data.maxKey()},Object.defineProperty(t.prototype,"size",{get:function(){return this.data.size},enumerable:!0,configurable:!0}),t.prototype.indexOf=function(t){return this.data.indexOf(t)},t.prototype.forEach=function(t){this.data.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.forEachInRange=function(t,e){for(var n=this.data.getIteratorFrom(t[0]);n.hasNext();){var r=n.getNext();if(this.comparator(r.key,t[1])>=0)return;e(r.key)}},t.prototype.forEachWhile=function(t,e){var n;for(n=void 0!==e?this.data.getIteratorFrom(e):this.data.getIterator();n.hasNext();){if(!t(n.getNext().key))return}},t.prototype.firstAfterOrEqual=function(t){var e=this.data.getIteratorFrom(t);return e.hasNext()?e.getNext().key:null},t.prototype.getIterator=function(){return new Va(this.data.getIterator())},t.prototype.getIteratorFrom=function(t){return new Va(this.data.getIteratorFrom(t))},t.prototype.add=function(t){return this.copy(this.data.remove(t).insert(t,!0))},t.prototype.delete=function(t){return this.has(t)?this.copy(this.data.remove(t)):this},t.prototype.isEmpty=function(){return this.data.isEmpty()},t.prototype.unionWith=function(t){var e=this;return t.forEach(function(t){e=e.add(t)}),e},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.data.getIterator(),r=e.data.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(0!==this.comparator(i,o))return!1}return!0},t.prototype.toArray=function(){var t=[];return this.forEach(function(e){t.push(e)}),t},t.prototype.toString=function(){var t=[];return this.forEach(function(e){return t.push(e)}),"SortedSet("+t.toString()+")"},t.prototype.copy=function(e){var n=new t(this.comparator);return n.data=e,n},t}(),Va=function(){function t(t){this.iter=t}return t.prototype.getNext=function(){return this.iter.getNext().key},t.prototype.hasNext=function(){return this.iter.hasNext()},t}(),Ba=new La(Ia.comparator);function ja(){return Ba}function Ka(){return ja()}var $a=new La(Ia.comparator);function Qa(){return $a}var Wa=new La(Ia.comparator);function Ga(){return Wa}var za=new Ua(Ia.comparator);function Ha(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];for(var n=za,r=0,i=t;r<i.length;r++){var o=i[r];n=n.add(o)}return n}var Ya=new Ua(oa);function Xa(){return Ya}var Ja=function(){function t(t,e,n,r){this.batchId=t,this.localWriteTime=e,this.baseMutations=n,this.mutations=r,ko(r.length>0,"Cannot create an empty mutation batch")}return t.prototype.applyToRemoteDocument=function(t,e,n){e&&ko(e.key.isEqual(t),"applyToRemoteDocument: key "+t+" should match maybeDoc key\n        "+e.key);var r=n.mutationResults;ko(r.length===this.mutations.length,"Mismatch between mutations length\n      ("+this.mutations.length+") and mutation results length\n      ("+r.length+").");for(var i=0;i<this.mutations.length;i++){var o=this.mutations[i];if(o.key.isEqual(t)){var a=r[i];e=o.applyToRemoteDocument(e,a)}}return e},t.prototype.applyToLocalView=function(t,e){e&&ko(e.key.isEqual(t),"applyToLocalDocument: key "+t+" should match maybeDoc key\n        "+e.key);for(var n=0,r=this.baseMutations;n<r.length;n++){(s=r[n]).key.isEqual(t)&&(e=s.applyToLocalView(e,e,this.localWriteTime))}for(var i=e,o=0,a=this.mutations;o<a.length;o++){var s;(s=a[o]).key.isEqual(t)&&(e=s.applyToLocalView(e,i,this.localWriteTime))}return e},t.prototype.applyToLocalDocumentSet=function(t){var e=this,n=t;return this.mutations.forEach(function(r){var i=e.applyToLocalView(r.key,t.get(r.key));i&&(n=n.insert(r.key,i))}),n},t.prototype.keys=function(){return this.mutations.reduce(function(t,e){return t.add(e.key)},Ha())},t.prototype.isEqual=function(t){return this.batchId===t.batchId&&aa(this.mutations,t.mutations)&&aa(this.baseMutations,t.baseMutations)},t}(),Za=function(){function t(t,e,n,r,i){this.batch=t,this.commitVersion=e,this.mutationResults=n,this.streamToken=r,this.docVersions=i}return t.from=function(e,n,r,i){ko(e.mutations.length===r.length,"Mutations sent "+e.mutations.length+" must equal results received "+r.length);for(var o=Ga(),a=e.mutations,s=0;s<a.length;s++)o=o.insert(a[s].key,r[s].version);return new t(e,n,r,i,o)},t}(),ts=function(){function t(t){var e=this;this.nextCallback=null,this.catchCallback=null,this.result=void 0,this.error=void 0,this.isDone=!1,this.callbackAttached=!1,t(function(t){e.isDone=!0,e.result=t,e.nextCallback&&e.nextCallback(t)},function(t){e.isDone=!0,e.error=t,e.catchCallback&&e.catchCallback(t)})}return t.prototype.catch=function(t){return this.next(void 0,t)},t.prototype.next=function(e,n){var r=this;return this.callbackAttached&&Do("Called next() or catch() twice for PersistencePromise"),this.callbackAttached=!0,this.isDone?this.error?this.wrapFailure(n,this.error):this.wrapSuccess(e,this.result):new t(function(t,i){r.nextCallback=function(n){r.wrapSuccess(e,n).next(t,i)},r.catchCallback=function(e){r.wrapFailure(n,e).next(t,i)}})},t.prototype.toPromise=function(){var t=this;return new Promise(function(e,n){t.next(e,n)})},t.prototype.wrapUserFunction=function(e){try{var n=e();return n instanceof t?n:t.resolve(n)}catch(e){return t.reject(e)}},t.prototype.wrapSuccess=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.resolve(n)},t.prototype.wrapFailure=function(e,n){return e?this.wrapUserFunction(function(){return e(n)}):t.reject(n)},t.resolve=function(e){return new t(function(t,n){t(e)})},t.reject=function(e){return new t(function(t,n){n(e)})},t.waitFor=function(e){return new t(function(t,n){var r=0,i=0,o=!1;e.forEach(function(e){++r,e.next(function(){++i,o&&i===r&&t()},function(t){return n(t)})}),o=!0,i===r&&t()})},t.or=function(e){for(var n=t.resolve(!1),r=function(e){n=n.next(function(n){return n?t.resolve(n):e()})},i=0,o=e;i<o.length;i++){r(o[i])}return n},t.forEach=function(t,e){var n=this,r=[];return t.forEach(function(t,i){r.push(e.call(n,t,i))}),this.waitFor(r)},t}(),es=function(){function t(t,e,n,r){this.userId=t,this.serializer=e,this.indexManager=n,this.referenceDelegate=r,this.documentKeysByBatchId={}}return t.forUser=function(e,n,r,i){return ko(""!==e.uid,"UserID must not be an empty string."),new t(e.isAuthenticated()?e.uid:"",n,r,i)},t.prototype.checkEmpty=function(t){var e=!0,n=IDBKeyRange.bound([this.userId,Number.NEGATIVE_INFINITY],[this.userId,Number.POSITIVE_INFINITY]);return os(t).iterate({index:vu.userMutationsIndex,range:n},function(t,n,r){e=!1,r.done()}).next(function(){return e})},t.prototype.acknowledgeBatch=function(t,e,n){return this.getMutationQueueMetadata(t).next(function(e){return e.lastStreamToken=is(n),ss(t).put(e)})},t.prototype.getLastStreamToken=function(t){return this.getMutationQueueMetadata(t).next(function(t){return t.lastStreamToken})},t.prototype.setLastStreamToken=function(t,e){return this.getMutationQueueMetadata(t).next(function(n){return n.lastStreamToken=is(e),ss(t).put(n)})},t.prototype.addMutationBatch=function(t,e,n,r){var i=this,o=as(t),a=os(t);return a.add({}).next(function(s){ko("number"==typeof s,"Auto-generated key is not a number");var u=new Ja(s,e,n,r),c=i.serializer.toDbMutationBatch(i.userId,u);i.documentKeysByBatchId[s]=u.keys();for(var h=[],l=0,f=r;l<f.length;l++){var p=f[l],d=bu.key(i.userId,p.key.path,s);h.push(a.put(c)),h.push(o.put(d,bu.PLACEHOLDER)),h.push(i.indexManager.addToCollectionParentIndex(t,p.key.path.popLast()))}return ts.waitFor(h).next(function(){return u})})},t.prototype.lookupMutationBatch=function(t,e){var n=this;return os(t).get(e).next(function(t){return t?(ko(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),n.serializer.fromDbMutationBatch(t)):null})},t.prototype.lookupMutationKeys=function(t,e){var n=this;return this.documentKeysByBatchId[e]?ts.resolve(this.documentKeysByBatchId[e]):this.lookupMutationBatch(t,e).next(function(t){if(t){var r=t.keys();return n.documentKeysByBatchId[e]=r,r}return null})},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=this,r=e+1,i=IDBKeyRange.lowerBound([this.userId,r]),o=null;return os(t).iterate({index:vu.userMutationsIndex,range:i},function(t,e,i){e.userId===n.userId&&(ko(e.batchId>=r,"Should have found mutation after "+r),o=n.serializer.fromDbMutationBatch(e)),i.done()}).next(function(){return o})},t.prototype.getHighestUnacknowledgedBatchId=function(t){var e=IDBKeyRange.upperBound([this.userId,Number.POSITIVE_INFINITY]),n=-1;return os(t).iterate({index:vu.userMutationsIndex,range:e,reverse:!0},function(t,e,r){n=e.batchId,r.done()}).next(function(){return n})},t.prototype.getAllMutationBatches=function(t){var e=this,n=IDBKeyRange.bound([this.userId,-1],[this.userId,Number.POSITIVE_INFINITY]);return os(t).loadAll(vu.userMutationsIndex,n).next(function(t){return t.map(function(t){return e.serializer.fromDbMutationBatch(t)})})},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=bu.prefixForPath(this.userId,e.path),i=IDBKeyRange.lowerBound(r),o=[];return as(t).iterate({range:i},function(r,i,a){var s=r[0],u=r[1],c=r[2],h=Oa(u);if(s===n.userId&&e.path.isEqual(h))return os(t).get(c).next(function(t){if(!t)throw Do("Dangling document-mutation reference found: "+r+" which points to "+c);ko(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+c),o.push(n.serializer.fromDbMutationBatch(t))});a.done()}).next(function(){return o})},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ua(oa),i=[];return e.forEach(function(e){var o=bu.prefixForPath(n.userId,e.path),a=IDBKeyRange.lowerBound(o),s=as(t).iterate({range:a},function(t,i,o){var a=t[0],s=t[1],u=t[2],c=Oa(s);a===n.userId&&e.path.isEqual(c)?r=r.add(u):o.done()});i.push(s)}),ts.waitFor(i).next(function(){return n.lookupMutationBatches(t,r)})},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){var n=this;ko(!e.isDocumentQuery(),"Document queries shouldn't go down this path"),ko(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=e.path,i=r.length+1,o=bu.prefixForPath(this.userId,r),a=IDBKeyRange.lowerBound(o),s=new Ua(oa);return as(t).iterate({range:a},function(t,e,o){var a=t[0],u=t[1],c=t[2],h=Oa(u);a===n.userId&&r.isPrefixOf(h)?h.length===i&&(s=s.add(c)):o.done()}).next(function(){return n.lookupMutationBatches(t,s)})},t.prototype.lookupMutationBatches=function(t,e){var n=this,r=[],i=[];return e.forEach(function(e){i.push(os(t).get(e).next(function(t){if(null===t)throw Do("Dangling document-mutation reference found, which points to "+e);ko(t.userId===n.userId,"Unexpected user '"+t.userId+"' for mutation batch "+e),r.push(n.serializer.fromDbMutationBatch(t))}))}),ts.waitFor(i).next(function(){return r})},t.prototype.removeMutationBatch=function(t,e){var n=this;return rs(t.simpleDbTransaction,this.userId,e).next(function(r){return n.removeCachedMutationKeys(e.batchId),ts.forEach(r,function(e){return n.referenceDelegate.removeMutationReference(t,e)})})},t.prototype.removeCachedMutationKeys=function(t){delete this.documentKeysByBatchId[t]},t.prototype.performConsistencyCheck=function(t){var e=this;return this.checkEmpty(t).next(function(n){if(!n)return ts.resolve();var r=IDBKeyRange.lowerBound(bu.prefixForUser(e.userId)),i=[];return as(t).iterate({range:r},function(t,n,r){if(t[0]===e.userId){var o=Oa(t[1]);i.push(o)}else r.done()}).next(function(){ko(0===i.length,"Document leak -- detected dangling mutation references when queue is empty. Dangling keys: "+i.map(function(t){return t.canonicalString()}))})})},t.prototype.containsKey=function(t,e){return ns(t,this.userId,e)},t.prototype.getMutationQueueMetadata=function(t){var e=this;return ss(t).get(this.userId).next(function(t){return t||new gu(e.userId,-1,"")})},t}();function ns(t,e,n){var r=bu.prefixForPath(e,n.path),i=r[1],o=IDBKeyRange.lowerBound(r),a=!1;return as(t).iterate({range:o,keysOnly:!0},function(t,n,r){var o=t[0],s=t[1];t[2];o===e&&s===i&&(a=!0),r.done()}).next(function(){return a})}function rs(t,e,n){var r=t.store(vu.store),i=t.store(bu.store),o=[],a=IDBKeyRange.only(n.batchId),s=0,u=r.iterate({range:a},function(t,e,n){return s++,n.delete()});o.push(u.next(function(){ko(1===s,"Dangling document-mutation reference found: Missing batch "+n.batchId)}));for(var c=[],h=0,l=n.mutations;h<l.length;h++){var f=l[h],p=bu.key(e,f.key.path,n.batchId);o.push(i.delete(p)),c.push(f.key)}return ts.waitFor(o).next(function(){return c})}function is(t){return t instanceof Uint8Array?(ko("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence."),t.toString()):t}function os(t){return zu.getStore(t,vu.store)}function as(t){return zu.getStore(t,bu.store)}function ss(t){return zu.getStore(t,gu.store)}var us,cs=1;!function(t){t[t.QueryCache=0]="QueryCache",t[t.SyncEngine=1]="SyncEngine"}(us||(us={}));var hs=function(){function t(t,e){this.generatorId=t,ko((t&cs)===t,"Generator ID "+t+" contains more than "+cs+" reserved bits"),this.seek(void 0!==e?e:this.generatorId)}return t.prototype.next=function(){var t=this.nextId;return this.nextId+=1<<cs,t},t.prototype.after=function(t){return this.seek(t+(1<<cs)),this.next()},t.prototype.seek=function(t){ko((t&cs)===this.generatorId,"Cannot supply target ID from different generator ID"),this.nextId=t},t.forQueryCache=function(){return new t(us.QueryCache,2)},t.forSyncEngine=function(){return new t(us.SyncEngine)},t}(),ls="SimpleDb",fs=function(){function t(e){this.db=e,12.2===t.getIOSVersion(Ut())&&Co("Firestore persistence suffers from a bug in iOS 12.2 Safari that may cause your app to stop working. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.")}return t.openOrCreate=function(e,n,r){return ko(t.isAvailable(),"IndexedDB not supported in current environment."),No(ls,"Opening database:",e),new ts(function(i,o){var a=window.indexedDB.open(e,n);a.onsuccess=function(e){var n=e.target.result;i(new t(n))},a.onblocked=function(){o(new Po(Oo.FAILED_PRECONDITION,"Cannot upgrade IndexedDB schema while another tab is open. Close all tabs that access Firestore and reload this page to proceed."))},a.onerror=function(t){var e=t.target.error;"VersionError"===e.name?o(new Po(Oo.FAILED_PRECONDITION,"A newer version of the Firestore SDK was previously used and so the persisted data is not compatible with the version of the SDK you are now using. The SDK will operate with persistence disabled. If you need persistence, please re-upgrade to a newer version of the SDK or else clear the persisted IndexedDB data for your app to start fresh.")):o(e)},a.onupgradeneeded=function(t){No(ls,'Database "'+e+'" requires upgrade from version:',t.oldVersion);var n=t.target.result,i=new ds(a.transaction);r.createOrUpgrade(n,i,t.oldVersion,pu).next(function(){No(ls,"Database upgrade to version "+pu+" complete")})}}).toPromise()},t.delete=function(t){return No(ls,"Removing database:",t),ys(window.indexedDB.deleteDatabase(t)).toPromise()},t.isAvailable=function(){if("undefined"==typeof window||null==window.indexedDB)return!1;if(void 0===window.navigator)return"YES"===process.env.USE_MOCK_PERSISTENCE;var e=Ut(),n=t.getIOSVersion(e),r=0<n&&n<10,i=t.getAndroidVersion(e),o=0<i&&i<4.5;return!(e.indexOf("MSIE ")>0||e.indexOf("Trident/")>0||e.indexOf("Edge/")>0||r||o)},t.getStore=function(t,e){return t.store(e)},t.getIOSVersion=function(t){var e=t.match(/i(?:phone|pad|pod) os ([\d_]+)/i),n=e?e[1].split("_").slice(0,2).join("."):"-1";return Number(n)},t.getAndroidVersion=function(t){var e=t.match(/Android ([\d.]+)/i),n=e?e[1].split(".").slice(0,2).join("."):"-1";return Number(n)},t.prototype.setVersionChangeListener=function(t){this.db.onversionchange=function(e){return t(e)}},t.prototype.runTransaction=function(t,e,n){var r=ds.open(this.db,t,e),i=n(r).catch(function(t){return r.abort(t),ts.reject(t)}).toPromise();return i.catch(function(){}),r.completionPromise.then(function(){return i})},t.prototype.close=function(){this.db.close()},t}(),ps=function(){function t(t){this.dbCursor=t,this.shouldStop=!1,this.nextKey=null}return Object.defineProperty(t.prototype,"isDone",{get:function(){return this.shouldStop},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"skipToKey",{get:function(){return this.nextKey},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"cursor",{set:function(t){this.dbCursor=t},enumerable:!0,configurable:!0}),t.prototype.done=function(){this.shouldStop=!0},t.prototype.skip=function(t){this.nextKey=t},t.prototype.delete=function(){return ys(this.dbCursor.delete())},t}(),ds=function(){function t(t){var e=this;this.transaction=t,this.aborted=!1,this.completionDeferred=new Ea,this.transaction.oncomplete=function(){e.completionDeferred.resolve()},this.transaction.onabort=function(){t.error?e.completionDeferred.reject(t.error):e.completionDeferred.resolve()},this.transaction.onerror=function(t){var n=vs(t.target.error);e.completionDeferred.reject(n)}}return t.open=function(e,n,r){return new t(e.transaction(r,n))},Object.defineProperty(t.prototype,"completionPromise",{get:function(){return this.completionDeferred.promise},enumerable:!0,configurable:!0}),t.prototype.abort=function(t){t&&this.completionDeferred.reject(t),this.aborted||(No(ls,"Aborting transaction:",t?t.message:"Client-initiated abort"),this.aborted=!0,this.transaction.abort())},t.prototype.store=function(t){var e=this.transaction.objectStore(t);return ko(!!e,"Object store not part of transaction: "+t),new ms(e)},t}(),ms=function(){function t(t){this.store=t}return t.prototype.put=function(t,e){var n;return void 0!==e?(No(ls,"PUT",this.store.name,t,e),n=this.store.put(e,t)):(No(ls,"PUT",this.store.name,"<auto-key>",t),n=this.store.put(t)),ys(n)},t.prototype.add=function(t){return No(ls,"ADD",this.store.name,t,t),ys(this.store.add(t))},t.prototype.get=function(t){var e=this;return ys(this.store.get(t)).next(function(n){return void 0===n&&(n=null),No(ls,"GET",e.store.name,t,n),n})},t.prototype.delete=function(t){return No(ls,"DELETE",this.store.name,t),ys(this.store.delete(t))},t.prototype.count=function(){return No(ls,"COUNT",this.store.name),ys(this.store.count())},t.prototype.loadAll=function(t,e){var n=this.cursor(this.options(t,e)),r=[];return this.iterateCursor(n,function(t,e){r.push(e)}).next(function(){return r})},t.prototype.deleteAll=function(t,e){No(ls,"DELETE ALL",this.store.name);var n=this.options(t,e);n.keysOnly=!1;var r=this.cursor(n);return this.iterateCursor(r,function(t,e,n){return n.delete()})},t.prototype.iterate=function(t,e){var n;e?n=t:(n={},e=t);var r=this.cursor(n);return this.iterateCursor(r,e)},t.prototype.iterateSerial=function(t){var e=this.cursor({});return new ts(function(n,r){e.onerror=function(t){var e=vs(t.target.error);r(e)},e.onsuccess=function(e){var r=e.target.result;r?t(r.primaryKey,r.value).next(function(t){t?r.continue():n()}):n()}})},t.prototype.iterateCursor=function(t,e){var n=[];return new ts(function(r,i){t.onerror=function(t){i(t.target.error)},t.onsuccess=function(t){var i=t.target.result;if(i){var o=new ps(i),a=e(i.primaryKey,i.value,o);if(a instanceof ts){var s=a.catch(function(t){return o.done(),ts.reject(t)});n.push(s)}o.isDone?r():null===o.skipToKey?i.continue():i.continue(o.skipToKey)}else r()}}).next(function(){return ts.waitFor(n)})},t.prototype.options=function(t,e){var n=void 0;return void 0!==t&&("string"==typeof t?n=t:(ko(void 0===e,"3rd argument must not be defined if 2nd is a range."),e=t)),{index:n,range:e}},t.prototype.cursor=function(t){var e="next";if(t.reverse&&(e="prev"),t.index){var n=this.store.index(t.index);return t.keysOnly?n.openKeyCursor(t.range,e):n.openCursor(t.range,e)}return this.store.openCursor(t.range,e)},t}();function ys(t){return new ts(function(e,n){t.onsuccess=function(t){var n=t.target.result;e(n)},t.onerror=function(t){var e=vs(t.target.error);n(e)}})}var gs=!1;function vs(t){var e=fs.getIOSVersion(Ut());if(e>=12.2&&e<13){var n="An internal error was encountered in the Indexed Database server";if(t.message.indexOf(n)>=0){var r=new Po("internal","IOS_INDEXEDDB_BUG1: IndexedDb has thrown '"+n+"'. This is likely due to an unavoidable bug in iOS. See https://stackoverflow.com/q/56496296/110915 for details and a potential workaround.");return gs||(gs=!0,setTimeout(function(){throw r},0)),r}}return t}var bs=function(){function t(t,e){this.referenceDelegate=t,this.serializer=e,this.targetIdGenerator=hs.forQueryCache()}return t.prototype.allocateTargetId=function(t){var e=this;return this.retrieveMetadata(t).next(function(n){return n.highestTargetId=e.targetIdGenerator.after(n.highestTargetId),e.saveMetadata(t,n).next(function(){return n.highestTargetId})})},t.prototype.getLastRemoteSnapshotVersion=function(t){return this.retrieveMetadata(t).next(function(t){return Ma.fromTimestamp(new Pa(t.lastRemoteSnapshotVersion.seconds,t.lastRemoteSnapshotVersion.nanoseconds))})},t.prototype.getHighestSequenceNumber=function(t){return Es(t.simpleDbTransaction)},t.prototype.setTargetsMetadata=function(t,e,n){var r=this;return this.retrieveMetadata(t).next(function(i){return i.highestListenSequenceNumber=e,n&&(i.lastRemoteSnapshotVersion=n.toTimestamp()),e>i.highestListenSequenceNumber&&(i.highestListenSequenceNumber=e),r.saveMetadata(t,i)})},t.prototype.addQueryData=function(t,e){var n=this;return this.saveQueryData(t,e).next(function(){return n.retrieveMetadata(t).next(function(r){return r.targetCount+=1,n.updateMetadataFromQueryData(e,r),n.saveMetadata(t,r)})})},t.prototype.updateQueryData=function(t,e){return this.saveQueryData(t,e)},t.prototype.removeQueryData=function(t,e){var n=this;return this.removeMatchingKeysForTargetId(t,e.targetId).next(function(){return ws(t).delete(e.targetId)}).next(function(){return n.retrieveMetadata(t)}).next(function(e){return ko(e.targetCount>0,"Removing from an empty query cache"),e.targetCount-=1,n.saveMetadata(t,e)})},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return ws(t).iterate(function(a,s){var u=r.serializer.fromDbTarget(s);u.sequenceNumber<=e&&void 0===n[u.targetId]&&(i++,o.push(r.removeQueryData(t,u)))}).next(function(){return ts.waitFor(o)}).next(function(){return i})},t.prototype.forEachTarget=function(t,e){var n=this;return ws(t).iterate(function(t,r){var i=n.serializer.fromDbTarget(r);e(i)})},t.prototype.retrieveMetadata=function(t){return Is(t.simpleDbTransaction)},t.prototype.saveMetadata=function(t,e){return(n=t,zu.getStore(n,Cu.store)).put(Cu.key,e);var n},t.prototype.saveQueryData=function(t,e){return ws(t).put(this.serializer.toDbTarget(e))},t.prototype.updateMetadataFromQueryData=function(t,e){var n=!1;return t.targetId>e.highestTargetId&&(e.highestTargetId=t.targetId,n=!0),t.sequenceNumber>e.highestListenSequenceNumber&&(e.highestListenSequenceNumber=t.sequenceNumber,n=!0),n},t.prototype.getQueryCount=function(t){return this.retrieveMetadata(t).next(function(t){return t.targetCount})},t.prototype.getQueryData=function(t,e){var n=this,r=e.canonicalId(),i=IDBKeyRange.bound([r,Number.NEGATIVE_INFINITY],[r,Number.POSITIVE_INFINITY]),o=null;return ws(t).iterate({range:i,index:Su.queryTargetsIndexName},function(t,r,i){var a=n.serializer.fromDbTarget(r);e.isEqual(a.query)&&(o=a,i.done())}).next(function(){return o})},t.prototype.addMatchingKeys=function(t,e,n){var r=this,i=[],o=Ts(t);return e.forEach(function(e){var a=ka(e.path);i.push(o.put(new Nu(n,a))),i.push(r.referenceDelegate.addReference(t,e))}),ts.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){var r=this,i=Ts(t);return ts.forEach(e,function(e){var o=ka(e.path);return ts.waitFor([i.delete([n,o]),r.referenceDelegate.removeReference(t,e)])})},t.prototype.removeMatchingKeysForTargetId=function(t,e){var n=Ts(t),r=IDBKeyRange.bound([e],[e+1],!1,!0);return n.delete(r)},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=IDBKeyRange.bound([e],[e+1],!1,!0),r=Ts(t),i=Ha();return r.iterate({range:n,keysOnly:!0},function(t,e,n){var r=Oa(t[1]),o=new Ia(r);i=i.add(o)}).next(function(){return i})},t.prototype.containsKey=function(t,e){var n=ka(e.path),r=IDBKeyRange.bound([n],[sa(n)],!1,!0),i=0;return Ts(t).iterate({index:Nu.documentTargetsIndex,keysOnly:!0,range:r},function(t,e,n){var r=t[0];t[1];0!==r&&(i++,n.done())}).next(function(){return i>0})},t.prototype.getQueryDataForTarget=function(t,e){var n=this;return ws(t).get(e).next(function(t){return t?n.serializer.fromDbTarget(t):null})},t}();function ws(t){return zu.getStore(t,Su.store)}function Is(t){return fs.getStore(t,Cu.store).get(Cu.key).next(function(t){return ko(null!==t,"Missing metadata row."),t})}function Es(t){return Is(t).next(function(t){return t.highestListenSequenceNumber})}function Ts(t){return zu.getStore(t,Nu.store)}var Ss,Ns=function(){function t(t){this.fields=t}return t.fromSet=function(e){return new t(e)},t.fromArray=function(e){var n=new Ua(wa.comparator);return e.forEach(function(t){return n=n.add(t)}),new t(n)},t.prototype.covers=function(t){var e=!1;return this.fields.forEach(function(n){n.isPrefixOf(t)&&(e=!0)}),e},t.prototype.isEqual=function(t){return this.fields.isEqual(t.fields)},t}(),Cs=function(){function t(t,e){this.field=t,this.transform=e}return t.prototype.isEqual=function(t){return this.field.isEqual(t.field)&&this.transform.isEqual(t.transform)},t}(),As=function(){return function(t,e){this.version=t,this.transformResults=e}}();!function(t){t[t.Set=0]="Set",t[t.Patch=1]="Patch",t[t.Transform=2]="Transform",t[t.Delete=3]="Delete"}(Ss||(Ss={}));var Ds,ks,_s=function(){function t(t,e){this.updateTime=t,this.exists=e,ko(void 0===t||void 0===e,'Precondition can specify "exists" or "updateTime" but not both')}return t.exists=function(e){return new t(void 0,e)},t.updateTime=function(e){return new t(e)},Object.defineProperty(t.prototype,"isNone",{get:function(){return void 0===this.updateTime&&void 0===this.exists},enumerable:!0,configurable:!0}),t.prototype.isValidFor=function(t){return void 0!==this.updateTime?t instanceof Zs&&t.version.isEqual(this.updateTime):void 0!==this.exists?this.exists===t instanceof Zs:(ko(this.isNone,"Precondition should be empty"),!0)},t.prototype.isEqual=function(t){return e=this.updateTime,n=t.updateTime,(null!=e?!(!n||!e.isEqual(n)):e===n)&&this.exists===t.exists;var e,n},t.NONE=new t,t}(),Rs=function(){function t(){}return t.prototype.verifyKeyMatches=function(t){null!=t&&ko(t.key.isEqual(this.key),"Can only apply a mutation to a document with the same key")},t.getPostMutationVersion=function(t){return t instanceof Zs?t.version:Ma.MIN},t}(),Os=function(t){function e(e,n,r){var i=t.call(this)||this;return i.key=e,i.value=n,i.precondition=r,i.type=Ss.Set,i}return Mt(e,t),e.prototype.applyToRemoteDocument=function(t,e){this.verifyKeyMatches(t),ko(null==e.transformResults,"Transform results received by SetMutation.");var n=e.version;return new Zs(this.key,n,{hasCommittedMutations:!0},this.value)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Rs.getPostMutationVersion(t);return new Zs(this.key,r,{hasLocalMutations:!0},this.value)},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.value.isEqual(t.value)&&this.precondition.isEqual(t.precondition)},e}(Rs),Ps=function(t){function e(e,n,r,i){var o=t.call(this)||this;return o.key=e,o.data=n,o.fieldMask=r,o.precondition=i,o.type=Ss.Patch,o}return Mt(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),ko(null==e.transformResults,"Transform results received by PatchMutation."),!this.precondition.isValidFor(t))return new eu(this.key,e.version);var n=this.patchDocument(t);return new Zs(this.key,e.version,{hasCommittedMutations:!0},n)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=Rs.getPostMutationVersion(t),i=this.patchDocument(t);return new Zs(this.key,r,{hasLocalMutations:!0},i)},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.fieldMask.isEqual(t.fieldMask)&&this.precondition.isEqual(t.precondition)},e.prototype.patchDocument=function(t){var e;return e=t instanceof Zs?t.data():Ys.EMPTY,this.patchObject(e)},e.prototype.patchObject=function(t){var e=this;return this.fieldMask.fields.forEach(function(n){if(!n.isEmpty()){var r=e.data.field(n);t=null!==r?t.set(n,r):t.delete(n)}}),t},e}(Rs),Ms=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.fieldTransforms=n,r.type=Ss.Transform,r.precondition=_s.exists(!0),r}return Mt(e,t),e.prototype.applyToRemoteDocument=function(t,e){if(this.verifyKeyMatches(t),ko(null!=e.transformResults,"Transform results missing for TransformMutation."),!this.precondition.isValidFor(t))return new eu(this.key,e.version);var n=this.requireDocument(t),r=this.serverTransformResults(t,e.transformResults),i=e.version,o=this.transformObject(n.data(),r);return new Zs(this.key,i,{hasCommittedMutations:!0},o)},e.prototype.applyToLocalView=function(t,e,n){if(this.verifyKeyMatches(t),!this.precondition.isValidFor(t))return t;var r=this.requireDocument(t),i=this.localTransformResults(n,t,e),o=this.transformObject(r.data(),i);return new Zs(this.key,r.version,{hasLocalMutations:!0},o)},e.prototype.extractBaseValue=function(t){for(var e=null,n=0,r=this.fieldTransforms;n<r.length;n++){var i=r[n],o=t instanceof Zs?t.field(i.field):void 0,a=i.transform.computeBaseValue(o||null);null!=a&&(e=null==e?Ys.EMPTY.set(i.field,a):e.set(i.field,a))}return e},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&aa(this.fieldTransforms,t.fieldTransforms)&&this.precondition.isEqual(t.precondition)},e.prototype.requireDocument=function(t){ko(t instanceof Zs,"Unknown MaybeDocument type "+t);var e=t;return ko(e.key.isEqual(this.key),"Can only transform a document with the same key"),e},e.prototype.serverTransformResults=function(t,e){var n=[];ko(this.fieldTransforms.length===e.length,"server transform result count ("+e.length+") should match field transform count ("+this.fieldTransforms.length+")");for(var r=0;r<e.length;r++){var i=this.fieldTransforms[r],o=i.transform,a=null;t instanceof Zs&&(a=t.field(i.field)),n.push(o.applyToRemoteDocument(a,e[r]))}return n},e.prototype.localTransformResults=function(t,e,n){for(var r=[],i=0,o=this.fieldTransforms;i<o.length;i++){var a=o[i],s=a.transform,u=null;e instanceof Zs&&(u=e.field(a.field)),null===u&&n instanceof Zs&&(u=n.field(a.field)),r.push(s.applyToLocalView(u,t))}return r},e.prototype.transformObject=function(t,e){ko(e.length===this.fieldTransforms.length,"TransformResults length mismatch.");for(var n=0;n<this.fieldTransforms.length;n++){var r=this.fieldTransforms[n].field;t=t.set(r,e[n])}return t},e}(Rs),Ls=function(t){function e(e,n){var r=t.call(this)||this;return r.key=e,r.precondition=n,r.type=Ss.Delete,r}return Mt(e,t),e.prototype.applyToRemoteDocument=function(t,e){return this.verifyKeyMatches(t),ko(null==e.transformResults,"Transform results received by DeleteMutation."),new tu(this.key,e.version,{hasCommittedMutations:!0})},e.prototype.applyToLocalView=function(t,e,n){return this.verifyKeyMatches(t),this.precondition.isValidFor(t)?(t&&ko(t.key.isEqual(this.key),"Can only apply mutation to document with same key"),new tu(this.key,Ma.forDeletedDoc())):t},e.prototype.extractBaseValue=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.precondition.isEqual(t.precondition)},e}(Rs);!function(t){t[t.NullValue=0]="NullValue",t[t.BooleanValue=1]="BooleanValue",t[t.NumberValue=2]="NumberValue",t[t.TimestampValue=3]="TimestampValue",t[t.StringValue=4]="StringValue",t[t.BlobValue=5]="BlobValue",t[t.RefValue=6]="RefValue",t[t.GeoPointValue=7]="GeoPointValue",t[t.ArrayValue=8]="ArrayValue",t[t.ObjectValue=9]="ObjectValue"}(Ds||(Ds={})),function(t){t[t.Default=0]="Default",t[t.Estimate=1]="Estimate",t[t.Previous=2]="Previous"}(ks||(ks={}));var xs=function(){function t(t,e){this.serverTimestampBehavior=t,this.timestampsInSnapshots=e}return t.fromSnapshotOptions=function(e,n){switch(e.serverTimestamps){case"estimate":return new t(ks.Estimate,n);case"previous":return new t(ks.Previous,n);case"none":case void 0:return new t(ks.Default,n);default:return Do("fromSnapshotOptions() called with invalid options.")}},t}(),qs=function(){function t(){}return t.prototype.toString=function(){var t=this.value();return null===t?"null":t.toString()},t.prototype.defaultCompareTo=function(t){return ko(this.typeOrder!==t.typeOrder,"Default compareTo should not be used for values of same type."),oa(this.typeOrder,t.typeOrder)},t}(),Fs=function(t){function e(){var e=t.call(this)||this;return e.typeOrder=Ds.NullValue,e.internalValue=null,e}return Mt(e,t),e.prototype.value=function(t){return null},e.prototype.isEqual=function(t){return t instanceof e},e.prototype.compareTo=function(t){return t instanceof e?0:this.defaultCompareTo(t)},e.INSTANCE=new e,e}(qs),Us=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ds.BooleanValue,n}return Mt(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?oa(this,t):this.defaultCompareTo(t)},e.of=function(t){return t?e.TRUE:e.FALSE},e.TRUE=new e(!0),e.FALSE=new e(!1),e}(qs),Vs=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ds.NumberValue,n}return Mt(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.compareTo=function(t){return t instanceof e?(n=this.internalValue,r=t.internalValue,n<r?-1:n>r?1:n===r?0:isNaN(n)?isNaN(r)?0:-1:1):this.defaultCompareTo(t);var n,r},e}(qs);function Bs(t,e){return t===e?0!==t||1/t==1/e:t!=t&&e!=e}var js=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mt(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Bs(this.internalValue,t.internalValue)},e}(Vs),Ks=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mt(e,t),e.prototype.isEqual=function(t){return t instanceof e&&Bs(this.internalValue,t.internalValue)},e.NAN=new e(NaN),e.POSITIVE_INFINITY=new e(1/0),e.NEGATIVE_INFINITY=new e(-1/0),e}(Vs),$s=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ds.StringValue,n}return Mt(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue===t.internalValue},e.prototype.compareTo=function(t){return t instanceof e?oa(this.internalValue,t.internalValue):this.defaultCompareTo(t)},e}(qs),Qs=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ds.TimestampValue,n}return Mt(e,t),e.prototype.value=function(t){return!t||t.timestampsInSnapshots?this.internalValue:this.internalValue.toDate()},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):t instanceof Ws?-1:this.defaultCompareTo(t)},e}(qs),Ws=function(t){function e(e,n){var r=t.call(this)||this;return r.localWriteTime=e,r.previousValue=n,r.typeOrder=Ds.TimestampValue,r}return Mt(e,t),e.prototype.value=function(t){return t&&t.serverTimestampBehavior===ks.Estimate?new Qs(this.localWriteTime).value(t):t&&t.serverTimestampBehavior===ks.Previous&&this.previousValue?this.previousValue.value(t):null},e.prototype.isEqual=function(t){return t instanceof e&&this.localWriteTime.isEqual(t.localWriteTime)},e.prototype.compareTo=function(t){return t instanceof e?this.localWriteTime._compareTo(t.localWriteTime):t instanceof Qs?1:this.defaultCompareTo(t)},e.prototype.toString=function(){return"<ServerTimestamp localTime="+this.localWriteTime.toString()+">"},e}(qs),Gs=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ds.BlobValue,n}return Mt(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(qs),zs=function(t){function e(e,n){var r=t.call(this)||this;return r.databaseId=e,r.key=n,r.typeOrder=Ds.RefValue,r}return Mt(e,t),e.prototype.value=function(t){return this.key},e.prototype.isEqual=function(t){return t instanceof e&&(this.key.isEqual(t.key)&&this.databaseId.isEqual(t.databaseId))},e.prototype.compareTo=function(t){if(t instanceof e){var n=this.databaseId.compareTo(t.databaseId);return 0!==n?n:Ia.comparator(this.key,t.key)}return this.defaultCompareTo(t)},e}(qs),Hs=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ds.GeoPointValue,n}return Mt(e,t),e.prototype.value=function(t){return this.internalValue},e.prototype.isEqual=function(t){return t instanceof e&&this.internalValue.isEqual(t.internalValue)},e.prototype.compareTo=function(t){return t instanceof e?this.internalValue._compareTo(t.internalValue):this.defaultCompareTo(t)},e}(qs),Ys=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ds.ObjectValue,n}return Mt(e,t),e.prototype.value=function(t){var e={};return this.internalValue.inorderTraversal(function(n,r){e[n]=r.value(t)}),e},e.prototype.forEach=function(t){this.internalValue.inorderTraversal(t)},e.prototype.isEqual=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext();if(i.key!==o.key||!i.value.isEqual(o.value))return!1}return!n.hasNext()&&!r.hasNext()}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=this.internalValue.getIterator(),r=t.internalValue.getIterator();n.hasNext()&&r.hasNext();){var i=n.getNext(),o=r.getNext(),a=oa(i.key,o.key)||i.value.compareTo(o.value);if(a)return a}return oa(n.hasNext(),r.hasNext())}return this.defaultCompareTo(t)},e.prototype.set=function(t,n){if(ko(!t.isEmpty(),"Cannot set field for empty path on ObjectValue"),1===t.length)return this.setChild(t.firstSegment(),n);var r=this.child(t.firstSegment());r instanceof e||(r=e.EMPTY);var i=r.set(t.popFirst(),n);return this.setChild(t.firstSegment(),i)},e.prototype.delete=function(t){if(ko(!t.isEmpty(),"Cannot delete field for empty path on ObjectValue"),1===t.length)return new e(this.internalValue.remove(t.firstSegment()));var n=this.child(t.firstSegment());if(n instanceof e){var r=n.delete(t.popFirst());return new e(this.internalValue.insert(t.firstSegment(),r))}return this},e.prototype.contains=function(t){return null!==this.field(t)},e.prototype.field=function(t){ko(!t.isEmpty(),"Can't get field of empty path");var n=this;return t.forEach(function(t){n=n instanceof e?n.internalValue.get(t):null}),n},e.prototype.fieldMask=function(){var t=new Ua(wa.comparator);return this.internalValue.forEach(function(n,r){var i=new wa([n]);if(r instanceof e){var o=r.fieldMask().fields;o.isEmpty()?t=t.add(i):o.forEach(function(e){t=t.add(i.child(e))})}else t=t.add(i)}),Ns.fromSet(t)},e.prototype.toString=function(){return this.internalValue.toString()},e.prototype.child=function(t){return this.internalValue.get(t)||void 0},e.prototype.setChild=function(t,n){return new e(this.internalValue.insert(t,n))},e.EMPTY=new e(new La(oa)),e}(qs),Xs=function(t){function e(e){var n=t.call(this)||this;return n.internalValue=e,n.typeOrder=Ds.ArrayValue,n}return Mt(e,t),e.prototype.value=function(t){return this.internalValue.map(function(e){return e.value(t)})},e.prototype.contains=function(t){for(var e=0,n=this.internalValue;e<n.length;e++){if(n[e].isEqual(t))return!0}return!1},e.prototype.forEach=function(t){this.internalValue.forEach(t)},e.prototype.isEqual=function(t){if(t instanceof e){if(this.internalValue.length!==t.internalValue.length)return!1;for(var n=0;n<this.internalValue.length;n++)if(!this.internalValue[n].isEqual(t.internalValue[n]))return!1;return!0}return!1},e.prototype.compareTo=function(t){if(t instanceof e){for(var n=Math.min(this.internalValue.length,t.internalValue.length),r=0;r<n;r++){var i=this.internalValue[r].compareTo(t.internalValue[r]);if(i)return i}return oa(this.internalValue.length,t.internalValue.length)}return this.defaultCompareTo(t)},e.prototype.toString=function(){return"["+this.internalValue.map(function(t){return t.toString()}).join(",")+"]"},e}(qs),Js=function(){function t(t,e){this.key=t,this.version=e}return t.compareByKey=function(t,e){return Ia.comparator(t.key,e.key)},t}(),Zs=function(t){function e(e,n,r,i,o,a){var s=t.call(this,e,n)||this;return s.objectValue=i,s.proto=o,s.converter=a,ko(void 0!==s.objectValue||void 0!==s.proto&&void 0!==s.converter,"If objectValue is not defined, proto and converter need to be set."),s.hasLocalMutations=!!r.hasLocalMutations,s.hasCommittedMutations=!!r.hasCommittedMutations,s}return Mt(e,t),e.prototype.field=function(t){if(this.objectValue)return this.objectValue.field(t);this.fieldValueCache||(this.fieldValueCache=new Map);var e=t.canonicalString(),n=this.fieldValueCache.get(e);if(void 0===n){var r=this.getProtoField(t);n=void 0===r?null:this.converter(r),this.fieldValueCache.set(e,n)}return n},e.prototype.data=function(){var t=this;if(!this.objectValue){var e=Ys.EMPTY;Fo(this.proto.fields,function(n,r){e=e.set(new wa([n]),t.converter(r))}),this.objectValue=e,this.fieldValueCache=void 0}return this.objectValue},e.prototype.value=function(){return this.data().value()},e.prototype.isEqual=function(t){return t instanceof e&&this.key.isEqual(t.key)&&this.version.isEqual(t.version)&&this.hasLocalMutations===t.hasLocalMutations&&this.hasCommittedMutations===t.hasCommittedMutations&&this.data().isEqual(t.data())},e.prototype.toString=function(){return"Document("+this.key+", "+this.version+", "+this.data().toString()+", {hasLocalMutations: "+this.hasLocalMutations+"}), {hasCommittedMutations: "+this.hasCommittedMutations+"})"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasLocalMutations||this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.getProtoField=function(t){ko(void 0!==this.proto,"Can only call getProtoField() when proto is defined");for(var e=this.proto.fields[t.firstSegment()],n=1;n<t.length;++n){if(!e||!e.mapValue)return;e=e.mapValue.fields[t.get(n)]}return e},e.compareByField=function(t,e,n){var r=e.field(t),i=n.field(t);return null!==r&&null!==i?r.compareTo(i):Do("Trying to compare documents on fields that don't exist")},e}(Js),tu=function(t){function e(e,n,r){var i=t.call(this,e,n)||this;return i.hasCommittedMutations=!(!r||!r.hasCommittedMutations),i}return Mt(e,t),e.prototype.toString=function(){return"NoDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return this.hasCommittedMutations},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.hasCommittedMutations===this.hasCommittedMutations&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Js),eu=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mt(e,t),e.prototype.toString=function(){return"UnknownDocument("+this.key+", "+this.version+")"},Object.defineProperty(e.prototype,"hasPendingWrites",{get:function(){return!0},enumerable:!0,configurable:!0}),e.prototype.isEqual=function(t){return t instanceof e&&t.version.isEqual(this.version)&&t.key.isEqual(this.key)},e}(Js),nu=function(){function t(t){this.mapKeyFn=t,this.inner={}}return t.prototype.get=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0!==n)for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];if(a.isEqual(t))return s}},t.prototype.has=function(t){return void 0!==this.get(t)},t.prototype.set=function(t,e){var n=this.mapKeyFn(t),r=this.inner[n];if(void 0!==r){for(var i=0;i<r.length;i++)if(r[i][0].isEqual(t))return void(r[i]=[t,e]);r.push([t,e])}else this.inner[n]=[[t,e]]},t.prototype.delete=function(t){var e=this.mapKeyFn(t),n=this.inner[e];if(void 0===n)return!1;for(var r=0;r<n.length;r++)if(n[r][0].isEqual(t))return 1===n.length?delete this.inner[e]:n.splice(r,1),!0;return!1},t.prototype.forEach=function(t){Fo(this.inner,function(e,n){for(var r=0,i=n;r<i.length;r++){var o=i[r],a=o[0],s=o[1];t(a,s)}})},t.prototype.isEmpty=function(){return Uo(this.inner)},t}(),ru=function(){function t(){this.changes=new nu(function(t){return t.toString()}),this.changesApplied=!1}return t.prototype.addEntry=function(t){this.assertNotApplied(),this.changes.set(t.key,t)},t.prototype.removeEntry=function(t){this.assertNotApplied(),this.changes.set(t,null)},t.prototype.getEntry=function(t,e){this.assertNotApplied();var n=this.changes.get(e);return void 0!==n?ts.resolve(n):this.getFromCache(t,e)},t.prototype.getEntries=function(t,e){return this.getAllFromCache(t,e)},t.prototype.apply=function(t){return this.assertNotApplied(),this.changesApplied=!0,this.applyChanges(t)},t.prototype.assertNotApplied=function(){ko(!this.changesApplied,"Changes have already been applied.")},t}(),iu="The remote document changelog no longer contains all changes for all local query views. It may be necessary to rebuild these views.",ou=function(){function t(t,e,n){this.serializer=t,this.indexManager=e,this.keepDocumentChangeLog=n,this._lastProcessedDocumentChangeId=0}return Object.defineProperty(t.prototype,"lastProcessedDocumentChangeId",{get:function(){return this._lastProcessedDocumentChangeId},enumerable:!0,configurable:!0}),t.prototype.start=function(t){var e=fs.getStore(t,ku.store);return this.synchronizeLastDocumentChangeId(e)},t.prototype.addEntry=function(t,e,n){var r=this;return su(t).put(cu(e),n).next(function(){r.indexManager.addToCollectionParentIndex(t,e.path.popLast())})},t.prototype.removeEntry=function(t,e){var n=su(t),r=cu(e);return n.delete(r)},t.prototype.updateMetadata=function(t,e,n){var r=this;return this.getMetadata(t).next(function(i){return i.byteSize+=n,r.setMetadata(t,i).next(function(){if(r.keepDocumentChangeLog)return uu(t).put({changes:r.serializer.toDbResourcePaths(e)})})})},t.prototype.getEntry=function(t,e){var n=this;return su(t).get(cu(e)).next(function(t){return t?n.serializer.fromDbRemoteDocument(t):null})},t.prototype.getSizedEntry=function(t,e){var n=this;return su(t).get(cu(e)).next(function(t){return t?{maybeDocument:n.serializer.fromDbRemoteDocument(t),size:hu(t)}:null})},t.prototype.getEntries=function(t,e){var n=this,r=Ka();return this.forEachDbEntry(t,e,function(t,e){r=e?r.insert(t,n.serializer.fromDbRemoteDocument(e)):r.insert(t,null)}).next(function(){return r})},t.prototype.getSizedEntries=function(t,e){var n=this,r=Ka(),i=new La(Ia.comparator);return this.forEachDbEntry(t,e,function(t,e){e?(r=r.insert(t,n.serializer.fromDbRemoteDocument(e)),i=i.insert(t,hu(e))):(r=r.insert(t,null),i=i.insert(t,0))}).next(function(){return{maybeDocuments:r,sizeMap:i}})},t.prototype.forEachDbEntry=function(t,e,n){if(e.isEmpty())return ts.resolve();var r=IDBKeyRange.bound(e.first().path.toArray(),e.last().path.toArray()),i=e.getIterator(),o=i.getNext();return su(t).iterate({range:r},function(t,e,r){for(var a=Ia.fromSegments(t);o&&Ia.comparator(o,a)<0;)n(o,null),o=i.getNext();o&&o.isEqual(a)&&(n(o,e),o=i.hasNext()?i.getNext():null),o?r.skip(o.path.toArray()):r.done()}).next(function(){for(;o;)n(o,null),o=i.hasNext()?i.getNext():null})},t.prototype.getDocumentsMatchingQuery=function(t,e){var n=this;ko(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var r=Qa(),i=e.path.length+1,o=e.path.toArray(),a=IDBKeyRange.lowerBound(o);return su(t).iterate({range:a},function(t,o,a){if(t.length===i){var s=n.serializer.fromDbRemoteDocument(o);e.path.isPrefixOf(s.key.path)?s instanceof Zs&&e.matches(s)&&(r=r.insert(s.key,s)):a.done()}}).next(function(){return r})},t.prototype.getNewDocumentChanges=function(t){var e=this;ko(this.keepDocumentChangeLog,"Can only call getNewDocumentChanges() when document change log is enabled");var n=Ha(),r=ja(),i=IDBKeyRange.lowerBound(this._lastProcessedDocumentChangeId+1),o=!0,a=uu(t);return a.iterate({range:i},function(t,r){if(o&&(o=!1,e._lastProcessedDocumentChangeId+1!==r.id))return e.synchronizeLastDocumentChangeId(a).next(function(){return ts.reject(new Po(Oo.DATA_LOSS,iu))});n=n.unionWith(e.serializer.fromDbResourcePaths(r.changes)),e._lastProcessedDocumentChangeId=r.id}).next(function(){var i=[];return n.forEach(function(n){i.push(e.getEntry(t,n).next(function(t){var e=t||new tu(n,Ma.forDeletedDoc());r=r.insert(n,e)}))}),ts.waitFor(i)}).next(function(){return r})},t.prototype.removeDocumentChangesThroughChangeId=function(t,e){var n=IDBKeyRange.upperBound(e);return uu(t).delete(n)},t.prototype.synchronizeLastDocumentChangeId=function(t){var e=this;return this._lastProcessedDocumentChangeId=0,t.iterate({keysOnly:!0,reverse:!0},function(t,n,r){e._lastProcessedDocumentChangeId=t,r.done()})},t.prototype.newChangeBuffer=function(){return new t.RemoteDocumentChangeBuffer(this)},t.prototype.getSize=function(t){return this.getMetadata(t).next(function(t){return t.byteSize})},t.prototype.getMetadata=function(t){return au(t).get(Tu.key).next(function(t){return ko(!!t,"Missing document cache metadata"),t})},t.prototype.setMetadata=function(t,e){return au(t).put(Tu.key,e)},t.RemoteDocumentChangeBuffer=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n.documentSizes=new nu(function(t){return t.toString()}),n}return Mt(e,t),e.prototype.applyChanges=function(t){var e=this,n=[],r=0,i=Ha();return this.changes.forEach(function(o,a){var s=e.documentSizes.get(o);if(ko(void 0!==s,"Cannot modify a document that wasn't read (for "+o+")"),a){var u=e.documentCache.serializer.toDbRemoteDocument(a),c=hu(u);r+=c-s,n.push(e.documentCache.addEntry(t,o,u))}else r-=s,n.push(e.documentCache.removeEntry(t,o));i=i.add(o)}),n.push(this.documentCache.updateMetadata(t,i,r)),ts.waitFor(n)},e.prototype.getFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntry(t,e).next(function(t){return null===t?(n.documentSizes.set(e,0),null):(n.documentSizes.set(e,t.size),t.maybeDocument)})},e.prototype.getAllFromCache=function(t,e){var n=this;return this.documentCache.getSizedEntries(t,e).next(function(t){var e=t.maybeDocuments;return t.sizeMap.forEach(function(t,e){n.documentSizes.set(t,e)}),e})},e}(ru),t}();function au(t){return zu.getStore(t,Tu.store)}function su(t){return zu.getStore(t,Eu.store)}function uu(t){return zu.getStore(t,ku.store)}function cu(t){return t.path.toArray()}function hu(t){var e;if(t.document)e=t.document;else if(t.unknownDocument)e=t.unknownDocument;else{if(!t.noDocument)throw Do("Unknown remote document type");e=t.noDocument}return JSON.stringify(e).length}var lu=function(){function t(){this.collectionParentIndex=new fu}return t.prototype.addToCollectionParentIndex=function(t,e){return this.collectionParentIndex.add(e),ts.resolve()},t.prototype.getCollectionParents=function(t,e){return ts.resolve(this.collectionParentIndex.getEntries(e))},t}(),fu=function(){function t(){this.index={}}return t.prototype.add=function(t){ko(t.length%2==1,"Expected a collection path.");var e=t.lastSegment(),n=t.popLast(),r=this.index[e]||new Ua(va.comparator),i=!r.has(n);return this.index[e]=r.add(n),i},t.prototype.getEntries=function(t){return(this.index[t]||new Ua(va.comparator)).toArray()},t}(),pu=8,du=function(){function t(t){this.serializer=t}return t.prototype.createOrUpgrade=function(t,e,n,r){var i=this;ko(n<r&&n>=0&&r<=pu,"Unexpected schema upgrade from v"+n+" to v{toVersion}."),n<1&&r>=1&&(function(t){t.createObjectStore(yu.store)}(t),function(t){t.createObjectStore(gu.store,{keyPath:gu.keyPath}),t.createObjectStore(vu.store,{keyPath:vu.keyPath,autoIncrement:!0}).createIndex(vu.userMutationsIndex,vu.userMutationsKeyPath,{unique:!0}),t.createObjectStore(bu.store)}(t),Du(t),function(t){t.createObjectStore(Eu.store)}(t));var o=ts.resolve();return n<3&&r>=3&&(0!==n&&(!function(t){t.deleteObjectStore(Nu.store),t.deleteObjectStore(Su.store),t.deleteObjectStore(Cu.store)}(t),Du(t)),o=o.next(function(){return function(t){var e=t.store(Cu.store),n=new Cu(0,0,Ma.MIN.toTimestamp(),0);return e.put(Cu.key,n)}(e)})),n<4&&r>=4&&(0!==n&&(o=o.next(function(){return function(t,e){return e.store(vu.store).loadAll().next(function(n){t.deleteObjectStore(vu.store);var r=t.createObjectStore(vu.store,{keyPath:vu.keyPath,autoIncrement:!0});r.createIndex(vu.userMutationsIndex,vu.userMutationsKeyPath,{unique:!0});var i=e.store(vu.store),o=n.map(function(t){return i.put(t)});return ts.waitFor(o)})}(t,e)})),o=o.next(function(){!function(t){t.createObjectStore(_u.store,{keyPath:_u.keyPath})}(t),function(t){t.createObjectStore(ku.store,{keyPath:"id",autoIncrement:!0})}(t)})),n<5&&r>=5&&(o=o.next(function(){return i.removeAcknowledgedMutations(e)})),n<6&&r>=6&&(o=o.next(function(){return function(t){t.createObjectStore(Tu.store)}(t),i.addDocumentGlobal(e)})),n<7&&r>=7&&(o=o.next(function(){return i.ensureSequenceNumbers(e)})),n<8&&r>=8&&(o=o.next(function(){return i.createCollectionParentIndex(t,e)})),o},t.prototype.addDocumentGlobal=function(t){var e=0;return t.store(Eu.store).iterate(function(t,n){e+=hu(n)}).next(function(){var n=new Tu(e);return t.store(Tu.store).put(Tu.key,n)})},t.prototype.removeAcknowledgedMutations=function(t){var e=this,n=t.store(gu.store),r=t.store(vu.store);return n.loadAll().next(function(n){return ts.forEach(n,function(n){var i=IDBKeyRange.bound([n.userId,-1],[n.userId,n.lastAcknowledgedBatchId]);return r.loadAll(vu.userMutationsIndex,i).next(function(r){return ts.forEach(r,function(r){ko(r.userId===n.userId,"Cannot process batch "+r.batchId+" from unexpected user");var i=e.serializer.fromDbMutationBatch(r);return rs(t,n.userId,i).next(function(){})})})})})},t.prototype.ensureSequenceNumbers=function(t){var e=t.store(Nu.store),n=t.store(Eu.store);return Es(t).next(function(t){var r=[];return n.iterate(function(n,i){var o=new va(n),a=function(t){return[0,ka(t)]}(o);r.push(e.get(a).next(function(n){return n?ts.resolve():function(n){return e.put(new Nu(0,ka(n),t))}(o)}))}).next(function(){return ts.waitFor(r)})})},t.prototype.createCollectionParentIndex=function(t,e){t.createObjectStore(Au.store,{keyPath:Au.keyPath});var n=e.store(Au.store),r=new fu,i=function(t){if(r.add(t)){var e=t.lastSegment(),i=t.popLast();return n.put({collectionId:e,parent:ka(i)})}};return e.store(Eu.store).iterate({keysOnly:!0},function(t,e){var n=new va(t);return i(n.popLast())}).next(function(){return e.store(bu.store).iterate({keysOnly:!0},function(t,e){t[0];var n=t[1],r=(t[2],Oa(n));return i(r.popLast())})})},t}();var mu=function(){return function(t,e){this.seconds=t,this.nanoseconds=e}}(),yu=function(){function t(t,e,n){this.ownerId=t,this.allowTabSynchronization=e,this.leaseTimestampMs=n}return t.store="owner",t.key="owner",t}();var gu=function(){function t(t,e,n){this.userId=t,this.lastAcknowledgedBatchId=e,this.lastStreamToken=n}return t.store="mutationQueues",t.keyPath="userId",t}(),vu=function(){function t(t,e,n,r,i){this.userId=t,this.batchId=e,this.localWriteTimeMs=n,this.baseMutations=r,this.mutations=i}return t.store="mutations",t.keyPath="batchId",t.userMutationsIndex="userMutationsIndex",t.userMutationsKeyPath=["userId","batchId"],t}();var bu=function(){function t(){}return t.prefixForUser=function(t){return[t]},t.prefixForPath=function(t,e){return[t,ka(e)]},t.key=function(t,e,n){return[t,ka(e),n]},t.store="documentMutations",t.PLACEHOLDER=new t,t}();var wu=function(){return function(t,e){this.path=t,this.readTime=e}}(),Iu=function(){return function(t,e){this.path=t,this.version=e}}(),Eu=function(){function t(t,e,n,r){this.unknownDocument=t,this.noDocument=e,this.document=n,this.hasCommittedMutations=r}return t.store="remoteDocuments",t}(),Tu=function(){function t(t){this.byteSize=t}return t.store="remoteDocumentGlobal",t.key="remoteDocumentGlobalKey",t}();var Su=function(){function t(t,e,n,r,i,o){this.targetId=t,this.canonicalId=e,this.readTime=n,this.resumeToken=r,this.lastListenSequenceNumber=i,this.query=o}return t.store="targets",t.keyPath="targetId",t.queryTargetsIndexName="queryTargetsIndex",t.queryTargetsKeyPath=["canonicalId","targetId"],t}(),Nu=function(){function t(t,e,n){this.targetId=t,this.path=e,this.sequenceNumber=n,ko(0===t==(void 0!==n),"A target-document row must either have targetId == 0 and a defined sequence number, or a non-zero targetId and no sequence number")}return t.store="targetDocuments",t.keyPath=["targetId","path"],t.documentTargetsIndex="documentTargetsIndex",t.documentTargetsKeyPath=["path","targetId"],t}(),Cu=function(){function t(t,e,n,r){this.highestTargetId=t,this.highestListenSequenceNumber=e,this.lastRemoteSnapshotVersion=n,this.targetCount=r}return t.key="targetGlobalKey",t.store="targetGlobal",t}(),Au=function(){function t(t,e){this.collectionId=t,this.parent=e}return t.store="collectionParents",t.keyPath=["collectionId","parent"],t}();function Du(t){t.createObjectStore(Nu.store,{keyPath:Nu.keyPath}).createIndex(Nu.documentTargetsIndex,Nu.documentTargetsKeyPath,{unique:!0}),t.createObjectStore(Su.store,{keyPath:Su.keyPath}).createIndex(Su.queryTargetsIndexName,Su.queryTargetsKeyPath,{unique:!0}),t.createObjectStore(Cu.store)}var ku=function(){function t(t){this.changes=t}return t.store="remoteDocumentChanges",t.keyPath="id",t}();var _u=function(){function t(t,e,n,r,i){this.clientId=t,this.updateTimeMs=e,this.networkEnabled=n,this.inForeground=r,this.lastProcessedDocumentChangeId=i}return t.store="clientMetadata",t.keyPath="clientId",t}();var Ru,Ou=[gu.store,vu.store,bu.store,Eu.store,Su.store,yu.store,Cu.store,Nu.store].concat([_u.store,ku.store]).concat([Tu.store]).concat([Au.store]),Pu=function(){function t(){this.collectionParentsCache=new fu}return t.prototype.addToCollectionParentIndex=function(t,e){if(ko(e.length%2==1,"Expected a collection path."),this.collectionParentsCache.add(e)){ko(e.length>=1,"Invalid collection path.");var n=e.lastSegment(),r=e.popLast();return Mu(t).put({collectionId:n,parent:ka(r)})}return ts.resolve()},t.prototype.getCollectionParents=function(t,e){var n=[],r=IDBKeyRange.bound([e,""],[sa(e),""],!1,!0);return Mu(t).loadAll(r).next(function(t){for(var r=0,i=t;r<i.length;r++){var o=i[r];if(o.collectionId!==e)break;n.push(Oa(o.parent))}return n})},t}();function Mu(t){return zu.getStore(t,Au.store)}!function(t){t[t.Listen=0]="Listen",t[t.ExistenceFilterMismatch=1]="ExistenceFilterMismatch",t[t.LimboResolution=2]="LimboResolution"}(Ru||(Ru={}));var Lu=function(){function t(t,e,n,r,i,o){void 0===i&&(i=Ma.MIN),void 0===o&&(o=Ro()),this.query=t,this.targetId=e,this.purpose=n,this.sequenceNumber=r,this.snapshotVersion=i,this.resumeToken=o}return t.prototype.withSequenceNumber=function(e){return new t(this.query,this.targetId,this.purpose,e,this.snapshotVersion,this.resumeToken)},t.prototype.withResumeToken=function(e,n){return new t(this.query,this.targetId,this.purpose,this.sequenceNumber,n,e)},t.prototype.isEqual=function(t){return this.targetId===t.targetId&&this.purpose===t.purpose&&this.sequenceNumber===t.sequenceNumber&&this.snapshotVersion.isEqual(t.snapshotVersion)&&this.resumeToken===t.resumeToken&&this.query.isEqual(t.query)},t}(),xu=function(){function t(t){this.remoteSerializer=t}return t.prototype.fromDbRemoteDocument=function(t){if(t.document)return this.remoteSerializer.fromDocument(t.document,!!t.hasCommittedMutations);if(t.noDocument){var e=Ia.fromSegments(t.noDocument.path),n=this.fromDbTimestamp(t.noDocument.readTime);return new tu(e,n,{hasCommittedMutations:!!t.hasCommittedMutations})}if(t.unknownDocument){e=Ia.fromSegments(t.unknownDocument.path),n=this.fromDbTimestamp(t.unknownDocument.version);return new eu(e,n)}return Do("Unexpected DbRemoteDocument")},t.prototype.toDbRemoteDocument=function(t){if(t instanceof Zs){var e=t.proto?t.proto:this.remoteSerializer.toDocument(t),n=t.hasCommittedMutations;return new Eu(null,null,e,n)}if(t instanceof tu){var r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);n=t.hasCommittedMutations;return new Eu(null,new wu(r,i),null,n)}if(t instanceof eu){r=t.key.path.toArray(),i=this.toDbTimestamp(t.version);return new Eu(new Iu(r,i),null,null,!0)}return Do("Unexpected MaybeDocumment")},t.prototype.toDbTimestamp=function(t){var e=t.toTimestamp();return new mu(e.seconds,e.nanoseconds)},t.prototype.fromDbTimestamp=function(t){var e=new Pa(t.seconds,t.nanoseconds);return Ma.fromTimestamp(e)},t.prototype.toDbMutationBatch=function(t,e){var n=this,r=e.baseMutations.map(function(t){return n.remoteSerializer.toMutation(t)}),i=e.mutations.map(function(t){return n.remoteSerializer.toMutation(t)});return new vu(t,e.batchId,e.localWriteTime.toMillis(),r,i)},t.prototype.fromDbMutationBatch=function(t){var e=this,n=(t.baseMutations||[]).map(function(t){return e.remoteSerializer.fromMutation(t)}),r=t.mutations.map(function(t){return e.remoteSerializer.fromMutation(t)}),i=Pa.fromMillis(t.localWriteTimeMs);return new Ja(t.batchId,i,n,r)},t.prototype.toDbResourcePaths=function(t){var e=[];return t.forEach(function(t){e.push(ka(t.path))}),e},t.prototype.fromDbResourcePaths=function(t){for(var e=Ha(),n=0,r=t;n<r.length;n++){var i=r[n];e=e.add(new Ia(Oa(i)))}return e},t.prototype.fromDbTarget=function(t){var e,n=this.fromDbTimestamp(t.readTime);return e=void 0!==t.query.documents?this.remoteSerializer.fromDocumentsTarget(t.query):this.remoteSerializer.fromQueryTarget(t.query),new Lu(e,t.targetId,Ru.Listen,t.lastListenSequenceNumber,n,t.resumeToken)},t.prototype.toDbTarget=function(t){ko(Ru.Listen===t.purpose,"Only queries with purpose "+Ru.Listen+" may be stored, got "+t.purpose);var e,n,r=this.toDbTimestamp(t.snapshotVersion);return e=t.query.isDocumentQuery()?this.remoteSerializer.toDocumentsTarget(t.query):this.remoteSerializer.toQueryTarget(t.query),t.resumeToken instanceof Uint8Array?(ko("YES"===process.env.USE_MOCK_PERSISTENCE,"Persisting non-string stream tokens is only supported with mock persistence ."),n=t.resumeToken.toString()):n=t.resumeToken,new Su(t.targetId,t.query.canonicalId(),r,n,t.sequenceNumber,e)},t}();function qu(t,e){var n=t[0],r=t[1],i=e[0],o=e[1],a=oa(n,i);return 0===a?oa(r,o):a}var Fu=function(){function t(t){this.maxElements=t,this.buffer=new Ua(qu),this.previousIndex=0}return t.prototype.nextIndex=function(){return++this.previousIndex},t.prototype.addElement=function(t){var e=[t,this.nextIndex()];if(this.buffer.size<this.maxElements)this.buffer=this.buffer.add(e);else{var n=this.buffer.last();qu(e,n)<0&&(this.buffer=this.buffer.delete(n).add(e))}},Object.defineProperty(t.prototype,"maxValue",{get:function(){return this.buffer.last()[0]},enumerable:!0,configurable:!0}),t}(),Uu={didRun:!1,sequenceNumbersCollected:0,targetsRemoved:0,documentsRemoved:0},Vu=function(){function t(t,e,n){this.cacheSizeCollectionThreshold=t,this.percentileToCollect=e,this.maximumSequenceNumbersToCollect=n}return t.withCacheSize=function(e){return new t(e,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT)},t.COLLECTION_DISABLED=-1,t.MINIMUM_CACHE_SIZE_BYTES=1048576,t.DEFAULT_CACHE_SIZE_BYTES=41943040,t.DEFAULT_COLLECTION_PERCENTILE=10,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT=1e3,t.DEFAULT=new t(t.DEFAULT_CACHE_SIZE_BYTES,t.DEFAULT_COLLECTION_PERCENTILE,t.DEFAULT_MAX_SEQUENCE_NUMBERS_TO_COLLECT),t.DISABLED=new t(t.COLLECTION_DISABLED,0,0),t}(),Bu=function(){function t(t,e,n){this.garbageCollector=t,this.asyncQueue=e,this.localStore=n,this.hasRun=!1,this.gcTask=null}return t.prototype.start=function(){ko(null===this.gcTask,"Cannot start an already started LruScheduler"),this.garbageCollector.params.cacheSizeCollectionThreshold!==Vu.COLLECTION_DISABLED&&this.scheduleGC()},t.prototype.stop=function(){this.gcTask&&(this.gcTask.cancel(),this.gcTask=null)},Object.defineProperty(t.prototype,"started",{get:function(){return null!==this.gcTask},enumerable:!0,configurable:!0}),t.prototype.scheduleGC=function(){var t=this;ko(null===this.gcTask,"Cannot schedule GC while a task is pending");var e=this.hasRun?3e5:6e4;No("LruGarbageCollector","Garbage collection scheduled in "+e+"ms"),this.gcTask=this.asyncQueue.enqueueAfterDelay(ha.LruGarbageCollection,e,function(){return t.gcTask=null,t.hasRun=!0,t.localStore.collectGarbage(t.garbageCollector).then(function(){return t.scheduleGC()}).catch(Hu)})},t}(),ju=function(){function t(t,e){this.delegate=t,this.params=e}return t.prototype.calculateTargetCount=function(t,e){return this.delegate.getSequenceNumberCount(t).next(function(t){return Math.floor(e/100*t)})},t.prototype.nthSequenceNumber=function(t,e){var n=this;if(0===e)return ts.resolve(ya.INVALID);var r=new Fu(e);return this.delegate.forEachTarget(t,function(t){return r.addElement(t.sequenceNumber)}).next(function(){return n.delegate.forEachOrphanedDocumentSequenceNumber(t,function(t){return r.addElement(t)})}).next(function(){return r.maxValue})},t.prototype.removeTargets=function(t,e,n){return this.delegate.removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){return this.delegate.removeOrphanedDocuments(t,e)},t.prototype.collect=function(t,e){var n=this;return this.params.cacheSizeCollectionThreshold===Vu.COLLECTION_DISABLED?(No("LruGarbageCollector","Garbage collection skipped; disabled"),ts.resolve(Uu)):this.getCacheSize(t).next(function(r){return r<n.params.cacheSizeCollectionThreshold?(No("LruGarbageCollector","Garbage collection skipped; Cache size "+r+" is lower than threshold "+n.params.cacheSizeCollectionThreshold),Uu):n.runGarbageCollection(t,e)})},t.prototype.getCacheSize=function(t){return this.delegate.getCacheSize(t)},t.prototype.runGarbageCollection=function(t,e){var n,r,i,o,a,s,u,c=this,h=Date.now();return this.calculateTargetCount(t,this.params.percentileToCollect).next(function(e){return e>c.params.maximumSequenceNumbersToCollect?(No("LruGarbageCollector","Capping sequence numbers to collect down to the maximum of "+c.params.maximumSequenceNumbersToCollect+" from "+e),r=c.params.maximumSequenceNumbersToCollect):r=e,o=Date.now(),c.nthSequenceNumber(t,r)}).next(function(r){return n=r,a=Date.now(),c.removeTargets(t,n,e)}).next(function(e){return i=e,s=Date.now(),c.removeOrphanedDocuments(t,n)}).next(function(t){(u=Date.now(),To()<=po.DEBUG)&&No("LruGarbageCollector","LRU Garbage Collection\n\tCounted targets in "+(o-h)+"ms\n\tDetermined least recently used "+r+" in "+(a-o)+"ms\n\tRemoved "+i+" targets in "+(s-a)+"ms\n\tRemoved "+t+" documents in "+(u-s)+"ms\nTotal Duration: "+(u-h)+"ms");return ts.resolve({didRun:!0,sequenceNumbersCollected:r,targetsRemoved:i,documentsRemoved:t})})},t}(),Ku=function(){return function(){}}(),$u="IndexedDbPersistence",Qu="The current tab is not in the required state to perform this operation. It might be necessary to refresh the browser tab.",Wu="Another tab has exclusive access to the persistence layer. To allow shared access, make sure to invoke `enablePersistence()` with `synchronizeTabs:true` in all tabs.",Gu=function(t){function e(e,n){var r=t.call(this)||this;return r.simpleDbTransaction=e,r.currentSequenceNumber=n,r}return Mt(e,t),e}(Ku),zu=function(){function t(e,n,r,i,o,a,s,u){if(this.allowTabSynchronization=e,this.persistenceKey=n,this.clientId=r,this.queue=a,this.sequenceNumberSyncer=u,this._started=!1,this.isPrimary=!1,this.networkEnabled=!0,this.windowUnloadHandler=null,this.inForeground=!1,this.documentVisibilityHandler=null,this.clientMetadataRefresher=null,this.lastGarbageCollectionTime=Number.NEGATIVE_INFINITY,this.primaryStateListener=function(t){return Promise.resolve()},this.referenceDelegate=new Ju(this,o),this.dbName=n+t.MAIN_DATABASE,this.serializer=new xu(s),this.document=i.document,this.queryCache=new bs(this.referenceDelegate,this.serializer),this.indexManager=new Pu,this.remoteDocumentCache=new ou(this.serializer,this.indexManager,this.allowTabSynchronization),!i.window||!i.window.localStorage)throw new Po(Oo.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");this.window=i.window,this.webStorage=this.window.localStorage}return t.getStore=function(t,e){if(t instanceof Gu)return fs.getStore(t.simpleDbTransaction,e);throw Do("IndexedDbPersistence must use instances of IndexedDbTransaction")},t.createIndexedDbPersistence=function(e){return xt(this,void 0,void 0,function(){var n;return qt(this,function(r){switch(r.label){case 0:if(!t.isAvailable())throw new Po(Oo.UNIMPLEMENTED,"This platform is either missing IndexedDB or is known to have an incomplete implementation. Offline persistence has been disabled.");return[4,(n=new t(e.allowTabSynchronization,e.persistenceKey,e.clientId,e.platform,e.lruParams,e.queue,e.serializer,e.sequenceNumberSyncer)).start()];case 1:return r.sent(),[2,n]}})})},t.prototype.start=function(){var t=this;return ko(!this.started,"IndexedDbPersistence double-started!"),ko(null!==this.window,"Expected 'window' to be defined"),fs.openOrCreate(this.dbName,pu,new du(this.serializer)).then(function(e){return t.simpleDb=e,t.updateClientMetadataAndTryBecomePrimary()}).then(function(){return t.attachVisibilityHandler(),t.attachWindowUnloadHook(),t.scheduleClientMetadataAndPrimaryLeaseRefreshes(),t.startRemoteDocumentCache()}).then(function(){return t.simpleDb.runTransaction("readonly",[Cu.store],function(e){return Es(e).next(function(e){t.listenSequence=new ya(e,t.sequenceNumberSyncer)})})}).then(function(){t._started=!0}).catch(function(e){return t.simpleDb&&t.simpleDb.close(),Promise.reject(e)})},t.prototype.startRemoteDocumentCache=function(){var t=this;return this.simpleDb.runTransaction("readonly",Ou,function(e){return t.remoteDocumentCache.start(e)})},t.prototype.setPrimaryStateListener=function(t){var e=this;return this.primaryStateListener=function(n){return xt(e,void 0,void 0,function(){return qt(this,function(e){return this.started?[2,t(n)]:[2]})})},t(this.isPrimary)},t.prototype.setDatabaseDeletedListener=function(t){var e=this;this.simpleDb.setVersionChangeListener(function(n){return xt(e,void 0,void 0,function(){return qt(this,function(e){switch(e.label){case 0:return null!==n.newVersion?[3,2]:[4,t()];case 1:e.sent(),e.label=2;case 2:return[2]}})})})},t.prototype.setNetworkEnabled=function(t){var e=this;this.networkEnabled!==t&&(this.networkEnabled=t,this.queue.enqueueAndForget(function(){return xt(e,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return this.started?[4,this.updateClientMetadataAndTryBecomePrimary()]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})}))},t.prototype.updateClientMetadataAndTryBecomePrimary=function(){var t=this;return this.simpleDb.runTransaction("readwrite",Ou,function(e){return Xu(e).put(new _u(t.clientId,Date.now(),t.networkEnabled,t.inForeground,t.remoteDocumentCache.lastProcessedDocumentChangeId)).next(function(){if(t.isPrimary)return t.verifyPrimaryLease(e).next(function(e){e||(t.isPrimary=!1,t.queue.enqueueAndForget(function(){return t.primaryStateListener(!1)}))})}).next(function(){return t.canActAsPrimary(e)}).next(function(n){var r=t.isPrimary;return t.isPrimary=n,r!==t.isPrimary&&t.queue.enqueueAndForget(function(){return t.primaryStateListener(t.isPrimary)}),r&&!t.isPrimary?t.releasePrimaryLeaseIfHeld(e):t.isPrimary?t.acquireOrExtendPrimaryLease(e):void 0})})},t.prototype.verifyPrimaryLease=function(t){var e=this;return Yu(t).get(yu.key).next(function(t){return ts.resolve(e.isLocalClient(t))})},t.prototype.removeClientMetadata=function(t){return Xu(t).delete(this.clientId)},t.prototype.maybeGarbageCollectMultiClientState=function(){return xt(this,void 0,void 0,function(){var e,n,r=this;return qt(this,function(i){switch(i.label){case 0:return!this.isPrimary||this.isWithinAge(this.lastGarbageCollectionTime,18e5)?[3,2]:(this.lastGarbageCollectionTime=Date.now(),n=[],[4,this.runTransaction("maybeGarbageCollectMultiClientState","readwrite-primary",function(i){var o=t.getStore(i,_u.store);return o.loadAll().next(function(t){e=r.filterActiveClients(t,18e5),n=t.filter(function(t){return-1===e.indexOf(t)})}).next(function(){return ts.forEach(n,function(t){return o.delete(t.clientId)})}).next(function(){if((e=e.filter(function(t){return t.clientId!==r.clientId})).length>0){var t=e.map(function(t){return t.lastProcessedDocumentChangeId||0}),n=Math.min.apply(Math,t);return r.remoteDocumentCache.removeDocumentChangesThroughChangeId(i,n)}})})]);case 1:i.sent(),n.forEach(function(t){r.window.localStorage.removeItem(r.zombiedClientLocalStorageKey(t.clientId))}),i.label=2;case 2:return[2]}})})},t.prototype.scheduleClientMetadataAndPrimaryLeaseRefreshes=function(){var t=this;this.clientMetadataRefresher=this.queue.enqueueAfterDelay(ha.ClientMetadataRefresh,4e3,function(){return t.updateClientMetadataAndTryBecomePrimary().then(function(){return t.maybeGarbageCollectMultiClientState()}).then(function(){return t.scheduleClientMetadataAndPrimaryLeaseRefreshes()})})},t.prototype.isLocalClient=function(t){return!!t&&t.ownerId===this.clientId},t.prototype.canActAsPrimary=function(t){var e=this;return Yu(t).get(yu.key).next(function(n){if(null!==n&&e.isWithinAge(n.leaseTimestampMs,5e3)&&!e.isClientZombied(n.ownerId)){if(e.isLocalClient(n)&&e.networkEnabled)return!0;if(!e.isLocalClient(n)){if(!n.allowTabSynchronization)throw new Po(Oo.FAILED_PRECONDITION,Wu);return!1}}return!(!e.networkEnabled||!e.inForeground)||Xu(t).loadAll().next(function(t){return void 0===e.filterActiveClients(t,5e3).find(function(t){if(e.clientId!==t.clientId){var n=!e.networkEnabled&&t.networkEnabled,r=!e.inForeground&&t.inForeground,i=e.networkEnabled===t.networkEnabled;if(n||r&&i)return!0}return!1})})}).next(function(t){return e.isPrimary!==t&&No($u,"Client "+(t?"is":"is not")+" eligible for a primary lease."),t})},t.prototype.shutdown=function(){return xt(this,void 0,void 0,function(){var t=this;return qt(this,function(e){switch(e.label){case 0:return this._started=!1,this.markClientZombied(),this.clientMetadataRefresher&&(this.clientMetadataRefresher.cancel(),this.clientMetadataRefresher=null),this.detachVisibilityHandler(),this.detachWindowUnloadHook(),[4,this.simpleDb.runTransaction("readwrite",[yu.store,_u.store],function(e){return t.releasePrimaryLeaseIfHeld(e).next(function(){return t.removeClientMetadata(e)})})];case 1:return e.sent(),this.simpleDb.close(),this.removeClientZombiedEntry(),[2]}})})},t.prototype.filterActiveClients=function(t,e){var n=this;return t.filter(function(t){return n.isWithinAge(t.updateTimeMs,e)&&!n.isClientZombied(t.clientId)})},t.prototype.getActiveClients=function(){var t=this;return this.simpleDb.runTransaction("readonly",[_u.store],function(e){return Xu(e).loadAll().next(function(e){return t.filterActiveClients(e,18e5).map(function(t){return t.clientId})})})},t.clearPersistence=function(e){return xt(this,void 0,void 0,function(){var n;return qt(this,function(r){switch(r.label){case 0:return t.isAvailable()?(n=e+t.MAIN_DATABASE,[4,fs.delete(n)]):[2,Promise.resolve()];case 1:return r.sent(),[2]}})})},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getMutationQueue=function(t){return ko(this.started,"Cannot initialize MutationQueue before persistence is started."),es.forUser(t,this.serializer,this.indexManager,this.referenceDelegate)},t.prototype.getQueryCache=function(){return ko(this.started,"Cannot initialize QueryCache before persistence is started."),this.queryCache},t.prototype.getRemoteDocumentCache=function(){return ko(this.started,"Cannot initialize RemoteDocumentCache before persistence is started."),this.remoteDocumentCache},t.prototype.getIndexManager=function(){return ko(this.started,"Cannot initialize IndexManager before persistence is started."),this.indexManager},t.prototype.runTransaction=function(t,e,n){var r=this;return No($u,"Starting transaction:",t),this.simpleDb.runTransaction("readonly"===e?"readonly":"readwrite",Ou,function(i){return"readwrite-primary"===e?r.verifyPrimaryLease(i).next(function(e){if(!e)throw Co("Failed to obtain primary lease for action '"+t+"'."),r.isPrimary=!1,r.queue.enqueueAndForget(function(){return r.primaryStateListener(!1)}),new Po(Oo.FAILED_PRECONDITION,Qu);return n(new Gu(i,r.listenSequence.next()))}).next(function(t){return r.acquireOrExtendPrimaryLease(i).next(function(){return t})}):r.verifyAllowTabSynchronization(i).next(function(){return n(new Gu(i,r.listenSequence.next()))})})},t.prototype.verifyAllowTabSynchronization=function(t){var e=this;return Yu(t).get(yu.key).next(function(t){if(null!==t&&e.isWithinAge(t.leaseTimestampMs,5e3)&&!e.isClientZombied(t.ownerId)&&!e.isLocalClient(t)&&!t.allowTabSynchronization)throw new Po(Oo.FAILED_PRECONDITION,Wu)})},t.prototype.acquireOrExtendPrimaryLease=function(t){var e=new yu(this.clientId,this.allowTabSynchronization,Date.now());return Yu(t).put(yu.key,e)},t.isAvailable=function(){return fs.isAvailable()},t.buildStoragePrefix=function(t){var e=t.databaseId.projectId;return t.databaseId.isDefaultDatabase||(e+="."+t.databaseId.database),"firestore/"+t.persistenceKey+"/"+e+"/"},t.prototype.releasePrimaryLeaseIfHeld=function(t){var e=this,n=Yu(t);return n.get(yu.key).next(function(t){return e.isLocalClient(t)?(No($u,"Releasing primary lease."),n.delete(yu.key)):ts.resolve()})},t.prototype.isWithinAge=function(t,e){var n=Date.now();return!(t<n-e)&&(!(t>n)||(Co("Detected an update time that is in the future: "+t+" > "+n),!1))},t.prototype.attachVisibilityHandler=function(){var t=this;null!==this.document&&"function"==typeof this.document.addEventListener&&(this.documentVisibilityHandler=function(){t.queue.enqueueAndForget(function(){return t.inForeground="visible"===t.document.visibilityState,t.updateClientMetadataAndTryBecomePrimary()})},this.document.addEventListener("visibilitychange",this.documentVisibilityHandler),this.inForeground="visible"===this.document.visibilityState)},t.prototype.detachVisibilityHandler=function(){this.documentVisibilityHandler&&(ko(null!==this.document&&"function"==typeof this.document.addEventListener,"Expected 'document.addEventListener' to be a function"),this.document.removeEventListener("visibilitychange",this.documentVisibilityHandler),this.documentVisibilityHandler=null)},t.prototype.attachWindowUnloadHook=function(){var t=this;"function"==typeof this.window.addEventListener&&(this.windowUnloadHandler=function(){t.markClientZombied(),t.queue.enqueueAndForget(function(){return t.shutdown()})},this.window.addEventListener("unload",this.windowUnloadHandler))},t.prototype.detachWindowUnloadHook=function(){this.windowUnloadHandler&&(ko("function"==typeof this.window.removeEventListener,"Expected 'window.removeEventListener' to be a function"),this.window.removeEventListener("unload",this.windowUnloadHandler),this.windowUnloadHandler=null)},t.prototype.isClientZombied=function(t){try{var e=null!==this.webStorage.getItem(this.zombiedClientLocalStorageKey(t));return No($u,"Client '"+t+"' "+(e?"is":"is not")+" zombied in LocalStorage"),e}catch(t){return Co($u,"Failed to get zombied client id.",t),!1}},t.prototype.markClientZombied=function(){try{this.webStorage.setItem(this.zombiedClientLocalStorageKey(this.clientId),String(Date.now()))}catch(t){Co("Failed to set zombie client id.",t)}},t.prototype.removeClientZombiedEntry=function(){try{this.webStorage.removeItem(this.zombiedClientLocalStorageKey(this.clientId))}catch(t){}},t.prototype.zombiedClientLocalStorageKey=function(t){return"firestore_zombie_"+this.persistenceKey+"_"+t},t.MAIN_DATABASE="main",t}();function Hu(t){return xt(this,void 0,void 0,function(){return qt(this,function(e){if(!function(t){return t.code===Oo.FAILED_PRECONDITION&&t.message===Qu}(t))throw t;return No($u,"Unexpectedly lost primary lease"),[2]})})}function Yu(t){return t.store(yu.store)}function Xu(t){return t.store(_u.store)}var Ju=function(){function t(t,e){this.db=t,this.inMemoryPins=null,this.garbageCollector=new ju(this,e)}return t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocmentCount(t);return this.db.getQueryCache().getQueryCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocmentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachTarget=function(t,e){return this.db.getQueryCache().forEachTarget(t,e)},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){return this.forEachOrphanedDocument(t,function(t,n){return e(n)})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return Zu(t,e)},t.prototype.removeReference=function(t,e){return Zu(t,e)},t.prototype.removeTargets=function(t,e,n){return this.db.getQueryCache().removeTargets(t,e,n)},t.prototype.removeMutationReference=function(t,e){return Zu(t,e)},t.prototype.isPinned=function(t,e){return this.inMemoryPins.containsKey(e)?ts.resolve(!0):function(t,e){var n=!1;return ss(t).iterateSerial(function(r){return ns(t,r,e).next(function(t){return t&&(n=!0),ts.resolve(!t)})}).next(function(){return n})}(t,e)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=this.db.getRemoteDocumentCache().newChangeBuffer(),i=[],o=0;return this.forEachOrphanedDocument(t,function(a,s){if(s<=e){var u=n.isPinned(t,a).next(function(e){if(!e)return o++,r.getEntry(t,a).next(function(){return r.removeEntry(a),Ts(t).delete([0,ka(a.path)])})});i.push(u)}}).next(function(){return ts.waitFor(i)}).next(function(){return r.apply(t)}).next(function(){return o})},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.db.getQueryCache().updateQueryData(t,n)},t.prototype.updateLimboDocument=function(t,e){return Zu(t,e)},t.prototype.forEachOrphanedDocument=function(t,e){var n,r=Ts(t),i=ya.INVALID;return r.iterate({index:Nu.documentTargetsIndex},function(t,r){var o=t[0],a=(t[1],r.path),s=r.sequenceNumber;0===o?(i!==ya.INVALID&&e(new Ia(Oa(n)),i),i=s,n=a):i=ya.INVALID}).next(function(){i!==ya.INVALID&&e(new Ia(Oa(n)),i)})},t.prototype.getCacheSize=function(t){return this.db.getRemoteDocumentCache().getSize(t)},t}();function Zu(t,e){return Ts(t).put(function(t,e){return new Nu(0,ka(t.path),e)}(e,t.currentSequenceNumber))}var tc=function(){function t(t,e,n){this.remoteDocumentCache=t,this.mutationQueue=e,this.indexManager=n}return t.prototype.getDocument=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKey(t,e).next(function(r){return n.getDocumentInternal(t,e,r)})},t.prototype.getDocumentInternal=function(t,e,n){return this.remoteDocumentCache.getEntry(t,e).next(function(t){for(var r=0,i=n;r<i.length;r++){t=i[r].applyToLocalView(e,t)}return t})},t.prototype.applyLocalMutationsToDocuments=function(t,e,n){var r=Ka();return e.forEach(function(t,e){for(var i=0,o=n;i<o.length;i++){e=o[i].applyToLocalView(t,e)}r=r.insert(t,e)}),r},t.prototype.getDocuments=function(t,e){var n=this;return this.remoteDocumentCache.getEntries(t,e).next(function(e){return n.getLocalViewOfDocuments(t,e)})},t.prototype.getLocalViewOfDocuments=function(t,e){var n=this;return this.mutationQueue.getAllMutationBatchesAffectingDocumentKeys(t,e).next(function(r){var i=n.applyLocalMutationsToDocuments(t,e,r),o=ja();return i.forEach(function(t,e){e||(e=new tu(t,Ma.forDeletedDoc())),o=o.insert(t,e)}),o})},t.prototype.getDocumentsMatchingQuery=function(t,e){return e.isDocumentQuery()?this.getDocumentsMatchingDocumentQuery(t,e.path):e.isCollectionGroupQuery()?this.getDocumentsMatchingCollectionGroupQuery(t,e):this.getDocumentsMatchingCollectionQuery(t,e)},t.prototype.getDocumentsMatchingDocumentQuery=function(t,e){return this.getDocument(t,new Ia(e)).next(function(t){var e=Qa();return t instanceof Zs&&(e=e.insert(t.key,t)),e})},t.prototype.getDocumentsMatchingCollectionGroupQuery=function(t,e){var n=this;ko(e.path.isEmpty(),"Currently we only support collection group queries at the root.");var r=e.collectionGroup,i=Qa();return this.indexManager.getCollectionParents(t,r).next(function(o){return ts.forEach(o,function(o){var a=e.asCollectionQueryAtPath(o.child(r));return n.getDocumentsMatchingCollectionQuery(t,a).next(function(t){t.forEach(function(t,e){i=i.insert(t,e)})})}).next(function(){return i})})},t.prototype.getDocumentsMatchingCollectionQuery=function(t,e){var n,r,i=this;return this.remoteDocumentCache.getDocumentsMatchingQuery(t,e).next(function(r){return n=r,i.mutationQueue.getAllMutationBatchesAffectingQuery(t,e)}).next(function(e){return r=e,i.addMissingBaseDocuments(t,r,n).next(function(t){n=t;for(var e=0,i=r;e<i.length;e++)for(var o=i[e],a=0,s=o.mutations;a<s.length;a++){var u=s[a],c=u.key,h=n.get(c),l=u.applyToLocalView(h,h,o.localWriteTime);n=l instanceof Zs?n.insert(c,l):n.remove(c)}})}).next(function(){return n.forEach(function(t,r){e.matches(r)||(n=n.remove(t))}),n})},t.prototype.addMissingBaseDocuments=function(t,e,n){for(var r=Ha(),i=0,o=e;i<o.length;i++)for(var a=0,s=o[i].mutations;a<s.length;a++){var u=s[a];u instanceof Ps&&null===n.get(u.key)&&(r=r.add(u.key))}var c=n;return this.remoteDocumentCache.getEntries(t,r).next(function(t){return t.forEach(function(t,e){null!==e&&e instanceof Zs&&(c=c.insert(t,e))}),c})},t}(),ec=function(){function t(){this.refsByKey=new Ua(nc.compareByKey),this.refsByTarget=new Ua(nc.compareByTargetId)}return t.prototype.isEmpty=function(){return this.refsByKey.isEmpty()},t.prototype.addReference=function(t,e){var n=new nc(t,e);this.refsByKey=this.refsByKey.add(n),this.refsByTarget=this.refsByTarget.add(n)},t.prototype.addReferences=function(t,e){var n=this;t.forEach(function(t){return n.addReference(t,e)})},t.prototype.removeReference=function(t,e){this.removeRef(new nc(t,e))},t.prototype.removeReferences=function(t,e){var n=this;t.forEach(function(t){return n.removeReference(t,e)})},t.prototype.removeReferencesForId=function(t){var e=this,n=Ia.EMPTY,r=new nc(n,t),i=new nc(n,t+1),o=[];return this.refsByTarget.forEachInRange([r,i],function(t){e.removeRef(t),o.push(t.key)}),o},t.prototype.removeAllReferences=function(){var t=this;this.refsByKey.forEach(function(e){return t.removeRef(e)})},t.prototype.removeRef=function(t){this.refsByKey=this.refsByKey.delete(t),this.refsByTarget=this.refsByTarget.delete(t)},t.prototype.referencesForId=function(t){var e=Ia.EMPTY,n=new nc(e,t),r=new nc(e,t+1),i=Ha();return this.refsByTarget.forEachInRange([n,r],function(t){i=i.add(t.key)}),i},t.prototype.containsKey=function(t){var e=new nc(t,0),n=this.refsByKey.firstAfterOrEqual(e);return null!==n&&t.isEqual(n.key)},t}(),nc=function(){function t(t,e){this.key=t,this.targetOrBatchId=e}return t.compareByKey=function(t,e){return Ia.comparator(t.key,e.key)||oa(t.targetOrBatchId,e.targetOrBatchId)},t.compareByTargetId=function(t,e){return oa(t.targetOrBatchId,e.targetOrBatchId)||Ia.comparator(t.key,e.key)},t}(),rc=function(){function t(t,e){this.persistence=t,this.localViewReferences=new ec,this.queryDataByTarget={},ko(t.started,"LocalStore was passed an unstarted persistence implementation"),this.persistence.referenceDelegate.setInMemoryPins(this.localViewReferences),this.mutationQueue=t.getMutationQueue(e),this.remoteDocuments=t.getRemoteDocumentCache(),this.queryCache=t.getQueryCache(),this.localDocuments=new tc(this.remoteDocuments,this.mutationQueue,this.persistence.getIndexManager())}return t.prototype.handleUserChange=function(t){var e=this;return this.persistence.runTransaction("Handle user change","readonly",function(n){var r;return e.mutationQueue.getAllMutationBatches(n).next(function(i){return r=i,e.mutationQueue=e.persistence.getMutationQueue(t),e.localDocuments=new tc(e.remoteDocuments,e.mutationQueue,e.persistence.getIndexManager()),e.mutationQueue.getAllMutationBatches(n)}).next(function(t){for(var i=[],o=[],a=Ha(),s=0,u=r;s<u.length;s++){var c=u[s];i.push(c.batchId);for(var h=0,l=c.mutations;h<l.length;h++){var f=l[h];a=a.add(f.key)}}for(var p=0,d=t;p<d.length;p++){c=d[p];o.push(c.batchId);for(var m=0,y=c.mutations;m<y.length;m++){f=y[m];a=a.add(f.key)}}return e.localDocuments.getDocuments(n,a).next(function(t){return{affectedDocuments:t,removedBatchIds:i,addedBatchIds:o}})})})},t.prototype.localWrite=function(t){var e=this,n=Pa.now(),r=t.reduce(function(t,e){return t.add(e.key)},Ha());return this.persistence.runTransaction("Locally write mutations","readwrite",function(i){return e.localDocuments.getDocuments(i,r).next(function(r){for(var o=[],a=0,s=t;a<s.length;a++){var u=s[a],c=u.extractBaseValue(r.get(u.key));null!=c&&o.push(new Ps(u.key,c,c.fieldMask(),_s.exists(!0)))}return e.mutationQueue.addMutationBatch(i,n,o,t).next(function(t){var e=t.applyToLocalDocumentSet(r);return{batchId:t.batchId,changes:e}})})})},t.prototype.lookupMutationDocuments=function(t){var e=this;return this.persistence.runTransaction("Lookup mutation documents","readonly",function(n){return e.mutationQueue.lookupMutationKeys(n,t).next(function(t){return t?e.localDocuments.getDocuments(n,t):ts.resolve(null)})})},t.prototype.acknowledgeBatch=function(t){var e=this;return this.persistence.runTransaction("Acknowledge batch","readwrite-primary",function(n){var r=t.batch.keys(),i=e.remoteDocuments.newChangeBuffer();return e.mutationQueue.acknowledgeBatch(n,t.batch,t.streamToken).next(function(){return e.applyWriteToRemoteDocuments(n,t,i)}).next(function(){return i.apply(n)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.rejectBatch=function(t){var e=this;return this.persistence.runTransaction("Reject batch","readwrite-primary",function(n){var r;return e.mutationQueue.lookupMutationBatch(n,t).next(function(t){return ko(null!==t,"Attempt to reject nonexistent batch!"),r=t.keys(),e.mutationQueue.removeMutationBatch(n,t)}).next(function(){return e.mutationQueue.performConsistencyCheck(n)}).next(function(){return e.localDocuments.getDocuments(n,r)})})},t.prototype.getHighestUnacknowledgedBatchId=function(){var t=this;return this.persistence.runTransaction("Get highest unacknowledged batch id","readonly",function(e){return t.mutationQueue.getHighestUnacknowledgedBatchId(e)})},t.prototype.getLastStreamToken=function(){var t=this;return this.persistence.runTransaction("Get last stream token","readonly",function(e){return t.mutationQueue.getLastStreamToken(e)})},t.prototype.setLastStreamToken=function(t){var e=this;return this.persistence.runTransaction("Set last stream token","readwrite-primary",function(n){return e.mutationQueue.setLastStreamToken(n,t)})},t.prototype.getLastRemoteSnapshotVersion=function(){var t=this;return this.persistence.runTransaction("Get last remote snapshot version","readonly",function(e){return t.queryCache.getLastRemoteSnapshotVersion(e)})},t.prototype.applyRemoteEvent=function(e){var n=this,r=this.remoteDocuments.newChangeBuffer(),i=e.snapshotVersion;return this.persistence.runTransaction("Apply remote event","readwrite-primary",function(o){var a=[];qo(e.targetChanges,function(e,r){var s=n.queryDataByTarget[e];if(s){a.push(n.queryCache.removeMatchingKeys(o,r.removedDocuments,e).next(function(){return n.queryCache.addMatchingKeys(o,r.addedDocuments,e)}));var u=r.resumeToken;if(u.length>0){var c=s.withResumeToken(u,i);n.queryDataByTarget[e]=c,t.shouldPersistQueryData(s,c,r)&&a.push(n.queryCache.updateQueryData(o,c))}}});var s=ja(),u=Ha();if(e.documentUpdates.forEach(function(t,e){u=u.add(t)}),a.push(r.getEntries(o,u).next(function(t){e.documentUpdates.forEach(function(i,u){var c=t.get(i);u instanceof tu&&u.version.isEqual(Ma.MIN)?(r.removeEntry(i),s=s.insert(i,u)):null==c||u.version.compareTo(c.version)>0||0===u.version.compareTo(c.version)&&c.hasPendingWrites?(Ma.MIN.isEqual(e.snapshotVersion)&&Co("LocalStore","Cannot add a document when the remote version is zero"),r.addEntry(u),s=s.insert(i,u)):No("LocalStore","Ignoring outdated watch update for ",i,". Current version:",c.version," Watch version:",u.version),e.resolvedLimboDocuments.has(i)&&a.push(n.persistence.referenceDelegate.updateLimboDocument(o,i))})})),!i.isEqual(Ma.MIN)){var c=n.queryCache.getLastRemoteSnapshotVersion(o).next(function(t){return ko(i.compareTo(t)>=0,"Watch stream reverted to previous snapshot?? "+i+" < "+t),n.queryCache.setTargetsMetadata(o,o.currentSequenceNumber,i)});a.push(c)}return ts.waitFor(a).next(function(){return r.apply(o)}).next(function(){return n.localDocuments.getLocalViewOfDocuments(o,s)})})},t.shouldPersistQueryData=function(t,e,n){return ko(e.resumeToken.length>0,"Attempted to persist query data with no resume token"),0===t.resumeToken.length||(e.snapshotVersion.toMicroseconds()-t.snapshotVersion.toMicroseconds()>=this.RESUME_TOKEN_MAX_AGE_MICROS||n.addedDocuments.size+n.modifiedDocuments.size+n.removedDocuments.size>0)},t.prototype.notifyLocalViewChanges=function(t){var e=this;return this.persistence.runTransaction("notifyLocalViewChanges","readwrite",function(n){return ts.forEach(t,function(t){return e.localViewReferences.addReferences(t.addedKeys,t.targetId),e.localViewReferences.removeReferences(t.removedKeys,t.targetId),ts.forEach(t.removedKeys,function(t){return e.persistence.referenceDelegate.removeReference(n,t)})})})},t.prototype.nextMutationBatch=function(t){var e=this;return this.persistence.runTransaction("Get next mutation batch","readonly",function(n){return void 0===t&&(t=-1),e.mutationQueue.getNextMutationBatchAfterBatchId(n,t)})},t.prototype.readDocument=function(t){var e=this;return this.persistence.runTransaction("read document","readonly",function(n){return e.localDocuments.getDocument(n,t)})},t.prototype.allocateQuery=function(t){var e=this;return this.persistence.runTransaction("Allocate query","readwrite",function(n){var r;return e.queryCache.getQueryData(n,t).next(function(i){return i?(r=i,ts.resolve()):e.queryCache.allocateTargetId(n).next(function(i){return r=new Lu(t,i,Ru.Listen,n.currentSequenceNumber),e.queryCache.addQueryData(n,r)})}).next(function(){return ko(!e.queryDataByTarget[r.targetId],"Tried to allocate an already allocated query: "+t),e.queryDataByTarget[r.targetId]=r,r})})},t.prototype.releaseQuery=function(t,e){var n=this,r=e?"readwrite":"readwrite-primary";return this.persistence.runTransaction("Release query",r,function(r){return n.queryCache.getQueryData(r,t).next(function(i){ko(null!=i,"Tried to release nonexistent query: "+t);var o=i.targetId,a=n.queryDataByTarget[o],s=n.localViewReferences.removeReferencesForId(o);return delete n.queryDataByTarget[o],e?ts.resolve():ts.forEach(s,function(t){return n.persistence.referenceDelegate.removeReference(r,t)}).next(function(){return n.persistence.referenceDelegate.removeTarget(r,a)})})})},t.prototype.executeQuery=function(t){var e=this;return this.persistence.runTransaction("Execute query","readonly",function(n){return e.localDocuments.getDocumentsMatchingQuery(n,t)})},t.prototype.remoteDocumentKeys=function(t){var e=this;return this.persistence.runTransaction("Remote document keys","readonly",function(n){return e.queryCache.getMatchingKeysForTargetId(n,t)})},t.prototype.getActiveClients=function(){return this.persistence.getActiveClients()},t.prototype.removeCachedMutationBatchMetadata=function(t){this.mutationQueue.removeCachedMutationKeys(t)},t.prototype.setNetworkEnabled=function(t){this.persistence.setNetworkEnabled(t)},t.prototype.applyWriteToRemoteDocuments=function(t,e,n){var r=this,i=e.batch,o=i.keys(),a=ts.resolve();return o.forEach(function(r){a=a.next(function(){return n.getEntry(t,r)}).next(function(t){var o=t,a=e.docVersions.get(r);ko(null!==a,"ackVersions should contain every doc in the write."),(!o||o.version.compareTo(a)<0)&&((o=i.applyToRemoteDocument(r,o,e))?n.addEntry(o):ko(!t,"Mutation batch "+i+" applied to document "+t+" resulted in null"))})}),a.next(function(){return r.mutationQueue.removeMutationBatch(t,i)})},t.prototype.collectGarbage=function(t){var e=this;return this.persistence.runTransaction("Collect garbage","readwrite-primary",function(n){return t.collect(n,e.queryDataByTarget)})},t.prototype.getQueryForTarget=function(t){var e=this;return this.queryDataByTarget[t]?Promise.resolve(this.queryDataByTarget[t].query):this.persistence.runTransaction("Get query data","readonly",function(n){return e.queryCache.getQueryDataForTarget(n,t).next(function(t){return t?t.query:null})})},t.prototype.getNewDocumentChanges=function(){var t=this;return this.persistence.runTransaction("Get new document changes","readonly",function(e){return t.remoteDocuments.getNewDocumentChanges(e)})},t.RESUME_TOKEN_MAX_AGE_MICROS=3e8,t}(),ic=function(){function t(t,e){this.indexManager=t,this.referenceDelegate=e,this.mutationQueue=[],this.nextBatchId=1,this.lastStreamToken=Ro(),this.batchesByDocumentKey=new Ua(nc.compareByKey)}return t.prototype.checkEmpty=function(t){return ts.resolve(0===this.mutationQueue.length)},t.prototype.acknowledgeBatch=function(t,e,n){var r=e.batchId,i=this.indexOfExistingBatchId(r,"acknowledged");ko(0===i,"Can only acknowledge the first batch in the mutation queue");var o=this.mutationQueue[i];return ko(r===o.batchId,"Queue ordering failure: expected batch "+r+", got batch "+o.batchId),this.lastStreamToken=n,ts.resolve()},t.prototype.getLastStreamToken=function(t){return ts.resolve(this.lastStreamToken)},t.prototype.setLastStreamToken=function(t,e){return this.lastStreamToken=e,ts.resolve()},t.prototype.addMutationBatch=function(t,e,n,r){ko(0!==r.length,"Mutation batches should not be empty");var i=this.nextBatchId;(this.nextBatchId++,this.mutationQueue.length>0)&&ko(this.mutationQueue[this.mutationQueue.length-1].batchId<i,"Mutation batchIDs must be monotonically increasing order");var o=new Ja(i,e,n,r);this.mutationQueue.push(o);for(var a=0,s=r;a<s.length;a++){var u=s[a];this.batchesByDocumentKey=this.batchesByDocumentKey.add(new nc(u.key,i)),this.indexManager.addToCollectionParentIndex(t,u.key.path.popLast())}return ts.resolve(o)},t.prototype.lookupMutationBatch=function(t,e){return ts.resolve(this.findMutationBatch(e))},t.prototype.lookupMutationKeys=function(t,e){var n=this.findMutationBatch(e);return ko(null!=n,"Failed to find local mutation batch."),ts.resolve(n.keys())},t.prototype.getNextMutationBatchAfterBatchId=function(t,e){var n=e+1,r=this.indexOfBatchId(n),i=r<0?0:r;return ts.resolve(this.mutationQueue.length>i?this.mutationQueue[i]:null)},t.prototype.getHighestUnacknowledgedBatchId=function(){return ts.resolve(0===this.mutationQueue.length?-1:this.nextBatchId-1)},t.prototype.getAllMutationBatches=function(t){return ts.resolve(this.mutationQueue.slice())},t.prototype.getAllMutationBatchesAffectingDocumentKey=function(t,e){var n=this,r=new nc(e,0),i=new nc(e,Number.POSITIVE_INFINITY),o=[];return this.batchesByDocumentKey.forEachInRange([r,i],function(t){ko(e.isEqual(t.key),"Should only iterate over a single key's batches");var r=n.findMutationBatch(t.targetOrBatchId);ko(null!==r,"Batches in the index must exist in the main table"),o.push(r)}),ts.resolve(o)},t.prototype.getAllMutationBatchesAffectingDocumentKeys=function(t,e){var n=this,r=new Ua(oa);return e.forEach(function(t){var e=new nc(t,0),i=new nc(t,Number.POSITIVE_INFINITY);n.batchesByDocumentKey.forEachInRange([e,i],function(e){ko(t.isEqual(e.key),"For each key, should only iterate over a single key's batches"),r=r.add(e.targetOrBatchId)})}),ts.resolve(this.findMutationBatches(r))},t.prototype.getAllMutationBatchesAffectingQuery=function(t,e){ko(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");var n=e.path,r=n.length+1,i=n;Ia.isDocumentKey(i)||(i=i.child(""));var o=new nc(new Ia(i),0),a=new Ua(oa);return this.batchesByDocumentKey.forEachWhile(function(t){var e=t.key.path;return!!n.isPrefixOf(e)&&(e.length===r&&(a=a.add(t.targetOrBatchId)),!0)},o),ts.resolve(this.findMutationBatches(a))},t.prototype.findMutationBatches=function(t){var e=this,n=[];return t.forEach(function(t){var r=e.findMutationBatch(t);null!==r&&n.push(r)}),n},t.prototype.removeMutationBatch=function(t,e){var n=this;ko(0===this.indexOfExistingBatchId(e.batchId,"removed"),"Can only remove the first entry of the mutation queue"),this.mutationQueue.shift();var r=this.batchesByDocumentKey;return ts.forEach(e.mutations,function(i){var o=new nc(i.key,e.batchId);return r=r.delete(o),n.referenceDelegate.removeMutationReference(t,i.key)}).next(function(){n.batchesByDocumentKey=r})},t.prototype.removeCachedMutationKeys=function(t){},t.prototype.containsKey=function(t,e){var n=new nc(e,0),r=this.batchesByDocumentKey.firstAfterOrEqual(n);return ts.resolve(e.isEqual(r&&r.key))},t.prototype.performConsistencyCheck=function(t){return 0===this.mutationQueue.length&&ko(this.batchesByDocumentKey.isEmpty(),"Document leak -- detected dangling mutation references when queue is empty."),ts.resolve()},t.prototype.indexOfExistingBatchId=function(t,e){var n=this.indexOfBatchId(t);return ko(n>=0&&n<this.mutationQueue.length,"Batches must exist to be "+e),n},t.prototype.indexOfBatchId=function(t){return 0===this.mutationQueue.length?0:t-this.mutationQueue[0].batchId},t.prototype.findMutationBatch=function(t){var e=this.indexOfBatchId(t);if(e<0||e>=this.mutationQueue.length)return null;var n=this.mutationQueue[e];return ko(n.batchId===t,"If found batch must match"),n},t}(),oc=function(){function t(t){this.persistence=t,this.queries=new nu(function(t){return t.canonicalId()}),this.lastRemoteSnapshotVersion=Ma.MIN,this.highestTargetId=0,this.highestSequenceNumber=0,this.references=new ec,this.targetCount=0,this.targetIdGenerator=hs.forQueryCache()}return t.prototype.getTargetCount=function(t){return ts.resolve(this.targetCount)},t.prototype.forEachTarget=function(t,e){return this.queries.forEach(function(t,n){return e(n)}),ts.resolve()},t.prototype.getLastRemoteSnapshotVersion=function(t){return ts.resolve(this.lastRemoteSnapshotVersion)},t.prototype.getHighestSequenceNumber=function(t){return ts.resolve(this.highestSequenceNumber)},t.prototype.allocateTargetId=function(t){var e=this.targetIdGenerator.after(this.highestTargetId);return this.highestTargetId=e,ts.resolve(e)},t.prototype.setTargetsMetadata=function(t,e,n){return n&&(this.lastRemoteSnapshotVersion=n),e>this.highestSequenceNumber&&(this.highestSequenceNumber=e),ts.resolve()},t.prototype.saveQueryData=function(t){this.queries.set(t.query,t);var e=t.targetId;e>this.highestTargetId&&(this.highestTargetId=e),t.sequenceNumber>this.highestSequenceNumber&&(this.highestSequenceNumber=t.sequenceNumber)},t.prototype.addQueryData=function(t,e){return ko(!this.queries.has(e.query),"Adding a query that already exists"),this.saveQueryData(e),this.targetCount+=1,ts.resolve()},t.prototype.updateQueryData=function(t,e){return ko(this.queries.has(e.query),"Updating a non-existent query"),this.saveQueryData(e),ts.resolve()},t.prototype.removeQueryData=function(t,e){return ko(this.targetCount>0,"Removing a target from an empty cache"),ko(this.queries.has(e.query),"Removing a non-existent target from the cache"),this.queries.delete(e.query),this.references.removeReferencesForId(e.targetId),this.targetCount-=1,ts.resolve()},t.prototype.removeTargets=function(t,e,n){var r=this,i=0,o=[];return this.queries.forEach(function(a,s){s.sequenceNumber<=e&&!n[s.targetId]&&(r.queries.delete(a),o.push(r.removeMatchingKeysForTargetId(t,s.targetId)),i++)}),ts.waitFor(o).next(function(){return i})},t.prototype.getQueryCount=function(t){return ts.resolve(this.targetCount)},t.prototype.getQueryData=function(t,e){var n=this.queries.get(e)||null;return ts.resolve(n)},t.prototype.getQueryDataForTarget=function(t,e){return Do("Not yet implemented.")},t.prototype.addMatchingKeys=function(t,e,n){this.references.addReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.addReference(t,e))}),ts.waitFor(i)},t.prototype.removeMatchingKeys=function(t,e,n){this.references.removeReferences(e,n);var r=this.persistence.referenceDelegate,i=[];return r&&e.forEach(function(e){i.push(r.removeReference(t,e))}),ts.waitFor(i)},t.prototype.removeMatchingKeysForTargetId=function(t,e){return this.references.removeReferencesForId(e),ts.resolve()},t.prototype.getMatchingKeysForTargetId=function(t,e){var n=this.references.referencesForId(e);return ts.resolve(n)},t.prototype.containsKey=function(t,e){return ts.resolve(this.references.containsKey(e))},t}();var ac=function(){function t(t,e){this.indexManager=t,this.sizer=e,this.docs=new La(Ia.comparator),this.newDocumentChanges=Ha(),this.size=0}return t.prototype.addEntry=function(t,e){var n=e.key,r=this.docs.get(n),i=r?r.size:0,o=this.sizer(e);return this.docs=this.docs.insert(n,{maybeDocument:e,size:o}),this.newDocumentChanges=this.newDocumentChanges.add(n),this.size+=o-i,this.indexManager.addToCollectionParentIndex(t,n.path.popLast())},t.prototype.removeEntry=function(t){var e=this.docs.get(t);e&&(this.docs=this.docs.remove(t),this.size-=e.size)},t.prototype.getEntry=function(t,e){var n=this.docs.get(e);return ts.resolve(n?n.maybeDocument:null)},t.prototype.getEntries=function(t,e){var n=this,r=Ka();return e.forEach(function(t){var e=n.docs.get(t);r=r.insert(t,e?e.maybeDocument:null)}),ts.resolve(r)},t.prototype.getDocumentsMatchingQuery=function(t,e){ko(!e.isCollectionGroupQuery(),"CollectionGroup queries should be handled in LocalDocumentsView");for(var n=Qa(),r=new Ia(e.path.child("")),i=this.docs.getIteratorFrom(r);i.hasNext();){var o=i.getNext(),a=o.key,s=o.value.maybeDocument;if(!e.path.isPrefixOf(a.path))break;s instanceof Zs&&e.matches(s)&&(n=n.insert(s.key,s))}return ts.resolve(n)},t.prototype.forEachDocumentKey=function(t,e){return ts.forEach(this.docs,function(t){return e(t)})},t.prototype.getNewDocumentChanges=function(t){var e=this,n=ja();return this.newDocumentChanges.forEach(function(t){var r=e.docs.get(t),i=r?r.maybeDocument:new tu(t,Ma.forDeletedDoc());n=n.insert(t,i)}),this.newDocumentChanges=Ha(),ts.resolve(n)},t.prototype.newChangeBuffer=function(){return new t.RemoteDocumentChangeBuffer(this)},t.prototype.getSize=function(t){return ts.resolve(this.size)},t.RemoteDocumentChangeBuffer=function(t){function e(e){var n=t.call(this)||this;return n.documentCache=e,n}return Mt(e,t),e.prototype.applyChanges=function(t){var e=this,n=[];return this.changes.forEach(function(r,i){i?n.push(e.documentCache.addEntry(t,i)):e.documentCache.removeEntry(r)}),ts.waitFor(n)},e.prototype.getFromCache=function(t,e){return this.documentCache.getEntry(t,e)},e.prototype.getAllFromCache=function(t,e){return this.documentCache.getEntries(t,e)},e}(ru),t}(),sc=function(){function t(t,e){var n=this;this.clientId=t,this.mutationQueues={},this.listenSequence=new ya(0),this._started=!1,this._started=!0,this.referenceDelegate=e(this),this.queryCache=new oc(this);this.indexManager=new lu,this.remoteDocumentCache=new ac(this.indexManager,function(t){return n.referenceDelegate.documentSize(t)})}return t.createLruPersistence=function(e,n,r){return new t(e,function(t){return new hc(t,new xu(n),r)})},t.createEagerPersistence=function(e){return new t(e,function(t){return new cc(t)})},t.prototype.shutdown=function(){return this._started=!1,Promise.resolve()},Object.defineProperty(t.prototype,"started",{get:function(){return this._started},enumerable:!0,configurable:!0}),t.prototype.getActiveClients=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){return[2,[this.clientId]]})})},t.prototype.setPrimaryStateListener=function(t){return t(!0)},t.prototype.setDatabaseDeletedListener=function(){},t.prototype.setNetworkEnabled=function(t){},t.prototype.getIndexManager=function(){return this.indexManager},t.prototype.getMutationQueue=function(t){var e=this.mutationQueues[t.toKey()];return e||(e=new ic(this.indexManager,this.referenceDelegate),this.mutationQueues[t.toKey()]=e),e},t.prototype.getQueryCache=function(){return this.queryCache},t.prototype.getRemoteDocumentCache=function(){return this.remoteDocumentCache},t.prototype.runTransaction=function(t,e,n){var r=this;No("MemoryPersistence","Starting transaction:",t);var i=new uc(this.listenSequence.next());return this.referenceDelegate.onTransactionStarted(),n(i).next(function(t){return r.referenceDelegate.onTransactionCommitted(i).next(function(){return t})}).toPromise()},t.prototype.mutationQueuesContainKey=function(t,e){return ts.or((n=this.mutationQueues,r=[],Fo(n,function(t,e){return r.push(e)}),r).map(function(n){return function(){return n.containsKey(t,e)}}));var n,r},t}(),uc=function(){return function(t){this.currentSequenceNumber=t}}(),cc=function(){function t(t){this.persistence=t,this.inMemoryPins=null,this._orphanedDocuments=null}return Object.defineProperty(t.prototype,"orphanedDocuments",{get:function(){if(this._orphanedDocuments)return this._orphanedDocuments;throw Do("orphanedDocuments is only valid during a transaction.")},enumerable:!0,configurable:!0}),t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.addReference=function(t,e){return this.orphanedDocuments.delete(e),ts.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedDocuments.add(e),ts.resolve()},t.prototype.removeMutationReference=function(t,e){return this.orphanedDocuments.add(e),ts.resolve()},t.prototype.removeTarget=function(t,e){var n=this,r=this.persistence.getQueryCache();return r.getMatchingKeysForTargetId(t,e.targetId).next(function(t){t.forEach(function(t){return n.orphanedDocuments.add(t)})}).next(function(){return r.removeQueryData(t,e)})},t.prototype.onTransactionStarted=function(){this._orphanedDocuments=new Set},t.prototype.onTransactionCommitted=function(t){var e=this,n=this.persistence.getRemoteDocumentCache().newChangeBuffer();return ts.forEach(this.orphanedDocuments,function(r){return e.isReferenced(t,r).next(function(t){t||n.removeEntry(r)})}).next(function(){return e._orphanedDocuments=null,n.apply(t)})},t.prototype.updateLimboDocument=function(t,e){var n=this;return this.isReferenced(t,e).next(function(t){t?n.orphanedDocuments.delete(e):n.orphanedDocuments.add(e)})},t.prototype.documentSize=function(t){return 0},t.prototype.isReferenced=function(t,e){var n=this;return ts.or([function(){return n.persistence.getQueryCache().containsKey(t,e)},function(){return n.persistence.mutationQueuesContainKey(t,e)},function(){return ts.resolve(n.inMemoryPins.containsKey(e))}])},t}(),hc=function(){function t(t,e,n){this.persistence=t,this.serializer=e,this.inMemoryPins=null,this.orphanedSequenceNumbers=new nu(function(t){return ka(t.path)}),this.garbageCollector=new ju(this,n)}return t.prototype.onTransactionStarted=function(){},t.prototype.onTransactionCommitted=function(t){return ts.resolve()},t.prototype.forEachTarget=function(t,e){return this.persistence.getQueryCache().forEachTarget(t,e)},t.prototype.getSequenceNumberCount=function(t){var e=this.orphanedDocumentCount(t);return this.persistence.getQueryCache().getTargetCount(t).next(function(t){return e.next(function(e){return t+e})})},t.prototype.orphanedDocumentCount=function(t){var e=0;return this.forEachOrphanedDocumentSequenceNumber(t,function(t){e++}).next(function(){return e})},t.prototype.forEachOrphanedDocumentSequenceNumber=function(t,e){var n=this;return ts.forEach(this.orphanedSequenceNumbers,function(r,i){return n.isPinned(t,r,i).next(function(t){return t?ts.resolve():e(i)})})},t.prototype.setInMemoryPins=function(t){this.inMemoryPins=t},t.prototype.removeTargets=function(t,e,n){return this.persistence.getQueryCache().removeTargets(t,e,n)},t.prototype.removeOrphanedDocuments=function(t,e){var n=this,r=0,i=this.persistence.getRemoteDocumentCache(),o=i.newChangeBuffer();return i.forEachDocumentKey(t,function(i){return n.isPinned(t,i,e).next(function(t){t||(r++,o.removeEntry(i))})}).next(function(){return o.apply(t)}).next(function(){return r})},t.prototype.removeMutationReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),ts.resolve()},t.prototype.removeTarget=function(t,e){var n=e.withSequenceNumber(t.currentSequenceNumber);return this.persistence.getQueryCache().updateQueryData(t,n)},t.prototype.addReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),ts.resolve()},t.prototype.removeReference=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),ts.resolve()},t.prototype.updateLimboDocument=function(t,e){return this.orphanedSequenceNumbers.set(e,t.currentSequenceNumber),ts.resolve()},t.prototype.documentSize=function(t){var e,n=this.serializer.toDbRemoteDocument(t);if(n.document)e=n.document;else if(n.unknownDocument)e=n.unknownDocument;else{if(!n.noDocument)throw Do("Unknown remote document type");e=n.noDocument}return JSON.stringify(e).length},t.prototype.isPinned=function(t,e,n){var r=this;return ts.or([function(){return r.persistence.mutationQueuesContainKey(t,e)},function(){return ts.resolve(r.inMemoryPins.containsKey(e))},function(){return r.persistence.getQueryCache().containsKey(t,e)},function(){var t=r.orphanedSequenceNumbers.get(e);return ts.resolve(void 0!==t&&t>n)}])},t.prototype.getCacheSize=function(t){return this.persistence.getRemoteDocumentCache().getSize(t)},t}(),lc=Number,fc=lc.MIN_SAFE_INTEGER||-(Math.pow(2,53)-1),pc=lc.MAX_SAFE_INTEGER||Math.pow(2,53)-1,dc=lc.isInteger||function(t){return"number"==typeof t&&isFinite(t)&&Math.floor(t)===t};function mc(t){return null==t}function yc(t){return dc(t)&&t<=pc&&t>=fc}var gc,vc=1e3,bc=1.5,wc=6e4,Ic=function(){function t(t,e,n,r,i){void 0===n&&(n=vc),void 0===r&&(r=bc),void 0===i&&(i=wc),this.queue=t,this.timerId=e,this.initialDelayMs=n,this.backoffFactor=r,this.maxDelayMs=i,this.currentBaseMs=0,this.timerPromise=null,this.lastAttemptTime=Date.now(),this.reset()}return t.prototype.reset=function(){this.currentBaseMs=0},t.prototype.resetToMax=function(){this.currentBaseMs=this.maxDelayMs},t.prototype.backoffAndRun=function(t){var e=this;this.cancel();var n=Math.floor(this.currentBaseMs+this.jitterDelayMs()),r=Math.max(0,Date.now()-this.lastAttemptTime),i=Math.max(0,n-r);this.currentBaseMs>0&&No("ExponentialBackoff","Backing off for "+i+" ms (base delay: "+this.currentBaseMs+" ms, delay with jitter: "+n+" ms, last attempt: "+r+" ms ago)"),this.timerPromise=this.queue.enqueueAfterDelay(this.timerId,i,function(){return e.lastAttemptTime=Date.now(),t()}),this.currentBaseMs*=this.backoffFactor,this.currentBaseMs<this.initialDelayMs&&(this.currentBaseMs=this.initialDelayMs),this.currentBaseMs>this.maxDelayMs&&(this.currentBaseMs=this.maxDelayMs)},t.prototype.cancel=function(){null!==this.timerPromise&&(this.timerPromise.cancel(),this.timerPromise=null)},t.prototype.jitterDelayMs=function(){return(Math.random()-.5)*this.currentBaseMs},t}();!function(t){t[t.Initial=0]="Initial",t[t.Starting=1]="Starting",t[t.Open=2]="Open",t[t.Error=3]="Error",t[t.Backoff=4]="Backoff"}(gc||(gc={}));var Ec,Tc,Sc=function(){function t(t,e,n,r,i,o){this.queue=t,this.idleTimerId=n,this.connection=r,this.credentialsProvider=i,this.listener=o,this.state=gc.Initial,this.closeCount=0,this.idleTimer=null,this.stream=null,this.backoff=new Ic(t,e)}return t.prototype.isStarted=function(){return this.state===gc.Starting||this.state===gc.Open||this.state===gc.Backoff},t.prototype.isOpen=function(){return this.state===gc.Open},t.prototype.start=function(){this.state!==gc.Error?(ko(this.state===gc.Initial,"Already started"),this.auth()):this.performBackoff()},t.prototype.stop=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return this.isStarted()?[4,this.close(gc.Initial)]:[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.inhibitBackoff=function(){ko(!this.isStarted(),"Can only inhibit backoff in a stopped state"),this.state=gc.Initial,this.backoff.reset()},t.prototype.markIdle=function(){var t=this;this.isOpen()&&null===this.idleTimer&&(this.idleTimer=this.queue.enqueueAfterDelay(this.idleTimerId,6e4,function(){return t.handleIdleCloseTimer()}))},t.prototype.sendRequest=function(t){this.cancelIdleCheck(),this.stream.send(t)},t.prototype.handleIdleCloseTimer=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){return this.isOpen()?[2,this.close(gc.Initial)]:[2]})})},t.prototype.cancelIdleCheck=function(){this.idleTimer&&(this.idleTimer.cancel(),this.idleTimer=null)},t.prototype.close=function(t,e){return xt(this,void 0,void 0,function(){return qt(this,function(n){switch(n.label){case 0:return ko(this.isStarted(),"Only started streams should be closed."),ko(t===gc.Error||mc(e),"Can't provide an error when not in an error state."),this.cancelIdleCheck(),this.backoff.cancel(),this.closeCount++,t!==gc.Error?this.backoff.reset():e&&e.code===Oo.RESOURCE_EXHAUSTED?(Co(e.toString()),Co("Using maximum backoff delay to prevent overloading the backend."),this.backoff.resetToMax()):e&&e.code===Oo.UNAUTHENTICATED&&this.credentialsProvider.invalidateToken(),null!==this.stream&&(this.tearDown(),this.stream.close(),this.stream=null),this.state=t,[4,this.listener.onClose(e)];case 1:return n.sent(),[2]}})})},t.prototype.tearDown=function(){},t.prototype.auth=function(){var t=this;ko(this.state===gc.Initial,"Must be in initial state to auth"),this.state=gc.Starting;var e=this.getCloseGuardedDispatcher(this.closeCount),n=this.closeCount;this.credentialsProvider.getToken().then(function(e){t.closeCount===n&&t.startStream(e)},function(n){e(function(){var e=new Po(Oo.UNKNOWN,"Fetching auth token failed: "+n.message);return t.handleStreamClose(e)})})},t.prototype.startStream=function(t){var e=this;ko(this.state===gc.Starting,"Trying to start stream in a non-starting state");var n=this.getCloseGuardedDispatcher(this.closeCount);this.stream=this.startRpc(t),this.stream.onOpen(function(){n(function(){return ko(e.state===gc.Starting,"Expected stream to be in state Starting, but was "+e.state),e.state=gc.Open,e.listener.onOpen()})}),this.stream.onClose(function(t){n(function(){return e.handleStreamClose(t)})}),this.stream.onMessage(function(t){n(function(){return e.onMessage(t)})})},t.prototype.performBackoff=function(){var t=this;ko(this.state===gc.Error,"Should only perform backoff when in Error state"),this.state=gc.Backoff,this.backoff.backoffAndRun(function(){return xt(t,void 0,void 0,function(){return qt(this,function(t){return ko(this.state===gc.Backoff,"Backoff elapsed but state is now: "+this.state),this.state=gc.Initial,this.start(),ko(this.isStarted(),"PersistentStream should have started"),[2]})})})},t.prototype.handleStreamClose=function(t){return ko(this.isStarted(),"Can't handle server close on non-started stream"),No("PersistentStream","close with error: "+t),this.stream=null,this.close(gc.Error,t)},t.prototype.getCloseGuardedDispatcher=function(t){var e=this;return function(n){e.queue.enqueueAndForget(function(){return e.closeCount===t?n():(No("PersistentStream","stream callback skipped by getCloseGuardedDispatcher."),Promise.resolve())})}},t}(),Nc=function(t){function e(e,n,r,i,o){var a=t.call(this,e,ha.ListenStreamConnectionBackoff,ha.ListenStreamIdle,n,r,o)||this;return a.serializer=i,a}return Mt(e,t),e.prototype.startRpc=function(t){return this.connection.openStream("Listen",t)},e.prototype.onMessage=function(t){this.backoff.reset();var e=this.serializer.fromWatchChange(t),n=this.serializer.versionFromListenResponse(t);return this.listener.onWatchChange(e,n)},e.prototype.watch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.addTarget=this.serializer.toTarget(t);var n=this.serializer.toListenRequestLabels(t);n&&(e.labels=n),this.sendRequest(e)},e.prototype.unwatch=function(t){var e={};e.database=this.serializer.encodedDatabaseId,e.removeTarget=t,this.sendRequest(e)},e}(Sc),Cc=function(t){function e(e,n,r,i,o){var a=t.call(this,e,ha.WriteStreamConnectionBackoff,ha.WriteStreamIdle,n,r,o)||this;return a.serializer=i,a.handshakeComplete_=!1,a.lastStreamToken=Ro(),a}return Mt(e,t),Object.defineProperty(e.prototype,"handshakeComplete",{get:function(){return this.handshakeComplete_},enumerable:!0,configurable:!0}),e.prototype.start=function(){this.handshakeComplete_=!1,t.prototype.start.call(this)},e.prototype.tearDown=function(){this.handshakeComplete_&&this.writeMutations([])},e.prototype.startRpc=function(t){return this.connection.openStream("Write",t)},e.prototype.onMessage=function(t){if(ko(!!t.streamToken,"Got a write response without a stream token"),this.lastStreamToken=t.streamToken,this.handshakeComplete_){this.backoff.reset();var e=this.serializer.fromWriteResults(t.writeResults,t.commitTime),n=this.serializer.fromVersion(t.commitTime);return this.listener.onMutationResult(n,e)}return ko(!t.writeResults||0===t.writeResults.length,"Got mutation results for handshake"),this.handshakeComplete_=!0,this.listener.onHandshakeComplete()},e.prototype.writeHandshake=function(){ko(this.isOpen(),"Writing handshake requires an opened stream"),ko(!this.handshakeComplete_,"Handshake already completed");var t={};t.database=this.serializer.encodedDatabaseId,this.sendRequest(t)},e.prototype.writeMutations=function(t){var e=this;ko(this.isOpen(),"Writing mutations requires an opened stream"),ko(this.handshakeComplete_,"Handshake must be complete before writing mutations"),ko(this.lastStreamToken.length>0,"Trying to write mutation without a token");var n={streamToken:this.lastStreamToken,writes:t.map(function(t){return e.serializer.toMutation(t)})};this.sendRequest(n)},e}(Sc),Ac=function(){function t(t,e,n,r){this.queue=t,this.connection=e,this.credentials=n,this.serializer=r}return t.prototype.newPersistentWriteStream=function(t){return new Cc(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.newPersistentWatchStream=function(t){return new Nc(this.queue,this.connection,this.credentials,this.serializer,t)},t.prototype.commit=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,writes:t.map(function(t){return e.serializer.toMutation(t)})};return this.invokeRPC("Commit",n).then(function(t){return e.serializer.fromWriteResults(t.writeResults,t.commitTime)})},t.prototype.lookup=function(t){var e=this,n={database:this.serializer.encodedDatabaseId,documents:t.map(function(t){return e.serializer.toName(t)})};return this.invokeStreamingRPC("BatchGetDocuments",n).then(function(n){var r=ja();n.forEach(function(t){var n=e.serializer.fromMaybeDocument(t);r=r.insert(n.key,n)});var i=[];return t.forEach(function(t){var e=r.get(t);ko(!!e,"Missing entity in write response for "+t),i.push(e)}),i})},t.prototype.invokeRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeRPC(t,e,r)}).catch(function(t){throw t.code===Oo.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t.prototype.invokeStreamingRPC=function(t,e){var n=this;return this.credentials.getToken().then(function(r){return n.connection.invokeStreamingRPC(t,e,r)}).catch(function(t){throw t.code===Oo.UNAUTHENTICATED&&n.credentials.invalidateToken(),t})},t}(),Dc=function(){function t(t){this.datastore=t,this.readVersions=Ga(),this.mutations=[],this.committed=!1,this.lastWriteError=null,this.writtenDocs=new Set}return t.prototype.lookup=function(t){return xt(this,void 0,void 0,function(){var e,n=this;return qt(this,function(r){switch(r.label){case 0:if(this.ensureCommitNotCalled(),this.mutations.length>0)throw new Po(Oo.INVALID_ARGUMENT,"Firestore transactions require all reads to be executed before all writes.");return[4,this.datastore.lookup(t)];case 1:return(e=r.sent()).forEach(function(t){t instanceof tu||t instanceof Zs?n.recordVersion(t):Do("Document in a transaction was a "+t.constructor.name)}),[2,e]}})})},t.prototype.set=function(t,e){this.write(e.toMutations(t,this.precondition(t))),this.writtenDocs.add(t)},t.prototype.update=function(t,e){try{this.write(e.toMutations(t,this.preconditionForUpdate(t)))}catch(t){this.lastWriteError=t}this.writtenDocs.add(t)},t.prototype.delete=function(t){this.write([new Ls(t,this.precondition(t))]),this.writtenDocs.add(t)},t.prototype.commit=function(){return xt(this,void 0,void 0,function(){var t;return qt(this,function(e){switch(e.label){case 0:if(this.ensureCommitNotCalled(),this.lastWriteError)throw this.lastWriteError;if(t=this.readVersions,this.mutations.forEach(function(e){t=t.remove(e.key)}),!t.isEmpty())throw new Po(Oo.INVALID_ARGUMENT,"Every document read in a transaction must also be written.");return[4,this.datastore.commit(this.mutations)];case 1:return e.sent(),this.committed=!0,[2]}})})},t.prototype.recordVersion=function(t){var e;if(t instanceof Zs)e=t.version;else{if(!(t instanceof tu))throw Do("Document in a transaction was a "+t.constructor.name);e=Ma.forDeletedDoc()}var n=this.readVersions.get(t.key);if(null!==n){if(!e.isEqual(n))throw new Po(Oo.ABORTED,"Document version changed between two reads.")}else this.readVersions=this.readVersions.insert(t.key,e)},t.prototype.precondition=function(t){var e=this.readVersions.get(t);return!this.writtenDocs.has(t)&&e?_s.updateTime(e):_s.NONE},t.prototype.preconditionForUpdate=function(t){var e=this.readVersions.get(t);if(!this.writtenDocs.has(t)&&e){if(e.isEqual(Ma.forDeletedDoc()))throw new Po(Oo.INVALID_ARGUMENT,"Can't update a document that doesn't exist.");return _s.updateTime(e)}return _s.exists(!0)},t.prototype.write=function(t){this.ensureCommitNotCalled(),this.mutations=this.mutations.concat(t)},t.prototype.ensureCommitNotCalled=function(){ko(!this.committed,"A transaction object cannot be used after its update callback has been invoked.")},t}();!function(t){t[t.Unknown=0]="Unknown",t[t.Online=1]="Online",t[t.Offline=2]="Offline"}(Ec||(Ec={})),function(t){t[t.RemoteStore=0]="RemoteStore",t[t.SharedClientState=1]="SharedClientState"}(Tc||(Tc={}));var kc,_c=function(){function t(t,e){this.asyncQueue=t,this.onlineStateHandler=e,this.state=Ec.Unknown,this.watchStreamFailures=0,this.onlineStateTimer=null,this.shouldWarnClientIsOffline=!0}return t.prototype.handleWatchStreamStart=function(){var t=this;0===this.watchStreamFailures&&(this.setAndBroadcast(Ec.Unknown),ko(null===this.onlineStateTimer,"onlineStateTimer shouldn't be started yet"),this.onlineStateTimer=this.asyncQueue.enqueueAfterDelay(ha.OnlineStateTimeout,1e4,function(){return t.onlineStateTimer=null,ko(t.state===Ec.Unknown,"Timer should be canceled if we transitioned to a different state."),t.logClientOfflineWarningIfNecessary("Backend didn't respond within 10 seconds."),t.setAndBroadcast(Ec.Offline),Promise.resolve()}))},t.prototype.handleWatchStreamFailure=function(t){this.state===Ec.Online?(this.setAndBroadcast(Ec.Unknown),ko(0===this.watchStreamFailures,"watchStreamFailures must be 0"),ko(null===this.onlineStateTimer,"onlineStateTimer must be null")):(this.watchStreamFailures++,this.watchStreamFailures>=1&&(this.clearOnlineStateTimer(),this.logClientOfflineWarningIfNecessary("Connection failed 1 times. Most recent error: "+t.toString()),this.setAndBroadcast(Ec.Offline)))},t.prototype.set=function(t){this.clearOnlineStateTimer(),this.watchStreamFailures=0,t===Ec.Online&&(this.shouldWarnClientIsOffline=!1),this.setAndBroadcast(t)},t.prototype.setAndBroadcast=function(t){t!==this.state&&(this.state=t,this.onlineStateHandler(t))},t.prototype.logClientOfflineWarningIfNecessary=function(t){var e="Could not reach Cloud Firestore backend. "+t+"\nThis typically indicates that your device does not have a healthy Internet connection at the moment. The client will operate in offline mode until it is able to successfully connect to the backend.";this.shouldWarnClientIsOffline?(Co(e),this.shouldWarnClientIsOffline=!1):No("OnlineStateTracker",e)},t.prototype.clearOnlineStateTimer=function(){null!==this.onlineStateTimer&&(this.onlineStateTimer.cancel(),this.onlineStateTimer=null)},t}();function Rc(t){switch(t){case Oo.OK:return Do("Treated status OK as error");case Oo.CANCELLED:case Oo.UNKNOWN:case Oo.DEADLINE_EXCEEDED:case Oo.RESOURCE_EXHAUSTED:case Oo.INTERNAL:case Oo.UNAVAILABLE:case Oo.UNAUTHENTICATED:return!1;case Oo.INVALID_ARGUMENT:case Oo.NOT_FOUND:case Oo.ALREADY_EXISTS:case Oo.PERMISSION_DENIED:case Oo.FAILED_PRECONDITION:case Oo.ABORTED:case Oo.OUT_OF_RANGE:case Oo.UNIMPLEMENTED:case Oo.DATA_LOSS:return!0;default:return Do("Unknown status code: "+t)}}function Oc(t){if(void 0===t)return Co("GRPC error has no .code"),Oo.UNKNOWN;switch(t){case kc.OK:return Oo.OK;case kc.CANCELLED:return Oo.CANCELLED;case kc.UNKNOWN:return Oo.UNKNOWN;case kc.DEADLINE_EXCEEDED:return Oo.DEADLINE_EXCEEDED;case kc.RESOURCE_EXHAUSTED:return Oo.RESOURCE_EXHAUSTED;case kc.INTERNAL:return Oo.INTERNAL;case kc.UNAVAILABLE:return Oo.UNAVAILABLE;case kc.UNAUTHENTICATED:return Oo.UNAUTHENTICATED;case kc.INVALID_ARGUMENT:return Oo.INVALID_ARGUMENT;case kc.NOT_FOUND:return Oo.NOT_FOUND;case kc.ALREADY_EXISTS:return Oo.ALREADY_EXISTS;case kc.PERMISSION_DENIED:return Oo.PERMISSION_DENIED;case kc.FAILED_PRECONDITION:return Oo.FAILED_PRECONDITION;case kc.ABORTED:return Oo.ABORTED;case kc.OUT_OF_RANGE:return Oo.OUT_OF_RANGE;case kc.UNIMPLEMENTED:return Oo.UNIMPLEMENTED;case kc.DATA_LOSS:return Oo.DATA_LOSS;default:return Do("Unknown status code: "+t)}}function Pc(t){if(void 0===t)return kc.OK;switch(t){case Oo.OK:return kc.OK;case Oo.CANCELLED:return kc.CANCELLED;case Oo.UNKNOWN:return kc.UNKNOWN;case Oo.DEADLINE_EXCEEDED:return kc.DEADLINE_EXCEEDED;case Oo.RESOURCE_EXHAUSTED:return kc.RESOURCE_EXHAUSTED;case Oo.INTERNAL:return kc.INTERNAL;case Oo.UNAVAILABLE:return kc.UNAVAILABLE;case Oo.UNAUTHENTICATED:return kc.UNAUTHENTICATED;case Oo.INVALID_ARGUMENT:return kc.INVALID_ARGUMENT;case Oo.NOT_FOUND:return kc.NOT_FOUND;case Oo.ALREADY_EXISTS:return kc.ALREADY_EXISTS;case Oo.PERMISSION_DENIED:return kc.PERMISSION_DENIED;case Oo.FAILED_PRECONDITION:return kc.FAILED_PRECONDITION;case Oo.ABORTED:return kc.ABORTED;case Oo.OUT_OF_RANGE:return kc.OUT_OF_RANGE;case Oo.UNIMPLEMENTED:return kc.UNIMPLEMENTED;case Oo.DATA_LOSS:return kc.DATA_LOSS;default:return Do("Unknown status code: "+t)}}!function(t){t[t.OK=0]="OK",t[t.CANCELLED=1]="CANCELLED",t[t.UNKNOWN=2]="UNKNOWN",t[t.INVALID_ARGUMENT=3]="INVALID_ARGUMENT",t[t.DEADLINE_EXCEEDED=4]="DEADLINE_EXCEEDED",t[t.NOT_FOUND=5]="NOT_FOUND",t[t.ALREADY_EXISTS=6]="ALREADY_EXISTS",t[t.PERMISSION_DENIED=7]="PERMISSION_DENIED",t[t.UNAUTHENTICATED=16]="UNAUTHENTICATED",t[t.RESOURCE_EXHAUSTED=8]="RESOURCE_EXHAUSTED",t[t.FAILED_PRECONDITION=9]="FAILED_PRECONDITION",t[t.ABORTED=10]="ABORTED",t[t.OUT_OF_RANGE=11]="OUT_OF_RANGE",t[t.UNIMPLEMENTED=12]="UNIMPLEMENTED",t[t.INTERNAL=13]="INTERNAL",t[t.UNAVAILABLE=14]="UNAVAILABLE",t[t.DATA_LOSS=15]="DATA_LOSS"}(kc||(kc={}));var Mc,Lc,xc=function(){function t(t){this.comparator=t?function(e,n){return t(e,n)||Ia.comparator(e.key,n.key)}:function(t,e){return Ia.comparator(t.key,e.key)},this.keyedMap=Qa(),this.sortedSet=new La(this.comparator)}return t.emptySet=function(e){return new t(e.comparator)},t.prototype.has=function(t){return null!=this.keyedMap.get(t)},t.prototype.get=function(t){return this.keyedMap.get(t)},t.prototype.first=function(){return this.sortedSet.minKey()},t.prototype.last=function(){return this.sortedSet.maxKey()},t.prototype.isEmpty=function(){return this.sortedSet.isEmpty()},t.prototype.indexOf=function(t){var e=this.keyedMap.get(t);return e?this.sortedSet.indexOf(e):-1},Object.defineProperty(t.prototype,"size",{get:function(){return this.sortedSet.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t){this.sortedSet.inorderTraversal(function(e,n){return t(e),!1})},t.prototype.add=function(t){var e=this.delete(t.key);return e.copy(e.keyedMap.insert(t.key,t),e.sortedSet.insert(t,null))},t.prototype.delete=function(t){var e=this.get(t);return e?this.copy(this.keyedMap.remove(t),this.sortedSet.remove(e)):this},t.prototype.isEqual=function(e){if(!(e instanceof t))return!1;if(this.size!==e.size)return!1;for(var n=this.sortedSet.getIterator(),r=e.sortedSet.getIterator();n.hasNext();){var i=n.getNext().key,o=r.getNext().key;if(!i.isEqual(o))return!1}return!0},t.prototype.toString=function(){var t=[];return this.forEach(function(e){t.push(e.toString())}),0===t.length?"DocumentSet ()":"DocumentSet (\n  "+t.join("  \n")+"\n)"},t.prototype.copy=function(e,n){var r=new t;return r.comparator=this.comparator,r.keyedMap=e,r.sortedSet=n,r},t}();!function(t){t[t.Added=0]="Added",t[t.Removed=1]="Removed",t[t.Modified=2]="Modified",t[t.Metadata=3]="Metadata"}(Mc||(Mc={})),function(t){t[t.Local=0]="Local",t[t.Synced=1]="Synced"}(Lc||(Lc={}));var qc,Fc=function(){function t(){this.changeMap=new La(Ia.comparator)}return t.prototype.track=function(t){var e=t.doc.key,n=this.changeMap.get(e);n?t.type!==Mc.Added&&n.type===Mc.Metadata?this.changeMap=this.changeMap.insert(e,t):t.type===Mc.Metadata&&n.type!==Mc.Removed?this.changeMap=this.changeMap.insert(e,{type:n.type,doc:t.doc}):t.type===Mc.Modified&&n.type===Mc.Modified?this.changeMap=this.changeMap.insert(e,{type:Mc.Modified,doc:t.doc}):t.type===Mc.Modified&&n.type===Mc.Added?this.changeMap=this.changeMap.insert(e,{type:Mc.Added,doc:t.doc}):t.type===Mc.Removed&&n.type===Mc.Added?this.changeMap=this.changeMap.remove(e):t.type===Mc.Removed&&n.type===Mc.Modified?this.changeMap=this.changeMap.insert(e,{type:Mc.Removed,doc:n.doc}):t.type===Mc.Added&&n.type===Mc.Removed?this.changeMap=this.changeMap.insert(e,{type:Mc.Modified,doc:t.doc}):Do("unsupported combination of changes: "+JSON.stringify(t)+" after "+JSON.stringify(n)):this.changeMap=this.changeMap.insert(e,t)},t.prototype.getChanges=function(){var t=[];return this.changeMap.inorderTraversal(function(e,n){t.push(n)}),t},t}(),Uc=function(){function t(t,e,n,r,i,o,a,s){this.query=t,this.docs=e,this.oldDocs=n,this.docChanges=r,this.mutatedKeys=i,this.fromCache=o,this.syncStateChanged=a,this.excludesMetadataChanges=s}return t.fromInitialDocuments=function(e,n,r,i){var o=[];return n.forEach(function(t){o.push({type:Mc.Added,doc:t})}),new t(e,n,xc.emptySet(n),o,r,i,!0,!1)},Object.defineProperty(t.prototype,"hasPendingWrites",{get:function(){return!this.mutatedKeys.isEmpty()},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){if(!(this.fromCache===t.fromCache&&this.syncStateChanged===t.syncStateChanged&&this.mutatedKeys.isEqual(t.mutatedKeys)&&this.query.isEqual(t.query)&&this.docs.isEqual(t.docs)&&this.oldDocs.isEqual(t.oldDocs)))return!1;var e=this.docChanges,n=t.docChanges;if(e.length!==n.length)return!1;for(var r=0;r<e.length;r++)if(e[r].type!==n[r].type||!e[r].doc.isEqual(n[r].doc))return!1;return!0},t}(),Vc=function(){function t(t,e,n,r,i){this.snapshotVersion=t,this.targetChanges=e,this.targetMismatches=n,this.documentUpdates=r,this.resolvedLimboDocuments=i}return t.createSynthesizedRemoteEventForCurrentChange=function(e,n){var r,i=((r={})[e]=Bc.createSynthesizedTargetChangeForCurrentChange(e,n),r);return new t(Ma.MIN,i,Xa(),ja(),Ha())},t}(),Bc=function(){function t(t,e,n,r,i){this.resumeToken=t,this.current=e,this.addedDocuments=n,this.modifiedDocuments=r,this.removedDocuments=i}return t.createSynthesizedTargetChangeForCurrentChange=function(e,n){return new t(Ro(),n,Ha(),Ha(),Ha())},t}(),jc=function(){return function(t,e,n,r){this.updatedTargetIds=t,this.removedTargetIds=e,this.key=n,this.newDoc=r}}(),Kc=function(){return function(t,e){this.targetId=t,this.existenceFilter=e}}();!function(t){t[t.NoChange=0]="NoChange",t[t.Added=1]="Added",t[t.Removed=2]="Removed",t[t.Current=3]="Current",t[t.Reset=4]="Reset"}(qc||(qc={}));var $c=function(){return function(t,e,n,r){void 0===n&&(n=Ro()),void 0===r&&(r=null),this.state=t,this.targetIds=e,this.resumeToken=n,this.cause=r}}(),Qc=function(){function t(){this.pendingResponses=0,this.documentChanges=zc(),this._resumeToken=Ro(),this._current=!1,this._hasPendingChanges=!0}return Object.defineProperty(t.prototype,"current",{get:function(){return this._current},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"resumeToken",{get:function(){return this._resumeToken},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"isPending",{get:function(){return 0!==this.pendingResponses},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"hasPendingChanges",{get:function(){return this._hasPendingChanges},enumerable:!0,configurable:!0}),t.prototype.updateResumeToken=function(t){t.length>0&&(this._hasPendingChanges=!0,this._resumeToken=t)},t.prototype.toTargetChange=function(){var t=Ha(),e=Ha(),n=Ha();return this.documentChanges.forEach(function(r,i){switch(i){case Mc.Added:t=t.add(r);break;case Mc.Modified:e=e.add(r);break;case Mc.Removed:n=n.add(r);break;default:Do("Encountered invalid change type: "+i)}}),new Bc(this._resumeToken,this._current,t,e,n)},t.prototype.clearPendingChanges=function(){this._hasPendingChanges=!1,this.documentChanges=zc()},t.prototype.addDocumentChange=function(t,e){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.insert(t,e)},t.prototype.removeDocumentChange=function(t){this._hasPendingChanges=!0,this.documentChanges=this.documentChanges.remove(t)},t.prototype.recordPendingTargetRequest=function(){this.pendingResponses+=1},t.prototype.recordTargetResponse=function(){this.pendingResponses-=1},t.prototype.markCurrent=function(){this._hasPendingChanges=!0,this._current=!0},t}(),Wc=function(){function t(t){this.metadataProvider=t,this.targetStates={},this.pendingDocumentUpdates=ja(),this.pendingDocumentTargetMapping=Gc(),this.pendingTargetResets=new Ua(oa)}return t.prototype.handleDocumentChange=function(t){for(var e=0,n=t.updatedTargetIds;e<n.length;e++){var r=n[e];t.newDoc instanceof Zs?this.addDocumentToTarget(r,t.newDoc):t.newDoc instanceof tu&&this.removeDocumentFromTarget(r,t.key,t.newDoc)}for(var i=0,o=t.removedTargetIds;i<o.length;i++){r=o[i];this.removeDocumentFromTarget(r,t.key,t.newDoc)}},t.prototype.handleTargetChange=function(t){var e=this;this.forEachTarget(t,function(n){var r=e.ensureTargetState(n);switch(t.state){case qc.NoChange:e.isActiveTarget(n)&&r.updateResumeToken(t.resumeToken);break;case qc.Added:r.recordTargetResponse(),r.isPending||r.clearPendingChanges(),r.updateResumeToken(t.resumeToken);break;case qc.Removed:r.recordTargetResponse(),r.isPending||e.removeTarget(n),ko(!t.cause,"WatchChangeAggregator does not handle errored targets");break;case qc.Current:e.isActiveTarget(n)&&(r.markCurrent(),r.updateResumeToken(t.resumeToken));break;case qc.Reset:e.isActiveTarget(n)&&(e.resetTarget(n),r.updateResumeToken(t.resumeToken));break;default:Do("Unknown target watch change state: "+t.state)}})},t.prototype.forEachTarget=function(t,e){t.targetIds.length>0?t.targetIds.forEach(e):qo(this.targetStates,e)},t.prototype.handleExistenceFilter=function(t){var e=t.targetId,n=t.existenceFilter.count,r=this.queryDataForActiveTarget(e);if(r){var i=r.query;if(i.isDocumentQuery())if(0===n){var o=new Ia(i.path);this.removeDocumentFromTarget(e,o,new tu(o,Ma.forDeletedDoc()))}else ko(1===n,"Single document existence filter with count: "+n);else this.getCurrentDocumentCountForTarget(e)!==n&&(this.resetTarget(e),this.pendingTargetResets=this.pendingTargetResets.add(e))}},t.prototype.createRemoteEvent=function(t){var e=this,n={};qo(this.targetStates,function(r,i){var o=e.queryDataForActiveTarget(r);if(o){if(i.current&&o.query.isDocumentQuery()){var a=new Ia(o.query.path);null!==e.pendingDocumentUpdates.get(a)||e.targetContainsDocument(r,a)||e.removeDocumentFromTarget(r,a,new tu(a,t))}i.hasPendingChanges&&(n[r]=i.toTargetChange(),i.clearPendingChanges())}});var r=Ha();this.pendingDocumentTargetMapping.forEach(function(t,n){var i=!0;n.forEachWhile(function(t){var n=e.queryDataForActiveTarget(t);return!n||n.purpose===Ru.LimboResolution||(i=!1,!1)}),i&&(r=r.add(t))});var i=new Vc(t,n,this.pendingTargetResets,this.pendingDocumentUpdates,r);return this.pendingDocumentUpdates=ja(),this.pendingDocumentTargetMapping=Gc(),this.pendingTargetResets=new Ua(oa),i},t.prototype.addDocumentToTarget=function(t,e){if(this.isActiveTarget(t)){var n=this.targetContainsDocument(t,e.key)?Mc.Modified:Mc.Added;this.ensureTargetState(t).addDocumentChange(e.key,n),this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e.key,e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e.key,this.ensureDocumentTargetMapping(e.key).add(t))}},t.prototype.removeDocumentFromTarget=function(t,e,n){if(this.isActiveTarget(t)){var r=this.ensureTargetState(t);this.targetContainsDocument(t,e)?r.addDocumentChange(e,Mc.Removed):r.removeDocumentChange(e),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(e,this.ensureDocumentTargetMapping(e).delete(t)),n&&(this.pendingDocumentUpdates=this.pendingDocumentUpdates.insert(e,n))}},t.prototype.removeTarget=function(t){delete this.targetStates[t]},t.prototype.getCurrentDocumentCountForTarget=function(t){var e=this.ensureTargetState(t).toTargetChange();return this.metadataProvider.getRemoteKeysForTarget(t).size+e.addedDocuments.size-e.removedDocuments.size},t.prototype.recordPendingTargetRequest=function(t){this.ensureTargetState(t).recordPendingTargetRequest()},t.prototype.ensureTargetState=function(t){return this.targetStates[t]||(this.targetStates[t]=new Qc),this.targetStates[t]},t.prototype.ensureDocumentTargetMapping=function(t){var e=this.pendingDocumentTargetMapping.get(t);return e||(e=new Ua(oa),this.pendingDocumentTargetMapping=this.pendingDocumentTargetMapping.insert(t,e)),e},t.prototype.isActiveTarget=function(t){var e=null!==this.queryDataForActiveTarget(t);return e||No("WatchChangeAggregator","Detected inactive target",t),e},t.prototype.queryDataForActiveTarget=function(t){var e=this.targetStates[t];return e&&e.isPending?null:this.metadataProvider.getQueryDataForTarget(t)},t.prototype.resetTarget=function(t){var e=this;ko(!this.targetStates[t].isPending,"Should only reset active targets"),this.targetStates[t]=new Qc,this.metadataProvider.getRemoteKeysForTarget(t).forEach(function(n){e.removeDocumentFromTarget(t,n,null)})},t.prototype.targetContainsDocument=function(t,e){return this.metadataProvider.getRemoteKeysForTarget(t).has(e)},t}();function Gc(){return new La(Ia.comparator)}function zc(){return new La(Ia.comparator)}var Hc="RemoteStore",Yc=function(){function t(t,e,n,r,i){var o=this;this.localStore=t,this.datastore=e,this.writePipeline=[],this.listenTargets={},this.watchChangeAggregator=null,this.networkEnabled=!1,this.isPrimary=!1,this.connectivityMonitor=i,this.connectivityMonitor.addCallback(function(t){n.enqueueAndForget(function(){return xt(o,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(No(Hc,"Restarting streams for network reachability change."),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})})}),this.onlineStateTracker=new _c(n,r),this.watchStream=this.datastore.newPersistentWatchStream({onOpen:this.onWatchStreamOpen.bind(this),onClose:this.onWatchStreamClose.bind(this),onWatchChange:this.onWatchStreamChange.bind(this)}),this.writeStream=this.datastore.newPersistentWriteStream({onOpen:this.onWriteStreamOpen.bind(this),onClose:this.onWriteStreamClose.bind(this),onHandshakeComplete:this.onWriteHandshakeComplete.bind(this),onMutationResult:this.onMutationResult.bind(this)})}return t.prototype.start=function(){return this.enableNetwork()},t.prototype.enableNetwork=function(){return xt(this,void 0,void 0,function(){var t;return qt(this,function(e){switch(e.label){case 0:return this.networkEnabled=!0,this.canUseNetwork()?(t=this.writeStream,[4,this.localStore.getLastStreamToken()]):[3,3];case 1:return t.lastStreamToken=e.sent(),this.shouldStartWatchStream()?this.startWatchStream():this.onlineStateTracker.set(Ec.Unknown),[4,this.fillWritePipeline()];case 2:e.sent(),e.label=3;case 3:return[2]}})})},t.prototype.disableNetwork=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Ec.Offline),[2]}})})},t.prototype.disableNetworkInternal=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return[4,this.writeStream.stop()];case 1:return t.sent(),[4,this.watchStream.stop()];case 2:return t.sent(),this.writePipeline.length>0&&(No(Hc,"Stopping write stream with "+this.writePipeline.length+" pending writes"),this.writePipeline=[]),this.cleanUpWatchStreamState(),[2]}})})},t.prototype.shutdown=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return No(Hc,"RemoteStore shutting down."),this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.connectivityMonitor.shutdown(),this.onlineStateTracker.set(Ec.Unknown),[2]}})})},t.prototype.listen=function(t){ko(!Lo(this.listenTargets,t.targetId),"listen called with duplicate targetId!"),this.listenTargets[t.targetId]=t,this.shouldStartWatchStream()?this.startWatchStream():this.watchStream.isOpen()&&this.sendWatchRequest(t)},t.prototype.unlisten=function(t){ko(Lo(this.listenTargets,t),"unlisten called without assigned target ID!"),delete this.listenTargets[t],this.watchStream.isOpen()&&this.sendUnwatchRequest(t),Uo(this.listenTargets)&&(this.watchStream.isOpen()?this.watchStream.markIdle():this.canUseNetwork()&&this.onlineStateTracker.set(Ec.Unknown))},t.prototype.getQueryDataForTarget=function(t){return this.listenTargets[t]||null},t.prototype.getRemoteKeysForTarget=function(t){return this.syncEngine.getRemoteKeysForTarget(t)},t.prototype.sendWatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t.targetId),this.watchStream.watch(t)},t.prototype.sendUnwatchRequest=function(t){this.watchChangeAggregator.recordPendingTargetRequest(t),this.watchStream.unwatch(t)},t.prototype.startWatchStream=function(){ko(this.shouldStartWatchStream(),"startWatchStream() called when shouldStartWatchStream() is false."),this.watchChangeAggregator=new Wc(this),this.watchStream.start(),this.onlineStateTracker.handleWatchStreamStart()},t.prototype.shouldStartWatchStream=function(){return this.canUseNetwork()&&!this.watchStream.isStarted()&&!Uo(this.listenTargets)},t.prototype.canUseNetwork=function(){return this.isPrimary&&this.networkEnabled},t.prototype.cleanUpWatchStreamState=function(){this.watchChangeAggregator=null},t.prototype.onWatchStreamOpen=function(){return xt(this,void 0,void 0,function(){var t=this;return qt(this,function(e){return qo(this.listenTargets,function(e,n){t.sendWatchRequest(n)}),[2]})})},t.prototype.onWatchStreamClose=function(t){return xt(this,void 0,void 0,function(){return qt(this,function(e){return void 0===t&&ko(!this.shouldStartWatchStream(),"Watch stream was stopped gracefully while still needed."),this.cleanUpWatchStreamState(),this.shouldStartWatchStream()?(this.onlineStateTracker.handleWatchStreamFailure(t),this.startWatchStream()):this.onlineStateTracker.set(Ec.Unknown),[2]})})},t.prototype.onWatchStreamChange=function(t,e){return xt(this,void 0,void 0,function(){var n;return qt(this,function(r){switch(r.label){case 0:return this.onlineStateTracker.set(Ec.Online),t instanceof $c&&t.state===qc.Removed&&t.cause?[2,this.handleTargetError(t)]:(t instanceof jc?this.watchChangeAggregator.handleDocumentChange(t):t instanceof Kc?this.watchChangeAggregator.handleExistenceFilter(t):(ko(t instanceof $c,"Expected watchChange to be an instance of WatchTargetChange"),this.watchChangeAggregator.handleTargetChange(t)),e.isEqual(Ma.MIN)?[3,3]:[4,this.localStore.getLastRemoteSnapshotVersion()]);case 1:return n=r.sent(),e.compareTo(n)>=0?[4,this.raiseWatchSnapshot(e)]:[3,3];case 2:r.sent(),r.label=3;case 3:return[2]}})})},t.prototype.raiseWatchSnapshot=function(t){var e=this;ko(!t.isEqual(Ma.MIN),"Can't raise event for unknown SnapshotVersion");var n=this.watchChangeAggregator.createRemoteEvent(t);return qo(n.targetChanges,function(n,r){if(r.resumeToken.length>0){var i=e.listenTargets[n];i&&(e.listenTargets[n]=i.withResumeToken(r.resumeToken,t))}}),n.targetMismatches.forEach(function(t){var n=e.listenTargets[t];if(n){e.listenTargets[t]=n.withResumeToken(Ro(),n.snapshotVersion),e.sendUnwatchRequest(t);var r=new Lu(n.query,t,Ru.ExistenceFilterMismatch,n.sequenceNumber);e.sendWatchRequest(r)}}),this.syncEngine.applyRemoteEvent(n)},t.prototype.handleTargetError=function(t){var e=this;ko(!!t.cause,"Handling target error without a cause");var n=t.cause,r=Promise.resolve();return t.targetIds.forEach(function(t){r=r.then(function(){return xt(e,void 0,void 0,function(){return qt(this,function(e){return Lo(this.listenTargets,t)?(delete this.listenTargets[t],this.watchChangeAggregator.removeTarget(t),[2,this.syncEngine.rejectListen(t,n)]):[2]})})})}),r},t.prototype.fillWritePipeline=function(){return xt(this,void 0,void 0,function(){var t,e;return qt(this,function(n){switch(n.label){case 0:return this.canAddToWritePipeline()?(t=this.writePipeline.length>0?this.writePipeline[this.writePipeline.length-1].batchId:-1,[4,this.localStore.nextMutationBatch(t)]):[3,4];case 1:return null!==(e=n.sent())?[3,2]:(0===this.writePipeline.length&&this.writeStream.markIdle(),[3,4]);case 2:return this.addToWritePipeline(e),[4,this.fillWritePipeline()];case 3:n.sent(),n.label=4;case 4:return this.shouldStartWriteStream()&&this.startWriteStream(),[2]}})})},t.prototype.canAddToWritePipeline=function(){return this.canUseNetwork()&&this.writePipeline.length<10},t.prototype.outstandingWrites=function(){return this.writePipeline.length},t.prototype.addToWritePipeline=function(t){ko(this.canAddToWritePipeline(),"addToWritePipeline called when pipeline is full"),this.writePipeline.push(t),this.writeStream.isOpen()&&this.writeStream.handshakeComplete&&this.writeStream.writeMutations(t.mutations)},t.prototype.shouldStartWriteStream=function(){return this.canUseNetwork()&&!this.writeStream.isStarted()&&this.writePipeline.length>0},t.prototype.startWriteStream=function(){ko(this.shouldStartWriteStream(),"startWriteStream() called when shouldStartWriteStream() is false."),this.writeStream.start()},t.prototype.onWriteStreamOpen=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){return this.writeStream.writeHandshake(),[2]})})},t.prototype.onWriteHandshakeComplete=function(){var t=this;return this.localStore.setLastStreamToken(this.writeStream.lastStreamToken).then(function(){for(var e=0,n=t.writePipeline;e<n.length;e++){var r=n[e];t.writeStream.writeMutations(r.mutations)}}).catch(Hu)},t.prototype.onMutationResult=function(t,e){var n=this;ko(this.writePipeline.length>0,"Got result for empty write pipeline");var r=this.writePipeline.shift(),i=Za.from(r,t,e,this.writeStream.lastStreamToken);return this.syncEngine.applySuccessfulWrite(i).then(function(){return n.fillWritePipeline()})},t.prototype.onWriteStreamClose=function(t){return xt(this,void 0,void 0,function(){var e=this;return qt(this,function(n){return void 0===t&&ko(!this.shouldStartWriteStream(),"Write stream was stopped gracefully while still needed."),t&&this.writePipeline.length>0?(void 0,[2,(this.writeStream.handshakeComplete?this.handleWriteError(t):this.handleHandshakeError(t)).then(function(){e.shouldStartWriteStream()&&e.startWriteStream()})]):[2]})})},t.prototype.handleHandshakeError=function(t){return xt(this,void 0,void 0,function(){return qt(this,function(e){return Rc(t.code)?(No(Hc,"RemoteStore error before completed handshake; resetting stream token: ",this.writeStream.lastStreamToken),this.writeStream.lastStreamToken=Ro(),[2,this.localStore.setLastStreamToken(Ro()).catch(Hu)]):[2]})})},t.prototype.handleWriteError=function(t){return xt(this,void 0,void 0,function(){var e,n=this;return qt(this,function(r){return Rc(i=t.code)&&i!==Oo.ABORTED?(e=this.writePipeline.shift(),this.writeStream.inhibitBackoff(),[2,this.syncEngine.rejectFailedWrite(e.batchId,t).then(function(){return n.fillWritePipeline()})]):[2];var i})})},t.prototype.createTransaction=function(){return new Dc(this.datastore)},t.prototype.restartNetwork=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return this.networkEnabled=!1,[4,this.disableNetworkInternal()];case 1:return t.sent(),this.onlineStateTracker.set(Ec.Unknown),[4,this.enableNetwork()];case 2:return t.sent(),[2]}})})},t.prototype.handleCredentialChange=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return this.canUseNetwork()?(No(Hc,"RemoteStore restarting streams for new credential"),[4,this.restartNetwork()]):[3,2];case 1:t.sent(),t.label=2;case 2:return[2]}})})},t.prototype.applyPrimaryState=function(t){return xt(this,void 0,void 0,function(){return qt(this,function(e){switch(e.label){case 0:return this.isPrimary=t,t&&this.networkEnabled?[4,this.enableNetwork()]:[3,2];case 1:return e.sent(),[3,4];case 2:return t?[3,4]:[4,this.disableNetworkInternal()];case 3:e.sent(),this.onlineStateTracker.set(Ec.Unknown),e.label=4;case 4:return[2]}})})},t}(),Xc=function(){function t(t,e){if(Bo("GeoPoint",arguments,2),$o("GeoPoint","number",1,t),$o("GeoPoint","number",2,e),!isFinite(t)||t<-90||t>90)throw new Po(Oo.INVALID_ARGUMENT,"Latitude must be a number between -90 and 90, but was: "+t);if(!isFinite(e)||e<-180||e>180)throw new Po(Oo.INVALID_ARGUMENT,"Longitude must be a number between -180 and 180, but was: "+e);this._lat=t,this._long=e}return Object.defineProperty(t.prototype,"latitude",{get:function(){return this._lat},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"longitude",{get:function(){return this._long},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(t){return this._lat===t._lat&&this._long===t._long},t.prototype._compareTo=function(t){return oa(this._lat,t._lat)||oa(this._long,t._long)},t}(),Jc=function(){function t(t,e,n,r,i,o,a){void 0===e&&(e=null),void 0===n&&(n=[]),void 0===r&&(r=[]),void 0===i&&(i=null),void 0===o&&(o=null),void 0===a&&(a=null),this.path=t,this.collectionGroup=e,this.explicitOrderBy=n,this.filters=r,this.limit=i,this.startAt=o,this.endAt=a,this.memoizedCanonicalId=null,this.memoizedOrderBy=null,this.startAt&&this.assertValidBound(this.startAt),this.endAt&&this.assertValidBound(this.endAt)}return t.atPath=function(e){return new t(e)},Object.defineProperty(t.prototype,"orderBy",{get:function(){if(null===this.memoizedOrderBy){var t=this.getInequalityFilterField(),e=this.getFirstOrderByField();if(null!==t&&null===e)t.isKeyField()?this.memoizedOrderBy=[hh]:this.memoizedOrderBy=[new ch(t),hh];else{ko(null===t||null!==e&&t.isEqual(e),"First orderBy should match inequality field."),this.memoizedOrderBy=[];for(var n=!1,r=0,i=this.explicitOrderBy;r<i.length;r++){var o=i[r];this.memoizedOrderBy.push(o),o.field.isKeyField()&&(n=!0)}if(!n){var a=this.explicitOrderBy.length>0?this.explicitOrderBy[this.explicitOrderBy.length-1].dir:sh.ASCENDING;this.memoizedOrderBy.push(a===sh.ASCENDING?hh:lh)}}}return this.memoizedOrderBy},enumerable:!0,configurable:!0}),t.prototype.addFilter=function(e){ko(null==this.getInequalityFilterField()||!(e instanceof eh)||!e.isInequality()||e.field.isEqual(this.getInequalityFilterField()),"Query must only have one inequality field."),ko(!this.isDocumentQuery(),"No filtering allowed for document query");var n=this.filters.concat([e]);return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),n,this.limit,this.startAt,this.endAt)},t.prototype.addOrderBy=function(e){ko(!this.startAt&&!this.endAt,"Bounds must be set after orderBy");var n=this.explicitOrderBy.concat([e]);return new t(this.path,this.collectionGroup,n,this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.withLimit=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),e,this.startAt,this.endAt)},t.prototype.withStartAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,e,this.endAt)},t.prototype.withEndAt=function(e){return new t(this.path,this.collectionGroup,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,e)},t.prototype.asCollectionQueryAtPath=function(e){return new t(e,null,this.explicitOrderBy.slice(),this.filters.slice(),this.limit,this.startAt,this.endAt)},t.prototype.canonicalId=function(){if(null===this.memoizedCanonicalId){var t=this.path.canonicalString();this.isCollectionGroupQuery()&&(t+="|cg:"+this.collectionGroup),t+="|f:";for(var e=0,n=this.filters;e<n.length;e++){t+=n[e].canonicalId(),t+=","}t+="|ob:";for(var r=0,i=this.orderBy;r<i.length;r++){t+=i[r].canonicalId(),t+=","}mc(this.limit)||(t+="|l:",t+=this.limit),this.startAt&&(t+="|lb:",t+=this.startAt.canonicalId()),this.endAt&&(t+="|ub:",t+=this.endAt.canonicalId()),this.memoizedCanonicalId=t}return this.memoizedCanonicalId},t.prototype.toString=function(){var t="Query("+this.path.canonicalString();return this.isCollectionGroupQuery()&&(t+=" collectionGroup="+this.collectionGroup),this.filters.length>0&&(t+=", filters: ["+this.filters.join(", ")+"]"),mc(this.limit)||(t+=", limit: "+this.limit),this.explicitOrderBy.length>0&&(t+=", orderBy: ["+this.explicitOrderBy.join(", ")+"]"),this.startAt&&(t+=", startAt: "+this.startAt.canonicalId()),this.endAt&&(t+=", endAt: "+this.endAt.canonicalId()),t+")"},t.prototype.isEqual=function(t){if(this.limit!==t.limit)return!1;if(this.orderBy.length!==t.orderBy.length)return!1;for(var e=0;e<this.orderBy.length;e++)if(!this.orderBy[e].isEqual(t.orderBy[e]))return!1;if(this.filters.length!==t.filters.length)return!1;for(e=0;e<this.filters.length;e++)if(!this.filters[e].isEqual(t.filters[e]))return!1;return this.collectionGroup===t.collectionGroup&&(!!this.path.isEqual(t.path)&&(!(null!==this.startAt?!this.startAt.isEqual(t.startAt):null!==t.startAt)&&(null!==this.endAt?this.endAt.isEqual(t.endAt):null===t.endAt)))},t.prototype.docComparator=function(t,e){for(var n=!1,r=0,i=this.orderBy;r<i.length;r++){var o=i[r],a=o.compare(t,e);if(0!==a)return a;n=n||o.field.isKeyField()}return ko(n,"orderBy used that doesn't compare on key field"),0},t.prototype.matches=function(t){return this.matchesPathAndCollectionGroup(t)&&this.matchesOrderBy(t)&&this.matchesFilters(t)&&this.matchesBounds(t)},t.prototype.hasLimit=function(){return!mc(this.limit)},t.prototype.getFirstOrderByField=function(){return this.explicitOrderBy.length>0?this.explicitOrderBy[0].field:null},t.prototype.getInequalityFilterField=function(){for(var t=0,e=this.filters;t<e.length;t++){var n=e[t];if(n instanceof eh&&n.isInequality())return n.field}return null},t.prototype.findFilterOperator=function(t){for(var e=0,n=this.filters;e<n.length;e++){var r=n[e];if(r instanceof eh&&t.indexOf(r.op)>=0)return r.op}return null},t.prototype.isDocumentQuery=function(){return Ia.isDocumentKey(this.path)&&null===this.collectionGroup&&0===this.filters.length},t.prototype.isCollectionGroupQuery=function(){return null!==this.collectionGroup},t.prototype.matchesPathAndCollectionGroup=function(t){var e=t.key.path;return null!==this.collectionGroup?t.key.hasCollectionId(this.collectionGroup)&&this.path.isPrefixOf(e):Ia.isDocumentKey(this.path)?this.path.isEqual(e):this.path.isImmediateParentOf(e)},t.prototype.matchesOrderBy=function(t){for(var e=0,n=this.explicitOrderBy;e<n.length;e++){var r=n[e];if(!r.field.isKeyField()&&null===t.field(r.field))return!1}return!0},t.prototype.matchesFilters=function(t){for(var e=0,n=this.filters;e<n.length;e++){if(!n[e].matches(t))return!1}return!0},t.prototype.matchesBounds=function(t){return!(this.startAt&&!this.startAt.sortsBeforeDocument(this.orderBy,t))&&(!this.endAt||!this.endAt.sortsBeforeDocument(this.orderBy,t))},t.prototype.assertValidBound=function(t){ko(t.position.length<=this.orderBy.length,"Bound is longer than orderBy")},t}(),Zc=function(){return function(){}}(),th=function(){function t(t){this.name=t}return t.fromString=function(e){switch(e){case"<":return t.LESS_THAN;case"<=":return t.LESS_THAN_OR_EQUAL;case"==":return t.EQUAL;case">=":return t.GREATER_THAN_OR_EQUAL;case">":return t.GREATER_THAN;case"array-contains":return t.ARRAY_CONTAINS;case"in":return t.IN;case"array-contains-any":return t.ARRAY_CONTAINS_ANY;default:return Do("Unknown FieldFilter operator: "+e)}},t.prototype.toString=function(){return this.name},t.prototype.isEqual=function(t){return this.name===t.name},t.LESS_THAN=new t("<"),t.LESS_THAN_OR_EQUAL=new t("<="),t.EQUAL=new t("=="),t.GREATER_THAN=new t(">"),t.GREATER_THAN_OR_EQUAL=new t(">="),t.ARRAY_CONTAINS=new t("array-contains"),t.IN=new t("in"),t.ARRAY_CONTAINS_ANY=new t("array-contains-any"),t}(),eh=function(t){function e(e,n,r){var i=t.call(this)||this;return i.field=e,i.op=n,i.value=r,i}return Mt(e,t),e.create=function(t,n,r){if(t.isKeyField())return n===th.IN?(ko(r instanceof Xs,"Comparing on key with IN, but filter value not an ArrayValue"),ko(r.internalValue.every(function(t){return t instanceof zs}),"Comparing on key with IN, but an array value was not a RefValue"),new rh(t,r)):(ko(r instanceof zs,"Comparing on key, but filter value not a RefValue"),ko(n!==th.ARRAY_CONTAINS&&n!==th.ARRAY_CONTAINS_ANY,"'"+n.toString()+"' queries don't make sense on document keys."),new nh(t,n,r));if(r.isEqual(Fs.INSTANCE)){if(n!==th.EQUAL)throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. Null supports only equality comparisons.");return new e(t,n,r)}if(r.isEqual(Ks.NAN)){if(n!==th.EQUAL)throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. NaN supports only equality comparisons.");return new e(t,n,r)}return n===th.ARRAY_CONTAINS?new ih(t,r):n===th.IN?(ko(r instanceof Xs,"IN filter has invalid value: "+r.toString()),new oh(t,r)):n===th.ARRAY_CONTAINS_ANY?(ko(r instanceof Xs,"ARRAY_CONTAINS_ANY filter has invalid value: "+r.toString()),new ah(t,r)):new e(t,n,r)},e.prototype.matches=function(t){var e=t.field(this.field);return null!==e&&this.value.typeOrder===e.typeOrder&&this.matchesComparison(e.compareTo(this.value))},e.prototype.matchesComparison=function(t){switch(this.op){case th.LESS_THAN:return t<0;case th.LESS_THAN_OR_EQUAL:return t<=0;case th.EQUAL:return 0===t;case th.GREATER_THAN:return t>0;case th.GREATER_THAN_OR_EQUAL:return t>=0;default:return Do("Unknown FieldFilter operator: "+this.op)}},e.prototype.isInequality=function(){return[th.LESS_THAN,th.LESS_THAN_OR_EQUAL,th.GREATER_THAN,th.GREATER_THAN_OR_EQUAL].indexOf(this.op)>=0},e.prototype.canonicalId=function(){return this.field.canonicalString()+this.op.toString()+this.value.toString()},e.prototype.isEqual=function(t){return t instanceof e&&(this.op.isEqual(t.op)&&this.field.isEqual(t.field)&&this.value.isEqual(t.value))},e.prototype.toString=function(){return this.field.canonicalString()+" "+this.op+" "+this.value.value()},e}(Zc),nh=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mt(e,t),e.prototype.matches=function(t){var e=this.value,n=Ia.comparator(t.key,e.key);return this.matchesComparison(n)},e}(eh),rh=function(t){function e(e,n){var r=t.call(this,e,th.IN,n)||this;return r.value=n,r}return Mt(e,t),e.prototype.matches=function(t){return this.value.internalValue.some(function(e){return t.key.isEqual(e.key)})},e}(eh),ih=function(t){function e(e,n){return t.call(this,e,th.ARRAY_CONTAINS,n)||this}return Mt(e,t),e.prototype.matches=function(t){var e=t.field(this.field);return e instanceof Xs&&e.contains(this.value)},e}(eh),oh=function(t){function e(e,n){var r=t.call(this,e,th.IN,n)||this;return r.value=n,r}return Mt(e,t),e.prototype.matches=function(t){var e=this.value,n=t.field(this.field);return null!==n&&e.contains(n)},e}(eh),ah=function(t){function e(e,n){var r=t.call(this,e,th.ARRAY_CONTAINS_ANY,n)||this;return r.value=n,r}return Mt(e,t),e.prototype.matches=function(t){var e=this,n=t.field(this.field);return n instanceof Xs&&n.internalValue.some(function(t){return e.value.contains(t)})},e}(eh),sh=function(){function t(t){this.name=t}return t.prototype.toString=function(){return this.name},t.ASCENDING=new t("asc"),t.DESCENDING=new t("desc"),t}(),uh=function(){function t(t,e){this.position=t,this.before=e}return t.prototype.canonicalId=function(){for(var t=this.before?"b:":"a:",e=0,n=this.position;e<n.length;e++){t+=n[e].toString()}return t},t.prototype.sortsBeforeDocument=function(t,e){ko(this.position.length<=t.length,"Bound has more components than query's orderBy");for(var n=0,r=0;r<this.position.length;r++){var i=t[r],o=this.position[r];if(i.field.isKeyField())ko(o instanceof zs,"Bound has a non-key value where the key path is being used."),n=Ia.comparator(o.key,e.key);else{var a=e.field(i.field);ko(null!==a,"Field should exist since document matched the orderBy already."),n=o.compareTo(a)}if(i.dir===sh.DESCENDING&&(n*=-1),0!==n)break}return this.before?n<=0:n<0},t.prototype.isEqual=function(t){if(null===t)return!1;if(this.before!==t.before||this.position.length!==t.position.length)return!1;for(var e=0;e<this.position.length;e++){var n=this.position[e],r=t.position[e];if(!n.isEqual(r))return!1}return!0},t}(),ch=function(){function t(t,e){this.field=t,void 0===e&&(e=sh.ASCENDING),this.dir=e,this.isKeyOrderBy=t.isKeyField()}return t.prototype.compare=function(t,e){var n=this.isKeyOrderBy?Zs.compareByKey(t,e):Zs.compareByField(this.field,t,e);switch(this.dir){case sh.ASCENDING:return n;case sh.DESCENDING:return-1*n;default:return Do("Unknown direction: "+this.dir)}},t.prototype.canonicalId=function(){return this.field.canonicalString()+this.dir.toString()},t.prototype.toString=function(){return this.field.canonicalString()+" ("+this.dir+")"},t.prototype.isEqual=function(t){return this.dir===t.dir&&this.field.isEqual(t.field)},t}(),hh=new ch(wa.keyField(),sh.ASCENDING),lh=new ch(wa.keyField(),sh.DESCENDING),fh=function(){function t(){}return t.prototype.applyToLocalView=function(t,e){return new Ws(e,t)},t.prototype.applyToRemoteDocument=function(t,e){return e},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t},t.instance=new t,t}(),ph=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=yh(t),n=function(t){e.find(function(e){return e.isEqual(t)})||e.push(t)},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new Xs(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&aa(e.elements,this.elements)},t}(),dh=function(){function t(t){this.elements=t}return t.prototype.applyToLocalView=function(t,e){return this.apply(t)},t.prototype.applyToRemoteDocument=function(t,e){return this.apply(t)},t.prototype.apply=function(t){for(var e=yh(t),n=function(t){e=e.filter(function(e){return!e.isEqual(t)})},r=0,i=this.elements;r<i.length;r++){n(i[r])}return new Xs(e)},t.prototype.computeBaseValue=function(t){return null},t.prototype.isEqual=function(e){return e instanceof t&&aa(e.elements,this.elements)},t}(),mh=function(){function t(t){this.operand=t}return t.prototype.applyToLocalView=function(t,e){var n=this.computeBaseValue(t);if(n instanceof js&&this.operand instanceof js){var r=n.internalValue+this.operand.internalValue;return new js(r)}r=n.internalValue+this.operand.internalValue;return new Ks(r)},t.prototype.applyToRemoteDocument=function(t,e){return ko(null!==e,"Didn't receive transformResult for NUMERIC_ADD transform"),e},t.prototype.computeBaseValue=function(t){return t instanceof Vs?t:new js(0)},t.prototype.isEqual=function(e){return e instanceof t&&this.operand.isEqual(e.operand)},t}();function yh(t){return t instanceof Xs?t.internalValue.slice():[]}var gh,vh,bh=function(){function t(t){this.count=t}return t.prototype.isEqual=function(t){return t&&t.count===this.count},t}(),wh=((gh={})[sh.ASCENDING.name]="ASCENDING",gh[sh.DESCENDING.name]="DESCENDING",gh),Ih=((vh={})[th.LESS_THAN.name]="LESS_THAN",vh[th.LESS_THAN_OR_EQUAL.name]="LESS_THAN_OR_EQUAL",vh[th.GREATER_THAN.name]="GREATER_THAN",vh[th.GREATER_THAN_OR_EQUAL.name]="GREATER_THAN_OR_EQUAL",vh[th.EQUAL.name]="EQUAL",vh[th.ARRAY_CONTAINS.name]="ARRAY_CONTAINS",vh[th.IN.name]="IN",vh[th.ARRAY_CONTAINS_ANY.name]="ARRAY_CONTAINS_ANY",vh),Eh=new RegExp(/^\d{4}-\d\d-\d\dT\d\d:\d\d:\d\d(?:\.(\d+))?Z$/);function Th(t,e){ko(!mc(t),e+" is missing")}function Sh(t){return"number"==typeof t?t:"string"==typeof t?Number(t):Do("can't parse "+t)}var Nh=function(){function t(t,e){this.databaseId=t,this.options=e}return t.prototype.emptyByteString=function(){return this.options.useProto3Json?"":new Uint8Array(0)},t.prototype.unsafeCastProtoByteString=function(t){return t},t.prototype.fromRpcStatus=function(t){var e=void 0===t.code?Oo.UNKNOWN:Oc(t.code);return new Po(e,t.message||"")},t.prototype.toInt32Value=function(t){return mc(t)?void 0:{value:t}},t.prototype.fromInt32Value=function(t){var e;return mc(e="object"==typeof t?t.value:t)?null:e},t.prototype.toTimestamp=function(t){return{seconds:""+t.seconds,nanos:t.nanoseconds}},t.prototype.fromTimestamp=function(t){if("string"==typeof t)return this.fromIso8601String(t);ko(!!t,"Cannot deserialize null or undefined timestamp.");var e=Sh(t.seconds||"0"),n=t.nanos||0;return new Pa(e,n)},t.prototype.fromIso8601String=function(t){var e=0,n=Eh.exec(t);if(ko(!!n,"invalid timestamp: "+t),n[1]){var r=n[1];r=(r+"000000000").substr(0,9),e=Number(r)}var i=new Date(t),o=Math.floor(i.getTime()/1e3);return new Pa(o,e)},t.prototype.toBytes=function(t){return this.options.useProto3Json?t.toBase64():this.unsafeCastProtoByteString(t.toUint8Array())},t.prototype.fromBlob=function(t){return"string"==typeof t?(ko(this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),la.fromBase64String(t)):(ko(!this.options.useProto3Json,"Expected bytes to be passed in as Uint8Array, but got a string instead."),la.fromUint8Array(t))},t.prototype.toVersion=function(t){return this.toTimestamp(t.toTimestamp())},t.prototype.fromVersion=function(t){return ko(!!t,"Trying to deserialize version that isn't set"),Ma.fromTimestamp(this.fromTimestamp(t))},t.prototype.toResourceName=function(t,e){return this.fullyQualifiedPrefixPath(t).child("documents").child(e).canonicalString()},t.prototype.fromResourceName=function(t){var e=va.fromString(t);return ko(this.isValidResourceName(e),"Tried to deserialize invalid key "+e.toString()),e},t.prototype.toName=function(t){return this.toResourceName(this.databaseId,t.path)},t.prototype.fromName=function(t){var e=this.fromResourceName(t);return ko(e.get(1)===this.databaseId.projectId,"Tried to deserialize key from different project: "+e.get(1)+" vs "+this.databaseId.projectId),ko(!e.get(3)&&!this.databaseId.database||e.get(3)===this.databaseId.database,"Tried to deserialize key from different database: "+e.get(3)+" vs "+this.databaseId.database),new Ia(this.extractLocalPathFromResourceName(e))},t.prototype.toQueryPath=function(t){return this.toResourceName(this.databaseId,t)},t.prototype.fromQueryPath=function(t){var e=this.fromResourceName(t);return 4===e.length?va.EMPTY_PATH:this.extractLocalPathFromResourceName(e)},Object.defineProperty(t.prototype,"encodedDatabaseId",{get:function(){return new va(["projects",this.databaseId.projectId,"databases",this.databaseId.database]).canonicalString()},enumerable:!0,configurable:!0}),t.prototype.fullyQualifiedPrefixPath=function(t){return new va(["projects",t.projectId,"databases",t.database])},t.prototype.extractLocalPathFromResourceName=function(t){return ko(t.length>4&&"documents"===t.get(4),"tried to deserialize invalid key "+t.toString()),t.popFirst(5)},t.prototype.isValidResourceName=function(t){return t.length>=4&&"projects"===t.get(0)&&"databases"===t.get(2)},t.prototype.toValue=function(t){if(t instanceof Fs)return{nullValue:"NULL_VALUE"};if(t instanceof Us)return{booleanValue:t.value()};if(t instanceof js)return{integerValue:""+t.value()};if(t instanceof Ks){var e=t.value();if(this.options.useProto3Json){if(isNaN(e))return{doubleValue:"NaN"};if(e===1/0)return{doubleValue:"Infinity"};if(e===-1/0)return{doubleValue:"-Infinity"}}return{doubleValue:t.value()}}return t instanceof $s?{stringValue:t.value()}:t instanceof Ys?{mapValue:this.toMapValue(t)}:t instanceof Xs?{arrayValue:this.toArrayValue(t)}:t instanceof Qs?{timestampValue:this.toTimestamp(t.internalValue)}:t instanceof Hs?{geoPointValue:{latitude:t.value().latitude,longitude:t.value().longitude}}:t instanceof Gs?{bytesValue:this.toBytes(t.value())}:t instanceof zs?{referenceValue:this.toResourceName(t.databaseId,t.key.path)}:Do("Unknown FieldValue "+JSON.stringify(t))},t.prototype.fromValue=function(t){var e=this;if("nullValue"in t)return Fs.INSTANCE;if("booleanValue"in t)return Us.of(t.booleanValue);if("integerValue"in t)return new js(Sh(t.integerValue));if("doubleValue"in t){if(this.options.useProto3Json){if("NaN"===t.doubleValue)return Ks.NAN;if("Infinity"===t.doubleValue)return Ks.POSITIVE_INFINITY;if("-Infinity"===t.doubleValue)return Ks.NEGATIVE_INFINITY}return new Ks(t.doubleValue)}if("stringValue"in t)return new $s(t.stringValue);if("mapValue"in t)return this.fromFields(t.mapValue.fields||{});if("arrayValue"in t){Th(t.arrayValue,"arrayValue");var n=t.arrayValue.values||[];return new Xs(n.map(function(t){return e.fromValue(t)}))}if("timestampValue"in t)return Th(t.timestampValue,"timestampValue"),new Qs(this.fromTimestamp(t.timestampValue));if("geoPointValue"in t){Th(t.geoPointValue,"geoPointValue");var r=t.geoPointValue.latitude||0,i=t.geoPointValue.longitude||0;return new Hs(new Xc(r,i))}if("bytesValue"in t){Th(t.bytesValue,"bytesValue");var o=this.fromBlob(t.bytesValue);return new Gs(o)}if("referenceValue"in t){Th(t.referenceValue,"referenceValue");var a=this.fromResourceName(t.referenceValue),s=new ma(a.get(1),a.get(3)),u=new Ia(this.extractLocalPathFromResourceName(a));return new zs(s,u)}return Do("Unknown Value proto "+JSON.stringify(t))},t.prototype.toMutationDocument=function(t,e){return{name:this.toName(t),fields:this.toFields(e)}},t.prototype.toDocument=function(t){return ko(!t.hasLocalMutations,"Can't serialize documents with mutations."),{name:this.toName(t.key),fields:this.toFields(t.data()),updateTime:this.toTimestamp(t.version.toTimestamp())}},t.prototype.fromDocument=function(t,e){var n=this,r=this.fromName(t.name),i=this.fromVersion(t.updateTime);return new Zs(r,i,{hasCommittedMutations:!!e},void 0,t,function(t){return n.fromValue(t)})},t.prototype.toFields=function(t){var e=this,n={};return t.forEach(function(t,r){n[t]=e.toValue(r)}),n},t.prototype.fromFields=function(t){var e=this,n=t,r=Ys.EMPTY;return Fo(n,function(t,n){r=r.set(new wa([t]),e.fromValue(n))}),r},t.prototype.toMapValue=function(t){return{fields:this.toFields(t)}},t.prototype.toArrayValue=function(t){var e=this,n=[];return t.forEach(function(t){n.push(e.toValue(t))}),{values:n}},t.prototype.fromFound=function(t){var e=this;ko(!!t.found,"Tried to deserialize a found document from a missing document."),Th(t.found.name,"doc.found.name"),Th(t.found.updateTime,"doc.found.updateTime");var n=this.fromName(t.found.name),r=this.fromVersion(t.found.updateTime);return new Zs(n,r,{},void 0,t.found,function(t){return e.fromValue(t)})},t.prototype.fromMissing=function(t){ko(!!t.missing,"Tried to deserialize a missing document from a found document."),ko(!!t.readTime,"Tried to deserialize a missing document without a read time.");var e=this.fromName(t.missing),n=this.fromVersion(t.readTime);return new tu(e,n)},t.prototype.fromMaybeDocument=function(t){return"found"in t?this.fromFound(t):"missing"in t?this.fromMissing(t):Do("invalid batch get response: "+JSON.stringify(t))},t.prototype.toWatchTargetChangeState=function(t){switch(t){case qc.Added:return"ADD";case qc.Current:return"CURRENT";case qc.NoChange:return"NO_CHANGE";case qc.Removed:return"REMOVE";case qc.Reset:return"RESET";default:return Do("Unknown WatchTargetChangeState: "+t)}},t.prototype.toTestWatchChange=function(t){if(t instanceof Kc)return{filter:{count:t.existenceFilter.count,targetId:t.targetId}};if(t instanceof jc){if(t.newDoc instanceof Zs){var e=t.newDoc;return{documentChange:{document:{name:this.toName(e.key),fields:this.toFields(e.data()),updateTime:this.toVersion(e.version)},targetIds:t.updatedTargetIds,removedTargetIds:t.removedTargetIds}}}if(t.newDoc instanceof tu){e=t.newDoc;return{documentDelete:{document:this.toName(e.key),readTime:this.toVersion(e.version),removedTargetIds:t.removedTargetIds}}}if(null===t.newDoc)return{documentRemove:{document:this.toName(t.key),removedTargetIds:t.removedTargetIds}}}if(t instanceof $c){var n=void 0;return t.cause&&(n={code:Pc(t.cause.code),message:t.cause.message}),{targetChange:{targetChangeType:this.toWatchTargetChangeState(t.state),targetIds:t.targetIds,resumeToken:this.unsafeCastProtoByteString(t.resumeToken),cause:n}}}return Do("Unrecognized watch change: "+JSON.stringify(t))},t.prototype.fromWatchChange=function(t){var e,n=this;if("targetChange"in t){Th(t.targetChange,"targetChange");var r=this.fromWatchTargetChangeState(t.targetChange.targetChangeType||"NO_CHANGE"),i=t.targetChange.targetIds||[],o=t.targetChange.resumeToken||this.emptyByteString(),a=t.targetChange.cause,s=a&&this.fromRpcStatus(a);e=new $c(r,i,o,s||null)}else if("documentChange"in t){Th(t.documentChange,"documentChange"),Th(t.documentChange.document,"documentChange.name"),Th(t.documentChange.document.name,"documentChange.document.name"),Th(t.documentChange.document.updateTime,"documentChange.document.updateTime");var u=t.documentChange,c=this.fromName(u.document.name),h=this.fromVersion(u.document.updateTime),l=new Zs(c,h,{},void 0,u.document,function(t){return n.fromValue(t)}),f=u.targetIds||[],p=u.removedTargetIds||[];e=new jc(f,p,l.key,l)}else if("documentDelete"in t){Th(t.documentDelete,"documentDelete"),Th(t.documentDelete.document,"documentDelete.document");var d=t.documentDelete;c=this.fromName(d.document),h=d.readTime?this.fromVersion(d.readTime):Ma.forDeletedDoc(),l=new tu(c,h),p=d.removedTargetIds||[];e=new jc([],p,l.key,l)}else if("documentRemove"in t){Th(t.documentRemove,"documentRemove"),Th(t.documentRemove.document,"documentRemove");var m=t.documentRemove;c=this.fromName(m.document),p=m.removedTargetIds||[];e=new jc([],p,c,null)}else{if(!("filter"in t))return Do("Unknown change type "+JSON.stringify(t));Th(t.filter,"filter"),Th(t.filter.targetId,"filter.targetId");var y=t.filter,g=y.count||0,v=new bh(g),b=y.targetId;e=new Kc(b,v)}return e},t.prototype.fromWatchTargetChangeState=function(t){return"NO_CHANGE"===t?qc.NoChange:"ADD"===t?qc.Added:"REMOVE"===t?qc.Removed:"CURRENT"===t?qc.Current:"RESET"===t?qc.Reset:Do("Got unexpected TargetChange.state: "+t)},t.prototype.versionFromListenResponse=function(t){if(!("targetChange"in t))return Ma.MIN;var e=t.targetChange;return e.targetIds&&e.targetIds.length?Ma.MIN:e.readTime?this.fromVersion(e.readTime):Ma.MIN},t.prototype.toMutation=function(t){var e,n=this;if(t instanceof Os)e={update:this.toMutationDocument(t.key,t.value)};else if(t instanceof Ls)e={delete:this.toName(t.key)};else if(t instanceof Ps)e={update:this.toMutationDocument(t.key,t.data),updateMask:this.toDocumentMask(t.fieldMask)};else{if(!(t instanceof Ms))return Do("Unknown mutation type "+t.type);e={transform:{document:this.toName(t.key),fieldTransforms:t.fieldTransforms.map(function(t){return n.toFieldTransform(t)})}}}return t.precondition.isNone||(e.currentDocument=this.toPrecondition(t.precondition)),e},t.prototype.fromMutation=function(t){var e=this,n=t.currentDocument?this.fromPrecondition(t.currentDocument):_s.NONE;if(t.update){Th(t.update.name,"name");var r=this.fromName(t.update.name),i=this.fromFields(t.update.fields||{});if(t.updateMask){var o=this.fromDocumentMask(t.updateMask);return new Ps(r,i,o,n)}return new Os(r,i,n)}if(t.delete){r=this.fromName(t.delete);return new Ls(r,n)}if(t.transform){r=this.fromName(t.transform.document);var a=t.transform.fieldTransforms.map(function(t){return e.fromFieldTransform(t)});return ko(!0===n.exists,'Transforms only support precondition "exists == true"'),new Ms(r,a)}return Do("unknown mutation proto: "+JSON.stringify(t))},t.prototype.toPrecondition=function(t){return ko(!t.isNone,"Can't serialize an empty precondition"),void 0!==t.updateTime?{updateTime:this.toVersion(t.updateTime)}:void 0!==t.exists?{exists:t.exists}:Do("Unknown precondition")},t.prototype.fromPrecondition=function(t){return void 0!==t.updateTime?_s.updateTime(this.fromVersion(t.updateTime)):void 0!==t.exists?_s.exists(t.exists):_s.NONE},t.prototype.fromWriteResult=function(t,e){var n=this,r=t.updateTime?this.fromVersion(t.updateTime):this.fromVersion(e),i=null;return t.transformResults&&t.transformResults.length>0&&(i=t.transformResults.map(function(t){return n.fromValue(t)})),new As(r,i)},t.prototype.fromWriteResults=function(t,e){var n=this;return t&&t.length>0?(ko(void 0!==e,"Received a write result without a commit time"),t.map(function(t){return n.fromWriteResult(t,e)})):[]},t.prototype.toFieldTransform=function(t){var e=this,n=t.transform;if(n instanceof fh)return{fieldPath:t.field.canonicalString(),setToServerValue:"REQUEST_TIME"};if(n instanceof ph)return{fieldPath:t.field.canonicalString(),appendMissingElements:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof dh)return{fieldPath:t.field.canonicalString(),removeAllFromArray:{values:n.elements.map(function(t){return e.toValue(t)})}};if(n instanceof mh)return{fieldPath:t.field.canonicalString(),increment:this.toValue(n.operand)};throw Do("Unknown transform: "+t.transform)},t.prototype.fromFieldTransform=function(t){var e=this,n=null;if("setToServerValue"in t)ko("REQUEST_TIME"===t.setToServerValue,"Unknown server value transform proto: "+JSON.stringify(t)),n=fh.instance;else if("appendMissingElements"in t){var r=t.appendMissingElements.values||[];n=new ph(r.map(function(t){return e.fromValue(t)}))}else if("removeAllFromArray"in t){r=t.removeAllFromArray.values||[];n=new dh(r.map(function(t){return e.fromValue(t)}))}else if("increment"in t){var i=this.fromValue(t.increment);ko(i instanceof Vs,"NUMERIC_ADD transform requires a NumberValue"),n=new mh(i)}else Do("Unknown transform proto: "+JSON.stringify(t));var o=wa.fromServerFormat(t.fieldPath);return new Cs(o,n)},t.prototype.toDocumentsTarget=function(t){return{documents:[this.toQueryPath(t.path)]}},t.prototype.fromDocumentsTarget=function(t){var e=t.documents.length;ko(1===e,"DocumentsTarget contained other than 1 document: "+e);var n=t.documents[0];return Jc.atPath(this.fromQueryPath(n))},t.prototype.toQueryTarget=function(t){var e={structuredQuery:{}},n=t.path;null!==t.collectionGroup?(ko(n.length%2==0,"Collection Group queries should be within a document path or root."),e.parent=this.toQueryPath(n),e.structuredQuery.from=[{collectionId:t.collectionGroup,allDescendants:!0}]):(ko(n.length%2!=0,"Document queries with filters are not supported."),e.parent=this.toQueryPath(n.popLast()),e.structuredQuery.from=[{collectionId:n.lastSegment()}]);var r=this.toFilter(t.filters);r&&(e.structuredQuery.where=r);var i=this.toOrder(t.orderBy);i&&(e.structuredQuery.orderBy=i);var o=this.toInt32Value(t.limit);return void 0!==o&&(e.structuredQuery.limit=o),t.startAt&&(e.structuredQuery.startAt=this.toCursor(t.startAt)),t.endAt&&(e.structuredQuery.endAt=this.toCursor(t.endAt)),e},t.prototype.fromQueryTarget=function(t){var e=this.fromQueryPath(t.parent),n=t.structuredQuery,r=n.from?n.from.length:0,i=null;if(r>0){ko(1===r,"StructuredQuery.from with more than one collection is not supported.");var o=n.from[0];o.allDescendants?i=o.collectionId:e=e.child(o.collectionId)}var a=[];n.where&&(a=this.fromFilter(n.where));var s=[];n.orderBy&&(s=this.fromOrder(n.orderBy));var u=null;n.limit&&(u=this.fromInt32Value(n.limit));var c=null;n.startAt&&(c=this.fromCursor(n.startAt));var h=null;return n.endAt&&(h=this.fromCursor(n.endAt)),new Jc(e,i,s,a,u,c,h)},t.prototype.toListenRequestLabels=function(t){var e=this.toLabel(t.purpose);return null==e?null:{"goog-listen-tags":e}},t.prototype.toLabel=function(t){switch(t){case Ru.Listen:return null;case Ru.ExistenceFilterMismatch:return"existence-filter-mismatch";case Ru.LimboResolution:return"limbo-document";default:return Do("Unrecognized query purpose: "+t)}},t.prototype.toTarget=function(t){var e,n=t.query;return(e=n.isDocumentQuery()?{documents:this.toDocumentsTarget(n)}:{query:this.toQueryTarget(n)}).targetId=t.targetId,t.resumeToken.length>0&&(e.resumeToken=this.unsafeCastProtoByteString(t.resumeToken)),e},t.prototype.toFilter=function(t){var e=this;if(0!==t.length){var n=t.map(function(t){return t instanceof eh?e.toUnaryOrFieldFilter(t):Do("Unrecognized filter: "+JSON.stringify(t))});return 1===n.length?n[0]:{compositeFilter:{op:"AND",filters:n}}}},t.prototype.fromFilter=function(t){var e=this;return t?void 0!==t.unaryFilter?[this.fromUnaryFilter(t)]:void 0!==t.fieldFilter?[this.fromFieldFilter(t)]:void 0!==t.compositeFilter?t.compositeFilter.filters.map(function(t){return e.fromFilter(t)}).reduce(function(t,e){return t.concat(e)}):Do("Unknown filter: "+JSON.stringify(t)):[]},t.prototype.toOrder=function(t){var e=this;if(0!==t.length)return t.map(function(t){return e.toPropertyOrder(t)})},t.prototype.fromOrder=function(t){var e=this;return t.map(function(t){return e.fromPropertyOrder(t)})},t.prototype.toCursor=function(t){var e=this;return{before:t.before,values:t.position.map(function(t){return e.toValue(t)})}},t.prototype.fromCursor=function(t){var e=this,n=!!t.before,r=t.values.map(function(t){return e.fromValue(t)});return new uh(r,n)},t.prototype.toDirection=function(t){return wh[t.name]},t.prototype.fromDirection=function(t){switch(t){case"ASCENDING":return sh.ASCENDING;case"DESCENDING":return sh.DESCENDING;default:return}},t.prototype.toOperatorName=function(t){return Ih[t.name]},t.prototype.fromOperatorName=function(t){switch(t){case"EQUAL":return th.EQUAL;case"GREATER_THAN":return th.GREATER_THAN;case"GREATER_THAN_OR_EQUAL":return th.GREATER_THAN_OR_EQUAL;case"LESS_THAN":return th.LESS_THAN;case"LESS_THAN_OR_EQUAL":return th.LESS_THAN_OR_EQUAL;case"ARRAY_CONTAINS":return th.ARRAY_CONTAINS;case"IN":return th.IN;case"ARRAY_CONTAINS_ANY":return th.ARRAY_CONTAINS_ANY;case"OPERATOR_UNSPECIFIED":return Do("Unspecified operator");default:return Do("Unknown operator")}},t.prototype.toFieldPathReference=function(t){return{fieldPath:t.canonicalString()}},t.prototype.fromFieldPathReference=function(t){return wa.fromServerFormat(t.fieldPath)},t.prototype.toPropertyOrder=function(t){return{field:this.toFieldPathReference(t.field),direction:this.toDirection(t.dir)}},t.prototype.fromPropertyOrder=function(t){return new ch(this.fromFieldPathReference(t.field),this.fromDirection(t.direction))},t.prototype.fromFieldFilter=function(t){return eh.create(this.fromFieldPathReference(t.fieldFilter.field),this.fromOperatorName(t.fieldFilter.op),this.fromValue(t.fieldFilter.value))},t.prototype.toUnaryOrFieldFilter=function(t){if(t.op===th.EQUAL){if(t.value.isEqual(Ks.NAN))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NAN"}};if(t.value.isEqual(Fs.INSTANCE))return{unaryFilter:{field:this.toFieldPathReference(t.field),op:"IS_NULL"}}}return{fieldFilter:{field:this.toFieldPathReference(t.field),op:this.toOperatorName(t.op),value:this.toValue(t.value)}}},t.prototype.fromUnaryFilter=function(t){switch(t.unaryFilter.op){case"IS_NAN":var e=this.fromFieldPathReference(t.unaryFilter.field);return eh.create(e,th.EQUAL,Ks.NAN);case"IS_NULL":var n=this.fromFieldPathReference(t.unaryFilter.field);return eh.create(n,th.EQUAL,Fs.INSTANCE);case"OPERATOR_UNSPECIFIED":return Do("Unspecified filter");default:return Do("Unknown filter")}},t.prototype.toDocumentMask=function(t){var e=[];return t.fields.forEach(function(t){return e.push(t.canonicalString())}),{fieldPaths:e}},t.prototype.fromDocumentMask=function(t){var e=(t.fieldPaths||[]).map(function(t){return wa.fromServerFormat(t)});return Ns.fromArray(e)},t}(),Ch=function(){return function(){this.viewSnap=null,this.targetId=0,this.listeners=[]}}(),Ah=function(){function t(t){this.syncEngine=t,this.queries=new nu(function(t){return t.canonicalId()}),this.onlineState=Ec.Unknown,this.snapshotsInSyncListeners=new Set,this.syncEngine.subscribe(this)}return t.prototype.listen=function(t){var e=t.query,n=!1,r=this.queries.get(e);(r||(n=!0,r=new Ch,this.queries.set(e,r)),r.listeners.push(t),ko(!t.applyOnlineStateChange(this.onlineState),"applyOnlineStateChange() shouldn't raise an event for brand-new listeners."),r.viewSnap)&&(t.onViewSnapshot(r.viewSnap)&&this.raiseSnapshotsInSyncEvent());return n?this.syncEngine.listen(e).then(function(t){return r.targetId=t,t}):Promise.resolve(r.targetId)},t.prototype.unlisten=function(t){return xt(this,void 0,void 0,function(){var e,n,r,i;return qt(this,function(o){return e=t.query,n=!1,(r=this.queries.get(e))&&(i=r.listeners.indexOf(t))>=0&&(r.listeners.splice(i,1),n=0===r.listeners.length),n?(this.queries.delete(e),[2,this.syncEngine.unlisten(e)]):[2]})})},t.prototype.onWatchChange=function(t){for(var e=!1,n=0,r=t;n<r.length;n++){var i=r[n],o=i.query,a=this.queries.get(o);if(a){for(var s=0,u=a.listeners;s<u.length;s++){u[s].onViewSnapshot(i)&&(e=!0)}a.viewSnap=i}}e&&this.raiseSnapshotsInSyncEvent()},t.prototype.onWatchError=function(t,e){var n=this.queries.get(t);if(n)for(var r=0,i=n.listeners;r<i.length;r++){i[r].onError(e)}this.queries.delete(t)},t.prototype.onOnlineStateChange=function(t){this.onlineState=t;var e=!1;this.queries.forEach(function(n,r){for(var i=0,o=r.listeners;i<o.length;i++){o[i].applyOnlineStateChange(t)&&(e=!0)}}),e&&this.raiseSnapshotsInSyncEvent()},t.prototype.addSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.add(t),t.next()},t.prototype.removeSnapshotsInSyncListener=function(t){this.snapshotsInSyncListeners.delete(t)},t.prototype.raiseSnapshotsInSyncEvent=function(){this.snapshotsInSyncListeners.forEach(function(t){t.next()})},t}(),Dh=function(){function t(t,e,n){this.query=t,this.queryObserver=e,this.raisedInitialEvent=!1,this.snap=null,this.onlineState=Ec.Unknown,this.options=n||{}}return t.prototype.onViewSnapshot=function(t){if(ko(t.docChanges.length>0||t.syncStateChanged,"We got a new snapshot with no changes?"),!this.options.includeMetadataChanges){for(var e=[],n=0,r=t.docChanges;n<r.length;n++){var i=r[n];i.type!==Mc.Metadata&&e.push(i)}t=new Uc(t.query,t.docs,t.oldDocs,e,t.mutatedKeys,t.fromCache,t.syncStateChanged,!0)}var o=!1;return this.raisedInitialEvent?this.shouldRaiseEvent(t)&&(this.queryObserver.next(t),o=!0):this.shouldRaiseInitialEvent(t,this.onlineState)&&(this.raiseInitialEvent(t),o=!0),this.snap=t,o},t.prototype.onError=function(t){this.queryObserver.error(t)},t.prototype.applyOnlineStateChange=function(t){this.onlineState=t;var e=!1;return this.snap&&!this.raisedInitialEvent&&this.shouldRaiseInitialEvent(this.snap,t)&&(this.raiseInitialEvent(this.snap),e=!0),e},t.prototype.shouldRaiseInitialEvent=function(t,e){if(ko(!this.raisedInitialEvent,"Determining whether to raise first event but already had first event"),!t.fromCache)return!0;var n=e!==Ec.Offline;return this.options.waitForSyncWhenOnline&&n?(ko(t.fromCache,"Waiting for sync, but snapshot is not from cache"),!1):!t.docs.isEmpty()||e===Ec.Offline},t.prototype.shouldRaiseEvent=function(t){if(t.docChanges.length>0)return!0;var e=this.snap&&this.snap.hasPendingWrites!==t.hasPendingWrites;return!(!t.syncStateChanged&&!e)&&!0===this.options.includeMetadataChanges},t.prototype.raiseInitialEvent=function(t){ko(!this.raisedInitialEvent,"Trying to raise initial events for second time"),t=Uc.fromInitialDocuments(t.query,t.docs,t.mutatedKeys,t.fromCache),this.raisedInitialEvent=!0,this.queryObserver.next(t)},t}(),kh=function(){function t(t,e,n){this.targetId=t,this.addedKeys=e,this.removedKeys=n}return t.fromSnapshot=function(e,n){for(var r=Ha(),i=Ha(),o=0,a=n.docChanges;o<a.length;o++){var s=a[o];switch(s.type){case Mc.Added:r=r.add(s.doc.key);break;case Mc.Removed:i=i.add(s.doc.key)}}return new t(e,r,i)},t}(),_h=function(){return function(t){this.key=t}}(),Rh=function(){return function(t){this.key=t}}(),Oh=function(){function t(t,e){this.query=t,this._syncedDocuments=e,this.syncState=null,this.current=!1,this.limboDocuments=Ha(),this.mutatedKeys=Ha(),this.documentSet=new xc(t.docComparator.bind(t))}return Object.defineProperty(t.prototype,"syncedDocuments",{get:function(){return this._syncedDocuments},enumerable:!0,configurable:!0}),t.prototype.computeDocChanges=function(t,e){var n=this,r=e?e.changeSet:new Fc,i=e?e.documentSet:this.documentSet,o=e?e.mutatedKeys:this.mutatedKeys,a=i,s=!1,u=this.query.hasLimit()&&i.size===this.query.limit?i.last():null;if(t.inorderTraversal(function(t,e){var c=i.get(t),h=e instanceof Zs?e:null;h&&(ko(t.isEqual(h.key),"Mismatching keys found in document changes: "+t+" != "+h.key),h=n.query.matches(h)?h:null);var l=!!c&&n.mutatedKeys.has(c.key),f=!!h&&(h.hasLocalMutations||n.mutatedKeys.has(h.key)&&h.hasCommittedMutations),p=!1;c&&h?c.data().isEqual(h.data())?l!==f&&(r.track({type:Mc.Metadata,doc:h}),p=!0):n.shouldWaitForSyncedDocument(c,h)||(r.track({type:Mc.Modified,doc:h}),p=!0,u&&n.query.docComparator(h,u)>0&&(s=!0)):!c&&h?(r.track({type:Mc.Added,doc:h}),p=!0):c&&!h&&(r.track({type:Mc.Removed,doc:c}),p=!0,u&&(s=!0));p&&(h?(a=a.add(h),o=f?o.add(t):o.delete(t)):(a=a.delete(t),o=o.delete(t)))}),this.query.hasLimit())for(;a.size>this.query.limit;){var c=a.last();a=a.delete(c.key),o=o.delete(c.key),r.track({type:Mc.Removed,doc:c})}return ko(!s||!e,"View was refilled using docs that themselves needed refilling."),{documentSet:a,changeSet:r,needsRefill:s,mutatedKeys:o}},t.prototype.shouldWaitForSyncedDocument=function(t,e){return t.hasLocalMutations&&e.hasCommittedMutations&&!e.hasLocalMutations},t.prototype.applyChanges=function(t,e,n){var r=this;ko(!t.needsRefill,"Cannot apply changes that need a refill");var i=this.documentSet;this.documentSet=t.documentSet,this.mutatedKeys=t.mutatedKeys;var o=t.changeSet.getChanges();o.sort(function(t,e){return function(t,e){var n=function(t){switch(t){case Mc.Added:return 1;case Mc.Modified:case Mc.Metadata:return 2;case Mc.Removed:return 0;default:return Do("Unknown ChangeType: "+t)}};return n(t)-n(e)}(t.type,e.type)||r.query.docComparator(t.doc,e.doc)}),this.applyTargetChange(n);var a=e?this.updateLimboDocuments():[],s=0===this.limboDocuments.size&&this.current?Lc.Synced:Lc.Local,u=s!==this.syncState;return this.syncState=s,0!==o.length||u?{snapshot:new Uc(this.query,t.documentSet,i,o,t.mutatedKeys,s===Lc.Local,u,!1),limboChanges:a}:{limboChanges:a}},t.prototype.applyOnlineStateChange=function(t){return this.current&&t===Ec.Offline?(this.current=!1,this.applyChanges({documentSet:this.documentSet,changeSet:new Fc,mutatedKeys:this.mutatedKeys,needsRefill:!1},!1)):{limboChanges:[]}},t.prototype.shouldBeInLimbo=function(t){return!this._syncedDocuments.has(t)&&(!!this.documentSet.has(t)&&!this.documentSet.get(t).hasLocalMutations)},t.prototype.applyTargetChange=function(t){var e=this;t&&(t.addedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.add(t)}),t.modifiedDocuments.forEach(function(t){return ko(e._syncedDocuments.has(t),"Modified document "+t+" not found in view.")}),t.removedDocuments.forEach(function(t){return e._syncedDocuments=e._syncedDocuments.delete(t)}),this.current=t.current)},t.prototype.updateLimboDocuments=function(){var t=this;if(!this.current)return[];var e=this.limboDocuments;this.limboDocuments=Ha(),this.documentSet.forEach(function(e){t.shouldBeInLimbo(e.key)&&(t.limboDocuments=t.limboDocuments.add(e.key))});var n=[];return e.forEach(function(e){t.limboDocuments.has(e)||n.push(new Rh(e))}),this.limboDocuments.forEach(function(t){e.has(t)||n.push(new _h(t))}),n},t.prototype.synchronizeWithPersistedState=function(t,e){this._syncedDocuments=e,this.limboDocuments=Ha();var n=this.computeDocChanges(t);return this.applyChanges(n,!0)},t.prototype.computeInitialSnapshot=function(){return Uc.fromInitialDocuments(this.query,this.documentSet,this.mutatedKeys,this.syncState===Lc.Local)},t}();var Ph=5,Mh=function(){function t(t,e,n,r){this.asyncQueue=t,this.remoteStore=e,this.updateFunction=n,this.deferred=r,this.retries=Ph,this.backoff=new Ic(this.asyncQueue,ha.RetryTransaction)}return t.prototype.run=function(){this.runWithBackOff()},t.prototype.runWithBackOff=function(){var t=this;this.backoff.backoffAndRun(function(){return xt(t,void 0,void 0,function(){var t,e,n=this;return qt(this,function(r){return t=this.remoteStore.createTransaction(),(e=this.tryRunUpdateFunction(t))&&e.then(function(e){n.asyncQueue.enqueueAndForget(function(){return t.commit().then(function(){n.deferred.resolve(e)}).catch(function(t){n.handleTransactionError(t)})})}).catch(function(t){n.handleTransactionError(t)}),[2]})})})},t.prototype.tryRunUpdateFunction=function(t){try{var e=this.updateFunction(t);return!mc(e)&&e.catch&&e.then?e:(this.deferred.reject(Error("Transaction callback must return a Promise")),null)}catch(t){return this.deferred.reject(t),null}},t.prototype.handleTransactionError=function(t){var e=this;this.retries>0&&this.isRetryableTransactionError(t)?(this.retries-=1,this.asyncQueue.enqueueAndForget(function(){return e.runWithBackOff(),Promise.resolve()})):this.deferred.reject(t)},t.prototype.isRetryableTransactionError=function(t){if("FirebaseError"===t.name){var e=t.code;return"aborted"===e||"failed-precondition"===e||!Rc(e)}return!1},t}(),Lh=function(){return function(t,e,n){this.query=t,this.targetId=e,this.view=n}}(),xh=function(){return function(t){this.key=t,this.receivedDocument=!1}}(),qh=function(){function t(t,e,n,r){this.localStore=t,this.remoteStore=e,this.sharedClientState=n,this.currentUser=r,this.syncEngineListener=null,this.queryViewsByQuery=new nu(function(t){return t.canonicalId()}),this.queryViewsByTarget={},this.limboTargetsByKey=new La(Ia.comparator),this.limboResolutionsByTarget={},this.limboDocumentRefs=new ec,this.mutationUserCallbacks={},this.pendingWritesCallbacks=new Map,this.limboTargetIdGenerator=hs.forSyncEngine(),this.isPrimary=void 0,this.onlineState=Ec.Unknown}return Object.defineProperty(t.prototype,"isPrimaryClient",{get:function(){return!0===this.isPrimary},enumerable:!0,configurable:!0}),t.prototype.subscribe=function(t){ko(null!==t,"SyncEngine listener cannot be null"),ko(null===this.syncEngineListener,"SyncEngine already has a subscriber."),this.syncEngineListener=t},t.prototype.listen=function(t){return xt(this,void 0,void 0,function(){var e,n,r,i,o;return qt(this,function(a){switch(a.label){case 0:return this.assertSubscribed("listen()"),(r=this.queryViewsByQuery.get(t))?(e=r.targetId,this.sharedClientState.addLocalQueryTarget(e),n=r.view.computeInitialSnapshot(),[3,4]):[3,1];case 1:return[4,this.localStore.allocateQuery(t)];case 2:return i=a.sent(),o=this.sharedClientState.addLocalQueryTarget(i.targetId),e=i.targetId,[4,this.initializeViewAndComputeSnapshot(i,"current"===o)];case 3:n=a.sent(),this.isPrimary&&this.remoteStore.listen(i),a.label=4;case 4:return this.syncEngineListener.onWatchChange([n]),[2,e]}})})},t.prototype.initializeViewAndComputeSnapshot=function(t,e){return xt(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c;return qt(this,function(h){switch(h.label){case 0:return n=t.query,[4,this.localStore.executeQuery(n)];case 1:return r=h.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return i=h.sent(),o=new Oh(n,i),a=o.computeDocChanges(r),s=Bc.createSynthesizedTargetChangeForCurrentChange(t.targetId,e&&this.onlineState!==Ec.Offline),ko(0===(u=o.applyChanges(a,!0===this.isPrimary,s)).limboChanges.length,"View returned limbo docs before target ack from the server."),ko(!!u.snapshot,"applyChanges for new view should always return a snapshot"),c=new Lh(n,t.targetId,o),this.queryViewsByQuery.set(n,c),this.queryViewsByTarget[t.targetId]=c,[2,u.snapshot]}})})},t.prototype.synchronizeViewAndComputeSnapshot=function(t){return xt(this,void 0,void 0,function(){var e,n,r;return qt(this,function(i){switch(i.label){case 0:return[4,this.localStore.executeQuery(t.query)];case 1:return e=i.sent(),[4,this.localStore.remoteDocumentKeys(t.targetId)];case 2:return n=i.sent(),r=t.view.synchronizeWithPersistedState(e,n),this.isPrimary&&this.updateTrackedLimbos(t.targetId,r.limboChanges),[2,r]}})})},t.prototype.unlisten=function(t){return xt(this,void 0,void 0,function(){var e,n=this;return qt(this,function(r){switch(r.label){case 0:return this.assertSubscribed("unlisten()"),ko(!!(e=this.queryViewsByQuery.get(t)),"Trying to unlisten on query not found:"+t),this.isPrimary?(this.sharedClientState.removeLocalQueryTarget(e.targetId),this.sharedClientState.isActiveQueryTarget(e.targetId)?[3,2]:[4,this.localStore.releaseQuery(t,!1).then(function(){n.sharedClientState.clearQueryState(e.targetId),n.remoteStore.unlisten(e.targetId),n.removeAndCleanupQuery(e)}).catch(Hu)]):[3,3];case 1:r.sent(),r.label=2;case 2:return[3,5];case 3:return this.removeAndCleanupQuery(e),[4,this.localStore.releaseQuery(t,!0)];case 4:r.sent(),r.label=5;case 5:return[2]}})})},t.prototype.write=function(t,e){return xt(this,void 0,void 0,function(){var n;return qt(this,function(r){switch(r.label){case 0:return this.assertSubscribed("write()"),[4,this.localStore.localWrite(t)];case 1:return n=r.sent(),this.sharedClientState.addPendingMutation(n.batchId),this.addMutationCallback(n.batchId,e),[4,this.emitNewSnapsAndNotifyLocalStore(n.changes)];case 2:return r.sent(),[4,this.remoteStore.fillWritePipeline()];case 3:return r.sent(),[2]}})})},t.prototype.runTransaction=function(t,e,n){new Mh(t,this.remoteStore,e,n).run()},t.prototype.applyRemoteEvent=function(t){return xt(this,void 0,void 0,function(){var e,n=this;return qt(this,function(r){switch(r.label){case 0:this.assertSubscribed("applyRemoteEvent()"),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.applyRemoteEvent(t)];case 2:return e=r.sent(),Fo(t.targetChanges,function(t,e){var r=n.limboResolutionsByTarget[Number(t)];r&&(ko(e.addedDocuments.size+e.modifiedDocuments.size+e.removedDocuments.size<=1,"Limbo resolution for single document contains multiple changes."),e.addedDocuments.size>0?r.receivedDocument=!0:e.modifiedDocuments.size>0?ko(r.receivedDocument,"Received change for limbo target document without add."):e.removedDocuments.size>0&&(ko(r.receivedDocument,"Received remove for limbo target document without add."),r.receivedDocument=!1))}),[4,this.emitNewSnapsAndNotifyLocalStore(e,t)];case 3:return r.sent(),[3,6];case 4:return[4,Hu(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.applyOnlineStateChange=function(t,e){if(this.isPrimary&&e===Tc.RemoteStore||!this.isPrimary&&e===Tc.SharedClientState){this.assertSubscribed("applyOnlineStateChange()");var n=[];this.queryViewsByQuery.forEach(function(e,r){var i=r.view.applyOnlineStateChange(t);ko(0===i.limboChanges.length,"OnlineState should not affect limbo documents."),i.snapshot&&n.push(i.snapshot)}),this.syncEngineListener.onOnlineStateChange(t),this.syncEngineListener.onWatchChange(n),this.onlineState=t,this.isPrimary&&this.sharedClientState.setOnlineState(t)}},t.prototype.rejectListen=function(t,e){return xt(this,void 0,void 0,function(){var n,r,i,o,a,s,u=this;return qt(this,function(c){switch(c.label){case 0:return this.assertSubscribed("rejectListens()"),this.sharedClientState.updateQueryState(t,"rejected",e),n=this.limboResolutionsByTarget[t],(r=n&&n.key)?(this.limboTargetsByKey=this.limboTargetsByKey.remove(r),delete this.limboResolutionsByTarget[t],i=(i=new La(Ia.comparator)).insert(r,new tu(r,Ma.forDeletedDoc())),o=Ha().add(r),a=new Vc(Ma.MIN,{},new Ua(oa),i,o),[2,this.applyRemoteEvent(a)]):[3,1];case 1:return ko(!!(s=this.queryViewsByTarget[t]),"Unknown targetId: "+t),[4,this.localStore.releaseQuery(s.query,!1).then(function(){return u.removeAndCleanupQuery(s)}).catch(Hu)];case 2:c.sent(),this.syncEngineListener.onWatchError(s.query,e),c.label=3;case 3:return[2]}})})},t.prototype.applyBatchState=function(t,e,n){return xt(this,void 0,void 0,function(){var r;return qt(this,function(i){switch(i.label){case 0:return this.assertSubscribed("applyBatchState()"),[4,this.localStore.lookupMutationDocuments(t)];case 1:return null===(r=i.sent())?(No("SyncEngine","Cannot apply mutation batch with id: "+t),[2]):"pending"!==e?[3,3]:[4,this.remoteStore.fillWritePipeline()];case 2:return i.sent(),[3,4];case 3:"acknowledged"===e||"rejected"===e?(this.processUserCallback(t,n||null),this.localStore.removeCachedMutationBatchMetadata(t)):Do("Unknown batchState: "+e),i.label=4;case 4:return[4,this.emitNewSnapsAndNotifyLocalStore(r)];case 5:return i.sent(),[2]}})})},t.prototype.applySuccessfulWrite=function(t){return xt(this,void 0,void 0,function(){var e,n;return qt(this,function(r){switch(r.label){case 0:this.assertSubscribed("applySuccessfulWrite()"),e=t.batch.batchId,this.processUserCallback(e,null),this.triggerPendingWritesCallbacks(e),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.acknowledgeBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(e,"acknowledged"),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Hu(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.rejectFailedWrite=function(t,e){return xt(this,void 0,void 0,function(){var n;return qt(this,function(r){switch(r.label){case 0:this.assertSubscribed("rejectFailedWrite()"),this.processUserCallback(t,e),this.triggerPendingWritesCallbacks(t),r.label=1;case 1:return r.trys.push([1,4,,6]),[4,this.localStore.rejectBatch(t)];case 2:return n=r.sent(),this.sharedClientState.updateMutationState(t,"rejected",e),[4,this.emitNewSnapsAndNotifyLocalStore(n)];case 3:return r.sent(),[3,6];case 4:return[4,Hu(r.sent())];case 5:return r.sent(),[3,6];case 6:return[2]}})})},t.prototype.registerPendingWritesCallback=function(t){return xt(this,void 0,void 0,function(){var e,n;return qt(this,function(r){switch(r.label){case 0:return this.remoteStore.canUseNetwork()||No("SyncEngine","The network is disabled. The task returned by 'awaitPendingWrites()' will not complete until the network is enabled."),[4,this.localStore.getHighestUnacknowledgedBatchId()];case 1:return-1===(e=r.sent())?(t.resolve(),[2]):((n=this.pendingWritesCallbacks.get(e)||[]).push(t),this.pendingWritesCallbacks.set(e,n),[2])}})})},t.prototype.triggerPendingWritesCallbacks=function(t){(this.pendingWritesCallbacks.get(t)||[]).forEach(function(t){t.resolve()}),this.pendingWritesCallbacks.delete(t)},t.prototype.rejectOutstandingPendingWritesCallbacks=function(t){this.pendingWritesCallbacks.forEach(function(e){e.forEach(function(e){e.reject(new Po(Oo.CANCELLED,t))})}),this.pendingWritesCallbacks.clear()},t.prototype.addMutationCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];n||(n=new La(oa)),n=n.insert(t,e),this.mutationUserCallbacks[this.currentUser.toKey()]=n},t.prototype.processUserCallback=function(t,e){var n=this.mutationUserCallbacks[this.currentUser.toKey()];if(n){var r=n.get(t);r&&(ko(t===n.minKey(),"Mutation callbacks processed out-of-order?"),e?r.reject(e):r.resolve(),n=n.remove(t)),this.mutationUserCallbacks[this.currentUser.toKey()]=n}},t.prototype.removeAndCleanupQuery=function(t){var e=this;if(this.sharedClientState.removeLocalQueryTarget(t.targetId),this.queryViewsByQuery.delete(t.query),delete this.queryViewsByTarget[t.targetId],this.isPrimary){var n=this.limboDocumentRefs.referencesForId(t.targetId);this.limboDocumentRefs.removeReferencesForId(t.targetId),n.forEach(function(t){e.limboDocumentRefs.containsKey(t)||e.removeLimboTarget(t)})}},t.prototype.removeLimboTarget=function(t){var e=this.limboTargetsByKey.get(t);null!==e&&(this.remoteStore.unlisten(e),this.limboTargetsByKey=this.limboTargetsByKey.remove(t),delete this.limboResolutionsByTarget[e])},t.prototype.updateTrackedLimbos=function(t,e){for(var n=0,r=e;n<r.length;n++){var i=r[n];if(i instanceof _h)this.limboDocumentRefs.addReference(i.key,t),this.trackLimboChange(i);else if(i instanceof Rh){No("SyncEngine","Document no longer in limbo: "+i.key),this.limboDocumentRefs.removeReference(i.key,t),this.limboDocumentRefs.containsKey(i.key)||this.removeLimboTarget(i.key)}else Do("Unknown limbo change: "+JSON.stringify(i))}},t.prototype.trackLimboChange=function(t){var e=t.key;if(!this.limboTargetsByKey.get(e)){No("SyncEngine","New document in limbo: "+e);var n=this.limboTargetIdGenerator.next(),r=Jc.atPath(e.path);this.limboResolutionsByTarget[n]=new xh(e),this.remoteStore.listen(new Lu(r,n,Ru.LimboResolution,ya.INVALID)),this.limboTargetsByKey=this.limboTargetsByKey.insert(e,n)}},t.prototype.currentLimboDocs=function(){return this.limboTargetsByKey},t.prototype.emitNewSnapsAndNotifyLocalStore=function(t,e){return xt(this,void 0,void 0,function(){var n,r,i,o=this;return qt(this,function(a){switch(a.label){case 0:return n=[],r=[],i=[],this.queryViewsByQuery.forEach(function(a,s){i.push(Promise.resolve().then(function(){var e=s.view.computeDocChanges(t);return e.needsRefill?o.localStore.executeQuery(s.query).then(function(t){return s.view.computeDocChanges(t,e)}):e}).then(function(t){var i=e&&e.targetChanges[s.targetId],a=s.view.applyChanges(t,!0===o.isPrimary,i);if(o.updateTrackedLimbos(s.targetId,a.limboChanges),a.snapshot){o.isPrimary&&o.sharedClientState.updateQueryState(s.targetId,a.snapshot.fromCache?"not-current":"current"),n.push(a.snapshot);var u=kh.fromSnapshot(s.targetId,a.snapshot);r.push(u)}}))}),[4,Promise.all(i)];case 1:return a.sent(),this.syncEngineListener.onWatchChange(n),[4,this.localStore.notifyLocalViewChanges(r)];case 2:return a.sent(),[2]}})})},t.prototype.assertSubscribed=function(t){ko(null!==this.syncEngineListener,"Trying to call "+t+" before calling subscribe().")},t.prototype.handleCredentialChange=function(t){return xt(this,void 0,void 0,function(){var e,n;return qt(this,function(r){switch(r.label){case 0:return e=!this.currentUser.isEqual(t),this.currentUser=t,e?(this.rejectOutstandingPendingWritesCallbacks("'waitForPendingWrites' promise is rejected due to a user change."),[4,this.localStore.handleUserChange(t)]):[3,3];case 1:return n=r.sent(),this.sharedClientState.handleUserChange(t,n.removedBatchIds,n.addedBatchIds),[4,this.emitNewSnapsAndNotifyLocalStore(n.affectedDocuments)];case 2:r.sent(),r.label=3;case 3:return[4,this.remoteStore.handleCredentialChange()];case 4:return r.sent(),[2]}})})},t.prototype.applyPrimaryState=function(t){return xt(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u=this;return qt(this,function(c){switch(c.label){case 0:return!0!==t||!0===this.isPrimary?[3,3]:(this.isPrimary=!0,[4,this.remoteStore.applyPrimaryState(!0)]);case 1:return c.sent(),e=this.sharedClientState.getAllActiveQueryTargets(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(e.toArray())];case 2:for(n=c.sent(),r=0,i=n;r<i.length;r++)o=i[r],this.remoteStore.listen(o);return[3,7];case 3:return!1!==t||!1===this.isPrimary?[3,7]:(this.isPrimary=!1,a=[],s=Promise.resolve(),qo(this.queryViewsByTarget,function(t,e){u.sharedClientState.isLocalQueryTarget(t)?a.push(t):s=s.then(function(){return u.unlisten(e.query)}),u.remoteStore.unlisten(e.targetId)}),[4,s]);case 4:return c.sent(),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)];case 5:return c.sent(),this.resetLimboDocuments(),[4,this.remoteStore.applyPrimaryState(!1)];case 6:c.sent(),c.label=7;case 7:return[2]}})})},t.prototype.resetLimboDocuments=function(){var t=this;qo(this.limboResolutionsByTarget,function(e){t.remoteStore.unlisten(e)}),this.limboDocumentRefs.removeAllReferences(),this.limboResolutionsByTarget=[],this.limboTargetsByKey=new La(Ia.comparator)},t.prototype.synchronizeQueryViewsAndRaiseSnapshots=function(t){return xt(this,void 0,void 0,function(){var e,n,r,i,o,a,s,u,c;return qt(this,function(h){switch(h.label){case 0:e=[],n=[],r=0,i=t,h.label=1;case 1:return r<i.length?(o=i[r],a=void 0,(s=this.queryViewsByTarget[o])?[4,this.localStore.releaseQuery(s.query,!0)]:[3,5]):[3,11];case 2:return h.sent(),[4,this.localStore.allocateQuery(s.query)];case 3:return a=h.sent(),[4,this.synchronizeViewAndComputeSnapshot(s)];case 4:return(u=h.sent()).snapshot&&n.push(u.snapshot),[3,9];case 5:return ko(!0===this.isPrimary,"A secondary tab should never have an active query without an active view."),[4,this.localStore.getQueryForTarget(o)];case 6:return ko(!!(c=h.sent()),"Query data for target "+o+" not found"),[4,this.localStore.allocateQuery(c)];case 7:return a=h.sent(),[4,this.initializeViewAndComputeSnapshot(a,!1)];case 8:h.sent(),h.label=9;case 9:e.push(a),h.label=10;case 10:return r++,[3,1];case 11:return this.syncEngineListener.onWatchChange(n),[2,e]}})})},t.prototype.getActiveClients=function(){return this.localStore.getActiveClients()},t.prototype.applyTargetState=function(t,e,n){return xt(this,void 0,void 0,function(){var r,i,o,a,s;return qt(this,function(u){switch(u.label){case 0:if(this.isPrimary)return No("SyncEngine","Ignoring unexpected query state notification."),[2];if(!this.queryViewsByTarget[t])return[3,11];switch(e){case"current":case"not-current":return[3,1];case"rejected":return[3,8]}return[3,10];case 1:return u.trys.push([1,4,,8]),[4,this.localStore.getNewDocumentChanges()];case 2:return r=u.sent(),i=Vc.createSynthesizedRemoteEventForCurrentChange(t,"current"===e),[4,this.emitNewSnapsAndNotifyLocalStore(r,i)];case 3:return u.sent(),[3,11];case 4:return o=u.sent(),(c=o).code!==Oo.DATA_LOSS||c.message!==iu?[3,6]:(a=[],qo(this.queryViewsByTarget,function(t){return a.push(t)}),[4,this.synchronizeQueryViewsAndRaiseSnapshots(a)]);case 5:return u.sent(),[3,7];case 6:throw o;case 7:return[3,8];case 8:return s=this.queryViewsByTarget[t],this.removeAndCleanupQuery(s),[4,this.localStore.releaseQuery(s.query,!0)];case 9:return u.sent(),this.syncEngineListener.onWatchError(s.query,n),[3,11];case 10:Do("Unexpected target state: "+e),u.label=11;case 11:return[2]}var c})})},t.prototype.applyActiveTargetsChange=function(t,e){return xt(this,void 0,void 0,function(){var n,r,i,o,a,s,u,c,h,l=this;return qt(this,function(f){switch(f.label){case 0:if(!this.isPrimary)return[2];n=0,r=t,f.label=1;case 1:return n<r.length?(h=r[n],ko(!this.queryViewsByTarget[h],"Trying to add an already active target"),[4,this.localStore.getQueryForTarget(h)]):[3,6];case 2:return ko(!!(i=f.sent()),"Query data for active target "+h+" not found"),[4,this.localStore.allocateQuery(i)];case 3:return o=f.sent(),[4,this.initializeViewAndComputeSnapshot(o,!1)];case 4:f.sent(),this.remoteStore.listen(o),f.label=5;case 5:return n++,[3,1];case 6:a=function(t){var e;return qt(this,function(n){switch(n.label){case 0:return(e=s.queryViewsByTarget[t])?[4,s.localStore.releaseQuery(e.query,!1).then(function(){l.remoteStore.unlisten(t),l.removeAndCleanupQuery(e)}).catch(Hu)]:[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}})},s=this,u=0,c=e,f.label=7;case 7:return u<c.length?(h=c[u],[5,a(h)]):[3,10];case 8:f.sent(),f.label=9;case 9:return u++,[3,7];case 10:return[2]}})})},t.prototype.enableNetwork=function(){return this.localStore.setNetworkEnabled(!0),this.remoteStore.enableNetwork()},t.prototype.disableNetwork=function(){return this.localStore.setNetworkEnabled(!1),this.remoteStore.disableNetwork()},t.prototype.getRemoteKeysForTarget=function(t){var e=this.limboResolutionsByTarget[t];return e&&e.receivedDocument?Ha().add(e.key):this.queryViewsByTarget[t]?this.queryViewsByTarget[t].view.syncedDocuments:Ha()},t}(),Fh=function(){function t(t){this.uid=t}return t.prototype.isAuthenticated=function(){return null!=this.uid},t.prototype.toKey=function(){return this.isAuthenticated()?"uid:"+this.uid:"anonymous-user"},t.prototype.isEqual=function(t){return t.uid===this.uid},t.UNAUTHENTICATED=new t(null),t.GOOGLE_CREDENTIALS=new t("google-credentials-uid"),t.FIRST_PARTY=new t("first-party-uid"),t}(),Uh="SharedClientState",Vh="firestore_clients",Bh="firestore_mutations",jh="firestore_targets",Kh="firestore_online_state",$h="firestore_sequence_number",Qh=function(){function t(t,e,n,r){this.user=t,this.batchId=e,this.state=n,this.error=r,ko(void 0!==r==("rejected"===n),"MutationMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n,r){var i=JSON.parse(r),o="object"==typeof i&&-1!==["pending","acknowledged","rejected"].indexOf(i.state)&&(void 0===i.error||"object"==typeof i.error),a=void 0;return o&&i.error&&(o="string"==typeof i.error.message&&"string"==typeof i.error.code)&&(a=new Po(i.error.code,i.error.message)),o?new t(e,n,i.state,a):(Co(Uh,"Failed to parse mutation state for ID '"+n+"': "+r),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Wh=function(){function t(t,e,n){this.targetId=t,this.state=e,this.error=n,ko(void 0!==n==("rejected"===e),"QueryTargetMetadata must contain an error iff state is 'rejected'")}return t.fromWebStorageEntry=function(e,n){var r=JSON.parse(n),i="object"==typeof r&&-1!==["not-current","current","rejected"].indexOf(r.state)&&(void 0===r.error||"object"==typeof r.error),o=void 0;return i&&r.error&&(i="string"==typeof r.error.message&&"string"==typeof r.error.code)&&(o=new Po(r.error.code,r.error.message)),i?new t(e,r.state,o):(Co(Uh,"Failed to parse target state for ID '"+e+"': "+n),null)},t.prototype.toWebStorageJSON=function(){var t={state:this.state,updateTimeMs:Date.now()};return this.error&&(t.error={code:this.error.code,message:this.error.message}),JSON.stringify(t)},t}(),Gh=function(){function t(t,e){this.clientId=t,this.activeTargetIds=e}return t.fromWebStorageEntry=function(e,n){for(var r=JSON.parse(n),i="object"==typeof r&&r.activeTargetIds instanceof Array,o=Xa(),a=0;i&&a<r.activeTargetIds.length;++a)i=yc(r.activeTargetIds[a]),o=o.add(r.activeTargetIds[a]);return i?new t(e,o):(Co(Uh,"Failed to parse client data for instance '"+e+"': "+n),null)},t}(),zh=function(){function t(t,e){this.clientId=t,this.onlineState=e}return t.fromWebStorageEntry=function(e){var n=JSON.parse(e);return"object"==typeof n&&n.onlineState in Ec&&"string"==typeof n.clientId?new t(n.clientId,Ec[n.onlineState]):(Co(Uh,"Failed to parse online state: "+e),null)},t}(),Hh=function(){function t(){this.activeTargetIds=Xa()}return t.prototype.addQueryTarget=function(t){ko(!this.activeTargetIds.has(t),"Target with ID '"+t+"' already active."),this.activeTargetIds=this.activeTargetIds.add(t)},t.prototype.removeQueryTarget=function(t){this.activeTargetIds=this.activeTargetIds.delete(t)},t.prototype.toWebStorageJSON=function(){var t={activeTargetIds:this.activeTargetIds.toArray(),updateTimeMs:Date.now()};return JSON.stringify(t)},t}(),Yh=function(){function t(e,n,r,i,o){if(this.queue=e,this.platform=n,this.persistenceKey=r,this.localClientId=i,this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null,this.activeClients={},this.storageListener=this.handleWebStorageEvent.bind(this),this.started=!1,this.earlyEvents=[],!t.isAvailable(this.platform))throw new Po(Oo.UNIMPLEMENTED,"LocalStorage is not available on this platform.");var a=r.replace(/[.*+?^${}()|[\]\\]/g,"\\$&");this.storage=this.platform.window.localStorage,this.currentUser=o,this.localClientStorageKey=this.toWebStorageClientStateKey(this.localClientId),this.sequenceNumberKey=$h+"_"+r,this.activeClients[this.localClientId]=new Hh,this.clientStateKeyRe=new RegExp("^"+Vh+"_"+a+"_([^_]*)$"),this.mutationBatchKeyRe=new RegExp("^"+Bh+"_"+a+"_(\\d+)(?:_(.*))?$"),this.queryTargetKeyRe=new RegExp("^"+jh+"_"+a+"_(\\d+)$"),this.onlineStateKey=Kh+"_"+r,this.platform.window.addEventListener("storage",this.storageListener)}return t.isAvailable=function(t){return!(!t.window||null==t.window.localStorage)},t.prototype.start=function(){return xt(this,void 0,void 0,function(){var t,e,n,r,i,o,a,s,u,c,h,l=this;return qt(this,function(f){switch(f.label){case 0:return ko(!this.started,"WebStorageSharedClientState already started"),ko(null!==this.syncEngine,"syncEngine property must be set before calling start()"),ko(null!==this.onlineStateHandler,"onlineStateHandler property must be set before calling start()"),[4,this.syncEngine.getActiveClients()];case 1:for(t=f.sent(),e=0,n=t;e<n.length;e++)(r=n[e])!==this.localClientId&&(i=this.getItem(this.toWebStorageClientStateKey(r)))&&(o=Gh.fromWebStorageEntry(r,i))&&(this.activeClients[o.clientId]=o);for(this.persistClientState(),(a=this.storage.getItem(this.onlineStateKey))&&(s=this.fromWebStorageOnlineState(a))&&this.handleOnlineStateEvent(s),u=0,c=this.earlyEvents;u<c.length;u++)h=c[u],this.handleWebStorageEvent(h);return this.earlyEvents=[],this.platform.window.addEventListener("unload",function(){return l.shutdown()}),this.started=!0,[2]}})})},t.prototype.writeSequenceNumber=function(t){this.setItem(this.sequenceNumberKey,JSON.stringify(t))},t.prototype.getAllActiveQueryTargets=function(){var t=Xa();return Fo(this.activeClients,function(e,n){t=t.unionWith(n.activeTargetIds)}),t},t.prototype.isActiveQueryTarget=function(t){for(var e in this.activeClients)if(this.activeClients.hasOwnProperty(e)&&this.activeClients[e].activeTargetIds.has(t))return!0;return!1},t.prototype.addPendingMutation=function(t){this.persistMutationState(t,"pending")},t.prototype.updateMutationState=function(t,e,n){this.persistMutationState(t,e,n),this.removeMutationState(t)},t.prototype.addLocalQueryTarget=function(t){var e="not-current";if(this.isActiveQueryTarget(t)){var n=this.storage.getItem(this.toWebStorageQueryTargetMetadataKey(t));if(n){var r=Wh.fromWebStorageEntry(t,n);r&&(e=r.state)}}return this.localClientState.addQueryTarget(t),this.persistClientState(),e},t.prototype.removeLocalQueryTarget=function(t){this.localClientState.removeQueryTarget(t),this.persistClientState()},t.prototype.isLocalQueryTarget=function(t){return this.localClientState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){this.removeItem(this.toWebStorageQueryTargetMetadataKey(t))},t.prototype.updateQueryState=function(t,e,n){this.persistQueryTargetState(t,e,n)},t.prototype.handleUserChange=function(t,e,n){var r=this;e.forEach(function(t){r.removeMutationState(t)}),this.currentUser=t,n.forEach(function(t){r.addPendingMutation(t)})},t.prototype.setOnlineState=function(t){this.persistOnlineState(t)},t.prototype.shutdown=function(){this.started&&(this.platform.window.removeEventListener("storage",this.storageListener),this.removeItem(this.localClientStorageKey),this.started=!1)},t.prototype.getItem=function(t){var e=this.storage.getItem(t);return No(Uh,"READ",t,e),e},t.prototype.setItem=function(t,e){No(Uh,"SET",t,e),this.storage.setItem(t,e)},t.prototype.removeItem=function(t){No(Uh,"REMOVE",t),this.storage.removeItem(t)},t.prototype.handleWebStorageEvent=function(t){var e=this;if(t.storageArea===this.storage){if(No(Uh,"EVENT",t.key,t.newValue),t.key===this.localClientStorageKey)return void Co("Received WebStorage notification for local change. Another client might have garbage-collected our state");this.queue.enqueueAndForget(function(){return xt(e,void 0,void 0,function(){var e,n,r,i,o,a;return qt(this,function(s){if(!this.started)return this.earlyEvents.push(t),[2];if(null===t.key)return[2];if(this.clientStateKeyRe.test(t.key)){if(null==t.newValue)return n=this.fromWebStorageClientStateKey(t.key),[2,this.handleClientStateEvent(n,null)];if(e=this.fromWebStorageClientState(t.key,t.newValue))return[2,this.handleClientStateEvent(e.clientId,e)]}else if(this.mutationBatchKeyRe.test(t.key)){if(null!==t.newValue&&(r=this.fromWebStorageMutationMetadata(t.key,t.newValue)))return[2,this.handleMutationBatchEvent(r)]}else if(this.queryTargetKeyRe.test(t.key)){if(null!==t.newValue&&(i=this.fromWebStorageQueryTargetMetadata(t.key,t.newValue)))return[2,this.handleQueryTargetEvent(i)]}else if(t.key===this.onlineStateKey){if(null!==t.newValue&&(o=this.fromWebStorageOnlineState(t.newValue)))return[2,this.handleOnlineStateEvent(o)]}else t.key===this.sequenceNumberKey&&(ko(!!this.sequenceNumberHandler,"Missing sequenceNumberHandler"),(a=function(t){var e=ya.INVALID;if(null!=t)try{var n=JSON.parse(t);ko("number"==typeof n,"Found non-numeric sequence number"),e=n}catch(t){Co(Uh,"Failed to read sequence number from WebStorage",t)}return e}(t.newValue))!==ya.INVALID&&this.sequenceNumberHandler(a));return[2]})})})}},Object.defineProperty(t.prototype,"localClientState",{get:function(){return this.activeClients[this.localClientId]},enumerable:!0,configurable:!0}),t.prototype.persistClientState=function(){this.setItem(this.localClientStorageKey,this.localClientState.toWebStorageJSON())},t.prototype.persistMutationState=function(t,e,n){var r=new Qh(this.currentUser,t,e,n),i=this.toWebStorageMutationBatchKey(t);this.setItem(i,r.toWebStorageJSON())},t.prototype.removeMutationState=function(t){var e=this.toWebStorageMutationBatchKey(t);this.removeItem(e)},t.prototype.persistOnlineState=function(t){var e={clientId:this.localClientId,onlineState:Ec[t]};this.storage.setItem(this.onlineStateKey,JSON.stringify(e))},t.prototype.persistQueryTargetState=function(t,e,n){var r=this.toWebStorageQueryTargetMetadataKey(t),i=new Wh(t,e,n);this.setItem(r,i.toWebStorageJSON())},t.prototype.toWebStorageClientStateKey=function(t){return ko(-1===t.indexOf("_"),"Client key cannot contain '_', but was '"+t+"'"),Vh+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageQueryTargetMetadataKey=function(t){return jh+"_"+this.persistenceKey+"_"+t},t.prototype.toWebStorageMutationBatchKey=function(t){var e=Bh+"_"+this.persistenceKey+"_"+t;return this.currentUser.isAuthenticated()&&(e+="_"+this.currentUser.uid),e},t.prototype.fromWebStorageClientStateKey=function(t){var e=this.clientStateKeyRe.exec(t);return e?e[1]:null},t.prototype.fromWebStorageClientState=function(t,e){var n=this.fromWebStorageClientStateKey(t);return ko(null!==n,"Cannot parse client state key '"+t+"'"),Gh.fromWebStorageEntry(n,e)},t.prototype.fromWebStorageMutationMetadata=function(t,e){var n=this.mutationBatchKeyRe.exec(t);ko(null!==n,"Cannot parse mutation batch key '"+t+"'");var r=Number(n[1]),i=void 0!==n[2]?n[2]:null;return Qh.fromWebStorageEntry(new Fh(i),r,e)},t.prototype.fromWebStorageQueryTargetMetadata=function(t,e){var n=this.queryTargetKeyRe.exec(t);ko(null!==n,"Cannot parse query target key '"+t+"'");var r=Number(n[1]);return Wh.fromWebStorageEntry(r,e)},t.prototype.fromWebStorageOnlineState=function(t){return zh.fromWebStorageEntry(t)},t.prototype.handleMutationBatchEvent=function(t){return xt(this,void 0,void 0,function(){return qt(this,function(e){return t.user.uid!==this.currentUser.uid?(No(Uh,"Ignoring mutation for non-active user "+t.user.uid),[2]):[2,this.syncEngine.applyBatchState(t.batchId,t.state,t.error)]})})},t.prototype.handleQueryTargetEvent=function(t){return this.syncEngine.applyTargetState(t.targetId,t.state,t.error)},t.prototype.handleClientStateEvent=function(t,e){var n=this,r=this.getAllActiveQueryTargets();e?this.activeClients[t]=e:delete this.activeClients[t];var i=this.getAllActiveQueryTargets(),o=[],a=[];return i.forEach(function(t){return xt(n,void 0,void 0,function(){return qt(this,function(e){return r.has(t)||o.push(t),[2]})})}),r.forEach(function(t){return xt(n,void 0,void 0,function(){return qt(this,function(e){return i.has(t)||a.push(t),[2]})})}),this.syncEngine.applyActiveTargetsChange(o,a)},t.prototype.handleOnlineStateEvent=function(t){this.activeClients[t.clientId]&&this.onlineStateHandler(t.onlineState)},t}();var Xh=function(){function t(){this.localState=new Hh,this.queryState={},this.syncEngine=null,this.onlineStateHandler=null,this.sequenceNumberHandler=null}return t.prototype.addPendingMutation=function(t){},t.prototype.updateMutationState=function(t,e,n){},t.prototype.addLocalQueryTarget=function(t){return this.localState.addQueryTarget(t),this.queryState[t]||"not-current"},t.prototype.updateQueryState=function(t,e,n){this.queryState[t]=e},t.prototype.removeLocalQueryTarget=function(t){this.localState.removeQueryTarget(t)},t.prototype.isLocalQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.clearQueryState=function(t){delete this.queryState[t]},t.prototype.getAllActiveQueryTargets=function(){return this.localState.activeTargetIds},t.prototype.isActiveQueryTarget=function(t){return this.localState.activeTargetIds.has(t)},t.prototype.start=function(){return this.localState=new Hh,Promise.resolve()},t.prototype.handleUserChange=function(t,e,n){},t.prototype.setOnlineState=function(t){},t.prototype.shutdown=function(){},t.prototype.writeSequenceNumber=function(t){},t}(),Jh=function(){function t(t,e){this.cacheSizeBytes=t,this.synchronizeTabs=e}return t.prototype.lruParams=function(){return Vu.withCacheSize(this.cacheSizeBytes)},t}(),Zh=function(){return function(){}}(),tl=function(){function t(t,e,n,r){this.platform=t,this.databaseInfo=e,this.credentials=n,this.asyncQueue=r,this.clientId=ia.newId()}return t.prototype.start=function(t){var e=this;this.verifyNotTerminated();var n=new Ea,r=new Ea,i=!1;return this.credentials.setChangeListener(function(o){i?e.asyncQueue.enqueueAndForget(function(){return e.handleCredentialChange(o)}):(i=!0,e.initializePersistence(t,r,o).then(function(t){return e.initializeRest(o,t)}).then(n.resolve,n.reject))}),this.asyncQueue.enqueueAndForget(function(){return n.promise}),r.promise},t.prototype.enableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.enableNetwork()})},t.prototype.initializePersistence=function(t,e,n){var r=this;return t instanceof Jh?this.startIndexedDbPersistence(n,t).then(function(t){return e.resolve(),t}).catch(function(t){if(e.reject(t),!r.canFallback(t))throw t;return console.warn("Error enabling offline persistence. Falling back to persistence disabled: "+t),r.startMemoryPersistence()}):(e.resolve(),this.startMemoryPersistence())},t.prototype.canFallback=function(t){return t instanceof Po?t.code===Oo.FAILED_PRECONDITION||t.code===Oo.UNIMPLEMENTED:!("undefined"!=typeof DOMException&&t instanceof DOMException)||(22===t.code||20===t.code||11===t.code)},t.prototype.verifyNotTerminated=function(){if(this.asyncQueue.isShuttingDown)throw new Po(Oo.FAILED_PRECONDITION,"The client has already been terminated.")},t.prototype.startIndexedDbPersistence=function(t,e){var n=this,r=zu.buildStoragePrefix(this.databaseInfo),i=new Nh(this.databaseInfo.databaseId,{useProto3Json:!0});return Promise.resolve().then(function(){return xt(n,void 0,void 0,function(){var n,o;return qt(this,function(a){switch(a.label){case 0:if(e.synchronizeTabs&&!Yh.isAvailable(this.platform))throw new Po(Oo.UNIMPLEMENTED,"IndexedDB persistence is only available on platforms that support LocalStorage.");return n=e.lruParams(),this.sharedClientState=e.synchronizeTabs?new Yh(this.asyncQueue,this.platform,r,this.clientId,t):new Xh,[4,zu.createIndexedDbPersistence({allowTabSynchronization:e.synchronizeTabs,persistenceKey:r,clientId:this.clientId,platform:this.platform,queue:this.asyncQueue,serializer:i,lruParams:n,sequenceNumberSyncer:this.sharedClientState})];case 1:return o=a.sent(),this.persistence=o,[2,o.referenceDelegate.garbageCollector]}})})})},t.prototype.startMemoryPersistence=function(){return this.persistence=sc.createEagerPersistence(this.clientId),this.sharedClientState=new Xh,Promise.resolve(null)},t.prototype.initializeRest=function(t,e){var n=this;return No("FirestoreClient","Initializing. user=",t.uid),this.platform.loadConnection(this.databaseInfo).then(function(r){return xt(n,void 0,void 0,function(){var n,i,o,a,s,u=this;return qt(this,function(c){switch(c.label){case 0:return this.localStore=new rc(this.persistence,t),e&&(this.lruScheduler=new Bu(e,this.asyncQueue,this.localStore)),n=this.platform.newConnectivityMonitor(),i=this.platform.newSerializer(this.databaseInfo.databaseId),o=new Ac(this.asyncQueue,r,this.credentials,i),a=function(t){return u.syncEngine.applyOnlineStateChange(t,Tc.RemoteStore)},s=function(t){return u.syncEngine.applyOnlineStateChange(t,Tc.SharedClientState)},this.remoteStore=new Yc(this.localStore,o,this.asyncQueue,a,n),this.syncEngine=new qh(this.localStore,this.remoteStore,this.sharedClientState,t),this.sharedClientState.onlineStateHandler=s,this.remoteStore.syncEngine=this.syncEngine,this.sharedClientState.syncEngine=this.syncEngine,this.eventMgr=new Ah(this.syncEngine),[4,this.sharedClientState.start()];case 1:return c.sent(),[4,this.remoteStore.start()];case 2:return c.sent(),[4,this.persistence.setPrimaryStateListener(function(t){return xt(u,void 0,void 0,function(){return qt(this,function(e){switch(e.label){case 0:return[4,this.syncEngine.applyPrimaryState(t)];case 1:return e.sent(),this.lruScheduler&&(t&&!this.lruScheduler.started?this.lruScheduler.start():t||this.lruScheduler.stop()),[2]}})})})];case 3:return c.sent(),[4,this.persistence.setDatabaseDeletedListener(function(){return xt(u,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return[4,this.terminate()];case 1:return t.sent(),[2]}})})})];case 4:return c.sent(),[2]}})})})},t.prototype.handleCredentialChange=function(t){return this.asyncQueue.verifyOperationInProgress(),No("FirestoreClient","Credential Changed. Current user: "+t.uid),this.syncEngine.handleCredentialChange(t)},t.prototype.disableNetwork=function(){var t=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return t.syncEngine.disableNetwork()})},t.prototype.terminate=function(){var t=this;return this.asyncQueue.enqueueAndInitiateShutdown(function(){return xt(t,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return this.lruScheduler&&this.lruScheduler.stop(),[4,this.remoteStore.shutdown()];case 1:return t.sent(),[4,this.sharedClientState.shutdown()];case 2:return t.sent(),[4,this.persistence.shutdown()];case 3:return t.sent(),this.credentials.removeChangeListener(),[2]}})})})},t.prototype.waitForPendingWrites=function(){var t=this;this.verifyNotTerminated();var e=new Ea;return this.asyncQueue.enqueueAndForget(function(){return t.syncEngine.registerPendingWritesCallback(e)}),e.promise},t.prototype.listen=function(t,e,n){var r=this;this.verifyNotTerminated();var i=new Dh(t,e,n);return this.asyncQueue.enqueueAndForget(function(){return r.eventMgr.listen(i)}),i},t.prototype.unlisten=function(t){var e=this;this.clientTerminated||this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.unlisten(t)})},t.prototype.getDocumentFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.localStore.readDocument(t)}).then(function(t){if(t instanceof Zs)return t;if(t instanceof tu)return null;throw new Po(Oo.UNAVAILABLE,"Failed to get document from cache. (However, this document may exist on the server. Run again without setting 'source' in the GetOptions to attempt to retrieve the document from the server.)")})},t.prototype.getDocumentsFromLocalCache=function(t){var e=this;return this.verifyNotTerminated(),this.asyncQueue.enqueue(function(){return e.localStore.executeQuery(t)}).then(function(e){var n=Ha(),r=new Oh(t,n),i=r.computeDocChanges(e);return r.applyChanges(i,!1).snapshot})},t.prototype.write=function(t){var e=this;this.verifyNotTerminated();var n=new Ea;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.write(t,n)}),n.promise},t.prototype.databaseId=function(){return this.databaseInfo.databaseId},t.prototype.addSnapshotsInSyncListener=function(t){var e=this;this.verifyNotTerminated(),this.asyncQueue.enqueueAndForget(function(){return e.eventMgr.addSnapshotsInSyncListener(t),Promise.resolve()})},t.prototype.removeSnapshotsInSyncListener=function(t){this.clientTerminated||this.eventMgr.removeSnapshotsInSyncListener(t)},Object.defineProperty(t.prototype,"clientTerminated",{get:function(){return this.asyncQueue.isShuttingDown},enumerable:!0,configurable:!0}),t.prototype.transaction=function(t){var e=this;this.verifyNotTerminated();var n=new Ea;return this.asyncQueue.enqueueAndForget(function(){return e.syncEngine.runTransaction(e.asyncQueue,t,n),Promise.resolve()}),n.promise},t}(),el=function(){function t(t){this.observer=t,this.muted=!1}return t.prototype.next=function(t){this.scheduleEvent(this.observer.next,t)},t.prototype.error=function(t){this.scheduleEvent(this.observer.error,t)},t.prototype.mute=function(){this.muted=!0},t.prototype.scheduleEvent=function(t,e){var n=this;this.muted||setTimeout(function(){n.muted||t(e)},0)},t}(),nl=function(){function t(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];!function(t,e,n,r){if(!(e instanceof Array)||e.length<r)throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() requires its "+n+" argument to be an array with at least "+ra(r,"element")+".")}("FieldPath",t,"fieldNames",1);for(var n=0;n<t.length;++n)if($o("FieldPath","string",n,t[n]),0===t[n].length)throw new Po(Oo.INVALID_ARGUMENT,"Invalid field name at argument $(i + 1). Field names must not be empty.");this._internalPath=new wa(t)}return t.documentId=function(){return t._DOCUMENT_ID},t.prototype.isEqual=function(e){if(!(e instanceof t))throw ea("isEqual","FieldPath",1,e);return this._internalPath.isEqual(e._internalPath)},t._DOCUMENT_ID=new t(wa.keyField().canonicalString()),t}(),rl=new RegExp("[~\\*/\\[\\]]");var il=function(){return function(t,e){this.user=e,this.type="OAuth",this.authHeaders={Authorization:"Bearer "+t}}}(),ol=function(){function t(){this.changeListener=null}return t.prototype.getToken=function(){return Promise.resolve(null)},t.prototype.invalidateToken=function(){},t.prototype.setChangeListener=function(t){ko(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(Fh.UNAUTHENTICATED)},t.prototype.removeChangeListener=function(){ko(null!==this.changeListener,"removeChangeListener() when no listener registered"),this.changeListener=null},t}(),al=function(){function t(t){var e=this;this.app=t,this.tokenListener=null,this.currentUser=Fh.UNAUTHENTICATED,this.tokenCounter=0,this.changeListener=null,this.forceRefresh=!1,this.tokenListener=function(){e.tokenCounter++,e.currentUser=e.getUser(),e.changeListener&&e.changeListener(e.currentUser)},this.currentUser=this.getUser(),this.tokenCounter=0,this.app.INTERNAL.addAuthTokenListener(this.tokenListener)}return t.prototype.getToken=function(){var t=this;ko(null!=this.tokenListener,"getToken cannot be called after listener removed.");var e=this.tokenCounter,n=this.forceRefresh;return this.forceRefresh=!1,this.app.INTERNAL.getToken(n).then(function(n){if(t.tokenCounter!==e)throw new Po(Oo.ABORTED,"getToken aborted due to token change.");return n?(ko("string"==typeof n.accessToken,"Invalid tokenData returned from getToken():"+n),new il(n.accessToken,t.currentUser)):null})},t.prototype.invalidateToken=function(){this.forceRefresh=!0},t.prototype.setChangeListener=function(t){ko(!this.changeListener,"Can only call setChangeListener() once."),this.changeListener=t,t(this.currentUser)},t.prototype.removeChangeListener=function(){ko(null!=this.tokenListener,"removeChangeListener() called twice"),ko(null!==this.changeListener,"removeChangeListener() called when no listener registered"),this.app.INTERNAL.removeAuthTokenListener(this.tokenListener),this.tokenListener=null,this.changeListener=null},t.prototype.getUser=function(){var t=this.app.INTERNAL.getUid();return ko(null===t||"string"==typeof t,"Received invalid UID: "+t),new Fh(t)},t}(),sl=function(){function t(t,e){this.gapi=t,this.sessionIndex=e,this.type="FirstParty",this.user=Fh.FIRST_PARTY}return Object.defineProperty(t.prototype,"authHeaders",{get:function(){var t={"X-Goog-AuthUser":this.sessionIndex},e=this.gapi.auth.getAuthHeaderValueForFirstParty([]);return e&&(t.Authorization=e),t},enumerable:!0,configurable:!0}),t}(),ul=function(){function t(t,e){this.gapi=t,this.sessionIndex=e}return t.prototype.getToken=function(){return Promise.resolve(new sl(this.gapi,this.sessionIndex))},t.prototype.setChangeListener=function(t){t(Fh.FIRST_PARTY)},t.prototype.removeChangeListener=function(){},t.prototype.invalidateToken=function(){},t}();function cl(t){return function(t,e){if("object"!=typeof t||null===t)return!1;for(var n=t,r=0,i=e;r<i.length;r++){var o=i[r];if(o in n&&"function"==typeof n[o])return!0}return!1}(t,["next","error","complete"])}var hl,ll=function(){function t(t){this._methodName=t}return t.delete=function(){return Vo("FieldValue.delete",arguments),fl.instance},t.serverTimestamp=function(){return Vo("FieldValue.serverTimestamp",arguments),pl.instance},t.arrayUnion=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return jo("FieldValue.arrayUnion",arguments,1),new dl(t)},t.arrayRemove=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];return jo("FieldValue.arrayRemove",arguments,1),new ml(t)},t.increment=function(t){return $o("FieldValue.increment","number",1,t),Bo("FieldValue.increment",arguments,1),new yl(t)},t.prototype.isEqual=function(t){return this===t},t}(),fl=function(t){function e(){return t.call(this,"FieldValue.delete")||this}return Mt(e,t),e.instance=new e,e}(ll),pl=function(t){function e(){return t.call(this,"FieldValue.serverTimestamp")||this}return Mt(e,t),e.instance=new e,e}(ll),dl=function(t){function e(e){var n=t.call(this,"FieldValue.arrayUnion")||this;return n._elements=e,n}return Mt(e,t),e}(ll),ml=function(t){function e(e){var n=t.call(this,"FieldValue.arrayRemove")||this;return n._elements=e,n}return Mt(e,t),e}(ll),yl=function(t){function e(e){var n=t.call(this,"FieldValue.increment")||this;return n._operand=e,n}return Mt(e,t),e}(ll),gl=Mo(ll,"Use FieldValue.<field>() instead."),vl=/^__.*__$/,bl=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[];return null!==this.fieldMask?n.push(new Ps(t,this.data,this.fieldMask,e)):n.push(new Os(t,this.data,e)),this.fieldTransforms.length>0&&n.push(new Ms(t,this.fieldTransforms)),n},t}(),wl=function(){function t(t,e,n){this.data=t,this.fieldMask=e,this.fieldTransforms=n}return t.prototype.toMutations=function(t,e){var n=[new Ps(t,this.data,this.fieldMask,e)];return this.fieldTransforms.length>0&&n.push(new Ms(t,this.fieldTransforms)),n},t}();function Il(t){switch(t){case hl.Set:case hl.MergeSet:case hl.Update:return!0;case hl.Argument:return!1;default:throw Do("Unexpected case for UserDataSource: "+t)}}!function(t){t[t.Set=0]="Set",t[t.Update=1]="Update",t[t.MergeSet=2]="MergeSet",t[t.Argument=3]="Argument"}(hl||(hl={}));var El=function(){function t(t,e,n,r,i,o){this.dataSource=t,this.methodName=e,this.path=n,this.arrayElement=r,void 0===i&&this.validatePath(),this.arrayElement=void 0!==r&&r,this.fieldTransforms=i||[],this.fieldMask=o||[]}return t.prototype.childContextForField=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePathSegment(e),r},t.prototype.childContextForFieldPath=function(e){var n=null==this.path?null:this.path.child(e),r=new t(this.dataSource,this.methodName,n,!1,this.fieldTransforms,this.fieldMask);return r.validatePath(),r},t.prototype.childContextForArray=function(e){return new t(this.dataSource,this.methodName,null,!0,this.fieldTransforms,this.fieldMask)},t.prototype.createError=function(t){var e=null===this.path||this.path.isEmpty()?"":" (found in field "+this.path.toString()+")";return new Po(Oo.INVALID_ARGUMENT,"Function "+this.methodName+"() called with invalid data. "+t+e)},t.prototype.contains=function(t){return void 0!==this.fieldMask.find(function(e){return t.isPrefixOf(e)})||void 0!==this.fieldTransforms.find(function(e){return t.isPrefixOf(e.field)})},t.prototype.validatePath=function(){if(null!==this.path)for(var t=0;t<this.path.length;t++)this.validatePathSegment(this.path.get(t))},t.prototype.validatePathSegment=function(t){if(Il(this.dataSource)&&vl.test(t))throw this.createError("Document fields cannot begin and end with __")},t}(),Tl=function(){return function(t,e){this.databaseId=t,this.key=e}}(),Sl=function(){function t(t){this.preConverter=t}return t.prototype.parseSetData=function(t,e){var n=new El(hl.Set,t,wa.EMPTY_PATH);Cl("Data must be an object, but it was:",n,e);var r=this.parseData(e,n);return new bl(r,null,n.fieldTransforms)},t.prototype.parseMergeData=function(t,e,n){var r=new El(hl.MergeSet,t,wa.EMPTY_PATH);Cl("Data must be an object, but it was:",r,e);var i,o,a=this.parseData(e,r);if(n){for(var s=new Ua(wa.comparator),u=0,c=n;u<c.length;u++){var h=c[u],l=void 0;if(h instanceof nl)l=h._internalPath;else{if("string"!=typeof h)throw Do("Expected stringOrFieldPath to be a string or a FieldPath");l=Dl(t,h)}if(!r.contains(l))throw new Po(Oo.INVALID_ARGUMENT,"Field '"+l+"' is specified in your field mask but missing from your input data.");s=s.add(l)}i=Ns.fromSet(s),o=r.fieldTransforms.filter(function(t){return i.covers(t.field)})}else i=Ns.fromArray(r.fieldMask),o=r.fieldTransforms;return new bl(a,i,o)},t.prototype.parseUpdateData=function(t,e){var n=this,r=new El(hl.Update,t,wa.EMPTY_PATH);Cl("Data must be an object, but it was:",r,e);var i=new Ua(wa.comparator),o=Ys.EMPTY;Fo(e,function(e,a){var s=Dl(t,e),u=r.childContextForFieldPath(s);if((a=n.runPreConverter(a,u))instanceof fl)i=i.add(s);else{var c=n.parseData(a,u);null!=c&&(i=i.add(s),o=o.set(s,c))}});var a=Ns.fromSet(i);return new wl(o,a,r.fieldTransforms)},t.prototype.parseUpdateVarargs=function(t,e,n,r){var i=new El(hl.Update,t,wa.EMPTY_PATH),o=[Al(t,e)],a=[n];if(r.length%2!=0)throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() needs to be called with an even number of arguments that alternate between field names and values.");for(var s=0;s<r.length;s+=2)o.push(Al(t,r[s])),a.push(r[s+1]);var u=new Ua(wa.comparator),c=Ys.EMPTY;for(s=0;s<o.length;++s){var h=o[s],l=i.childContextForFieldPath(h),f=this.runPreConverter(a[s],l);if(f instanceof fl)u=u.add(h);else{var p=this.parseData(f,l);null!=p&&(u=u.add(h),c=c.set(h,p))}}var d=Ns.fromSet(u);return new wl(c,d,i.fieldTransforms)},t.prototype.parseQueryValue=function(t,e){var n=new El(hl.Argument,t,wa.EMPTY_PATH),r=this.parseData(e,n);return ko(null!=r,"Parsed data should not be null."),ko(0===n.fieldTransforms.length,"Field transforms should have been disallowed."),r},t.prototype.runPreConverter=function(t,e){try{return this.preConverter(t)}catch(t){var n=kl(t);throw e.createError(n)}},t.prototype.parseData=function(t,e){if(Nl(t=this.runPreConverter(t,e)))return Cl("Unsupported field value:",e,t),this.parseObject(t,e);if(t instanceof ll)return this.parseSentinelFieldValue(t,e),null;if(e.path&&e.fieldMask.push(e.path),t instanceof Array){if(e.arrayElement)throw e.createError("Nested arrays are not supported");return this.parseArray(t,e)}return this.parseScalarValue(t,e)},t.prototype.parseObject=function(t,e){var n=this,r=new La(oa);return Uo(t)?e.path&&e.path.length>0&&e.fieldMask.push(e.path):Fo(t,function(t,i){var o=n.parseData(i,e.childContextForField(t));null!=o&&(r=r.insert(t,o))}),new Ys(r)},t.prototype.parseArray=function(t,e){for(var n=[],r=0,i=0,o=t;i<o.length;i++){var a=o[i],s=this.parseData(a,e.childContextForArray(r));null==s&&(s=Fs.INSTANCE),n.push(s),r++}return new Xs(n)},t.prototype.parseSentinelFieldValue=function(t,e){if(!Il(e.dataSource))throw e.createError(t._methodName+"() can only be used with update() and set()");if(null===e.path)throw e.createError(t._methodName+"() is not currently supported inside arrays");if(t instanceof fl){if(e.dataSource!==hl.MergeSet)throw e.dataSource===hl.Update?(ko(e.path.length>0,"FieldValue.delete() at the top level should have already been handled."),e.createError("FieldValue.delete() can only appear at the top level of your update data")):e.createError("FieldValue.delete() cannot be used with set() unless you pass {merge:true}");e.fieldMask.push(e.path)}else if(t instanceof pl)e.fieldTransforms.push(new Cs(e.path,fh.instance));else if(t instanceof dl){var n=this.parseArrayTransformElements(t._methodName,t._elements),r=new ph(n);e.fieldTransforms.push(new Cs(e.path,r))}else if(t instanceof ml){n=this.parseArrayTransformElements(t._methodName,t._elements);var i=new dh(n);e.fieldTransforms.push(new Cs(e.path,i))}else if(t instanceof yl){var o=this.parseQueryValue("FieldValue.increment",t._operand),a=new mh(o);e.fieldTransforms.push(new Cs(e.path,a))}else Do("Unknown FieldValue type: "+t)},t.prototype.parseScalarValue=function(t,e){if(null===t)return Fs.INSTANCE;if("number"==typeof t)return yc(t)?new js(t):new Ks(t);if("boolean"==typeof t)return Us.of(t);if("string"==typeof t)return new $s(t);if(t instanceof Date)return new Qs(Pa.fromDate(t));if(t instanceof Pa)return new Qs(new Pa(t.seconds,1e3*Math.floor(t.nanoseconds/1e3)));if(t instanceof Xc)return new Hs(t);if(t instanceof la)return new Gs(t);if(t instanceof Tl)return new zs(t.databaseId,t.key);throw e.createError("Unsupported field value: "+Jo(t))},t.prototype.parseArrayTransformElements=function(t,e){var n=this;return e.map(function(e,r){var i=new El(hl.Argument,t,wa.EMPTY_PATH);return n.parseData(e,i.childContextForArray(r))})},t}();function Nl(t){return!("object"!=typeof t||null===t||t instanceof Array||t instanceof Date||t instanceof Pa||t instanceof Xc||t instanceof la||t instanceof Tl||t instanceof ll)}function Cl(t,e,n){if(!Nl(n)||!Xo(n)){var r=Jo(n);throw"an object"===r?e.createError(t+" a custom object"):e.createError(t+" "+r)}}function Al(t,e){if(e instanceof nl)return e._internalPath;if("string"==typeof e)return Dl(t,e);throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. Field path arguments must be of type string or FieldPath.")}function Dl(t,e){try{return function(t){if(t.search(rl)>=0)throw new Po(Oo.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not contain '~', '*', '/', '[', or ']'");try{return new(nl.bind.apply(nl,[void 0].concat(t.split("."))))}catch(e){throw new Po(Oo.INVALID_ARGUMENT,"Invalid field path ("+t+"). Paths must not be empty, begin with '.', end with '.', or contain '..'")}}(e)._internalPath}catch(e){var n=kl(e);throw new Po(Oo.INVALID_ARGUMENT,"Function "+t+"() called with invalid data. "+n)}}function kl(t){return t instanceof Error?t.message:t.toString()}var _l="firestore.googleapis.com",Rl=!0,Ol=!0,Pl=!1,Ml=Vu.COLLECTION_DISABLED,Ll=function(){function t(t){if(void 0===t.host){if(void 0!==t.ssl)throw new Po(Oo.INVALID_ARGUMENT,"Can't provide ssl option if host option is not set");this.host=_l,this.ssl=Rl}else Wo("settings","non-empty string","host",t.host),this.host=t.host,Go("settings","boolean","ssl",t.ssl),this.ssl=xo(t.ssl,Rl);if(ta("settings",t,["host","ssl","credentials","timestampsInSnapshots","cacheSizeBytes","experimentalForceLongPolling"]),Go("settings","object","credentials",t.credentials),this.credentials=t.credentials,Go("settings","boolean","timestampsInSnapshots",t.timestampsInSnapshots),!0===t.timestampsInSnapshots?Co("\n  The timestampsInSnapshots setting now defaults to true and you no\n  longer need to explicitly set it. In a future release, the setting\n  will be removed entirely and so it is recommended that you remove it\n  from your firestore.settings() call now."):!1===t.timestampsInSnapshots&&Co("\n  The timestampsInSnapshots setting will soon be removed. YOU MUST UPDATE\n  YOUR CODE.\n\n  To hide this warning, stop using the timestampsInSnapshots setting in your\n  firestore.settings({ ... }) call.\n\n  Once you remove the setting, Timestamps stored in Cloud Firestore will be\n  read back as Firebase Timestamp objects instead of as system Date objects.\n  So you will also need to update code expecting a Date to instead expect a\n  Timestamp. For example:\n\n  // Old:\n  const date = snapshot.get('created_at');\n  // New:\n  const timestamp = snapshot.get('created_at'); const date =\n  timestamp.toDate();\n\n  Please audit all existing usages of Date when you enable the new\n  behavior."),this.timestampsInSnapshots=xo(t.timestampsInSnapshots,Ol),Go("settings","number","cacheSizeBytes",t.cacheSizeBytes),void 0===t.cacheSizeBytes)this.cacheSizeBytes=Vu.DEFAULT_CACHE_SIZE_BYTES;else{if(t.cacheSizeBytes!==Ml&&t.cacheSizeBytes<Vu.MINIMUM_CACHE_SIZE_BYTES)throw new Po(Oo.INVALID_ARGUMENT,"cacheSizeBytes must be at least "+Vu.MINIMUM_CACHE_SIZE_BYTES);this.cacheSizeBytes=t.cacheSizeBytes}Go("settings","boolean","experimentalForceLongPolling",t.experimentalForceLongPolling),this.forceLongPolling=void 0===t.experimentalForceLongPolling?Pl:t.experimentalForceLongPolling}return t.prototype.isEqual=function(t){return this.host===t.host&&this.ssl===t.ssl&&this.timestampsInSnapshots===t.timestampsInSnapshots&&this.credentials===t.credentials&&this.cacheSizeBytes===t.cacheSizeBytes&&this.forceLongPolling===t.forceLongPolling},t}(),xl=function(){function t(e){var n=this;if(this._firebaseApp=null,this._queue=new Sa,this.INTERNAL={delete:function(){return xt(n,void 0,void 0,function(){return qt(this,function(t){switch(t.label){case 0:return this.ensureClientConfigured(),[4,this._firestoreClient.terminate()];case 1:return t.sent(),[2]}})})}},"object"==typeof e.options){var r=e;this._firebaseApp=r,this._databaseId=t.databaseIdFromApp(r),this._persistenceKey=r.name,this._credentials=new al(r)}else{var i=e;if(!i.projectId)throw new Po(Oo.INVALID_ARGUMENT,"Must provide projectId");this._databaseId=new ma(i.projectId,i.database),this._persistenceKey="[DEFAULT]",this._credentials=new ol}this._settings=new Ll({}),this._dataConverter=this.createDataConverter(this._databaseId)}return t.prototype.settings=function(t){if(Bo("Firestore.settings",arguments,1),$o("Firestore.settings","object",1,t),Lo(t,"persistence"))throw new Po(Oo.INVALID_ARGUMENT,'"persistence" is now specified with a separate call to firestore.enablePersistence().');var e=new Ll(t);if(this._firestoreClient&&!this._settings.isEqual(e))throw new Po(Oo.FAILED_PRECONDITION,"Firestore has already been started and its settings can no longer be changed. You can only call settings() before calling any other methods on a Firestore object.");this._settings=e,void 0!==e.credentials&&(this._credentials=function(t){if(!t)return new ol;switch(t.type){case"gapi":var e=t.client;return ko(!("object"!=typeof e||null===e||!e.auth||!e.auth.getAuthHeaderValueForFirstParty),"unexpected gapi interface"),new ul(e,t.sessionIndex||"0");case"provider":return t.client;default:throw new Po(Oo.INVALID_ARGUMENT,"makeCredentialsProvider failed due to invalid credential type")}}(e.credentials))},t.prototype.enableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.enableNetwork()},t.prototype.disableNetwork=function(){return this.ensureClientConfigured(),this._firestoreClient.disableNetwork()},t.prototype.enablePersistence=function(t){if(this._firestoreClient)throw new Po(Oo.FAILED_PRECONDITION,"Firestore has already been started and persistence can no longer be enabled. You can only call enablePersistence() before calling any other methods on a Firestore object.");var e=!1;return t&&(void 0!==t.experimentalTabSynchronization&&Co("The 'experimentalTabSynchronization' setting has been renamed to 'synchronizeTabs'. In a future release, the setting will be removed and it is recommended that you update your firestore.enablePersistence() call to use 'synchronizeTabs'."),e=xo(void 0!==t.synchronizeTabs?t.synchronizeTabs:t.experimentalTabSynchronization,!1)),this.configureClient(new Jh(this._settings.cacheSizeBytes,e))},t.prototype.clearPersistence=function(){var t=this,e=zu.buildStoragePrefix(this.makeDatabaseInfo()),n=new Ea;return this._queue.enqueueAndForgetEvenAfterShutdown(function(){return xt(t,void 0,void 0,function(){var t;return qt(this,function(r){switch(r.label){case 0:if(r.trys.push([0,2,,3]),void 0!==this._firestoreClient&&!this._firestoreClient.clientTerminated)throw new Po(Oo.FAILED_PRECONDITION,"Persistence cannot be cleared after this Firestore instance is initialized.");return[4,zu.clearPersistence(e)];case 1:return r.sent(),n.resolve(),[3,3];case 2:return t=r.sent(),n.reject(t),[3,3];case 3:return[2]}})})}),n.promise},t.prototype.terminate=function(){return this.app._removeServiceInstance("firestore"),this.INTERNAL.delete()},Object.defineProperty(t.prototype,"_isTerminated",{get:function(){return this.ensureClientConfigured(),this._firestoreClient.clientTerminated},enumerable:!0,configurable:!0}),t.prototype.waitForPendingWrites=function(){return this.ensureClientConfigured(),this._firestoreClient.waitForPendingWrites()},t.prototype._onSnapshotsInSync=function(t){if(this.ensureClientConfigured(),cl(t))return this.onSnapshotsInSyncInternal(t);$o("Firestore.onSnapshotsInSync","function",1,t);var e={next:t};return this.onSnapshotsInSyncInternal(e)},t.prototype.onSnapshotsInSyncInternal=function(t){var e=this,n=new el({next:function(){t.next&&t.next()},error:function(t){throw Do("Uncaught Error in onSnapshotsInSync")}});return this._firestoreClient.addSnapshotsInSyncListener(n),function(){n.mute(),e._firestoreClient.removeSnapshotsInSyncListener(n)}},t.prototype.ensureClientConfigured=function(){return this._firestoreClient||this.configureClient(new Zh),this._firestoreClient},t.prototype.makeDatabaseInfo=function(){return new pa(this._databaseId,this._persistenceKey,this._settings.host,this._settings.ssl,this._settings.forceLongPolling)},t.prototype.configureClient=function(t){ko(!!this._settings.host,"FirestoreSettings.host is not set"),ko(!this._firestoreClient,"configureClient() called multiple times");var e=this.makeDatabaseInfo();return this._firestoreClient=new tl(_o.getPlatform(),e,this._credentials,this._queue),this._firestoreClient.start(t)},t.prototype.createDataConverter=function(t){return new Sl(function(e){if(e instanceof Ul){var n=t,r=e.firestore._databaseId;if(!r.isEqual(n))throw new Po(Oo.INVALID_ARGUMENT,"Document reference is for database "+r.projectId+"/"+r.database+" but should be for database "+n.projectId+"/"+n.database);return new Tl(t,e._key)}return e})},t.databaseIdFromApp=function(t){var e=t.options;if(!Lo(e,"projectId"))throw new Po(Oo.INVALID_ARGUMENT,'"projectId" not provided in firebase.initializeApp.');var n=e.projectId;if(!n||"string"!=typeof n)throw new Po(Oo.INVALID_ARGUMENT,"projectId must be a string in FirebaseApp.options");return new ma(n)},Object.defineProperty(t.prototype,"app",{get:function(){if(!this._firebaseApp)throw new Po(Oo.FAILED_PRECONDITION,"Firestore was not initialized using the Firebase SDK. 'app' is not available");return this._firebaseApp},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){return Bo("Firestore.collection",arguments,1),$o("Firestore.collection","non-empty string",1,t),this.ensureClientConfigured(),new Ql(va.fromString(t),this)},t.prototype.doc=function(t){return Bo("Firestore.doc",arguments,1),$o("Firestore.doc","non-empty string",1,t),this.ensureClientConfigured(),Ul.forPath(va.fromString(t),this)},t.prototype.collectionGroup=function(t){if(Bo("Firestore.collectionGroup",arguments,1),$o("Firestore.collectionGroup","non-empty string",1,t),t.indexOf("/")>=0)throw new Po(Oo.INVALID_ARGUMENT,"Invalid collection ID '"+t+"' passed to function Firestore.collectionGroup(). Collection IDs must not contain '/'.");return this.ensureClientConfigured(),new Kl(new Jc(va.EMPTY_PATH,t),this)},t.prototype.runTransaction=function(t){var e=this;return Bo("Firestore.runTransaction",arguments,1),$o("Firestore.runTransaction","function",1,t),this.ensureClientConfigured().transaction(function(n){return t(new ql(e,n))})},t.prototype.batch=function(){return this.ensureClientConfigured(),new Fl(this)},Object.defineProperty(t,"logLevel",{get:function(){switch(To()){case po.DEBUG:return"debug";case po.ERROR:return"error";case po.SILENT:return"silent";default:return Do("Unknown log level: "+To())}},enumerable:!0,configurable:!0}),t.setLogLevel=function(t){switch(Bo("Firestore.setLogLevel",arguments,1),$o("Firestore.setLogLevel","non-empty string",1,t),t){case"debug":So(po.DEBUG);break;case"error":So(po.ERROR);break;case"silent":So(po.SILENT);break;default:throw new Po(Oo.INVALID_ARGUMENT,"Invalid log level: "+t)}},t.prototype._areTimestampsInSnapshotsEnabled=function(){return this._settings.timestampsInSnapshots},t}(),ql=function(){function t(t,e){this._firestore=t,this._transaction=e}return t.prototype.get=function(t){var e=this;Bo("Transaction.get",arguments,1);var n=Hl("Transaction.get",t,this._firestore);return this._transaction.lookup([n._key]).then(function(t){if(!t||1!==t.length)return Do("Mismatch in docs returned from document lookup.");var r=t[0];if(r instanceof tu)return new Bl(e._firestore,n._key,null,!1,!1);if(r instanceof Zs)return new Bl(e._firestore,n._key,r,!1,!1);throw Do("BatchGetDocumentsRequest returned unexpected document type: "+r.constructor.name)})},t.prototype.set=function(t,e,n){Ko("Transaction.set",arguments,2,3);var r=Hl("Transaction.set",t,this._firestore),i=(n=Wl("Transaction.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("Transaction.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("Transaction.set",e);return this._transaction.set(r._key,i),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return"string"==typeof e||e instanceof nl?(jo("Transaction.update",arguments,3),r=Hl("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("Transaction.update",e,n,o)):(Bo("Transaction.update",arguments,2),r=Hl("Transaction.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("Transaction.update",e)),this._transaction.update(r._key,i),this},t.prototype.delete=function(t){Bo("Transaction.delete",arguments,1);var e=Hl("Transaction.delete",t,this._firestore);return this._transaction.delete(e._key),this},t}(),Fl=function(){function t(t){this._firestore=t,this._mutations=[],this._committed=!1}return t.prototype.set=function(t,e,n){Ko("WriteBatch.set",arguments,2,3),this.verifyNotCommitted();var r=Hl("WriteBatch.set",t,this._firestore),i=(n=Wl("WriteBatch.set",n)).merge||n.mergeFields?this._firestore._dataConverter.parseMergeData("WriteBatch.set",e,n.mergeFields):this._firestore._dataConverter.parseSetData("WriteBatch.set",e);return this._mutations=this._mutations.concat(i.toMutations(r._key,_s.NONE)),this},t.prototype.update=function(t,e,n){for(var r,i,o=[],a=3;a<arguments.length;a++)o[a-3]=arguments[a];return this.verifyNotCommitted(),"string"==typeof e||e instanceof nl?(jo("WriteBatch.update",arguments,3),r=Hl("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateVarargs("WriteBatch.update",e,n,o)):(Bo("WriteBatch.update",arguments,2),r=Hl("WriteBatch.update",t,this._firestore),i=this._firestore._dataConverter.parseUpdateData("WriteBatch.update",e)),this._mutations=this._mutations.concat(i.toMutations(r._key,_s.exists(!0))),this},t.prototype.delete=function(t){Bo("WriteBatch.delete",arguments,1),this.verifyNotCommitted();var e=Hl("WriteBatch.delete",t,this._firestore);return this._mutations=this._mutations.concat(new Ls(e._key,_s.NONE)),this},t.prototype.commit=function(){return xt(this,void 0,void 0,function(){return qt(this,function(t){return this.verifyNotCommitted(),this._committed=!0,this._mutations.length>0?[2,this._firestore.ensureClientConfigured().write(this._mutations)]:[2]})})},t.prototype.verifyNotCommitted=function(){if(this._committed)throw new Po(Oo.FAILED_PRECONDITION,"A write batch can no longer be used after commit() has been called.")},t}(),Ul=function(){function t(t,e){this._key=t,this.firestore=e,this._firestoreClient=this.firestore.ensureClientConfigured()}return t.forPath=function(e,n){if(e.length%2!=0)throw new Po(Oo.INVALID_ARGUMENT,"Invalid document reference. Document references must have an even number of segments, but "+e.canonicalString()+" has "+e.length);return new t(new Ia(e),n)},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"parent",{get:function(){return new Ql(this._key.path.popLast(),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"path",{get:function(){return this._key.path.canonicalString()},enumerable:!0,configurable:!0}),t.prototype.collection=function(t){if(Bo("DocumentReference.collection",arguments,1),$o("DocumentReference.collection","non-empty string",1,t),!t)throw new Po(Oo.INVALID_ARGUMENT,"Must provide a non-empty collection name to collection()");var e=va.fromString(t);return new Ql(this._key.path.child(e),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw ea("isEqual","DocumentReference",1,e);return this.firestore===e.firestore&&this._key.isEqual(e._key)},t.prototype.set=function(t,e){Ko("DocumentReference.set",arguments,1,2);var n=(e=Wl("DocumentReference.set",e)).merge||e.mergeFields?this.firestore._dataConverter.parseMergeData("DocumentReference.set",t,e.mergeFields):this.firestore._dataConverter.parseSetData("DocumentReference.set",t);return this._firestoreClient.write(n.toMutations(this._key,_s.NONE))},t.prototype.update=function(t,e){for(var n,r=[],i=2;i<arguments.length;i++)r[i-2]=arguments[i];return"string"==typeof t||t instanceof nl?(jo("DocumentReference.update",arguments,2),n=this.firestore._dataConverter.parseUpdateVarargs("DocumentReference.update",t,e,r)):(Bo("DocumentReference.update",arguments,1),n=this.firestore._dataConverter.parseUpdateData("DocumentReference.update",t)),this._firestoreClient.write(n.toMutations(this._key,_s.exists(!0)))},t.prototype.delete=function(){return Bo("DocumentReference.delete",arguments,0),this._firestoreClient.write([new Ls(this._key,_s.NONE)])},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ko("DocumentReference.onSnapshot",arguments,1,4);var n,r={includeMetadataChanges:!1},i=0;"object"!=typeof t[i]||cl(t[i])||(ta("DocumentReference.onSnapshot",r=t[i],["includeMetadataChanges"]),Go("DocumentReference.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++);var o={includeMetadataChanges:r.includeMetadataChanges};return cl(t[i])?n=t[i]:($o("DocumentReference.onSnapshot","function",i,t[i]),Qo("DocumentReference.onSnapshot","function",i+1,t[i+1]),Qo("DocumentReference.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(o,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new el({next:function(t){if(e.next){ko(t.docs.size<=1,"Too many documents returned on a document query");var r=t.docs.get(n._key);e.next(new Bl(n.firestore,n._key,r,t.fromCache,t.hasPendingWrites))}},error:r}),o=this._firestoreClient.listen(Jc.atPath(this._key.path),i,t);return function(){i.mute(),n._firestoreClient.unlisten(o)}},t.prototype.get=function(t){var e=this;return Ko("DocumentReference.get",arguments,0,1),zl("DocumentReference.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentFromLocalCache(e._key).then(function(t){n(new Bl(e.firestore,e._key,t,!0,t instanceof Zs&&t.hasLocalMutations))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),!i.exists&&i.metadata.fromCache?e(new Po(Oo.UNAVAILABLE,"Failed to get document because the client is offline.")):i.exists&&i.metadata.fromCache&&n&&"server"===n.source?e(new Po(Oo.UNAVAILABLE,'Failed to get document from server. (However, this document does exist in the local cache. Run again without setting source to "server" to retrieve the cached document.)')):t(i)},error:e})},t}(),Vl=function(){function t(t,e){this.hasPendingWrites=t,this.fromCache=e}return t.prototype.isEqual=function(t){return this.hasPendingWrites===t.hasPendingWrites&&this.fromCache===t.fromCache},t}(),Bl=function(){function t(t,e,n,r,i){this._firestore=t,this._key=e,this._document=n,this._fromCache=r,this._hasPendingWrites=i}return t.prototype.data=function(t){return Ko("DocumentSnapshot.data",arguments,0,1),t=Gl("DocumentSnapshot.data",t),this._document?this.convertObject(this._document.data(),xs.fromSnapshotOptions(t,this._firestore._areTimestampsInSnapshotsEnabled())):void 0},t.prototype.get=function(t,e){if(Ko("DocumentSnapshot.get",arguments,1,2),e=Gl("DocumentSnapshot.get",e),this._document){var n=this._document.data().field(Al("DocumentSnapshot.get",t));if(null!==n)return this.convertValue(n,xs.fromSnapshotOptions(e,this._firestore._areTimestampsInSnapshotsEnabled()))}},Object.defineProperty(t.prototype,"id",{get:function(){return this._key.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"ref",{get:function(){return new Ul(this._key,this._firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"exists",{get:function(){return null!==this._document},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"metadata",{get:function(){return new Vl(this._hasPendingWrites,this._fromCache)},enumerable:!0,configurable:!0}),t.prototype.isEqual=function(e){if(!(e instanceof t))throw ea("isEqual","DocumentSnapshot",1,e);return this._firestore===e._firestore&&this._fromCache===e._fromCache&&this._key.isEqual(e._key)&&(null===this._document?null===e._document:this._document.isEqual(e._document))},t.prototype.convertObject=function(t,e){var n=this,r={};return t.forEach(function(t,i){r[t]=n.convertValue(i,e)}),r},t.prototype.convertValue=function(t,e){if(t instanceof Ys)return this.convertObject(t,e);if(t instanceof Xs)return this.convertArray(t,e);if(t instanceof zs){var n=t.value(e),r=this._firestore.ensureClientConfigured().databaseId();return t.databaseId.isEqual(r)||Co("Document "+this._key.path+" contains a document reference within a different database ("+t.databaseId.projectId+"/"+t.databaseId.database+") which is not supported. It will be treated as a reference in the current database ("+r.projectId+"/"+r.database+") instead."),new Ul(n,this._firestore)}return t.value(e)},t.prototype.convertArray=function(t,e){var n=this;return t.internalValue.map(function(t){return n.convertValue(t,e)})},t}(),jl=function(t){function e(){return null!==t&&t.apply(this,arguments)||this}return Mt(e,t),e.prototype.data=function(e){var n=t.prototype.data.call(this,e);return ko("object"==typeof n,"Document in a QueryDocumentSnapshot should exist"),n},e}(Bl),Kl=function(){function t(t,e){this._query=t,this.firestore=e}return t.prototype.where=function(e,n,r){if(Bo("Query.where",arguments,3),Zo("Query.where",3,r),"in"!==n&&"array-contains-any"!==n){!function(t,e,n,r){if(!e.some(function(t){return t===r}))throw new Po(Oo.INVALID_ARGUMENT,"Invalid value "+Jo(r)+" provided to function "+t+"() for its "+na(n)+" argument. Acceptable values: "+e.join(", "))}("Query.where",["<","<=","==",">=",">","array-contains"],2,n)}var i,o=Al("Query.where",e),a=th.fromString(n);if(o.isKeyField()){if(a===th.ARRAY_CONTAINS||a===th.ARRAY_CONTAINS_ANY)throw new Po(Oo.INVALID_ARGUMENT,"Invalid Query. You can't perform '"+a.toString()+"' queries on FieldPath.documentId().");if(a===th.IN){this.validateDisjunctiveFilterElements(r,a);for(var s=[],u=0,c=r;u<c.length;u++){var h=c[u];s.push(this.parseDocumentIdValue(h))}i=new Xs(s)}else i=this.parseDocumentIdValue(r)}else a!==th.IN&&a!==th.ARRAY_CONTAINS_ANY||this.validateDisjunctiveFilterElements(r,a),i=this.firestore._dataConverter.parseQueryValue("Query.where",r);var l=eh.create(o,a,i);return this.validateNewFilter(l),new t(this._query.addFilter(l),this.firestore)},t.prototype.orderBy=function(e,n){var r;if(Ko("Query.orderBy",arguments,1,2),Qo("Query.orderBy","non-empty string",2,n),void 0===n||"asc"===n)r=sh.ASCENDING;else{if("desc"!==n)throw new Po(Oo.INVALID_ARGUMENT,"Function Query.orderBy() has unknown direction '"+n+"', expected 'asc' or 'desc'.");r=sh.DESCENDING}if(null!==this._query.startAt)throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. You must not call Query.startAt() or Query.startAfter() before calling Query.orderBy().");if(null!==this._query.endAt)throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. You must not call Query.endAt() or Query.endBefore() before calling Query.orderBy().");var i=Al("Query.orderBy",e),o=new ch(i,r);return this.validateNewOrderBy(o),new t(this._query.addOrderBy(o),this.firestore)},t.prototype.limit=function(e){if(Bo("Query.limit",arguments,1),$o("Query.limit","number",1,e),e<=0)throw new Po(Oo.INVALID_ARGUMENT,"Invalid Query. Query limit ("+e+") is invalid. Limit must be positive.");return new t(this._query.withLimit(e),this.firestore)},t.prototype.startAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];jo("Query.startAt",arguments,1);var i=this.boundFromDocOrFields("Query.startAt",e,n,!0);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.startAfter=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];jo("Query.startAfter",arguments,1);var i=this.boundFromDocOrFields("Query.startAfter",e,n,!1);return new t(this._query.withStartAt(i),this.firestore)},t.prototype.endBefore=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];jo("Query.endBefore",arguments,1);var i=this.boundFromDocOrFields("Query.endBefore",e,n,!0);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.endAt=function(e){for(var n=[],r=1;r<arguments.length;r++)n[r-1]=arguments[r];jo("Query.endAt",arguments,1);var i=this.boundFromDocOrFields("Query.endAt",e,n,!1);return new t(this._query.withEndAt(i),this.firestore)},t.prototype.isEqual=function(e){if(!(e instanceof t))throw ea("isEqual","Query",1,e);return this.firestore===e.firestore&&this._query.isEqual(e._query)},t.prototype.boundFromDocOrFields=function(t,e,n,r){if(Zo(t,1,e),e instanceof Bl){if(n.length>0)throw new Po(Oo.INVALID_ARGUMENT,"Too many arguments provided to "+t+"().");var i=e;if(!i.exists)throw new Po(Oo.NOT_FOUND,"Can't use a DocumentSnapshot that doesn't exist for "+t+"().");return this.boundFromDocument(t,i._document,r)}var o=[e].concat(n);return this.boundFromFields(t,o,r)},t.prototype.boundFromDocument=function(t,e,n){for(var r=[],i=0,o=this._query.orderBy;i<o.length;i++){var a=o[i];if(a.field.isKeyField())r.push(new zs(this.firestore._databaseId,e.key));else{var s=e.field(a.field);if(s instanceof Ws)throw new Po(Oo.INVALID_ARGUMENT,'Invalid query. You are trying to start or end a query using a document for which the field "'+a.field+'" is an uncommitted server timestamp. (Since the value of this field is unknown, you cannot start/end a query with it.)');if(null===s){var u=a.field.canonicalString();throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. You are trying to start or end a query using a document for which the field '"+u+"' (used as the orderBy) does not exist.")}r.push(s)}}return new uh(r,n)},t.prototype.boundFromFields=function(t,e,n){var r=this._query.explicitOrderBy;if(e.length>r.length)throw new Po(Oo.INVALID_ARGUMENT,"Too many arguments provided to "+t+"(). The number of arguments must be less than or equal to the number of Query.orderBy() clauses");for(var i=[],o=0;o<e.length;o++){var a=e[o];if(r[o].field.isKeyField()){if("string"!=typeof a)throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. Expected a string for document ID in "+t+"(), but got a "+typeof a);if(!this._query.isCollectionGroupQuery()&&-1!==a.indexOf("/"))throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. When querying a collection and ordering by FieldPath.documentId(), the value passed to "+t+"() must be a plain document ID, but '"+a+"' contains a slash.");var s=this._query.path.child(va.fromString(a));if(!Ia.isDocumentKey(s))throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. When querying a collection group and ordering by FieldPath.documentId(), the value passed to "+t+"() must result in a valid document path, but '"+s+"' is not because it contains an odd number of segments.");var u=new Ia(s);i.push(new zs(this.firestore._databaseId,u))}else{var c=this.firestore._dataConverter.parseQueryValue(t,a);i.push(c)}}return new uh(i,n)},t.prototype.onSnapshot=function(){for(var t=[],e=0;e<arguments.length;e++)t[e]=arguments[e];Ko("Query.onSnapshot",arguments,1,4);var n,r={},i=0;return"object"!=typeof t[i]||cl(t[i])||(ta("Query.onSnapshot",r=t[i],["includeMetadataChanges"]),Go("Query.onSnapshot","boolean","includeMetadataChanges",r.includeMetadataChanges),i++),cl(t[i])?n=t[i]:($o("Query.onSnapshot","function",i,t[i]),Qo("Query.onSnapshot","function",i+1,t[i+1]),Qo("Query.onSnapshot","function",i+2,t[i+2]),n={next:t[i],error:t[i+1],complete:t[i+2]}),this.onSnapshotInternal(r,n)},t.prototype.onSnapshotInternal=function(t,e){var n=this,r=function(t){console.error("Uncaught Error in onSnapshot:",t)};e.error&&(r=e.error.bind(e));var i=new el({next:function(t){e.next&&e.next(new $l(n.firestore,n._query,t))},error:r}),o=this.firestore.ensureClientConfigured(),a=o.listen(this._query,i,t);return function(){i.mute(),o.unlisten(a)}},t.prototype.get=function(t){var e=this;return Ko("Query.get",arguments,0,1),zl("Query.get",t),new Promise(function(n,r){t&&"cache"===t.source?e.firestore.ensureClientConfigured().getDocumentsFromLocalCache(e._query).then(function(t){n(new $l(e.firestore,e._query,t))},r):e.getViaSnapshotListener(n,r,t)})},t.prototype.getViaSnapshotListener=function(t,e,n){var r=this.onSnapshotInternal({includeMetadataChanges:!0,waitForSyncWhenOnline:!0},{next:function(i){r(),i.metadata.fromCache&&n&&"server"===n.source?e(new Po(Oo.UNAVAILABLE,'Failed to get documents from server. (However, these documents may exist in the local cache. Run again without setting source to "server" to retrieve the cached documents.)')):t(i)},error:e})},t.prototype.parseDocumentIdValue=function(t){if("string"==typeof t){if(""===t)throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid document ID, but it was an empty string.");if(!this._query.isCollectionGroupQuery()&&-1!==t.indexOf("/"))throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. When querying a collection by FieldPath.documentId(), you must provide a plain document ID, but '"+t+"' contains a '/' character.");var e=this._query.path.child(va.fromString(t));if(!Ia.isDocumentKey(e))throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. When querying a collection group by FieldPath.documentId(), the value provided must result in a valid document path, but '"+e+"' is not because it has an odd number of segments ("+e.length+").");return new zs(this.firestore._databaseId,new Ia(e))}if(t instanceof Ul){var n=t;return new zs(this.firestore._databaseId,n._key)}throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. When querying with FieldPath.documentId(), you must provide a valid string or a DocumentReference, but it was: "+Jo(t)+".")},t.prototype.validateDisjunctiveFilterElements=function(t,e){if(!Array.isArray(t)||0===t.length)throw new Po(Oo.INVALID_ARGUMENT,"Invalid Query. A non-empty array is required for '"+e.toString()+"' filters.");if(t.length>10)throw new Po(Oo.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters support a maximum of 10 elements in the value array.");if(t.indexOf(null)>=0)throw new Po(Oo.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'null' in the value array.");if(t.filter(function(t){return Number.isNaN(t)}).length>0)throw new Po(Oo.INVALID_ARGUMENT,"Invalid Query. '"+e.toString()+"' filters cannot contain 'NaN' in the value array.")},t.prototype.validateNewFilter=function(t){if(t instanceof eh){var e=[th.ARRAY_CONTAINS,th.ARRAY_CONTAINS_ANY],n=[th.IN,th.ARRAY_CONTAINS_ANY],r=e.indexOf(t.op)>=0,i=n.indexOf(t.op)>=0;if(t.isInequality()){var o=this._query.getInequalityFilterField();if(null!==o&&!o.isEqual(t.field))throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. All where filters with an inequality (<, <=, >, or >=) must be on the same field. But you have inequality filters on '"+o.toString()+"' and '"+t.field.toString()+"'");var a=this._query.getFirstOrderByField();null!==a&&this.validateOrderByAndInequalityMatch(t.field,a)}else if(i||r){var s=null;if(i&&(s=this._query.findFilterOperator(n)),null===s&&r&&(s=this._query.findFilterOperator(e)),null!=s)throw s===t.op?new Po(Oo.INVALID_ARGUMENT,"Invalid query. You cannot use more than one '"+t.op.toString()+"' filter."):new Po(Oo.INVALID_ARGUMENT,"Invalid query. You cannot use '"+t.op.toString()+"' filters with '"+s.toString()+"' filters.")}}},t.prototype.validateNewOrderBy=function(t){if(null===this._query.getFirstOrderByField()){var e=this._query.getInequalityFilterField();null!==e&&this.validateOrderByAndInequalityMatch(e,t.field)}},t.prototype.validateOrderByAndInequalityMatch=function(t,e){if(!e.isEqual(t))throw new Po(Oo.INVALID_ARGUMENT,"Invalid query. You have a where filter with an inequality (<, <=, >, or >=) on field '"+t.toString()+"' and so you must also use '"+t.toString()+"' as your first Query.orderBy(), but your first Query.orderBy() is on field '"+e.toString()+"' instead.")},t}(),$l=function(){function t(t,e,n){this._firestore=t,this._originalQuery=e,this._snapshot=n,this._cachedChanges=null,this._cachedChangesIncludeMetadataChanges=null,this.metadata=new Vl(n.hasPendingWrites,n.fromCache)}return Object.defineProperty(t.prototype,"docs",{get:function(){var t=[];return this.forEach(function(e){return t.push(e)}),t},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"empty",{get:function(){return this._snapshot.docs.isEmpty()},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"size",{get:function(){return this._snapshot.docs.size},enumerable:!0,configurable:!0}),t.prototype.forEach=function(t,e){var n=this;Ko("QuerySnapshot.forEach",arguments,1,2),$o("QuerySnapshot.forEach","function",1,t),this._snapshot.docs.forEach(function(r){t.call(e,n.convertToDocumentImpl(r))})},Object.defineProperty(t.prototype,"query",{get:function(){return new Kl(this._originalQuery,this._firestore)},enumerable:!0,configurable:!0}),t.prototype.docChanges=function(t){t&&(ta("QuerySnapshot.docChanges",t,["includeMetadataChanges"]),Go("QuerySnapshot.docChanges","boolean","includeMetadataChanges",t.includeMetadataChanges));var e=!(!t||!t.includeMetadataChanges);if(e&&this._snapshot.excludesMetadataChanges)throw new Po(Oo.INVALID_ARGUMENT,"To include metadata changes with your document changes, you must also pass { includeMetadataChanges:true } to onSnapshot().");return this._cachedChanges&&this._cachedChangesIncludeMetadataChanges===e||(this._cachedChanges=function(t,e,n){if(n.oldDocs.isEmpty()){var r,i=0;return n.docChanges.map(function(e){var o=new jl(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key));return ko(e.type===Mc.Added,"Invalid event type for first snapshot"),ko(!r||n.query.docComparator(r,e.doc)<0,"Got added events in wrong order"),r=e.doc,{type:"added",doc:o,oldIndex:-1,newIndex:i++}})}var o=n.oldDocs;return n.docChanges.filter(function(t){return e||t.type!==Mc.Metadata}).map(function(e){var r=new jl(t,e.doc.key,e.doc,n.fromCache,n.mutatedKeys.has(e.doc.key)),i=-1,a=-1;return e.type!==Mc.Added&&(ko((i=o.indexOf(e.doc.key))>=0,"Index for document not found"),o=o.delete(e.doc.key)),e.type!==Mc.Removed&&(o=o.add(e.doc),a=o.indexOf(e.doc.key)),{type:Yl(e.type),doc:r,oldIndex:i,newIndex:a}})}(this._firestore,e,this._snapshot),this._cachedChangesIncludeMetadataChanges=e),this._cachedChanges},t.prototype.isEqual=function(e){if(!(e instanceof t))throw ea("isEqual","QuerySnapshot",1,e);return this._firestore===e._firestore&&this._originalQuery.isEqual(e._originalQuery)&&this._snapshot.isEqual(e._snapshot)},t.prototype.convertToDocumentImpl=function(t){return new jl(this._firestore,t.key,t,this.metadata.fromCache,this._snapshot.mutatedKeys.has(t.key))},t}();["length","forEach","map"].concat("undefined"!=typeof Symbol?[Symbol.iterator]:[]).forEach(function(t){try{Object.defineProperty($l.prototype.docChanges,t,{get:function(){return function(){throw new Po(Oo.INVALID_ARGUMENT,'QuerySnapshot.docChanges has been changed from a property into a method, so usages like "querySnapshot.docChanges" should become "querySnapshot.docChanges()"')}()}})}catch(t){}});var Ql=function(t){function e(e,n){var r=t.call(this,Jc.atPath(e),n)||this;if(e.length%2!=1)throw new Po(Oo.INVALID_ARGUMENT,"Invalid collection reference. Collection references must have an odd number of segments, but "+e.canonicalString()+" has "+e.length);return r}return Mt(e,t),Object.defineProperty(e.prototype,"id",{get:function(){return this._query.path.lastSegment()},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"parent",{get:function(){var t=this._query.path.popLast();return t.isEmpty()?null:new Ul(new Ia(t),this.firestore)},enumerable:!0,configurable:!0}),Object.defineProperty(e.prototype,"path",{get:function(){return this._query.path.canonicalString()},enumerable:!0,configurable:!0}),e.prototype.doc=function(t){if(Ko("CollectionReference.doc",arguments,0,1),0===arguments.length&&(t=ia.newId()),$o("CollectionReference.doc","non-empty string",1,t),""===t)throw new Po(Oo.INVALID_ARGUMENT,"Document path must be a non-empty string");var e=va.fromString(t);return Ul.forPath(this._query.path.child(e),this.firestore)},e.prototype.add=function(t){Bo("CollectionReference.add",arguments,1),$o("CollectionReference.add","object",1,t);var e=this.doc();return e.set(t).then(function(){return e})},e}(Kl);function Wl(t,e){if(void 0===e)return{merge:!1};if(ta(t,e,["merge","mergeFields"]),Go(t,"boolean","merge",e.merge),zo(t,"mergeFields","a string or a FieldPath",e.mergeFields,function(t){return"string"==typeof t||t instanceof nl}),void 0!==e.mergeFields&&void 0!==e.merge)throw new Po(Oo.INVALID_ARGUMENT,"Invalid options passed to function "+t+'(): You cannot specify both "merge" and "mergeFields".');return e}function Gl(t,e){return void 0===e?{}:(ta(t,e,["serverTimestamps"]),Ho(t,0,"serverTimestamps",e.serverTimestamps,["estimate","previous","none"]),e)}function zl(t,e){Qo(t,"object",1,e),e&&(ta(t,e,["source"]),Ho(t,0,"source",e.source,["default","server","cache"]))}function Hl(t,e,n){if(e instanceof Ul){if(e.firestore!==n)throw new Po(Oo.INVALID_ARGUMENT,"Provided document reference is from a different Firestore instance.");return e}throw ea(t,"DocumentReference",1,e)}function Yl(t){switch(t){case Mc.Added:return"added";case Mc.Modified:case Mc.Metadata:return"modified";case Mc.Removed:return"removed";default:return Do("Unknown change type: "+t)}}var Xl=Mo(xl,"Use firebase.firestore() instead."),Jl=Mo(ql,"Use firebase.firestore().runTransaction() instead."),Zl=Mo(Fl,"Use firebase.firestore().batch() instead."),tf=Mo(Ul,"Use firebase.firestore().doc() instead."),ef=Mo(Bl),nf=Mo(jl),rf=Mo(Kl),of=Mo($l),af=Mo(Ql,"Use firebase.firestore().collection() instead."),sf={Firestore:Xl,GeoPoint:Xc,Timestamp:Pa,Blob:fa,Transaction:Jl,WriteBatch:Zl,DocumentReference:tf,DocumentSnapshot:ef,Query:rf,QueryDocumentSnapshot:nf,QuerySnapshot:of,CollectionReference:af,FieldPath:nl,FieldValue:gl,setLogLevel:xl.setLogLevel,CACHE_SIZE_UNLIMITED:Ml};function uf(t){t.INTERNAL.registerService("firestore",function(t){return new xl(t)},function(t){ko(t&&"object"==typeof t,"shallowCopy() expects object parameter.");var e={};for(var n in t)Object.prototype.hasOwnProperty.call(t,n)&&(e[n]=t[n]);return e}(sf))}var cf=function(){function t(){}return t.prototype.addCallback=function(t){},t.prototype.shutdown=function(){},t}(),hf=function(){function t(){var t=this;this.networkAvailableListener=function(){return t.onNetworkAvailable()},this.networkUnavailableListener=function(){return t.onNetworkUnavailable()},this.callbacks=[],this.configureNetworkMonitoring()}return t.prototype.addCallback=function(t){this.callbacks.push(t)},t.prototype.shutdown=function(){window.removeEventListener("online",this.networkAvailableListener),window.removeEventListener("offline",this.networkUnavailableListener)},t.prototype.configureNetworkMonitoring=function(){window.addEventListener("online",this.networkAvailableListener),window.addEventListener("offline",this.networkUnavailableListener)},t.prototype.onNetworkAvailable=function(){No("ConnectivityMonitor","Network connectivity changed: AVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(0)}},t.prototype.onNetworkUnavailable=function(){No("ConnectivityMonitor","Network connectivity changed: UNAVAILABLE");for(var t=0,e=this.callbacks;t<e.length;t++){(0,e[t])(1)}},t.isAvailable=function(){return"undefined"!=typeof window&&void 0!==window.addEventListener&&void 0!==window.removeEventListener},t}(),lf=function(){function t(t){this.sendFn=t.sendFn,this.closeFn=t.closeFn}return t.prototype.onOpen=function(t){ko(!this.wrappedOnOpen,"Called onOpen on stream twice!"),this.wrappedOnOpen=t},t.prototype.onClose=function(t){ko(!this.wrappedOnClose,"Called onClose on stream twice!"),this.wrappedOnClose=t},t.prototype.onMessage=function(t){ko(!this.wrappedOnMessage,"Called onMessage on stream twice!"),this.wrappedOnMessage=t},t.prototype.close=function(){this.closeFn()},t.prototype.send=function(t){this.sendFn(t)},t.prototype.callOnOpen=function(){ko(void 0!==this.wrappedOnOpen,"Cannot call onOpen because no callback was set"),this.wrappedOnOpen()},t.prototype.callOnClose=function(t){ko(void 0!==this.wrappedOnClose,"Cannot call onClose because no callback was set"),this.wrappedOnClose(t)},t.prototype.callOnMessage=function(t){ko(void 0!==this.wrappedOnMessage,"Cannot call onMessage because no callback was set"),this.wrappedOnMessage(t)},t}(),ff="Connection",pf={BatchGetDocuments:"batchGet",Commit:"commit"},df="gl-js/ fire/"+Io,mf=function(){function t(t){this.databaseId=t.databaseId;var e=t.ssl?"https":"http";this.baseUrl=e+"://"+t.host,this.forceLongPolling=t.forceLongPolling}return t.prototype.modifyHeadersForRequest=function(t,e){if(e)for(var n in e.authHeaders)e.authHeaders.hasOwnProperty(n)&&(t[n]=e.authHeaders[n]);t["X-Goog-Api-Client"]=df},t.prototype.invokeRPC=function(t,e,n){var r=this,i=this.makeUrl(t);return new Promise(function(o,a){var s=new wo;s.listenOnce(vo.COMPLETE,function(){try{switch(s.getLastErrorCode()){case go.NO_ERROR:var e=s.getResponseJson();No(ff,"XHR received:",JSON.stringify(e)),o(e);break;case go.TIMEOUT:No(ff,'RPC "'+t+'" timed out'),a(new Po(Oo.DEADLINE_EXCEEDED,"Request time out"));break;case go.HTTP_ERROR:var n=s.getStatus();if(No(ff,'RPC "'+t+'" failed with status:',n,"response text:",s.getResponseText()),n>0){var r=s.getResponseJson().error;if(r&&r.status&&r.message){var i=(u=r.status,c=u.toLowerCase().replace("_","-"),Object.values(Oo).indexOf(c)>=0?c:Oo.UNKNOWN);a(new Po(i,r.message))}else a(new Po(Oo.UNKNOWN,"Server responded with status "+s.getStatus()))}else No(ff,'RPC "'+t+'" failed'),a(new Po(Oo.UNAVAILABLE,"Connection failed."));break;default:Do('RPC "'+t+'" failed with unanticipated webchannel error '+s.getLastErrorCode()+": "+s.getLastError()+", giving up.")}}finally{No(ff,'RPC "'+t+'" completed.')}var u,c});var u=JSON.stringify(e);No(ff,"XHR sending: ",i+" "+u);var c={"Content-Type":"text/plain"};r.modifyHeadersForRequest(c,n),s.send(i,"POST",u,c,15)})},t.prototype.invokeStreamingRPC=function(t,e,n){return this.invokeRPC(t,e,n)},t.prototype.openStream=function(t,e){var n=[this.baseUrl,"/","google.firestore.v1.Firestore","/",t,"/channel"],r=yo(),i={backgroundChannelTest:!0,httpSessionIdParam:"gsessionid",initMessageHeaders:{},messageUrlParams:{database:"projects/"+this.databaseId.projectId+"/databases/"+this.databaseId.database},sendRawJson:!0,supportsCrossDomainXhr:!0,internalChannelParams:{forwardChannelRequestTimeoutMs:6e5},forceLongPolling:this.forceLongPolling};this.modifyHeadersForRequest(i.initMessageHeaders,e),"object"==typeof navigator&&"ReactNative"===navigator.product||(i.httpHeadersOverwriteParam="$httpHeaders");var o=n.join("");No(ff,"Creating WebChannel: "+o+" "+i);var a=r.createWebChannel(o,i),s=!1,u=!1,c=new lf({sendFn:function(t){u?No(ff,"Not sending because WebChannel is closed:",t):(s||(No(ff,"Opening WebChannel transport."),a.open(),s=!0),No(ff,"WebChannel sending:",t),a.send(t))},closeFn:function(){return a.close()}}),h=function(t,e){a.listen(t,function(t){try{e(t)}catch(t){setTimeout(function(){throw t},0)}})};return h(bo.EventType.OPEN,function(){u||No(ff,"WebChannel transport opened.")}),h(bo.EventType.CLOSE,function(){u||(u=!0,No(ff,"WebChannel transport closed"),c.callOnClose())}),h(bo.EventType.ERROR,function(t){u||(u=!0,No(ff,"WebChannel transport errored:",t),c.callOnClose(new Po(Oo.UNAVAILABLE,"The operation could not be completed")))}),h(bo.EventType.MESSAGE,function(t){if(!u){var e=t.data[0];ko(!!e,"Got a webchannel message without data.");var n=e,r=n.error||n[0]&&n[0].error;if(r){No(ff,"WebChannel received error:",r);var i=r.status,o=function(t){var e=kc[t];if(void 0!==e)return Oc(e)}(i),s=r.message;void 0===o&&(o=Oo.INTERNAL,s="Unknown error status: "+i+" with message "+r.message),u=!0,c.callOnClose(new Po(o,s)),a.close()}else No(ff,"WebChannel received:",e),c.callOnMessage(e)}}),setTimeout(function(){c.callOnOpen()},0),c},t.prototype.makeUrl=function(t){var e=pf[t];ko(void 0!==e,"Unknown REST mapping for: "+t);var n=[this.baseUrl,"/","v1"];return n.push("/projects/"),n.push(this.databaseId.projectId),n.push("/databases/"),n.push(this.databaseId.database),n.push("/documents"),n.push(":"),n.push(e),n.join("")},t}(),yf=function(){function t(){this.emptyByteString="",this.base64Available="undefined"!=typeof atob}return Object.defineProperty(t.prototype,"document",{get:function(){return"undefined"!=typeof document?document:null},enumerable:!0,configurable:!0}),Object.defineProperty(t.prototype,"window",{get:function(){return"undefined"!=typeof window?window:null},enumerable:!0,configurable:!0}),t.prototype.loadConnection=function(t){return Promise.resolve(new mf(t))},t.prototype.newConnectivityMonitor=function(){return hf.isAvailable()?new hf:new cf},t.prototype.newSerializer=function(t){return new Nh(t,{useProto3Json:!0})},t.prototype.formatJSON=function(t){return JSON.stringify(t)},t.prototype.atob=function(t){return atob(t)},t.prototype.btoa=function(t){return btoa(t)},t}();_o.setPlatform(new yf),function(t){uf(t)}(ue);ue.initializeApp({apiKey:"AIzaSyDnoLNyrB4BKOkKHLomCEeQbtzMYxIAhAw",authDomain:"crwn-clothing-78d3c.firebaseapp.com",databaseURL:"https://crwn-clothing-78d3c.firebaseio.com",projectId:"crwn-clothing-78d3c",storageBucket:"crwn-clothing-78d3c.appspot.com",messagingSenderId:"918000947",appId:"1:918000947:web:7bf0a9b10714f805"});const gf=ue.auth(),vf=new ue.auth.GoogleAuthProvider;ue.firestore();function bf(t){return"function"==typeof t}var wf=!1,If={Promise:void 0,set useDeprecatedSynchronousErrorHandling(t){t&&(new Error).stack;wf=t},get useDeprecatedSynchronousErrorHandling(){return wf}};function Ef(t){setTimeout(function(){throw t},0)}var Tf={closed:!0,next:function(t){},error:function(t){if(If.useDeprecatedSynchronousErrorHandling)throw t;Ef(t)},complete:function(){}},Sf=function(){return Array.isArray||function(t){return t&&"number"==typeof t.length}}();var Nf=function(){function t(t){return Error.call(this),this.message=t?t.length+" errors occurred during unsubscription:\n"+t.map(function(t,e){return e+1+") "+t.toString()}).join("\n  "):"",this.name="UnsubscriptionError",this.errors=t,this}return t.prototype=Object.create(Error.prototype),t}(),Cf=function(){function t(t){this.closed=!1,this._parentOrParents=null,this._subscriptions=null,t&&(this._unsubscribe=t)}var e;return t.prototype.unsubscribe=function(){var e;if(!this.closed){var n,r=this._parentOrParents,i=this._unsubscribe,o=this._subscriptions;if(this.closed=!0,this._parentOrParents=null,this._subscriptions=null,r instanceof t)r.remove(this);else if(null!==r)for(var a=0;a<r.length;++a){r[a].remove(this)}if(bf(i))try{i.call(this)}catch(t){e=t instanceof Nf?Af(t.errors):[t]}if(Sf(o)){a=-1;for(var s=o.length;++a<s;){var u=o[a];if(null!==(n=u)&&"object"==typeof n)try{u.unsubscribe()}catch(t){e=e||[],t instanceof Nf?e=e.concat(Af(t.errors)):e.push(t)}}}if(e)throw new Nf(e)}},t.prototype.add=function(e){var n=e;if(!e)return t.EMPTY;switch(typeof e){case"function":n=new t(e);case"object":if(n===this||n.closed||"function"!=typeof n.unsubscribe)return n;if(this.closed)return n.unsubscribe(),n;if(!(n instanceof t)){var r=n;(n=new t)._subscriptions=[r]}break;default:throw new Error("unrecognized teardown "+e+" added to Subscription.")}var i=n._parentOrParents;if(null===i)n._parentOrParents=this;else if(i instanceof t){if(i===this)return n;n._parentOrParents=[i,this]}else{if(-1!==i.indexOf(this))return n;i.push(this)}var o=this._subscriptions;return null===o?this._subscriptions=[n]:o.push(n),n},t.prototype.remove=function(t){var e=this._subscriptions;if(e){var n=e.indexOf(t);-1!==n&&e.splice(n,1)}},t.EMPTY=((e=new t).closed=!0,e),t}();function Af(t){return t.reduce(function(t,e){return t.concat(e instanceof Nf?e.errors:e)},[])}var Df=function(){return"function"==typeof Symbol?Symbol("rxSubscriber"):"@@rxSubscriber_"+Math.random()}(),kf=function(t){function e(n,r,i){var o=t.call(this)||this;switch(o.syncErrorValue=null,o.syncErrorThrown=!1,o.syncErrorThrowable=!1,o.isStopped=!1,arguments.length){case 0:o.destination=Tf;break;case 1:if(!n){o.destination=Tf;break}if("object"==typeof n){n instanceof e?(o.syncErrorThrowable=n.syncErrorThrowable,o.destination=n,n.add(o)):(o.syncErrorThrowable=!0,o.destination=new _f(o,n));break}default:o.syncErrorThrowable=!0,o.destination=new _f(o,n,r,i)}return o}return Mt(e,t),e.prototype[Df]=function(){return this},e.create=function(t,n,r){var i=new e(t,n,r);return i.syncErrorThrowable=!1,i},e.prototype.next=function(t){this.isStopped||this._next(t)},e.prototype.error=function(t){this.isStopped||(this.isStopped=!0,this._error(t))},e.prototype.complete=function(){this.isStopped||(this.isStopped=!0,this._complete())},e.prototype.unsubscribe=function(){this.closed||(this.isStopped=!0,t.prototype.unsubscribe.call(this))},e.prototype._next=function(t){this.destination.next(t)},e.prototype._error=function(t){this.destination.error(t),this.unsubscribe()},e.prototype._complete=function(){this.destination.complete(),this.unsubscribe()},e.prototype._unsubscribeAndRecycle=function(){var t=this._parentOrParents;return this._parentOrParents=null,this.unsubscribe(),this.closed=!1,this.isStopped=!1,this._parentOrParents=t,this},e}(Cf),_f=function(t){function e(e,n,r,i){var o,a=t.call(this)||this;a._parentSubscriber=e;var s=a;return bf(n)?o=n:n&&(o=n.next,r=n.error,i=n.complete,n!==Tf&&(bf((s=Object.create(n)).unsubscribe)&&a.add(s.unsubscribe.bind(s)),s.unsubscribe=a.unsubscribe.bind(a))),a._context=s,a._next=o,a._error=r,a._complete=i,a}return Mt(e,t),e.prototype.next=function(t){if(!this.isStopped&&this._next){var e=this._parentSubscriber;If.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?this.__tryOrSetError(e,this._next,t)&&this.unsubscribe():this.__tryOrUnsub(this._next,t)}},e.prototype.error=function(t){if(!this.isStopped){var e=this._parentSubscriber,n=If.useDeprecatedSynchronousErrorHandling;if(this._error)n&&e.syncErrorThrowable?(this.__tryOrSetError(e,this._error,t),this.unsubscribe()):(this.__tryOrUnsub(this._error,t),this.unsubscribe());else if(e.syncErrorThrowable)n?(e.syncErrorValue=t,e.syncErrorThrown=!0):Ef(t),this.unsubscribe();else{if(this.unsubscribe(),n)throw t;Ef(t)}}},e.prototype.complete=function(){var t=this;if(!this.isStopped){var e=this._parentSubscriber;if(this._complete){var n=function(){return t._complete.call(t._context)};If.useDeprecatedSynchronousErrorHandling&&e.syncErrorThrowable?(this.__tryOrSetError(e,n),this.unsubscribe()):(this.__tryOrUnsub(n),this.unsubscribe())}else this.unsubscribe()}},e.prototype.__tryOrUnsub=function(t,e){try{t.call(this._context,e)}catch(t){if(this.unsubscribe(),If.useDeprecatedSynchronousErrorHandling)throw t;Ef(t)}},e.prototype.__tryOrSetError=function(t,e,n){if(!If.useDeprecatedSynchronousErrorHandling)throw new Error("bad call");try{e.call(this._context,n)}catch(e){return If.useDeprecatedSynchronousErrorHandling?(t.syncErrorValue=e,t.syncErrorThrown=!0,!0):(Ef(e),!0)}return!1},e.prototype._unsubscribe=function(){var t=this._parentSubscriber;this._context=null,this._parentSubscriber=null,t.unsubscribe()},e}(kf);var Rf=function(){return"function"==typeof Symbol&&Symbol.observable||"@@observable"}();function Of(){}var Pf=function(){function t(t){this._isScalar=!1,t&&(this._subscribe=t)}return t.prototype.lift=function(e){var n=new t;return n.source=this,n.operator=e,n},t.prototype.subscribe=function(t,e,n){var r=this.operator,i=function(t,e,n){if(t){if(t instanceof kf)return t;if(t[Df])return t[Df]()}return t||e||n?new kf(t,e,n):new kf(Tf)}(t,e,n);if(r?i.add(r.call(i,this.source)):i.add(this.source||If.useDeprecatedSynchronousErrorHandling&&!i.syncErrorThrowable?this._subscribe(i):this._trySubscribe(i)),If.useDeprecatedSynchronousErrorHandling&&i.syncErrorThrowable&&(i.syncErrorThrowable=!1,i.syncErrorThrown))throw i.syncErrorValue;return i},t.prototype._trySubscribe=function(t){try{return this._subscribe(t)}catch(e){If.useDeprecatedSynchronousErrorHandling&&(t.syncErrorThrown=!0,t.syncErrorValue=e),!function(t){for(;t;){var e=t,n=e.closed,r=e.destination,i=e.isStopped;if(n||i)return!1;t=r&&r instanceof kf?r:null}return!0}(t)?console.warn(e):t.error(e)}},t.prototype.forEach=function(t,e){var n=this;return new(e=Mf(e))(function(e,r){var i;i=n.subscribe(function(e){try{t(e)}catch(t){r(t),i&&i.unsubscribe()}},r,e)})},t.prototype._subscribe=function(t){var e=this.source;return e&&e.subscribe(t)},t.prototype[Rf]=function(){return this},t.prototype.pipe=function(){for(var t,e=[],n=0;n<arguments.length;n++)e[n]=arguments[n];return 0===e.length?this:((t=e)?1===t.length?t[0]:function(e){return t.reduce(function(t,e){return e(t)},e)}:Of)(this)},t.prototype.toPromise=function(t){var e=this;return new(t=Mf(t))(function(t,n){var r;e.subscribe(function(t){return r=t},function(t){return n(t)},function(){return t(r)})})},t.create=function(e){return new t(e)},t}();function Mf(t){if(t||(t=Promise),!t)throw new Error("no Promise impl found");return t}function Lf(t){var e,n,r=new H({props:{$$slots:{default:[qf]},$$scope:{ctx:t}}});return r.$on("click",jf),{c(){e=p("div"),r.$$.fragment.c(),g(e,"class","main2 svelte-202ri")},m(t,i){l(t,e,i),F(r,e,null),n=!0},p(t,e){var n={};t.$$scope&&(n.$$scope={changed:t,ctx:e}),r.$set(n)},i(t){n||(x(r.$$.fragment,t),n=!0)},o(t){q(r.$$.fragment,t),n=!1},d(t){t&&f(e),U(r)}}}function xf(t){var n,r,i,o,a,s,u,c,d,y=[t.user];let v={};for(var b=0;b<y.length;b+=1)v=e(v,y[b]);var w=new Ot({props:v}),I=new H({props:{$$slots:{default:[Ff]},$$scope:{ctx:t}}});I.$on("click",t.click_handler);var E=new H({props:{$$slots:{default:[Uf]},$$scope:{ctx:t}}});E.$on("click",t.click_handler_1);var T="add"===t.editMode&&Vf(t),S=new lt({props:{meetups:t.meetups}});return S.$on("togglefavorite",t.toggleFavorite),{c(){w.$$.fragment.c(),n=m(),I.$$.fragment.c(),r=m(),i=p("hr"),o=m(),a=p("main"),s=p("div"),E.$$.fragment.c(),u=m(),T&&T.c(),c=m(),S.$$.fragment.c(),g(s,"class","meetup-controls svelte-202ri"),g(a,"class","svelte-202ri")},m(t,e){F(w,t,e),l(t,n,e),F(I,t,e),l(t,r,e),l(t,i,e),l(t,o,e),l(t,a,e),h(a,s),F(E,s,null),h(a,u),T&&T.m(a,null),h(a,c),F(S,a,null),d=!0},p(t,e){var n,r=t.user?function(t,e){const n={},r={},i={$$scope:1};let o=t.length;for(;o--;){const a=t[o],s=e[o];if(s){for(const t in a)t in s||(r[t]=1);for(const t in s)i[t]||(n[t]=s[t],i[t]=1);t[o]=s}else for(const t in a)i[t]=1}for(const t in r)t in n||(n[t]=void 0);return n}(y,[(n=e.user,"object"==typeof n&&null!==n?n:{})]):{};w.$set(r);var i={};t.$$scope&&(i.$$scope={changed:t,ctx:e}),I.$set(i);var o={};t.$$scope&&(o.$$scope={changed:t,ctx:e}),E.$set(o),"add"===e.editMode?T?x(T,1):((T=Vf(e)).c(),x(T,1),T.m(a,c)):T&&(M(),q(T,1,1,()=>{T=null}),L());var s={};t.meetups&&(s.meetups=e.meetups),S.$set(s)},i(t){d||(x(w.$$.fragment,t),x(I.$$.fragment,t),x(E.$$.fragment,t),x(T),x(S.$$.fragment,t),d=!0)},o(t){q(w.$$.fragment,t),q(I.$$.fragment,t),q(E.$$.fragment,t),q(T),q(S.$$.fragment,t),d=!1},d(t){U(w,t),t&&f(n),U(I,t),t&&(f(r),f(i),f(o),f(a)),U(E),T&&T.d(),U(S)}}}function qf(t){var e;return{c(){e=d("Signin with Google")},m(t,n){l(t,e,n)},d(t){t&&f(e)}}}function Ff(t){var e;return{c(){e=d("Logout")},m(t,n){l(t,e,n)},d(t){t&&f(e)}}}function Uf(t){var e;return{c(){e=d("New Meetup")},m(t,n){l(t,e,n)},d(t){t&&f(e)}}}function Vf(t){var e,n=new kt({});return n.$on("save",t.addMeetup),n.$on("cancel",t.cancelEdit),{c(){n.$$.fragment.c()},m(t,r){F(n,t,r),e=!0},i(t){e||(x(n.$$.fragment,t),e=!0)},o(t){q(n.$$.fragment,t),e=!1},d(t){U(n,t)}}}function Bf(t){var e,n,r,i,o,a=new $({}),s=[xf,Lf],u=[];function c(t,e){return e.user?0:1}return r=c(0,t),i=u[r]=s[r](t),{c(){a.$$.fragment.c(),e=m(),n=p("section"),i.c()},m(t,i){F(a,t,i),l(t,e,i),l(t,n,i),u[r].m(n,null),o=!0},p(t,e){var o=r;(r=c(0,e))===o?u[r].p(t,e):(M(),q(u[o],1,1,()=>{u[o]=null}),L(),(i=u[r])||(i=u[r]=s[r](e)).c(),x(i,1),i.m(n,null))},i(t){o||(x(a.$$.fragment,t),x(i),o=!0)},o(t){q(a.$$.fragment,t),q(i),o=!1},d(t){U(a,t),t&&(f(e),f(n)),u[r].d()}}}function jf(){gf.signInWithPopup(vf)}function Kf(t,e,n){let r;(function(t){return new Pf(function(e){return{unsubscribe:t.onAuthStateChanged(e)}})})(gf).subscribe(t=>n("user",r=t));let i,o=[{id:"m1",title:"Coding Bootcamp",subtitle:"Learn to code in 2 hours",description:"In this meetup, we will have some experts that teach you how to code!",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/9/9a/Caffe_Nero_coffee_bar%2C_High_St%2C_Sutton%2C_Surrey%2C_Greater_London.JPG/800px-Caffe_Nero_coffee_bar%2C_High_St%2C_Sutton%2C_Surrey%2C_Greater_London.JPG",address:"27th Nerd Road, 32523 New York",contactEmail:"code@test.com",isFavorite:!1},{id:"m2",title:"Swim Together",subtitle:"Let's go for some swimming",description:"We will simply swim some rounds!",imageUrl:"https://upload.wikimedia.org/wikipedia/commons/thumb/6/69/Olympic_swimming_pool_%28Tbilisi%29.jpg/800px-Olympic_swimming_pool_%28Tbilisi%29.jpg",address:"27th Nerd Road, 32523 New York",contactEmail:"swim@test.com",isFavorite:!1}];return{user:r,meetups:o,editMode:i,addMeetup:function(t){const e={id:Math.random().toString(),title:t.detail.title,subtitle:t.detail.subtitle,description:t.detail.description,imageUrl:t.detail.imageUrl,contactEmail:t.detail.email,address:t.detail.address};n("meetups",o=[e,...o]),n("editMode",i=null)},cancelEdit:function(){n("editMode",i=null)},toggleFavorite:function(t){const e=t.detail,r={...o.find(t=>t.id===e)};r.isFavorite=!r.isFavorite;const i=o.findIndex(t=>t.id===e),a=[...o];a[i]=r,n("meetups",o=a)},click_handler:()=>gf.signOut(),click_handler_1:()=>n("editMode",i="add")}}return new class extends j{constructor(t){super(),B(this,t,Kf,Bf,a,[])}}({target:document.body})}();
//# sourceMappingURL=bundle.js.map
